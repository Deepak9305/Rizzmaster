var X0=Object.defineProperty;var Z0=(t,e,r)=>e in t?X0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var xi=(t,e,r)=>Z0(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();var mh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ew(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Lp={exports:{}},ka={},jp={exports:{}},Y={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ds=Symbol.for("react.element"),tw=Symbol.for("react.portal"),rw=Symbol.for("react.fragment"),nw=Symbol.for("react.strict_mode"),iw=Symbol.for("react.profiler"),sw=Symbol.for("react.provider"),ow=Symbol.for("react.context"),aw=Symbol.for("react.forward_ref"),lw=Symbol.for("react.suspense"),cw=Symbol.for("react.memo"),uw=Symbol.for("react.lazy"),gh=Symbol.iterator;function dw(t){return t===null||typeof t!="object"?null:(t=gh&&t[gh]||t["@@iterator"],typeof t=="function"?t:null)}var Up={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$p=Object.assign,Mp={};function hi(t,e,r){this.props=t,this.context=e,this.refs=Mp,this.updater=r||Up}hi.prototype.isReactComponent={};hi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};hi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Bp(){}Bp.prototype=hi.prototype;function Iu(t,e,r){this.props=t,this.context=e,this.refs=Mp,this.updater=r||Up}var Pu=Iu.prototype=new Bp;Pu.constructor=Iu;$p(Pu,hi.prototype);Pu.isPureReactComponent=!0;var yh=Array.isArray,Fp=Object.prototype.hasOwnProperty,Au={current:null},zp={key:!0,ref:!0,__self:!0,__source:!0};function Vp(t,e,r){var n,i={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Fp.call(e,n)&&!zp.hasOwnProperty(n)&&(i[n]=e[n]);var a=arguments.length-2;if(a===1)i.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(n in a=t.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return{$$typeof:Ds,type:t,key:s,ref:o,props:i,_owner:Au.current}}function hw(t,e){return{$$typeof:Ds,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ou(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ds}function fw(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var wh=/\/+/g;function fl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?fw(""+t.key):e.toString(36)}function Ao(t,e,r,n,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ds:case tw:o=!0}}if(o)return o=t,i=i(o),t=n===""?"."+fl(o,0):n,yh(i)?(r="",t!=null&&(r=t.replace(wh,"$&/")+"/"),Ao(i,e,r,"",function(c){return c})):i!=null&&(Ou(i)&&(i=hw(i,r+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(wh,"$&/")+"/")+t)),e.push(i)),1;if(o=0,n=n===""?".":n+":",yh(t))for(var a=0;a<t.length;a++){s=t[a];var l=n+fl(s,a);o+=Ao(s,e,r,l,i)}else if(l=dw(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=n+fl(s,a++),o+=Ao(s,e,r,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Js(t,e,r){if(t==null)return t;var n=[],i=0;return Ao(t,n,"","",function(s){return e.call(r,s,i++)}),n}function pw(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Qe={current:null},Oo={transition:null},mw={ReactCurrentDispatcher:Qe,ReactCurrentBatchConfig:Oo,ReactCurrentOwner:Au};function Wp(){throw Error("act(...) is not supported in production builds of React.")}Y.Children={map:Js,forEach:function(t,e,r){Js(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return Js(t,function(){e++}),e},toArray:function(t){return Js(t,function(e){return e})||[]},only:function(t){if(!Ou(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Y.Component=hi;Y.Fragment=rw;Y.Profiler=iw;Y.PureComponent=Iu;Y.StrictMode=nw;Y.Suspense=lw;Y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mw;Y.act=Wp;Y.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=$p({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Au.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)Fp.call(e,l)&&!zp.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];n.children=a}return{$$typeof:Ds,type:t.type,key:i,ref:s,props:n,_owner:o}};Y.createContext=function(t){return t={$$typeof:ow,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:sw,_context:t},t.Consumer=t};Y.createElement=Vp;Y.createFactory=function(t){var e=Vp.bind(null,t);return e.type=t,e};Y.createRef=function(){return{current:null}};Y.forwardRef=function(t){return{$$typeof:aw,render:t}};Y.isValidElement=Ou;Y.lazy=function(t){return{$$typeof:uw,_payload:{_status:-1,_result:t},_init:pw}};Y.memo=function(t,e){return{$$typeof:cw,type:t,compare:e===void 0?null:e}};Y.startTransition=function(t){var e=Oo.transition;Oo.transition={};try{t()}finally{Oo.transition=e}};Y.unstable_act=Wp;Y.useCallback=function(t,e){return Qe.current.useCallback(t,e)};Y.useContext=function(t){return Qe.current.useContext(t)};Y.useDebugValue=function(){};Y.useDeferredValue=function(t){return Qe.current.useDeferredValue(t)};Y.useEffect=function(t,e){return Qe.current.useEffect(t,e)};Y.useId=function(){return Qe.current.useId()};Y.useImperativeHandle=function(t,e,r){return Qe.current.useImperativeHandle(t,e,r)};Y.useInsertionEffect=function(t,e){return Qe.current.useInsertionEffect(t,e)};Y.useLayoutEffect=function(t,e){return Qe.current.useLayoutEffect(t,e)};Y.useMemo=function(t,e){return Qe.current.useMemo(t,e)};Y.useReducer=function(t,e,r){return Qe.current.useReducer(t,e,r)};Y.useRef=function(t){return Qe.current.useRef(t)};Y.useState=function(t){return Qe.current.useState(t)};Y.useSyncExternalStore=function(t,e,r){return Qe.current.useSyncExternalStore(t,e,r)};Y.useTransition=function(){return Qe.current.useTransition()};Y.version="18.3.1";jp.exports=Y;var O=jp.exports;const Hp=ew(O);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gw=O,yw=Symbol.for("react.element"),ww=Symbol.for("react.fragment"),vw=Object.prototype.hasOwnProperty,_w=gw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bw={key:!0,ref:!0,__self:!0,__source:!0};function Gp(t,e,r){var n,i={},s=null,o=null;r!==void 0&&(s=""+r),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)vw.call(e,n)&&!bw.hasOwnProperty(n)&&(i[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:yw,type:t,key:s,ref:o,props:i,_owner:_w.current}}ka.Fragment=ww;ka.jsx=Gp;ka.jsxs=Gp;Lp.exports=ka;var b=Lp.exports,lc={},Kp={exports:{}},mt={},Jp={exports:{}},qp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(C,H){var L=C.length;C.push(H);e:for(;0<L;){var J=L-1>>>1,Z=C[J];if(0<i(Z,H))C[J]=H,C[L]=Z,L=J;else break e}}function r(C){return C.length===0?null:C[0]}function n(C){if(C.length===0)return null;var H=C[0],L=C.pop();if(L!==H){C[0]=L;e:for(var J=0,Z=C.length,De=Z>>>1;J<De;){var oe=2*(J+1)-1,se=C[oe],Ze=oe+1,yt=C[Ze];if(0>i(se,L))Ze<Z&&0>i(yt,se)?(C[J]=yt,C[Ze]=L,J=Ze):(C[J]=se,C[oe]=L,J=oe);else if(Ze<Z&&0>i(yt,L))C[J]=yt,C[Ze]=L,J=Ze;else break e}}return H}function i(C,H){var L=C.sortIndex-H.sortIndex;return L!==0?L:C.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,m=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(C){for(var H=r(c);H!==null;){if(H.callback===null)n(c);else if(H.startTime<=C)n(c),H.sortIndex=H.expirationTime,e(l,H);else break;H=r(c)}}function _(C){if(y=!1,g(C),!m)if(r(l)!==null)m=!0,pr(S);else{var H=r(c);H!==null&&Xt(_,H.startTime-C)}}function S(C,H){m=!1,y&&(y=!1,w(T),T=-1),f=!0;var L=h;try{for(g(H),d=r(l);d!==null&&(!(d.expirationTime>H)||C&&!M());){var J=d.callback;if(typeof J=="function"){d.callback=null,h=d.priorityLevel;var Z=J(d.expirationTime<=H);H=t.unstable_now(),typeof Z=="function"?d.callback=Z:d===r(l)&&n(l),g(H)}else n(l);d=r(l)}if(d!==null)var De=!0;else{var oe=r(c);oe!==null&&Xt(_,oe.startTime-H),De=!1}return De}finally{d=null,h=L,f=!1}}var R=!1,x=null,T=-1,I=5,N=-1;function M(){return!(t.unstable_now()-N<I)}function B(){if(x!==null){var C=t.unstable_now();N=C;var H=!0;try{H=x(!0,C)}finally{H?Se():(R=!1,x=null)}}else R=!1}var Se;if(typeof p=="function")Se=function(){p(B)};else if(typeof MessageChannel<"u"){var kt=new MessageChannel,ze=kt.port2;kt.port1.onmessage=B,Se=function(){ze.postMessage(null)}}else Se=function(){v(B,0)};function pr(C){x=C,R||(R=!0,Se())}function Xt(C,H){T=v(function(){C(t.unstable_now())},H)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(C){C.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,pr(S))},t.unstable_forceFrameRate=function(C){0>C||125<C?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<C?Math.floor(1e3/C):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(C){switch(h){case 1:case 2:case 3:var H=3;break;default:H=h}var L=h;h=H;try{return C()}finally{h=L}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(C,H){switch(C){case 1:case 2:case 3:case 4:case 5:break;default:C=3}var L=h;h=C;try{return H()}finally{h=L}},t.unstable_scheduleCallback=function(C,H,L){var J=t.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?J+L:J):L=J,C){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=L+Z,C={id:u++,callback:H,priorityLevel:C,startTime:L,expirationTime:Z,sortIndex:-1},L>J?(C.sortIndex=L,e(c,C),r(l)===null&&C===r(c)&&(y?(w(T),T=-1):y=!0,Xt(_,L-J))):(C.sortIndex=Z,e(l,C),m||f||(m=!0,pr(S))),C},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(C){var H=h;return function(){var L=h;h=H;try{return C.apply(this,arguments)}finally{h=L}}}})(qp);Jp.exports=qp;var Sw=Jp.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ew=O,pt=Sw;function P(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Yp=new Set,ls={};function hn(t,e){ii(t,e),ii(t+"Capture",e)}function ii(t,e){for(ls[t]=e,t=0;t<e.length;t++)Yp.add(e[t])}var lr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cc=Object.prototype.hasOwnProperty,Rw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,vh={},_h={};function xw(t){return cc.call(_h,t)?!0:cc.call(vh,t)?!1:Rw.test(t)?_h[t]=!0:(vh[t]=!0,!1)}function Tw(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function kw(t,e,r,n){if(e===null||typeof e>"u"||Tw(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xe(t,e,r,n,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Be={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Be[t]=new Xe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Be[e]=new Xe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Be[t]=new Xe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Be[t]=new Xe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Be[t]=new Xe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Be[t]=new Xe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Be[t]=new Xe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Be[t]=new Xe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Be[t]=new Xe(t,5,!1,t.toLowerCase(),null,!1,!1)});var Nu=/[\-:]([a-z])/g;function Cu(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Nu,Cu);Be[e]=new Xe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Nu,Cu);Be[e]=new Xe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Nu,Cu);Be[e]=new Xe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Be[t]=new Xe(t,1,!1,t.toLowerCase(),null,!1,!1)});Be.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Be[t]=new Xe(t,1,!1,t.toLowerCase(),null,!0,!0)});function Du(t,e,r,n){var i=Be.hasOwnProperty(e)?Be[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(kw(e,r,i,n)&&(r=null),n||i===null?xw(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):i.mustUseProperty?t[i.propertyName]=r===null?i.type===3?!1:"":r:(e=i.attributeName,n=i.attributeNamespace,r===null?t.removeAttribute(e):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var hr=Ew.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,qs=Symbol.for("react.element"),Nn=Symbol.for("react.portal"),Cn=Symbol.for("react.fragment"),Lu=Symbol.for("react.strict_mode"),uc=Symbol.for("react.profiler"),Qp=Symbol.for("react.provider"),Xp=Symbol.for("react.context"),ju=Symbol.for("react.forward_ref"),dc=Symbol.for("react.suspense"),hc=Symbol.for("react.suspense_list"),Uu=Symbol.for("react.memo"),vr=Symbol.for("react.lazy"),Zp=Symbol.for("react.offscreen"),bh=Symbol.iterator;function Ti(t){return t===null||typeof t!="object"?null:(t=bh&&t[bh]||t["@@iterator"],typeof t=="function"?t:null)}var me=Object.assign,pl;function Ui(t){if(pl===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);pl=e&&e[1]||""}return`
`+pl+t}var ml=!1;function gl(t,e){if(!t||ml)return"";ml=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var n=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){n=c}t.call(e.prototype)}else{try{throw Error()}catch(c){n=c}t()}}catch(c){if(c&&n&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=n.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{ml=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Ui(t):""}function Iw(t){switch(t.tag){case 5:return Ui(t.type);case 16:return Ui("Lazy");case 13:return Ui("Suspense");case 19:return Ui("SuspenseList");case 0:case 2:case 15:return t=gl(t.type,!1),t;case 11:return t=gl(t.type.render,!1),t;case 1:return t=gl(t.type,!0),t;default:return""}}function fc(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Cn:return"Fragment";case Nn:return"Portal";case uc:return"Profiler";case Lu:return"StrictMode";case dc:return"Suspense";case hc:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Xp:return(t.displayName||"Context")+".Consumer";case Qp:return(t._context.displayName||"Context")+".Provider";case ju:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Uu:return e=t.displayName||null,e!==null?e:fc(t.type)||"Memo";case vr:e=t._payload,t=t._init;try{return fc(t(e))}catch{}}return null}function Pw(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fc(e);case 8:return e===Lu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function jr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function em(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Aw(t){var e=em(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ys(t){t._valueTracker||(t._valueTracker=Aw(t))}function tm(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=em(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function qo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function pc(t,e){var r=e.checked;return me({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function Sh(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=jr(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function rm(t,e){e=e.checked,e!=null&&Du(t,"checked",e,!1)}function mc(t,e){rm(t,e);var r=jr(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?gc(t,e.type,r):e.hasOwnProperty("defaultValue")&&gc(t,e.type,jr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Eh(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function gc(t,e,r){(e!=="number"||qo(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var $i=Array.isArray;function Kn(t,e,r,n){if(t=t.options,e){e={};for(var i=0;i<r.length;i++)e["$"+r[i]]=!0;for(r=0;r<t.length;r++)i=e.hasOwnProperty("$"+t[r].value),t[r].selected!==i&&(t[r].selected=i),i&&n&&(t[r].defaultSelected=!0)}else{for(r=""+jr(r),e=null,i=0;i<t.length;i++){if(t[i].value===r){t[i].selected=!0,n&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function yc(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(P(91));return me({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Rh(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(P(92));if($i(r)){if(1<r.length)throw Error(P(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:jr(r)}}function nm(t,e){var r=jr(e.value),n=jr(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function xh(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function im(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wc(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?im(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Qs,sm=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,i){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Qs=Qs||document.createElement("div"),Qs.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Qs.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function cs(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var Ji={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ow=["Webkit","ms","Moz","O"];Object.keys(Ji).forEach(function(t){Ow.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ji[e]=Ji[t]})});function om(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||Ji.hasOwnProperty(t)&&Ji[t]?(""+e).trim():e+"px"}function am(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=om(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,i):t[r]=i}}var Nw=me({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vc(t,e){if(e){if(Nw[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(P(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(P(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(P(61))}if(e.style!=null&&typeof e.style!="object")throw Error(P(62))}}function _c(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bc=null;function $u(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Sc=null,Jn=null,qn=null;function Th(t){if(t=Us(t)){if(typeof Sc!="function")throw Error(P(280));var e=t.stateNode;e&&(e=Na(e),Sc(t.stateNode,t.type,e))}}function lm(t){Jn?qn?qn.push(t):qn=[t]:Jn=t}function cm(){if(Jn){var t=Jn,e=qn;if(qn=Jn=null,Th(t),e)for(t=0;t<e.length;t++)Th(e[t])}}function um(t,e){return t(e)}function dm(){}var yl=!1;function hm(t,e,r){if(yl)return t(e,r);yl=!0;try{return um(t,e,r)}finally{yl=!1,(Jn!==null||qn!==null)&&(dm(),cm())}}function us(t,e){var r=t.stateNode;if(r===null)return null;var n=Na(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(P(231,e,typeof r));return r}var Ec=!1;if(lr)try{var ki={};Object.defineProperty(ki,"passive",{get:function(){Ec=!0}}),window.addEventListener("test",ki,ki),window.removeEventListener("test",ki,ki)}catch{Ec=!1}function Cw(t,e,r,n,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(r,c)}catch(u){this.onError(u)}}var qi=!1,Yo=null,Qo=!1,Rc=null,Dw={onError:function(t){qi=!0,Yo=t}};function Lw(t,e,r,n,i,s,o,a,l){qi=!1,Yo=null,Cw.apply(Dw,arguments)}function jw(t,e,r,n,i,s,o,a,l){if(Lw.apply(this,arguments),qi){if(qi){var c=Yo;qi=!1,Yo=null}else throw Error(P(198));Qo||(Qo=!0,Rc=c)}}function fn(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function fm(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function kh(t){if(fn(t)!==t)throw Error(P(188))}function Uw(t){var e=t.alternate;if(!e){if(e=fn(t),e===null)throw Error(P(188));return e!==t?null:t}for(var r=t,n=e;;){var i=r.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===r)return kh(i),t;if(s===n)return kh(i),e;s=s.sibling}throw Error(P(188))}if(r.return!==n.return)r=i,n=s;else{for(var o=!1,a=i.child;a;){if(a===r){o=!0,r=i,n=s;break}if(a===n){o=!0,n=i,r=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===r){o=!0,r=s,n=i;break}if(a===n){o=!0,n=s,r=i;break}a=a.sibling}if(!o)throw Error(P(189))}}if(r.alternate!==n)throw Error(P(190))}if(r.tag!==3)throw Error(P(188));return r.stateNode.current===r?t:e}function pm(t){return t=Uw(t),t!==null?mm(t):null}function mm(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=mm(t);if(e!==null)return e;t=t.sibling}return null}var gm=pt.unstable_scheduleCallback,Ih=pt.unstable_cancelCallback,$w=pt.unstable_shouldYield,Mw=pt.unstable_requestPaint,ve=pt.unstable_now,Bw=pt.unstable_getCurrentPriorityLevel,Mu=pt.unstable_ImmediatePriority,ym=pt.unstable_UserBlockingPriority,Xo=pt.unstable_NormalPriority,Fw=pt.unstable_LowPriority,wm=pt.unstable_IdlePriority,Ia=null,Yt=null;function zw(t){if(Yt&&typeof Yt.onCommitFiberRoot=="function")try{Yt.onCommitFiberRoot(Ia,t,void 0,(t.current.flags&128)===128)}catch{}}var Mt=Math.clz32?Math.clz32:Hw,Vw=Math.log,Ww=Math.LN2;function Hw(t){return t>>>=0,t===0?32:31-(Vw(t)/Ww|0)|0}var Xs=64,Zs=4194304;function Mi(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Zo(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,i=t.suspendedLanes,s=t.pingedLanes,o=r&268435455;if(o!==0){var a=o&~i;a!==0?n=Mi(a):(s&=o,s!==0&&(n=Mi(s)))}else o=r&~i,o!==0?n=Mi(o):s!==0&&(n=Mi(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(n&4&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-Mt(e),i=1<<r,n|=t[r],e&=~i;return n}function Gw(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Kw(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Mt(s),a=1<<o,l=i[o];l===-1?(!(a&r)||a&n)&&(i[o]=Gw(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function xc(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function vm(){var t=Xs;return Xs<<=1,!(Xs&4194240)&&(Xs=64),t}function wl(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function Ls(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Mt(e),t[e]=r}function Jw(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var i=31-Mt(r),s=1<<i;e[i]=0,n[i]=-1,t[i]=-1,r&=~s}}function Bu(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-Mt(r),i=1<<n;i&e|t[n]&e&&(t[n]|=e),r&=~i}}var ne=0;function _m(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var bm,Fu,Sm,Em,Rm,Tc=!1,eo=[],kr=null,Ir=null,Pr=null,ds=new Map,hs=new Map,Sr=[],qw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ph(t,e){switch(t){case"focusin":case"focusout":kr=null;break;case"dragenter":case"dragleave":Ir=null;break;case"mouseover":case"mouseout":Pr=null;break;case"pointerover":case"pointerout":ds.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":hs.delete(e.pointerId)}}function Ii(t,e,r,n,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Us(e),e!==null&&Fu(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function Yw(t,e,r,n,i){switch(e){case"focusin":return kr=Ii(kr,t,e,r,n,i),!0;case"dragenter":return Ir=Ii(Ir,t,e,r,n,i),!0;case"mouseover":return Pr=Ii(Pr,t,e,r,n,i),!0;case"pointerover":var s=i.pointerId;return ds.set(s,Ii(ds.get(s)||null,t,e,r,n,i)),!0;case"gotpointercapture":return s=i.pointerId,hs.set(s,Ii(hs.get(s)||null,t,e,r,n,i)),!0}return!1}function xm(t){var e=Xr(t.target);if(e!==null){var r=fn(e);if(r!==null){if(e=r.tag,e===13){if(e=fm(r),e!==null){t.blockedOn=e,Rm(t.priority,function(){Sm(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function No(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=kc(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);bc=n,r.target.dispatchEvent(n),bc=null}else return e=Us(r),e!==null&&Fu(e),t.blockedOn=r,!1;e.shift()}return!0}function Ah(t,e,r){No(t)&&r.delete(e)}function Qw(){Tc=!1,kr!==null&&No(kr)&&(kr=null),Ir!==null&&No(Ir)&&(Ir=null),Pr!==null&&No(Pr)&&(Pr=null),ds.forEach(Ah),hs.forEach(Ah)}function Pi(t,e){t.blockedOn===e&&(t.blockedOn=null,Tc||(Tc=!0,pt.unstable_scheduleCallback(pt.unstable_NormalPriority,Qw)))}function fs(t){function e(i){return Pi(i,t)}if(0<eo.length){Pi(eo[0],t);for(var r=1;r<eo.length;r++){var n=eo[r];n.blockedOn===t&&(n.blockedOn=null)}}for(kr!==null&&Pi(kr,t),Ir!==null&&Pi(Ir,t),Pr!==null&&Pi(Pr,t),ds.forEach(e),hs.forEach(e),r=0;r<Sr.length;r++)n=Sr[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<Sr.length&&(r=Sr[0],r.blockedOn===null);)xm(r),r.blockedOn===null&&Sr.shift()}var Yn=hr.ReactCurrentBatchConfig,ea=!0;function Xw(t,e,r,n){var i=ne,s=Yn.transition;Yn.transition=null;try{ne=1,zu(t,e,r,n)}finally{ne=i,Yn.transition=s}}function Zw(t,e,r,n){var i=ne,s=Yn.transition;Yn.transition=null;try{ne=4,zu(t,e,r,n)}finally{ne=i,Yn.transition=s}}function zu(t,e,r,n){if(ea){var i=kc(t,e,r,n);if(i===null)Il(t,e,n,ta,r),Ph(t,n);else if(Yw(i,t,e,r,n))n.stopPropagation();else if(Ph(t,n),e&4&&-1<qw.indexOf(t)){for(;i!==null;){var s=Us(i);if(s!==null&&bm(s),s=kc(t,e,r,n),s===null&&Il(t,e,n,ta,r),s===i)break;i=s}i!==null&&n.stopPropagation()}else Il(t,e,n,null,r)}}var ta=null;function kc(t,e,r,n){if(ta=null,t=$u(n),t=Xr(t),t!==null)if(e=fn(t),e===null)t=null;else if(r=e.tag,r===13){if(t=fm(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ta=t,null}function Tm(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Bw()){case Mu:return 1;case ym:return 4;case Xo:case Fw:return 16;case wm:return 536870912;default:return 16}default:return 16}}var xr=null,Vu=null,Co=null;function km(){if(Co)return Co;var t,e=Vu,r=e.length,n,i="value"in xr?xr.value:xr.textContent,s=i.length;for(t=0;t<r&&e[t]===i[t];t++);var o=r-t;for(n=1;n<=o&&e[r-n]===i[s-n];n++);return Co=i.slice(t,1<n?1-n:void 0)}function Do(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function to(){return!0}function Oh(){return!1}function gt(t){function e(r,n,i,s,o){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?to:Oh,this.isPropagationStopped=Oh,this}return me(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=to)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=to)},persist:function(){},isPersistent:to}),e}var fi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wu=gt(fi),js=me({},fi,{view:0,detail:0}),ev=gt(js),vl,_l,Ai,Pa=me({},js,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hu,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ai&&(Ai&&t.type==="mousemove"?(vl=t.screenX-Ai.screenX,_l=t.screenY-Ai.screenY):_l=vl=0,Ai=t),vl)},movementY:function(t){return"movementY"in t?t.movementY:_l}}),Nh=gt(Pa),tv=me({},Pa,{dataTransfer:0}),rv=gt(tv),nv=me({},js,{relatedTarget:0}),bl=gt(nv),iv=me({},fi,{animationName:0,elapsedTime:0,pseudoElement:0}),sv=gt(iv),ov=me({},fi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),av=gt(ov),lv=me({},fi,{data:0}),Ch=gt(lv),cv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hv(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=dv[t])?!!e[t]:!1}function Hu(){return hv}var fv=me({},js,{key:function(t){if(t.key){var e=cv[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Do(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?uv[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hu,charCode:function(t){return t.type==="keypress"?Do(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Do(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),pv=gt(fv),mv=me({},Pa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Dh=gt(mv),gv=me({},js,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hu}),yv=gt(gv),wv=me({},fi,{propertyName:0,elapsedTime:0,pseudoElement:0}),vv=gt(wv),_v=me({},Pa,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),bv=gt(_v),Sv=[9,13,27,32],Gu=lr&&"CompositionEvent"in window,Yi=null;lr&&"documentMode"in document&&(Yi=document.documentMode);var Ev=lr&&"TextEvent"in window&&!Yi,Im=lr&&(!Gu||Yi&&8<Yi&&11>=Yi),Lh=" ",jh=!1;function Pm(t,e){switch(t){case"keyup":return Sv.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Am(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Dn=!1;function Rv(t,e){switch(t){case"compositionend":return Am(e);case"keypress":return e.which!==32?null:(jh=!0,Lh);case"textInput":return t=e.data,t===Lh&&jh?null:t;default:return null}}function xv(t,e){if(Dn)return t==="compositionend"||!Gu&&Pm(t,e)?(t=km(),Co=Vu=xr=null,Dn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Im&&e.locale!=="ko"?null:e.data;default:return null}}var Tv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Uh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Tv[t.type]:e==="textarea"}function Om(t,e,r,n){lm(n),e=ra(e,"onChange"),0<e.length&&(r=new Wu("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var Qi=null,ps=null;function kv(t){zm(t,0)}function Aa(t){var e=Un(t);if(tm(e))return t}function Iv(t,e){if(t==="change")return e}var Nm=!1;if(lr){var Sl;if(lr){var El="oninput"in document;if(!El){var $h=document.createElement("div");$h.setAttribute("oninput","return;"),El=typeof $h.oninput=="function"}Sl=El}else Sl=!1;Nm=Sl&&(!document.documentMode||9<document.documentMode)}function Mh(){Qi&&(Qi.detachEvent("onpropertychange",Cm),ps=Qi=null)}function Cm(t){if(t.propertyName==="value"&&Aa(ps)){var e=[];Om(e,ps,t,$u(t)),hm(kv,e)}}function Pv(t,e,r){t==="focusin"?(Mh(),Qi=e,ps=r,Qi.attachEvent("onpropertychange",Cm)):t==="focusout"&&Mh()}function Av(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Aa(ps)}function Ov(t,e){if(t==="click")return Aa(e)}function Nv(t,e){if(t==="input"||t==="change")return Aa(e)}function Cv(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ft=typeof Object.is=="function"?Object.is:Cv;function ms(t,e){if(Ft(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!cc.call(e,i)||!Ft(t[i],e[i]))return!1}return!0}function Bh(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Fh(t,e){var r=Bh(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Bh(r)}}function Dm(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Dm(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Lm(){for(var t=window,e=qo();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=qo(t.document)}return e}function Ku(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Dv(t){var e=Lm(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&Dm(r.ownerDocument.documentElement,r)){if(n!==null&&Ku(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=r.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!t.extend&&s>n&&(i=n,n=s,s=i),i=Fh(r,s);var o=Fh(r,n);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>n?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Lv=lr&&"documentMode"in document&&11>=document.documentMode,Ln=null,Ic=null,Xi=null,Pc=!1;function zh(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Pc||Ln==null||Ln!==qo(n)||(n=Ln,"selectionStart"in n&&Ku(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Xi&&ms(Xi,n)||(Xi=n,n=ra(Ic,"onSelect"),0<n.length&&(e=new Wu("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=Ln)))}function ro(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var jn={animationend:ro("Animation","AnimationEnd"),animationiteration:ro("Animation","AnimationIteration"),animationstart:ro("Animation","AnimationStart"),transitionend:ro("Transition","TransitionEnd")},Rl={},jm={};lr&&(jm=document.createElement("div").style,"AnimationEvent"in window||(delete jn.animationend.animation,delete jn.animationiteration.animation,delete jn.animationstart.animation),"TransitionEvent"in window||delete jn.transitionend.transition);function Oa(t){if(Rl[t])return Rl[t];if(!jn[t])return t;var e=jn[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in jm)return Rl[t]=e[r];return t}var Um=Oa("animationend"),$m=Oa("animationiteration"),Mm=Oa("animationstart"),Bm=Oa("transitionend"),Fm=new Map,Vh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $r(t,e){Fm.set(t,e),hn(e,[t])}for(var xl=0;xl<Vh.length;xl++){var Tl=Vh[xl],jv=Tl.toLowerCase(),Uv=Tl[0].toUpperCase()+Tl.slice(1);$r(jv,"on"+Uv)}$r(Um,"onAnimationEnd");$r($m,"onAnimationIteration");$r(Mm,"onAnimationStart");$r("dblclick","onDoubleClick");$r("focusin","onFocus");$r("focusout","onBlur");$r(Bm,"onTransitionEnd");ii("onMouseEnter",["mouseout","mouseover"]);ii("onMouseLeave",["mouseout","mouseover"]);ii("onPointerEnter",["pointerout","pointerover"]);ii("onPointerLeave",["pointerout","pointerover"]);hn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hn("onBeforeInput",["compositionend","keypress","textInput","paste"]);hn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$v=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bi));function Wh(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,jw(n,e,void 0,t),t.currentTarget=null}function zm(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],i=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Wh(i,a,c),s=l}else for(o=0;o<n.length;o++){if(a=n[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Wh(i,a,c),s=l}}}if(Qo)throw t=Rc,Qo=!1,Rc=null,t}function ce(t,e){var r=e[Dc];r===void 0&&(r=e[Dc]=new Set);var n=t+"__bubble";r.has(n)||(Vm(e,t,2,!1),r.add(n))}function kl(t,e,r){var n=0;e&&(n|=4),Vm(r,t,n,e)}var no="_reactListening"+Math.random().toString(36).slice(2);function gs(t){if(!t[no]){t[no]=!0,Yp.forEach(function(r){r!=="selectionchange"&&($v.has(r)||kl(r,!1,t),kl(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[no]||(e[no]=!0,kl("selectionchange",!1,e))}}function Vm(t,e,r,n){switch(Tm(e)){case 1:var i=Xw;break;case 4:i=Zw;break;default:i=zu}r=i.bind(null,e,r,t),i=void 0,!Ec||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?t.addEventListener(e,r,{capture:!0,passive:i}):t.addEventListener(e,r,!0):i!==void 0?t.addEventListener(e,r,{passive:i}):t.addEventListener(e,r,!1)}function Il(t,e,r,n,i){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Xr(a),o===null)return;if(l=o.tag,l===5||l===6){n=s=o;continue e}a=a.parentNode}}n=n.return}hm(function(){var c=s,u=$u(r),d=[];e:{var h=Fm.get(t);if(h!==void 0){var f=Wu,m=t;switch(t){case"keypress":if(Do(r)===0)break e;case"keydown":case"keyup":f=pv;break;case"focusin":m="focus",f=bl;break;case"focusout":m="blur",f=bl;break;case"beforeblur":case"afterblur":f=bl;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Nh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=rv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=yv;break;case Um:case $m:case Mm:f=sv;break;case Bm:f=vv;break;case"scroll":f=ev;break;case"wheel":f=bv;break;case"copy":case"cut":case"paste":f=av;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Dh}var y=(e&4)!==0,v=!y&&t==="scroll",w=y?h!==null?h+"Capture":null:h;y=[];for(var p=c,g;p!==null;){g=p;var _=g.stateNode;if(g.tag===5&&_!==null&&(g=_,w!==null&&(_=us(p,w),_!=null&&y.push(ys(p,_,g)))),v)break;p=p.return}0<y.length&&(h=new f(h,m,null,r,u),d.push({event:h,listeners:y}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&r!==bc&&(m=r.relatedTarget||r.fromElement)&&(Xr(m)||m[cr]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(m=r.relatedTarget||r.toElement,f=c,m=m?Xr(m):null,m!==null&&(v=fn(m),m!==v||m.tag!==5&&m.tag!==6)&&(m=null)):(f=null,m=c),f!==m)){if(y=Nh,_="onMouseLeave",w="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(y=Dh,_="onPointerLeave",w="onPointerEnter",p="pointer"),v=f==null?h:Un(f),g=m==null?h:Un(m),h=new y(_,p+"leave",f,r,u),h.target=v,h.relatedTarget=g,_=null,Xr(u)===c&&(y=new y(w,p+"enter",m,r,u),y.target=g,y.relatedTarget=v,_=y),v=_,f&&m)t:{for(y=f,w=m,p=0,g=y;g;g=gn(g))p++;for(g=0,_=w;_;_=gn(_))g++;for(;0<p-g;)y=gn(y),p--;for(;0<g-p;)w=gn(w),g--;for(;p--;){if(y===w||w!==null&&y===w.alternate)break t;y=gn(y),w=gn(w)}y=null}else y=null;f!==null&&Hh(d,h,f,y,!1),m!==null&&v!==null&&Hh(d,v,m,y,!0)}}e:{if(h=c?Un(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var S=Iv;else if(Uh(h))if(Nm)S=Nv;else{S=Av;var R=Pv}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(S=Ov);if(S&&(S=S(t,c))){Om(d,S,r,u);break e}R&&R(t,h,c),t==="focusout"&&(R=h._wrapperState)&&R.controlled&&h.type==="number"&&gc(h,"number",h.value)}switch(R=c?Un(c):window,t){case"focusin":(Uh(R)||R.contentEditable==="true")&&(Ln=R,Ic=c,Xi=null);break;case"focusout":Xi=Ic=Ln=null;break;case"mousedown":Pc=!0;break;case"contextmenu":case"mouseup":case"dragend":Pc=!1,zh(d,r,u);break;case"selectionchange":if(Lv)break;case"keydown":case"keyup":zh(d,r,u)}var x;if(Gu)e:{switch(t){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Dn?Pm(t,r)&&(T="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(T="onCompositionStart");T&&(Im&&r.locale!=="ko"&&(Dn||T!=="onCompositionStart"?T==="onCompositionEnd"&&Dn&&(x=km()):(xr=u,Vu="value"in xr?xr.value:xr.textContent,Dn=!0)),R=ra(c,T),0<R.length&&(T=new Ch(T,t,null,r,u),d.push({event:T,listeners:R}),x?T.data=x:(x=Am(r),x!==null&&(T.data=x)))),(x=Ev?Rv(t,r):xv(t,r))&&(c=ra(c,"onBeforeInput"),0<c.length&&(u=new Ch("onBeforeInput","beforeinput",null,r,u),d.push({event:u,listeners:c}),u.data=x))}zm(d,e)})}function ys(t,e,r){return{instance:t,listener:e,currentTarget:r}}function ra(t,e){for(var r=e+"Capture",n=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=us(t,r),s!=null&&n.unshift(ys(t,s,i)),s=us(t,e),s!=null&&n.push(ys(t,s,i))),t=t.return}return n}function gn(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Hh(t,e,r,n,i){for(var s=e._reactName,o=[];r!==null&&r!==n;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&c!==null&&(a=c,i?(l=us(r,s),l!=null&&o.unshift(ys(r,l,a))):i||(l=us(r,s),l!=null&&o.push(ys(r,l,a)))),r=r.return}o.length!==0&&t.push({event:e,listeners:o})}var Mv=/\r\n?/g,Bv=/\u0000|\uFFFD/g;function Gh(t){return(typeof t=="string"?t:""+t).replace(Mv,`
`).replace(Bv,"")}function io(t,e,r){if(e=Gh(e),Gh(t)!==e&&r)throw Error(P(425))}function na(){}var Ac=null,Oc=null;function Nc(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Cc=typeof setTimeout=="function"?setTimeout:void 0,Fv=typeof clearTimeout=="function"?clearTimeout:void 0,Kh=typeof Promise=="function"?Promise:void 0,zv=typeof queueMicrotask=="function"?queueMicrotask:typeof Kh<"u"?function(t){return Kh.resolve(null).then(t).catch(Vv)}:Cc;function Vv(t){setTimeout(function(){throw t})}function Pl(t,e){var r=e,n=0;do{var i=r.nextSibling;if(t.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){t.removeChild(i),fs(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);fs(e)}function Ar(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Jh(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var pi=Math.random().toString(36).slice(2),Jt="__reactFiber$"+pi,ws="__reactProps$"+pi,cr="__reactContainer$"+pi,Dc="__reactEvents$"+pi,Wv="__reactListeners$"+pi,Hv="__reactHandles$"+pi;function Xr(t){var e=t[Jt];if(e)return e;for(var r=t.parentNode;r;){if(e=r[cr]||r[Jt]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=Jh(t);t!==null;){if(r=t[Jt])return r;t=Jh(t)}return e}t=r,r=t.parentNode}return null}function Us(t){return t=t[Jt]||t[cr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Un(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(P(33))}function Na(t){return t[ws]||null}var Lc=[],$n=-1;function Mr(t){return{current:t}}function ue(t){0>$n||(t.current=Lc[$n],Lc[$n]=null,$n--)}function le(t,e){$n++,Lc[$n]=t.current,t.current=e}var Ur={},Je=Mr(Ur),nt=Mr(!1),on=Ur;function si(t,e){var r=t.type.contextTypes;if(!r)return Ur;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in r)i[s]=e[s];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function it(t){return t=t.childContextTypes,t!=null}function ia(){ue(nt),ue(Je)}function qh(t,e,r){if(Je.current!==Ur)throw Error(P(168));le(Je,e),le(nt,r)}function Wm(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(P(108,Pw(t)||"Unknown",i));return me({},r,n)}function sa(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ur,on=Je.current,le(Je,t),le(nt,nt.current),!0}function Yh(t,e,r){var n=t.stateNode;if(!n)throw Error(P(169));r?(t=Wm(t,e,on),n.__reactInternalMemoizedMergedChildContext=t,ue(nt),ue(Je),le(Je,t)):ue(nt),le(nt,r)}var ir=null,Ca=!1,Al=!1;function Hm(t){ir===null?ir=[t]:ir.push(t)}function Gv(t){Ca=!0,Hm(t)}function Br(){if(!Al&&ir!==null){Al=!0;var t=0,e=ne;try{var r=ir;for(ne=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}ir=null,Ca=!1}catch(i){throw ir!==null&&(ir=ir.slice(t+1)),gm(Mu,Br),i}finally{ne=e,Al=!1}}return null}var Mn=[],Bn=0,oa=null,aa=0,_t=[],bt=0,an=null,sr=1,or="";function Gr(t,e){Mn[Bn++]=aa,Mn[Bn++]=oa,oa=t,aa=e}function Gm(t,e,r){_t[bt++]=sr,_t[bt++]=or,_t[bt++]=an,an=t;var n=sr;t=or;var i=32-Mt(n)-1;n&=~(1<<i),r+=1;var s=32-Mt(e)+i;if(30<s){var o=i-i%5;s=(n&(1<<o)-1).toString(32),n>>=o,i-=o,sr=1<<32-Mt(e)+i|r<<i|n,or=s+t}else sr=1<<s|r<<i|n,or=t}function Ju(t){t.return!==null&&(Gr(t,1),Gm(t,1,0))}function qu(t){for(;t===oa;)oa=Mn[--Bn],Mn[Bn]=null,aa=Mn[--Bn],Mn[Bn]=null;for(;t===an;)an=_t[--bt],_t[bt]=null,or=_t[--bt],_t[bt]=null,sr=_t[--bt],_t[bt]=null}var ft=null,ht=null,de=!1,Ut=null;function Km(t,e){var r=St(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function Qh(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ft=t,ht=Ar(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ft=t,ht=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=an!==null?{id:sr,overflow:or}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=St(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,ft=t,ht=null,!0):!1;default:return!1}}function jc(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Uc(t){if(de){var e=ht;if(e){var r=e;if(!Qh(t,e)){if(jc(t))throw Error(P(418));e=Ar(r.nextSibling);var n=ft;e&&Qh(t,e)?Km(n,r):(t.flags=t.flags&-4097|2,de=!1,ft=t)}}else{if(jc(t))throw Error(P(418));t.flags=t.flags&-4097|2,de=!1,ft=t}}}function Xh(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ft=t}function so(t){if(t!==ft)return!1;if(!de)return Xh(t),de=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Nc(t.type,t.memoizedProps)),e&&(e=ht)){if(jc(t))throw Jm(),Error(P(418));for(;e;)Km(t,e),e=Ar(e.nextSibling)}if(Xh(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(P(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){ht=Ar(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}ht=null}}else ht=ft?Ar(t.stateNode.nextSibling):null;return!0}function Jm(){for(var t=ht;t;)t=Ar(t.nextSibling)}function oi(){ht=ft=null,de=!1}function Yu(t){Ut===null?Ut=[t]:Ut.push(t)}var Kv=hr.ReactCurrentBatchConfig;function Oi(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(P(309));var n=r.stateNode}if(!n)throw Error(P(147,t));var i=n,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(P(284));if(!r._owner)throw Error(P(290,t))}return t}function oo(t,e){throw t=Object.prototype.toString.call(e),Error(P(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Zh(t){var e=t._init;return e(t._payload)}function qm(t){function e(w,p){if(t){var g=w.deletions;g===null?(w.deletions=[p],w.flags|=16):g.push(p)}}function r(w,p){if(!t)return null;for(;p!==null;)e(w,p),p=p.sibling;return null}function n(w,p){for(w=new Map;p!==null;)p.key!==null?w.set(p.key,p):w.set(p.index,p),p=p.sibling;return w}function i(w,p){return w=Dr(w,p),w.index=0,w.sibling=null,w}function s(w,p,g){return w.index=g,t?(g=w.alternate,g!==null?(g=g.index,g<p?(w.flags|=2,p):g):(w.flags|=2,p)):(w.flags|=1048576,p)}function o(w){return t&&w.alternate===null&&(w.flags|=2),w}function a(w,p,g,_){return p===null||p.tag!==6?(p=Ul(g,w.mode,_),p.return=w,p):(p=i(p,g),p.return=w,p)}function l(w,p,g,_){var S=g.type;return S===Cn?u(w,p,g.props.children,_,g.key):p!==null&&(p.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===vr&&Zh(S)===p.type)?(_=i(p,g.props),_.ref=Oi(w,p,g),_.return=w,_):(_=Fo(g.type,g.key,g.props,null,w.mode,_),_.ref=Oi(w,p,g),_.return=w,_)}function c(w,p,g,_){return p===null||p.tag!==4||p.stateNode.containerInfo!==g.containerInfo||p.stateNode.implementation!==g.implementation?(p=$l(g,w.mode,_),p.return=w,p):(p=i(p,g.children||[]),p.return=w,p)}function u(w,p,g,_,S){return p===null||p.tag!==7?(p=sn(g,w.mode,_,S),p.return=w,p):(p=i(p,g),p.return=w,p)}function d(w,p,g){if(typeof p=="string"&&p!==""||typeof p=="number")return p=Ul(""+p,w.mode,g),p.return=w,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case qs:return g=Fo(p.type,p.key,p.props,null,w.mode,g),g.ref=Oi(w,null,p),g.return=w,g;case Nn:return p=$l(p,w.mode,g),p.return=w,p;case vr:var _=p._init;return d(w,_(p._payload),g)}if($i(p)||Ti(p))return p=sn(p,w.mode,g,null),p.return=w,p;oo(w,p)}return null}function h(w,p,g,_){var S=p!==null?p.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return S!==null?null:a(w,p,""+g,_);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case qs:return g.key===S?l(w,p,g,_):null;case Nn:return g.key===S?c(w,p,g,_):null;case vr:return S=g._init,h(w,p,S(g._payload),_)}if($i(g)||Ti(g))return S!==null?null:u(w,p,g,_,null);oo(w,g)}return null}function f(w,p,g,_,S){if(typeof _=="string"&&_!==""||typeof _=="number")return w=w.get(g)||null,a(p,w,""+_,S);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case qs:return w=w.get(_.key===null?g:_.key)||null,l(p,w,_,S);case Nn:return w=w.get(_.key===null?g:_.key)||null,c(p,w,_,S);case vr:var R=_._init;return f(w,p,g,R(_._payload),S)}if($i(_)||Ti(_))return w=w.get(g)||null,u(p,w,_,S,null);oo(p,_)}return null}function m(w,p,g,_){for(var S=null,R=null,x=p,T=p=0,I=null;x!==null&&T<g.length;T++){x.index>T?(I=x,x=null):I=x.sibling;var N=h(w,x,g[T],_);if(N===null){x===null&&(x=I);break}t&&x&&N.alternate===null&&e(w,x),p=s(N,p,T),R===null?S=N:R.sibling=N,R=N,x=I}if(T===g.length)return r(w,x),de&&Gr(w,T),S;if(x===null){for(;T<g.length;T++)x=d(w,g[T],_),x!==null&&(p=s(x,p,T),R===null?S=x:R.sibling=x,R=x);return de&&Gr(w,T),S}for(x=n(w,x);T<g.length;T++)I=f(x,w,T,g[T],_),I!==null&&(t&&I.alternate!==null&&x.delete(I.key===null?T:I.key),p=s(I,p,T),R===null?S=I:R.sibling=I,R=I);return t&&x.forEach(function(M){return e(w,M)}),de&&Gr(w,T),S}function y(w,p,g,_){var S=Ti(g);if(typeof S!="function")throw Error(P(150));if(g=S.call(g),g==null)throw Error(P(151));for(var R=S=null,x=p,T=p=0,I=null,N=g.next();x!==null&&!N.done;T++,N=g.next()){x.index>T?(I=x,x=null):I=x.sibling;var M=h(w,x,N.value,_);if(M===null){x===null&&(x=I);break}t&&x&&M.alternate===null&&e(w,x),p=s(M,p,T),R===null?S=M:R.sibling=M,R=M,x=I}if(N.done)return r(w,x),de&&Gr(w,T),S;if(x===null){for(;!N.done;T++,N=g.next())N=d(w,N.value,_),N!==null&&(p=s(N,p,T),R===null?S=N:R.sibling=N,R=N);return de&&Gr(w,T),S}for(x=n(w,x);!N.done;T++,N=g.next())N=f(x,w,T,N.value,_),N!==null&&(t&&N.alternate!==null&&x.delete(N.key===null?T:N.key),p=s(N,p,T),R===null?S=N:R.sibling=N,R=N);return t&&x.forEach(function(B){return e(w,B)}),de&&Gr(w,T),S}function v(w,p,g,_){if(typeof g=="object"&&g!==null&&g.type===Cn&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case qs:e:{for(var S=g.key,R=p;R!==null;){if(R.key===S){if(S=g.type,S===Cn){if(R.tag===7){r(w,R.sibling),p=i(R,g.props.children),p.return=w,w=p;break e}}else if(R.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===vr&&Zh(S)===R.type){r(w,R.sibling),p=i(R,g.props),p.ref=Oi(w,R,g),p.return=w,w=p;break e}r(w,R);break}else e(w,R);R=R.sibling}g.type===Cn?(p=sn(g.props.children,w.mode,_,g.key),p.return=w,w=p):(_=Fo(g.type,g.key,g.props,null,w.mode,_),_.ref=Oi(w,p,g),_.return=w,w=_)}return o(w);case Nn:e:{for(R=g.key;p!==null;){if(p.key===R)if(p.tag===4&&p.stateNode.containerInfo===g.containerInfo&&p.stateNode.implementation===g.implementation){r(w,p.sibling),p=i(p,g.children||[]),p.return=w,w=p;break e}else{r(w,p);break}else e(w,p);p=p.sibling}p=$l(g,w.mode,_),p.return=w,w=p}return o(w);case vr:return R=g._init,v(w,p,R(g._payload),_)}if($i(g))return m(w,p,g,_);if(Ti(g))return y(w,p,g,_);oo(w,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,p!==null&&p.tag===6?(r(w,p.sibling),p=i(p,g),p.return=w,w=p):(r(w,p),p=Ul(g,w.mode,_),p.return=w,w=p),o(w)):r(w,p)}return v}var ai=qm(!0),Ym=qm(!1),la=Mr(null),ca=null,Fn=null,Qu=null;function Xu(){Qu=Fn=ca=null}function Zu(t){var e=la.current;ue(la),t._currentValue=e}function $c(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function Qn(t,e){ca=t,Qu=Fn=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(rt=!0),t.firstContext=null)}function xt(t){var e=t._currentValue;if(Qu!==t)if(t={context:t,memoizedValue:e,next:null},Fn===null){if(ca===null)throw Error(P(308));Fn=t,ca.dependencies={lanes:0,firstContext:t}}else Fn=Fn.next=t;return e}var Zr=null;function ed(t){Zr===null?Zr=[t]:Zr.push(t)}function Qm(t,e,r,n){var i=e.interleaved;return i===null?(r.next=r,ed(e)):(r.next=i.next,i.next=r),e.interleaved=r,ur(t,n)}function ur(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var _r=!1;function td(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Xm(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ar(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Or(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,ee&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,ur(t,r)}return i=n.interleaved,i===null?(e.next=e,ed(n)):(e.next=i.next,i.next=e),n.interleaved=e,ur(t,r)}function Lo(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,Bu(t,r)}}function ef(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?i=s=o:s=s.next=o,r=r.next}while(r!==null);s===null?i=s=e:s=s.next=e}else i=s=e;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function ua(t,e,r,n){var i=t.updateQueue;_r=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,f=a.eventTime;if((n&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,y=a;switch(h=e,f=r,y.tag){case 1:if(m=y.payload,typeof m=="function"){d=m.call(f,d,h);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,h=typeof m=="function"?m.call(f,d,h):m,h==null)break e;d=me({},d,h);break e;case 2:_r=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(u===null&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);cn|=o,t.lanes=o,t.memoizedState=d}}function tf(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(P(191,i));i.call(n)}}}var $s={},Qt=Mr($s),vs=Mr($s),_s=Mr($s);function en(t){if(t===$s)throw Error(P(174));return t}function rd(t,e){switch(le(_s,e),le(vs,t),le(Qt,$s),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:wc(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=wc(e,t)}ue(Qt),le(Qt,e)}function li(){ue(Qt),ue(vs),ue(_s)}function Zm(t){en(_s.current);var e=en(Qt.current),r=wc(e,t.type);e!==r&&(le(vs,t),le(Qt,r))}function nd(t){vs.current===t&&(ue(Qt),ue(vs))}var fe=Mr(0);function da(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ol=[];function id(){for(var t=0;t<Ol.length;t++)Ol[t]._workInProgressVersionPrimary=null;Ol.length=0}var jo=hr.ReactCurrentDispatcher,Nl=hr.ReactCurrentBatchConfig,ln=0,pe=null,ke=null,Ne=null,ha=!1,Zi=!1,bs=0,Jv=0;function Ve(){throw Error(P(321))}function sd(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Ft(t[r],e[r]))return!1;return!0}function od(t,e,r,n,i,s){if(ln=s,pe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,jo.current=t===null||t.memoizedState===null?Xv:Zv,t=r(n,i),Zi){s=0;do{if(Zi=!1,bs=0,25<=s)throw Error(P(301));s+=1,Ne=ke=null,e.updateQueue=null,jo.current=e_,t=r(n,i)}while(Zi)}if(jo.current=fa,e=ke!==null&&ke.next!==null,ln=0,Ne=ke=pe=null,ha=!1,e)throw Error(P(300));return t}function ad(){var t=bs!==0;return bs=0,t}function Ht(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ne===null?pe.memoizedState=Ne=t:Ne=Ne.next=t,Ne}function Tt(){if(ke===null){var t=pe.alternate;t=t!==null?t.memoizedState:null}else t=ke.next;var e=Ne===null?pe.memoizedState:Ne.next;if(e!==null)Ne=e,ke=t;else{if(t===null)throw Error(P(310));ke=t,t={memoizedState:ke.memoizedState,baseState:ke.baseState,baseQueue:ke.baseQueue,queue:ke.queue,next:null},Ne===null?pe.memoizedState=Ne=t:Ne=Ne.next=t}return Ne}function Ss(t,e){return typeof e=="function"?e(t):e}function Cl(t){var e=Tt(),r=e.queue;if(r===null)throw Error(P(311));r.lastRenderedReducer=t;var n=ke,i=n.baseQueue,s=r.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}n.baseQueue=i=s,r.pending=null}if(i!==null){s=i.next,n=n.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((ln&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),n=c.hasEagerState?c.eagerState:t(n,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=n):l=l.next=d,pe.lanes|=u,cn|=u}c=c.next}while(c!==null&&c!==s);l===null?o=n:l.next=a,Ft(n,e.memoizedState)||(rt=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=l,r.lastRenderedState=n}if(t=r.interleaved,t!==null){i=t;do s=i.lane,pe.lanes|=s,cn|=s,i=i.next;while(i!==t)}else i===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function Dl(t){var e=Tt(),r=e.queue;if(r===null)throw Error(P(311));r.lastRenderedReducer=t;var n=r.dispatch,i=r.pending,s=e.memoizedState;if(i!==null){r.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Ft(s,e.memoizedState)||(rt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),r.lastRenderedState=s}return[s,n]}function eg(){}function tg(t,e){var r=pe,n=Tt(),i=e(),s=!Ft(n.memoizedState,i);if(s&&(n.memoizedState=i,rt=!0),n=n.queue,ld(ig.bind(null,r,n,t),[t]),n.getSnapshot!==e||s||Ne!==null&&Ne.memoizedState.tag&1){if(r.flags|=2048,Es(9,ng.bind(null,r,n,i,e),void 0,null),Ce===null)throw Error(P(349));ln&30||rg(r,e,i)}return i}function rg(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=pe.updateQueue,e===null?(e={lastEffect:null,stores:null},pe.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function ng(t,e,r,n){e.value=r,e.getSnapshot=n,sg(e)&&og(t)}function ig(t,e,r){return r(function(){sg(e)&&og(t)})}function sg(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Ft(t,r)}catch{return!0}}function og(t){var e=ur(t,1);e!==null&&Bt(e,t,1,-1)}function rf(t){var e=Ht();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ss,lastRenderedState:t},e.queue=t,t=t.dispatch=Qv.bind(null,pe,t),[e.memoizedState,t]}function Es(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=pe.updateQueue,e===null?(e={lastEffect:null,stores:null},pe.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function ag(){return Tt().memoizedState}function Uo(t,e,r,n){var i=Ht();pe.flags|=t,i.memoizedState=Es(1|e,r,void 0,n===void 0?null:n)}function Da(t,e,r,n){var i=Tt();n=n===void 0?null:n;var s=void 0;if(ke!==null){var o=ke.memoizedState;if(s=o.destroy,n!==null&&sd(n,o.deps)){i.memoizedState=Es(e,r,s,n);return}}pe.flags|=t,i.memoizedState=Es(1|e,r,s,n)}function nf(t,e){return Uo(8390656,8,t,e)}function ld(t,e){return Da(2048,8,t,e)}function lg(t,e){return Da(4,2,t,e)}function cg(t,e){return Da(4,4,t,e)}function ug(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function dg(t,e,r){return r=r!=null?r.concat([t]):null,Da(4,4,ug.bind(null,e,t),r)}function cd(){}function hg(t,e){var r=Tt();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&sd(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function fg(t,e){var r=Tt();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&sd(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function pg(t,e,r){return ln&21?(Ft(r,e)||(r=vm(),pe.lanes|=r,cn|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,rt=!0),t.memoizedState=r)}function qv(t,e){var r=ne;ne=r!==0&&4>r?r:4,t(!0);var n=Nl.transition;Nl.transition={};try{t(!1),e()}finally{ne=r,Nl.transition=n}}function mg(){return Tt().memoizedState}function Yv(t,e,r){var n=Cr(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},gg(t))yg(e,r);else if(r=Qm(t,e,r,n),r!==null){var i=Ye();Bt(r,t,n,i),wg(r,e,n)}}function Qv(t,e,r){var n=Cr(t),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(gg(t))yg(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,r);if(i.hasEagerState=!0,i.eagerState=a,Ft(a,o)){var l=e.interleaved;l===null?(i.next=i,ed(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}r=Qm(t,e,i,n),r!==null&&(i=Ye(),Bt(r,t,n,i),wg(r,e,n))}}function gg(t){var e=t.alternate;return t===pe||e!==null&&e===pe}function yg(t,e){Zi=ha=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function wg(t,e,r){if(r&4194240){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,Bu(t,r)}}var fa={readContext:xt,useCallback:Ve,useContext:Ve,useEffect:Ve,useImperativeHandle:Ve,useInsertionEffect:Ve,useLayoutEffect:Ve,useMemo:Ve,useReducer:Ve,useRef:Ve,useState:Ve,useDebugValue:Ve,useDeferredValue:Ve,useTransition:Ve,useMutableSource:Ve,useSyncExternalStore:Ve,useId:Ve,unstable_isNewReconciler:!1},Xv={readContext:xt,useCallback:function(t,e){return Ht().memoizedState=[t,e===void 0?null:e],t},useContext:xt,useEffect:nf,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,Uo(4194308,4,ug.bind(null,e,t),r)},useLayoutEffect:function(t,e){return Uo(4194308,4,t,e)},useInsertionEffect:function(t,e){return Uo(4,2,t,e)},useMemo:function(t,e){var r=Ht();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=Ht();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=Yv.bind(null,pe,t),[n.memoizedState,t]},useRef:function(t){var e=Ht();return t={current:t},e.memoizedState=t},useState:rf,useDebugValue:cd,useDeferredValue:function(t){return Ht().memoizedState=t},useTransition:function(){var t=rf(!1),e=t[0];return t=qv.bind(null,t[1]),Ht().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=pe,i=Ht();if(de){if(r===void 0)throw Error(P(407));r=r()}else{if(r=e(),Ce===null)throw Error(P(349));ln&30||rg(n,e,r)}i.memoizedState=r;var s={value:r,getSnapshot:e};return i.queue=s,nf(ig.bind(null,n,s,t),[t]),n.flags|=2048,Es(9,ng.bind(null,n,s,r,e),void 0,null),r},useId:function(){var t=Ht(),e=Ce.identifierPrefix;if(de){var r=or,n=sr;r=(n&~(1<<32-Mt(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=bs++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=Jv++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Zv={readContext:xt,useCallback:hg,useContext:xt,useEffect:ld,useImperativeHandle:dg,useInsertionEffect:lg,useLayoutEffect:cg,useMemo:fg,useReducer:Cl,useRef:ag,useState:function(){return Cl(Ss)},useDebugValue:cd,useDeferredValue:function(t){var e=Tt();return pg(e,ke.memoizedState,t)},useTransition:function(){var t=Cl(Ss)[0],e=Tt().memoizedState;return[t,e]},useMutableSource:eg,useSyncExternalStore:tg,useId:mg,unstable_isNewReconciler:!1},e_={readContext:xt,useCallback:hg,useContext:xt,useEffect:ld,useImperativeHandle:dg,useInsertionEffect:lg,useLayoutEffect:cg,useMemo:fg,useReducer:Dl,useRef:ag,useState:function(){return Dl(Ss)},useDebugValue:cd,useDeferredValue:function(t){var e=Tt();return ke===null?e.memoizedState=t:pg(e,ke.memoizedState,t)},useTransition:function(){var t=Dl(Ss)[0],e=Tt().memoizedState;return[t,e]},useMutableSource:eg,useSyncExternalStore:tg,useId:mg,unstable_isNewReconciler:!1};function Nt(t,e){if(t&&t.defaultProps){e=me({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function Mc(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:me({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var La={isMounted:function(t){return(t=t._reactInternals)?fn(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=Ye(),i=Cr(t),s=ar(n,i);s.payload=e,r!=null&&(s.callback=r),e=Or(t,s,i),e!==null&&(Bt(e,t,i,n),Lo(e,t,i))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=Ye(),i=Cr(t),s=ar(n,i);s.tag=1,s.payload=e,r!=null&&(s.callback=r),e=Or(t,s,i),e!==null&&(Bt(e,t,i,n),Lo(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=Ye(),n=Cr(t),i=ar(r,n);i.tag=2,e!=null&&(i.callback=e),e=Or(t,i,n),e!==null&&(Bt(e,t,n,r),Lo(e,t,n))}};function sf(t,e,r,n,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!ms(r,n)||!ms(i,s):!0}function vg(t,e,r){var n=!1,i=Ur,s=e.contextType;return typeof s=="object"&&s!==null?s=xt(s):(i=it(e)?on:Je.current,n=e.contextTypes,s=(n=n!=null)?si(t,i):Ur),e=new e(r,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=La,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function of(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&La.enqueueReplaceState(e,e.state,null)}function Bc(t,e,r,n){var i=t.stateNode;i.props=r,i.state=t.memoizedState,i.refs={},td(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=xt(s):(s=it(e)?on:Je.current,i.context=si(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Mc(t,e,s,r),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&La.enqueueReplaceState(i,i.state,null),ua(t,r,i,n),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function ci(t,e){try{var r="",n=e;do r+=Iw(n),n=n.return;while(n);var i=r}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Ll(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function Fc(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var t_=typeof WeakMap=="function"?WeakMap:Map;function _g(t,e,r){r=ar(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){ma||(ma=!0,Qc=n),Fc(t,e)},r}function bg(t,e,r){r=ar(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;r.payload=function(){return n(i)},r.callback=function(){Fc(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){Fc(t,e),typeof n!="function"&&(Nr===null?Nr=new Set([this]):Nr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),r}function af(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new t_;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(r)||(i.add(r),t=m_.bind(null,t,e,r),e.then(t,t))}function lf(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function cf(t,e,r,n,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=ar(-1,1),e.tag=2,Or(r,e,1))),r.lanes|=1),t)}var r_=hr.ReactCurrentOwner,rt=!1;function qe(t,e,r,n){e.child=t===null?Ym(e,null,r,n):ai(e,t.child,r,n)}function uf(t,e,r,n,i){r=r.render;var s=e.ref;return Qn(e,i),n=od(t,e,r,n,s,i),r=ad(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,dr(t,e,i)):(de&&r&&Ju(e),e.flags|=1,qe(t,e,n,i),e.child)}function df(t,e,r,n,i){if(t===null){var s=r.type;return typeof s=="function"&&!yd(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=s,Sg(t,e,s,n,i)):(t=Fo(r.type,null,n,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(r=r.compare,r=r!==null?r:ms,r(o,n)&&t.ref===e.ref)return dr(t,e,i)}return e.flags|=1,t=Dr(s,n),t.ref=e.ref,t.return=e,e.child=t}function Sg(t,e,r,n,i){if(t!==null){var s=t.memoizedProps;if(ms(s,n)&&t.ref===e.ref)if(rt=!1,e.pendingProps=n=s,(t.lanes&i)!==0)t.flags&131072&&(rt=!0);else return e.lanes=t.lanes,dr(t,e,i)}return zc(t,e,r,n,i)}function Eg(t,e,r){var n=e.pendingProps,i=n.children,s=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},le(Vn,ut),ut|=r;else{if(!(r&1073741824))return t=s!==null?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,le(Vn,ut),ut|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:r,le(Vn,ut),ut|=n}else s!==null?(n=s.baseLanes|r,e.memoizedState=null):n=r,le(Vn,ut),ut|=n;return qe(t,e,i,r),e.child}function Rg(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function zc(t,e,r,n,i){var s=it(r)?on:Je.current;return s=si(e,s),Qn(e,i),r=od(t,e,r,n,s,i),n=ad(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,dr(t,e,i)):(de&&n&&Ju(e),e.flags|=1,qe(t,e,r,i),e.child)}function hf(t,e,r,n,i){if(it(r)){var s=!0;sa(e)}else s=!1;if(Qn(e,i),e.stateNode===null)$o(t,e),vg(e,r,n),Bc(e,r,n,i),n=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=xt(c):(c=it(r)?on:Je.current,c=si(e,c));var u=r.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||l!==c)&&of(e,o,n,c),_r=!1;var h=e.memoizedState;o.state=h,ua(e,n,o,i),l=e.memoizedState,a!==n||h!==l||nt.current||_r?(typeof u=="function"&&(Mc(e,r,u,n),l=e.memoizedState),(a=_r||sf(e,r,a,n,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),o.props=n,o.state=l,o.context=c,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,Xm(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Nt(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=xt(l):(l=it(r)?on:Je.current,l=si(e,l));var f=r.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&of(e,o,n,l),_r=!1,h=e.memoizedState,o.state=h,ua(e,n,o,i);var m=e.memoizedState;a!==d||h!==m||nt.current||_r?(typeof f=="function"&&(Mc(e,r,f,n),m=e.memoizedState),(c=_r||sf(e,r,c,n,h,m,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=m),o.props=n,o.state=m,o.context=l,n=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),n=!1)}return Vc(t,e,r,n,s,i)}function Vc(t,e,r,n,i,s){Rg(t,e);var o=(e.flags&128)!==0;if(!n&&!o)return i&&Yh(e,r,!1),dr(t,e,s);n=e.stateNode,r_.current=e;var a=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&o?(e.child=ai(e,t.child,null,s),e.child=ai(e,null,a,s)):qe(t,e,a,s),e.memoizedState=n.state,i&&Yh(e,r,!0),e.child}function xg(t){var e=t.stateNode;e.pendingContext?qh(t,e.pendingContext,e.pendingContext!==e.context):e.context&&qh(t,e.context,!1),rd(t,e.containerInfo)}function ff(t,e,r,n,i){return oi(),Yu(i),e.flags|=256,qe(t,e,r,n),e.child}var Wc={dehydrated:null,treeContext:null,retryLane:0};function Hc(t){return{baseLanes:t,cachePool:null,transitions:null}}function Tg(t,e,r){var n=e.pendingProps,i=fe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),le(fe,i&1),t===null)return Uc(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,t=n.fallback,s?(n=e.mode,s=e.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=$a(o,n,0,null),t=sn(t,n,r,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Hc(r),e.memoizedState=Wc,t):ud(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return n_(t,e,o,n,a,i,r);if(s){s=n.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:n.children};return!(o&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=Dr(i,l),n.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Dr(a,s):(s=sn(s,o,r,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=t.child.memoizedState,o=o===null?Hc(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~r,e.memoizedState=Wc,n}return s=t.child,t=s.sibling,n=Dr(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function ud(t,e){return e=$a({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ao(t,e,r,n){return n!==null&&Yu(n),ai(e,t.child,null,r),t=ud(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function n_(t,e,r,n,i,s,o){if(r)return e.flags&256?(e.flags&=-257,n=Ll(Error(P(422))),ao(t,e,o,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=n.fallback,i=e.mode,n=$a({mode:"visible",children:n.children},i,0,null),s=sn(s,i,o,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&ai(e,t.child,null,o),e.child.memoizedState=Hc(o),e.memoizedState=Wc,s);if(!(e.mode&1))return ao(t,e,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(P(419)),n=Ll(s,n,void 0),ao(t,e,o,n)}if(a=(o&t.childLanes)!==0,rt||a){if(n=Ce,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,ur(t,i),Bt(n,t,i,-1))}return gd(),n=Ll(Error(P(421))),ao(t,e,o,n)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=g_.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,ht=Ar(i.nextSibling),ft=e,de=!0,Ut=null,t!==null&&(_t[bt++]=sr,_t[bt++]=or,_t[bt++]=an,sr=t.id,or=t.overflow,an=e),e=ud(e,n.children),e.flags|=4096,e)}function pf(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),$c(t.return,e,r)}function jl(t,e,r,n,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=r,s.tailMode=i)}function kg(t,e,r){var n=e.pendingProps,i=n.revealOrder,s=n.tail;if(qe(t,e,n.children,r),n=fe.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&pf(t,r,e);else if(t.tag===19)pf(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(le(fe,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(r=e.child,i=null;r!==null;)t=r.alternate,t!==null&&da(t)===null&&(i=r),r=r.sibling;r=i,r===null?(i=e.child,e.child=null):(i=r.sibling,r.sibling=null),jl(e,!1,i,r,s);break;case"backwards":for(r=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&da(t)===null){e.child=i;break}t=i.sibling,i.sibling=r,r=i,i=t}jl(e,!0,r,null,s);break;case"together":jl(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function $o(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function dr(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),cn|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(P(153));if(e.child!==null){for(t=e.child,r=Dr(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Dr(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function i_(t,e,r){switch(e.tag){case 3:xg(e),oi();break;case 5:Zm(e);break;case 1:it(e.type)&&sa(e);break;case 4:rd(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;le(la,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(le(fe,fe.current&1),e.flags|=128,null):r&e.child.childLanes?Tg(t,e,r):(le(fe,fe.current&1),t=dr(t,e,r),t!==null?t.sibling:null);le(fe,fe.current&1);break;case 19:if(n=(r&e.childLanes)!==0,t.flags&128){if(n)return kg(t,e,r);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),le(fe,fe.current),n)break;return null;case 22:case 23:return e.lanes=0,Eg(t,e,r)}return dr(t,e,r)}var Ig,Gc,Pg,Ag;Ig=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Gc=function(){};Pg=function(t,e,r,n){var i=t.memoizedProps;if(i!==n){t=e.stateNode,en(Qt.current);var s=null;switch(r){case"input":i=pc(t,i),n=pc(t,n),s=[];break;case"select":i=me({},i,{value:void 0}),n=me({},n,{value:void 0}),s=[];break;case"textarea":i=yc(t,i),n=yc(t,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=na)}vc(r,n);var o;r=null;for(c in i)if(!n.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(ls.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in n){var l=n[c];if(a=i!=null?i[c]:void 0,n.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(s||(s=[]),s.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(ls.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ce("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}r&&(s=s||[]).push("style",r);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};Ag=function(t,e,r,n){r!==n&&(e.flags|=4)};function Ni(t,e){if(!de)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function We(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var i=t.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function s_(t,e,r){var n=e.pendingProps;switch(qu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return We(e),null;case 1:return it(e.type)&&ia(),We(e),null;case 3:return n=e.stateNode,li(),ue(nt),ue(Je),id(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(so(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ut!==null&&(eu(Ut),Ut=null))),Gc(t,e),We(e),null;case 5:nd(e);var i=en(_s.current);if(r=e.type,t!==null&&e.stateNode!=null)Pg(t,e,r,n,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(P(166));return We(e),null}if(t=en(Qt.current),so(e)){n=e.stateNode,r=e.type;var s=e.memoizedProps;switch(n[Jt]=e,n[ws]=s,t=(e.mode&1)!==0,r){case"dialog":ce("cancel",n),ce("close",n);break;case"iframe":case"object":case"embed":ce("load",n);break;case"video":case"audio":for(i=0;i<Bi.length;i++)ce(Bi[i],n);break;case"source":ce("error",n);break;case"img":case"image":case"link":ce("error",n),ce("load",n);break;case"details":ce("toggle",n);break;case"input":Sh(n,s),ce("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},ce("invalid",n);break;case"textarea":Rh(n,s),ce("invalid",n)}vc(r,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&io(n.textContent,a,t),i=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&io(n.textContent,a,t),i=["children",""+a]):ls.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ce("scroll",n)}switch(r){case"input":Ys(n),Eh(n,s,!0);break;case"textarea":Ys(n),xh(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=na)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=im(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=o.createElement(r,{is:n.is}):(t=o.createElement(r),r==="select"&&(o=t,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):t=o.createElementNS(t,r),t[Jt]=e,t[ws]=n,Ig(t,e,!1,!1),e.stateNode=t;e:{switch(o=_c(r,n),r){case"dialog":ce("cancel",t),ce("close",t),i=n;break;case"iframe":case"object":case"embed":ce("load",t),i=n;break;case"video":case"audio":for(i=0;i<Bi.length;i++)ce(Bi[i],t);i=n;break;case"source":ce("error",t),i=n;break;case"img":case"image":case"link":ce("error",t),ce("load",t),i=n;break;case"details":ce("toggle",t),i=n;break;case"input":Sh(t,n),i=pc(t,n),ce("invalid",t);break;case"option":i=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},i=me({},n,{value:void 0}),ce("invalid",t);break;case"textarea":Rh(t,n),i=yc(t,n),ce("invalid",t);break;default:i=n}vc(r,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?am(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&sm(t,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&cs(t,l):typeof l=="number"&&cs(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ls.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ce("scroll",t):l!=null&&Du(t,s,l,o))}switch(r){case"input":Ys(t),Eh(t,n,!1);break;case"textarea":Ys(t),xh(t);break;case"option":n.value!=null&&t.setAttribute("value",""+jr(n.value));break;case"select":t.multiple=!!n.multiple,s=n.value,s!=null?Kn(t,!!n.multiple,s,!1):n.defaultValue!=null&&Kn(t,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=na)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return We(e),null;case 6:if(t&&e.stateNode!=null)Ag(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(P(166));if(r=en(_s.current),en(Qt.current),so(e)){if(n=e.stateNode,r=e.memoizedProps,n[Jt]=e,(s=n.nodeValue!==r)&&(t=ft,t!==null))switch(t.tag){case 3:io(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&io(n.nodeValue,r,(t.mode&1)!==0)}s&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Jt]=e,e.stateNode=n}return We(e),null;case 13:if(ue(fe),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(de&&ht!==null&&e.mode&1&&!(e.flags&128))Jm(),oi(),e.flags|=98560,s=!1;else if(s=so(e),n!==null&&n.dehydrated!==null){if(t===null){if(!s)throw Error(P(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(P(317));s[Jt]=e}else oi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;We(e),s=!1}else Ut!==null&&(eu(Ut),Ut=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||fe.current&1?Ie===0&&(Ie=3):gd())),e.updateQueue!==null&&(e.flags|=4),We(e),null);case 4:return li(),Gc(t,e),t===null&&gs(e.stateNode.containerInfo),We(e),null;case 10:return Zu(e.type._context),We(e),null;case 17:return it(e.type)&&ia(),We(e),null;case 19:if(ue(fe),s=e.memoizedState,s===null)return We(e),null;if(n=(e.flags&128)!==0,o=s.rendering,o===null)if(n)Ni(s,!1);else{if(Ie!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=da(t),o!==null){for(e.flags|=128,Ni(s,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)s=r,t=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return le(fe,fe.current&1|2),e.child}t=t.sibling}s.tail!==null&&ve()>ui&&(e.flags|=128,n=!0,Ni(s,!1),e.lanes=4194304)}else{if(!n)if(t=da(o),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),Ni(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!de)return We(e),null}else 2*ve()-s.renderingStartTime>ui&&r!==1073741824&&(e.flags|=128,n=!0,Ni(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(r=s.last,r!==null?r.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ve(),e.sibling=null,r=fe.current,le(fe,n?r&1|2:r&1),e):(We(e),null);case 22:case 23:return md(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?ut&1073741824&&(We(e),e.subtreeFlags&6&&(e.flags|=8192)):We(e),null;case 24:return null;case 25:return null}throw Error(P(156,e.tag))}function o_(t,e){switch(qu(e),e.tag){case 1:return it(e.type)&&ia(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return li(),ue(nt),ue(Je),id(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return nd(e),null;case 13:if(ue(fe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(P(340));oi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ue(fe),null;case 4:return li(),null;case 10:return Zu(e.type._context),null;case 22:case 23:return md(),null;case 24:return null;default:return null}}var lo=!1,Ke=!1,a_=typeof WeakSet=="function"?WeakSet:Set,D=null;function zn(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){we(t,e,n)}else r.current=null}function Kc(t,e,r){try{r()}catch(n){we(t,e,n)}}var mf=!1;function l_(t,e){if(Ac=ea,t=Lm(),Ku(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=t,h=null;t:for(;;){for(var f;d!==r||i!==0&&d.nodeType!==3||(a=o+i),d!==s||n!==0&&d.nodeType!==3||(l=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===r&&++c===i&&(a=o),h===s&&++u===n&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(Oc={focusedElem:t,selectionRange:r},ea=!1,D=e;D!==null;)if(e=D,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,D=t;else for(;D!==null;){e=D;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,v=m.memoizedState,w=e.stateNode,p=w.getSnapshotBeforeUpdate(e.elementType===e.type?y:Nt(e.type,y),v);w.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var g=e.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(P(163))}}catch(_){we(e,e.return,_)}if(t=e.sibling,t!==null){t.return=e.return,D=t;break}D=e.return}return m=mf,mf=!1,m}function es(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Kc(e,r,s)}i=i.next}while(i!==n)}}function ja(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function Jc(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function Og(t){var e=t.alternate;e!==null&&(t.alternate=null,Og(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Jt],delete e[ws],delete e[Dc],delete e[Wv],delete e[Hv])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Ng(t){return t.tag===5||t.tag===3||t.tag===4}function gf(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Ng(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function qc(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=na));else if(n!==4&&(t=t.child,t!==null))for(qc(t,e,r),t=t.sibling;t!==null;)qc(t,e,r),t=t.sibling}function Yc(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Yc(t,e,r),t=t.sibling;t!==null;)Yc(t,e,r),t=t.sibling}var Ue=null,Lt=!1;function mr(t,e,r){for(r=r.child;r!==null;)Cg(t,e,r),r=r.sibling}function Cg(t,e,r){if(Yt&&typeof Yt.onCommitFiberUnmount=="function")try{Yt.onCommitFiberUnmount(Ia,r)}catch{}switch(r.tag){case 5:Ke||zn(r,e);case 6:var n=Ue,i=Lt;Ue=null,mr(t,e,r),Ue=n,Lt=i,Ue!==null&&(Lt?(t=Ue,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Ue.removeChild(r.stateNode));break;case 18:Ue!==null&&(Lt?(t=Ue,r=r.stateNode,t.nodeType===8?Pl(t.parentNode,r):t.nodeType===1&&Pl(t,r),fs(t)):Pl(Ue,r.stateNode));break;case 4:n=Ue,i=Lt,Ue=r.stateNode.containerInfo,Lt=!0,mr(t,e,r),Ue=n,Lt=i;break;case 0:case 11:case 14:case 15:if(!Ke&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Kc(r,e,o),i=i.next}while(i!==n)}mr(t,e,r);break;case 1:if(!Ke&&(zn(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){we(r,e,a)}mr(t,e,r);break;case 21:mr(t,e,r);break;case 22:r.mode&1?(Ke=(n=Ke)||r.memoizedState!==null,mr(t,e,r),Ke=n):mr(t,e,r);break;default:mr(t,e,r)}}function yf(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new a_),e.forEach(function(n){var i=y_.bind(null,t,n);r.has(n)||(r.add(n),n.then(i,i))})}}function It(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ue=a.stateNode,Lt=!1;break e;case 3:Ue=a.stateNode.containerInfo,Lt=!0;break e;case 4:Ue=a.stateNode.containerInfo,Lt=!0;break e}a=a.return}if(Ue===null)throw Error(P(160));Cg(s,o,i),Ue=null,Lt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){we(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Dg(e,t),e=e.sibling}function Dg(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(It(e,t),Vt(t),n&4){try{es(3,t,t.return),ja(3,t)}catch(y){we(t,t.return,y)}try{es(5,t,t.return)}catch(y){we(t,t.return,y)}}break;case 1:It(e,t),Vt(t),n&512&&r!==null&&zn(r,r.return);break;case 5:if(It(e,t),Vt(t),n&512&&r!==null&&zn(r,r.return),t.flags&32){var i=t.stateNode;try{cs(i,"")}catch(y){we(t,t.return,y)}}if(n&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=r!==null?r.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&rm(i,s),_c(a,o);var c=_c(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?am(i,d):u==="dangerouslySetInnerHTML"?sm(i,d):u==="children"?cs(i,d):Du(i,u,d,c)}switch(a){case"input":mc(i,s);break;case"textarea":nm(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?Kn(i,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?Kn(i,!!s.multiple,s.defaultValue,!0):Kn(i,!!s.multiple,s.multiple?[]:"",!1))}i[ws]=s}catch(y){we(t,t.return,y)}}break;case 6:if(It(e,t),Vt(t),n&4){if(t.stateNode===null)throw Error(P(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(y){we(t,t.return,y)}}break;case 3:if(It(e,t),Vt(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{fs(e.containerInfo)}catch(y){we(t,t.return,y)}break;case 4:It(e,t),Vt(t);break;case 13:It(e,t),Vt(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(fd=ve())),n&4&&yf(t);break;case 22:if(u=r!==null&&r.memoizedState!==null,t.mode&1?(Ke=(c=Ke)||u,It(e,t),Ke=c):It(e,t),Vt(t),n&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(D=t,u=t.child;u!==null;){for(d=D=u;D!==null;){switch(h=D,f=h.child,h.tag){case 0:case 11:case 14:case 15:es(4,h,h.return);break;case 1:zn(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){n=h,r=h.return;try{e=n,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(y){we(n,r,y)}}break;case 5:zn(h,h.return);break;case 22:if(h.memoizedState!==null){vf(d);continue}}f!==null?(f.return=h,D=f):vf(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=om("display",o))}catch(y){we(t,t.return,y)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(y){we(t,t.return,y)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:It(e,t),Vt(t),n&4&&yf(t);break;case 21:break;default:It(e,t),Vt(t)}}function Vt(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(Ng(r)){var n=r;break e}r=r.return}throw Error(P(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(cs(i,""),n.flags&=-33);var s=gf(t);Yc(t,s,i);break;case 3:case 4:var o=n.stateNode.containerInfo,a=gf(t);qc(t,a,o);break;default:throw Error(P(161))}}catch(l){we(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function c_(t,e,r){D=t,Lg(t)}function Lg(t,e,r){for(var n=(t.mode&1)!==0;D!==null;){var i=D,s=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||lo;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Ke;a=lo;var c=Ke;if(lo=o,(Ke=l)&&!c)for(D=i;D!==null;)o=D,l=o.child,o.tag===22&&o.memoizedState!==null?_f(i):l!==null?(l.return=o,D=l):_f(i);for(;s!==null;)D=s,Lg(s),s=s.sibling;D=i,lo=a,Ke=c}wf(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,D=s):wf(t)}}function wf(t){for(;D!==null;){var e=D;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ke||ja(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Ke)if(r===null)n.componentDidMount();else{var i=e.elementType===e.type?r.memoizedProps:Nt(e.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&tf(e,s,n);break;case 3:var o=e.updateQueue;if(o!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}tf(e,o,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&fs(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(P(163))}Ke||e.flags&512&&Jc(e)}catch(h){we(e,e.return,h)}}if(e===t){D=null;break}if(r=e.sibling,r!==null){r.return=e.return,D=r;break}D=e.return}}function vf(t){for(;D!==null;){var e=D;if(e===t){D=null;break}var r=e.sibling;if(r!==null){r.return=e.return,D=r;break}D=e.return}}function _f(t){for(;D!==null;){var e=D;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{ja(4,e)}catch(l){we(e,r,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(l){we(e,i,l)}}var s=e.return;try{Jc(e)}catch(l){we(e,s,l)}break;case 5:var o=e.return;try{Jc(e)}catch(l){we(e,o,l)}}}catch(l){we(e,e.return,l)}if(e===t){D=null;break}var a=e.sibling;if(a!==null){a.return=e.return,D=a;break}D=e.return}}var u_=Math.ceil,pa=hr.ReactCurrentDispatcher,dd=hr.ReactCurrentOwner,Rt=hr.ReactCurrentBatchConfig,ee=0,Ce=null,be=null,Me=0,ut=0,Vn=Mr(0),Ie=0,Rs=null,cn=0,Ua=0,hd=0,ts=null,tt=null,fd=0,ui=1/0,rr=null,ma=!1,Qc=null,Nr=null,co=!1,Tr=null,ga=0,rs=0,Xc=null,Mo=-1,Bo=0;function Ye(){return ee&6?ve():Mo!==-1?Mo:Mo=ve()}function Cr(t){return t.mode&1?ee&2&&Me!==0?Me&-Me:Kv.transition!==null?(Bo===0&&(Bo=vm()),Bo):(t=ne,t!==0||(t=window.event,t=t===void 0?16:Tm(t.type)),t):1}function Bt(t,e,r,n){if(50<rs)throw rs=0,Xc=null,Error(P(185));Ls(t,r,n),(!(ee&2)||t!==Ce)&&(t===Ce&&(!(ee&2)&&(Ua|=r),Ie===4&&Er(t,Me)),st(t,n),r===1&&ee===0&&!(e.mode&1)&&(ui=ve()+500,Ca&&Br()))}function st(t,e){var r=t.callbackNode;Kw(t,e);var n=Zo(t,t===Ce?Me:0);if(n===0)r!==null&&Ih(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&Ih(r),e===1)t.tag===0?Gv(bf.bind(null,t)):Hm(bf.bind(null,t)),zv(function(){!(ee&6)&&Br()}),r=null;else{switch(_m(n)){case 1:r=Mu;break;case 4:r=ym;break;case 16:r=Xo;break;case 536870912:r=wm;break;default:r=Xo}r=Vg(r,jg.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function jg(t,e){if(Mo=-1,Bo=0,ee&6)throw Error(P(327));var r=t.callbackNode;if(Xn()&&t.callbackNode!==r)return null;var n=Zo(t,t===Ce?Me:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=ya(t,n);else{e=n;var i=ee;ee|=2;var s=$g();(Ce!==t||Me!==e)&&(rr=null,ui=ve()+500,nn(t,e));do try{f_();break}catch(a){Ug(t,a)}while(!0);Xu(),pa.current=s,ee=i,be!==null?e=0:(Ce=null,Me=0,e=Ie)}if(e!==0){if(e===2&&(i=xc(t),i!==0&&(n=i,e=Zc(t,i))),e===1)throw r=Rs,nn(t,0),Er(t,n),st(t,ve()),r;if(e===6)Er(t,n);else{if(i=t.current.alternate,!(n&30)&&!d_(i)&&(e=ya(t,n),e===2&&(s=xc(t),s!==0&&(n=s,e=Zc(t,s))),e===1))throw r=Rs,nn(t,0),Er(t,n),st(t,ve()),r;switch(t.finishedWork=i,t.finishedLanes=n,e){case 0:case 1:throw Error(P(345));case 2:Kr(t,tt,rr);break;case 3:if(Er(t,n),(n&130023424)===n&&(e=fd+500-ve(),10<e)){if(Zo(t,0)!==0)break;if(i=t.suspendedLanes,(i&n)!==n){Ye(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Cc(Kr.bind(null,t,tt,rr),e);break}Kr(t,tt,rr);break;case 4:if(Er(t,n),(n&4194240)===n)break;for(e=t.eventTimes,i=-1;0<n;){var o=31-Mt(n);s=1<<o,o=e[o],o>i&&(i=o),n&=~s}if(n=i,n=ve()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*u_(n/1960))-n,10<n){t.timeoutHandle=Cc(Kr.bind(null,t,tt,rr),n);break}Kr(t,tt,rr);break;case 5:Kr(t,tt,rr);break;default:throw Error(P(329))}}}return st(t,ve()),t.callbackNode===r?jg.bind(null,t):null}function Zc(t,e){var r=ts;return t.current.memoizedState.isDehydrated&&(nn(t,e).flags|=256),t=ya(t,e),t!==2&&(e=tt,tt=r,e!==null&&eu(e)),t}function eu(t){tt===null?tt=t:tt.push.apply(tt,t)}function d_(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],s=i.getSnapshot;i=i.value;try{if(!Ft(s(),i))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Er(t,e){for(e&=~hd,e&=~Ua,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Mt(e),n=1<<r;t[r]=-1,e&=~n}}function bf(t){if(ee&6)throw Error(P(327));Xn();var e=Zo(t,0);if(!(e&1))return st(t,ve()),null;var r=ya(t,e);if(t.tag!==0&&r===2){var n=xc(t);n!==0&&(e=n,r=Zc(t,n))}if(r===1)throw r=Rs,nn(t,0),Er(t,e),st(t,ve()),r;if(r===6)throw Error(P(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Kr(t,tt,rr),st(t,ve()),null}function pd(t,e){var r=ee;ee|=1;try{return t(e)}finally{ee=r,ee===0&&(ui=ve()+500,Ca&&Br())}}function un(t){Tr!==null&&Tr.tag===0&&!(ee&6)&&Xn();var e=ee;ee|=1;var r=Rt.transition,n=ne;try{if(Rt.transition=null,ne=1,t)return t()}finally{ne=n,Rt.transition=r,ee=e,!(ee&6)&&Br()}}function md(){ut=Vn.current,ue(Vn)}function nn(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,Fv(r)),be!==null)for(r=be.return;r!==null;){var n=r;switch(qu(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&ia();break;case 3:li(),ue(nt),ue(Je),id();break;case 5:nd(n);break;case 4:li();break;case 13:ue(fe);break;case 19:ue(fe);break;case 10:Zu(n.type._context);break;case 22:case 23:md()}r=r.return}if(Ce=t,be=t=Dr(t.current,null),Me=ut=e,Ie=0,Rs=null,hd=Ua=cn=0,tt=ts=null,Zr!==null){for(e=0;e<Zr.length;e++)if(r=Zr[e],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,s=r.pending;if(s!==null){var o=s.next;s.next=i,n.next=o}r.pending=n}Zr=null}return t}function Ug(t,e){do{var r=be;try{if(Xu(),jo.current=fa,ha){for(var n=pe.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}ha=!1}if(ln=0,Ne=ke=pe=null,Zi=!1,bs=0,dd.current=null,r===null||r.return===null){Ie=1,Rs=e,be=null;break}e:{var s=t,o=r.return,a=r,l=e;if(e=Me,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=lf(o);if(f!==null){f.flags&=-257,cf(f,o,a,s,e),f.mode&1&&af(s,c,e),e=f,l=c;var m=e.updateQueue;if(m===null){var y=new Set;y.add(l),e.updateQueue=y}else m.add(l);break e}else{if(!(e&1)){af(s,c,e),gd();break e}l=Error(P(426))}}else if(de&&a.mode&1){var v=lf(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),cf(v,o,a,s,e),Yu(ci(l,a));break e}}s=l=ci(l,a),Ie!==4&&(Ie=2),ts===null?ts=[s]:ts.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var w=_g(s,l,e);ef(s,w);break e;case 1:a=l;var p=s.type,g=s.stateNode;if(!(s.flags&128)&&(typeof p.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Nr===null||!Nr.has(g)))){s.flags|=65536,e&=-e,s.lanes|=e;var _=bg(s,a,e);ef(s,_);break e}}s=s.return}while(s!==null)}Bg(r)}catch(S){e=S,be===r&&r!==null&&(be=r=r.return);continue}break}while(!0)}function $g(){var t=pa.current;return pa.current=fa,t===null?fa:t}function gd(){(Ie===0||Ie===3||Ie===2)&&(Ie=4),Ce===null||!(cn&268435455)&&!(Ua&268435455)||Er(Ce,Me)}function ya(t,e){var r=ee;ee|=2;var n=$g();(Ce!==t||Me!==e)&&(rr=null,nn(t,e));do try{h_();break}catch(i){Ug(t,i)}while(!0);if(Xu(),ee=r,pa.current=n,be!==null)throw Error(P(261));return Ce=null,Me=0,Ie}function h_(){for(;be!==null;)Mg(be)}function f_(){for(;be!==null&&!$w();)Mg(be)}function Mg(t){var e=zg(t.alternate,t,ut);t.memoizedProps=t.pendingProps,e===null?Bg(t):be=e,dd.current=null}function Bg(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=o_(r,e),r!==null){r.flags&=32767,be=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ie=6,be=null;return}}else if(r=s_(r,e,ut),r!==null){be=r;return}if(e=e.sibling,e!==null){be=e;return}be=e=t}while(e!==null);Ie===0&&(Ie=5)}function Kr(t,e,r){var n=ne,i=Rt.transition;try{Rt.transition=null,ne=1,p_(t,e,r,n)}finally{Rt.transition=i,ne=n}return null}function p_(t,e,r,n){do Xn();while(Tr!==null);if(ee&6)throw Error(P(327));r=t.finishedWork;var i=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(P(177));t.callbackNode=null,t.callbackPriority=0;var s=r.lanes|r.childLanes;if(Jw(t,s),t===Ce&&(be=Ce=null,Me=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||co||(co=!0,Vg(Xo,function(){return Xn(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=Rt.transition,Rt.transition=null;var o=ne;ne=1;var a=ee;ee|=4,dd.current=null,l_(t,r),Dg(r,t),Dv(Oc),ea=!!Ac,Oc=Ac=null,t.current=r,c_(r),Mw(),ee=a,ne=o,Rt.transition=s}else t.current=r;if(co&&(co=!1,Tr=t,ga=i),s=t.pendingLanes,s===0&&(Nr=null),zw(r.stateNode),st(t,ve()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)i=e[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(ma)throw ma=!1,t=Qc,Qc=null,t;return ga&1&&t.tag!==0&&Xn(),s=t.pendingLanes,s&1?t===Xc?rs++:(rs=0,Xc=t):rs=0,Br(),null}function Xn(){if(Tr!==null){var t=_m(ga),e=Rt.transition,r=ne;try{if(Rt.transition=null,ne=16>t?16:t,Tr===null)var n=!1;else{if(t=Tr,Tr=null,ga=0,ee&6)throw Error(P(331));var i=ee;for(ee|=4,D=t.current;D!==null;){var s=D,o=s.child;if(D.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(D=c;D!==null;){var u=D;switch(u.tag){case 0:case 11:case 15:es(8,u,s)}var d=u.child;if(d!==null)d.return=u,D=d;else for(;D!==null;){u=D;var h=u.sibling,f=u.return;if(Og(u),u===c){D=null;break}if(h!==null){h.return=f,D=h;break}D=f}}}var m=s.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(y!==null)}}D=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,D=o;else e:for(;D!==null;){if(s=D,s.flags&2048)switch(s.tag){case 0:case 11:case 15:es(9,s,s.return)}var w=s.sibling;if(w!==null){w.return=s.return,D=w;break e}D=s.return}}var p=t.current;for(D=p;D!==null;){o=D;var g=o.child;if(o.subtreeFlags&2064&&g!==null)g.return=o,D=g;else e:for(o=p;D!==null;){if(a=D,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ja(9,a)}}catch(S){we(a,a.return,S)}if(a===o){D=null;break e}var _=a.sibling;if(_!==null){_.return=a.return,D=_;break e}D=a.return}}if(ee=i,Br(),Yt&&typeof Yt.onPostCommitFiberRoot=="function")try{Yt.onPostCommitFiberRoot(Ia,t)}catch{}n=!0}return n}finally{ne=r,Rt.transition=e}}return!1}function Sf(t,e,r){e=ci(r,e),e=_g(t,e,1),t=Or(t,e,1),e=Ye(),t!==null&&(Ls(t,1,e),st(t,e))}function we(t,e,r){if(t.tag===3)Sf(t,t,r);else for(;e!==null;){if(e.tag===3){Sf(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Nr===null||!Nr.has(n))){t=ci(r,t),t=bg(e,t,1),e=Or(e,t,1),t=Ye(),e!==null&&(Ls(e,1,t),st(e,t));break}}e=e.return}}function m_(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=Ye(),t.pingedLanes|=t.suspendedLanes&r,Ce===t&&(Me&r)===r&&(Ie===4||Ie===3&&(Me&130023424)===Me&&500>ve()-fd?nn(t,0):hd|=r),st(t,e)}function Fg(t,e){e===0&&(t.mode&1?(e=Zs,Zs<<=1,!(Zs&130023424)&&(Zs=4194304)):e=1);var r=Ye();t=ur(t,e),t!==null&&(Ls(t,e,r),st(t,r))}function g_(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),Fg(t,r)}function y_(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,i=t.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(P(314))}n!==null&&n.delete(e),Fg(t,r)}var zg;zg=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||nt.current)rt=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return rt=!1,i_(t,e,r);rt=!!(t.flags&131072)}else rt=!1,de&&e.flags&1048576&&Gm(e,aa,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;$o(t,e),t=e.pendingProps;var i=si(e,Je.current);Qn(e,r),i=od(null,e,n,t,i,r);var s=ad();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,it(n)?(s=!0,sa(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,td(e),i.updater=La,e.stateNode=i,i._reactInternals=e,Bc(e,n,t,r),e=Vc(null,e,n,!0,s,r)):(e.tag=0,de&&s&&Ju(e),qe(null,e,i,r),e=e.child),e;case 16:n=e.elementType;e:{switch($o(t,e),t=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=v_(n),t=Nt(n,t),i){case 0:e=zc(null,e,n,t,r);break e;case 1:e=hf(null,e,n,t,r);break e;case 11:e=uf(null,e,n,t,r);break e;case 14:e=df(null,e,n,Nt(n.type,t),r);break e}throw Error(P(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Nt(n,i),zc(t,e,n,i,r);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Nt(n,i),hf(t,e,n,i,r);case 3:e:{if(xg(e),t===null)throw Error(P(387));n=e.pendingProps,s=e.memoizedState,i=s.element,Xm(t,e),ua(e,n,null,r);var o=e.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=ci(Error(P(423)),e),e=ff(t,e,n,r,i);break e}else if(n!==i){i=ci(Error(P(424)),e),e=ff(t,e,n,r,i);break e}else for(ht=Ar(e.stateNode.containerInfo.firstChild),ft=e,de=!0,Ut=null,r=Ym(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(oi(),n===i){e=dr(t,e,r);break e}qe(t,e,n,r)}e=e.child}return e;case 5:return Zm(e),t===null&&Uc(e),n=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,Nc(n,i)?o=null:s!==null&&Nc(n,s)&&(e.flags|=32),Rg(t,e),qe(t,e,o,r),e.child;case 6:return t===null&&Uc(e),null;case 13:return Tg(t,e,r);case 4:return rd(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=ai(e,null,n,r):qe(t,e,n,r),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Nt(n,i),uf(t,e,n,i,r);case 7:return qe(t,e,e.pendingProps,r),e.child;case 8:return qe(t,e,e.pendingProps.children,r),e.child;case 12:return qe(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,le(la,n._currentValue),n._currentValue=o,s!==null)if(Ft(s.value,o)){if(s.children===i.children&&!nt.current){e=dr(t,e,r);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(s.tag===1){l=ar(-1,r&-r),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),$c(s.return,r,e),a.lanes|=r;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(P(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),$c(o,r,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}qe(t,e,i.children,r),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,Qn(e,r),i=xt(i),n=n(i),e.flags|=1,qe(t,e,n,r),e.child;case 14:return n=e.type,i=Nt(n,e.pendingProps),i=Nt(n.type,i),df(t,e,n,i,r);case 15:return Sg(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Nt(n,i),$o(t,e),e.tag=1,it(n)?(t=!0,sa(e)):t=!1,Qn(e,r),vg(e,n,i),Bc(e,n,i,r),Vc(null,e,n,!0,t,r);case 19:return kg(t,e,r);case 22:return Eg(t,e,r)}throw Error(P(156,e.tag))};function Vg(t,e){return gm(t,e)}function w_(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function St(t,e,r,n){return new w_(t,e,r,n)}function yd(t){return t=t.prototype,!(!t||!t.isReactComponent)}function v_(t){if(typeof t=="function")return yd(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ju)return 11;if(t===Uu)return 14}return 2}function Dr(t,e){var r=t.alternate;return r===null?(r=St(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Fo(t,e,r,n,i,s){var o=2;if(n=t,typeof t=="function")yd(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Cn:return sn(r.children,i,s,e);case Lu:o=8,i|=8;break;case uc:return t=St(12,r,e,i|2),t.elementType=uc,t.lanes=s,t;case dc:return t=St(13,r,e,i),t.elementType=dc,t.lanes=s,t;case hc:return t=St(19,r,e,i),t.elementType=hc,t.lanes=s,t;case Zp:return $a(r,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Qp:o=10;break e;case Xp:o=9;break e;case ju:o=11;break e;case Uu:o=14;break e;case vr:o=16,n=null;break e}throw Error(P(130,t==null?t:typeof t,""))}return e=St(o,r,e,i),e.elementType=t,e.type=n,e.lanes=s,e}function sn(t,e,r,n){return t=St(7,t,n,e),t.lanes=r,t}function $a(t,e,r,n){return t=St(22,t,n,e),t.elementType=Zp,t.lanes=r,t.stateNode={isHidden:!1},t}function Ul(t,e,r){return t=St(6,t,null,e),t.lanes=r,t}function $l(t,e,r){return e=St(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function __(t,e,r,n,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wl(0),this.expirationTimes=wl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wl(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function wd(t,e,r,n,i,s,o,a,l){return t=new __(t,e,r,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=St(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},td(s),t}function b_(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Nn,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function Wg(t){if(!t)return Ur;t=t._reactInternals;e:{if(fn(t)!==t||t.tag!==1)throw Error(P(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(it(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(P(171))}if(t.tag===1){var r=t.type;if(it(r))return Wm(t,r,e)}return e}function Hg(t,e,r,n,i,s,o,a,l){return t=wd(r,n,!0,t,i,s,o,a,l),t.context=Wg(null),r=t.current,n=Ye(),i=Cr(r),s=ar(n,i),s.callback=e??null,Or(r,s,i),t.current.lanes=i,Ls(t,i,n),st(t,n),t}function Ma(t,e,r,n){var i=e.current,s=Ye(),o=Cr(i);return r=Wg(r),e.context===null?e.context=r:e.pendingContext=r,e=ar(s,o),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=Or(i,e,o),t!==null&&(Bt(t,i,o,s),Lo(t,i,o)),o}function wa(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Ef(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function vd(t,e){Ef(t,e),(t=t.alternate)&&Ef(t,e)}function S_(){return null}var Gg=typeof reportError=="function"?reportError:function(t){console.error(t)};function _d(t){this._internalRoot=t}Ba.prototype.render=_d.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(P(409));Ma(t,e,null,null)};Ba.prototype.unmount=_d.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;un(function(){Ma(null,t,null,null)}),e[cr]=null}};function Ba(t){this._internalRoot=t}Ba.prototype.unstable_scheduleHydration=function(t){if(t){var e=Em();t={blockedOn:null,target:t,priority:e};for(var r=0;r<Sr.length&&e!==0&&e<Sr[r].priority;r++);Sr.splice(r,0,t),r===0&&xm(t)}};function bd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Fa(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Rf(){}function E_(t,e,r,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var c=wa(o);s.call(c)}}var o=Hg(e,n,t,0,null,!1,!1,"",Rf);return t._reactRootContainer=o,t[cr]=o.current,gs(t.nodeType===8?t.parentNode:t),un(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof n=="function"){var a=n;n=function(){var c=wa(l);a.call(c)}}var l=wd(t,0,!1,null,null,!1,!1,"",Rf);return t._reactRootContainer=l,t[cr]=l.current,gs(t.nodeType===8?t.parentNode:t),un(function(){Ma(e,l,r,n)}),l}function za(t,e,r,n,i){var s=r._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=wa(o);a.call(l)}}Ma(e,o,t,i)}else o=E_(r,e,t,i,n);return wa(o)}bm=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=Mi(e.pendingLanes);r!==0&&(Bu(e,r|1),st(e,ve()),!(ee&6)&&(ui=ve()+500,Br()))}break;case 13:un(function(){var n=ur(t,1);if(n!==null){var i=Ye();Bt(n,t,1,i)}}),vd(t,1)}};Fu=function(t){if(t.tag===13){var e=ur(t,134217728);if(e!==null){var r=Ye();Bt(e,t,134217728,r)}vd(t,134217728)}};Sm=function(t){if(t.tag===13){var e=Cr(t),r=ur(t,e);if(r!==null){var n=Ye();Bt(r,t,e,n)}vd(t,e)}};Em=function(){return ne};Rm=function(t,e){var r=ne;try{return ne=t,e()}finally{ne=r}};Sc=function(t,e,r){switch(e){case"input":if(mc(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var i=Na(n);if(!i)throw Error(P(90));tm(n),mc(n,i)}}}break;case"textarea":nm(t,r);break;case"select":e=r.value,e!=null&&Kn(t,!!r.multiple,e,!1)}};um=pd;dm=un;var R_={usingClientEntryPoint:!1,Events:[Us,Un,Na,lm,cm,pd]},Ci={findFiberByHostInstance:Xr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},x_={bundleType:Ci.bundleType,version:Ci.version,rendererPackageName:Ci.rendererPackageName,rendererConfig:Ci.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=pm(t),t===null?null:t.stateNode},findFiberByHostInstance:Ci.findFiberByHostInstance||S_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uo.isDisabled&&uo.supportsFiber)try{Ia=uo.inject(x_),Yt=uo}catch{}}mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R_;mt.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bd(e))throw Error(P(200));return b_(t,e,null,r)};mt.createRoot=function(t,e){if(!bd(t))throw Error(P(299));var r=!1,n="",i=Gg;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=wd(t,1,!1,null,null,r,!1,n,i),t[cr]=e.current,gs(t.nodeType===8?t.parentNode:t),new _d(e)};mt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(P(188)):(t=Object.keys(t).join(","),Error(P(268,t)));return t=pm(e),t=t===null?null:t.stateNode,t};mt.flushSync=function(t){return un(t)};mt.hydrate=function(t,e,r){if(!Fa(e))throw Error(P(200));return za(null,t,e,!0,r)};mt.hydrateRoot=function(t,e,r){if(!bd(t))throw Error(P(405));var n=r!=null&&r.hydratedSources||null,i=!1,s="",o=Gg;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),e=Hg(e,null,t,1,r??null,i,!1,s,o),t[cr]=e.current,gs(t),n)for(t=0;t<n.length;t++)r=n[t],i=r._getVersion,i=i(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,i]:e.mutableSourceEagerHydrationData.push(r,i);return new Ba(e)};mt.render=function(t,e,r){if(!Fa(e))throw Error(P(200));return za(null,t,e,!1,r)};mt.unmountComponentAtNode=function(t){if(!Fa(t))throw Error(P(40));return t._reactRootContainer?(un(function(){za(null,null,t,!1,function(){t._reactRootContainer=null,t[cr]=null})}),!0):!1};mt.unstable_batchedUpdates=pd;mt.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!Fa(r))throw Error(P(200));if(t==null||t._reactInternals===void 0)throw Error(P(38));return za(t,e,r,!1,n)};mt.version="18.3.1-next-f1338f8080-20240426";function Kg(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Kg)}catch(t){console.error(t)}}Kg(),Kp.exports=mt;var T_=Kp.exports,xf=T_;lc.createRoot=xf.createRoot,lc.hydrateRoot=xf.hydrateRoot;const k_="modulepreload",I_=function(t,e){return new URL(t,e).href},Tf={},mi=function(e,r,n){let i=Promise.resolve();if(r&&r.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(r.map(c=>{if(c=I_(c,n),c in Tf)return;Tf[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(!!n)for(let m=o.length-1;m>=0;m--){const y=o[m];if(y.href===c&&(!u||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":k_,u||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),u)return new Promise((m,y)=>{f.addEventListener("load",m),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},tu="RFC3986",ru={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},P_="RFC1738",A_=Array.isArray,Wt=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),Ml=1024,O_=(t,e,r,n,i)=>{if(t.length===0)return t;let s=t;if(typeof t=="symbol"?s=Symbol.prototype.toString.call(t):typeof t!="string"&&(s=String(t)),r==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let o="";for(let a=0;a<s.length;a+=Ml){const l=s.length>=Ml?s.slice(a,a+Ml):s,c=[];for(let u=0;u<l.length;++u){let d=l.charCodeAt(u);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||i===P_&&(d===40||d===41)){c[c.length]=l.charAt(u);continue}if(d<128){c[c.length]=Wt[d];continue}if(d<2048){c[c.length]=Wt[192|d>>6]+Wt[128|d&63];continue}if(d<55296||d>=57344){c[c.length]=Wt[224|d>>12]+Wt[128|d>>6&63]+Wt[128|d&63];continue}u+=1,d=65536+((d&1023)<<10|l.charCodeAt(u)&1023),c[c.length]=Wt[240|d>>18]+Wt[128|d>>12&63]+Wt[128|d>>6&63]+Wt[128|d&63]}o+=c.join("")}return o};function N_(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function kf(t,e){if(A_(t)){const r=[];for(let n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)}const C_=Object.prototype.hasOwnProperty,Jg={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},Gt=Array.isArray,D_=Array.prototype.push,qg=function(t,e){D_.apply(t,Gt(e)?e:[e])},L_=Date.prototype.toISOString,Te={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:O_,encodeValuesOnly:!1,format:tu,formatter:ru[tu],indices:!1,serializeDate(t){return L_.call(t)},skipNulls:!1,strictNullHandling:!1};function j_(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const Bl={};function Yg(t,e,r,n,i,s,o,a,l,c,u,d,h,f,m,y,v,w){let p=t,g=w,_=0,S=!1;for(;(g=g.get(Bl))!==void 0&&!S;){const N=g.get(t);if(_+=1,typeof N<"u"){if(N===_)throw new RangeError("Cyclic object value");S=!0}typeof g.get(Bl)>"u"&&(_=0)}if(typeof c=="function"?p=c(e,p):p instanceof Date?p=h==null?void 0:h(p):r==="comma"&&Gt(p)&&(p=kf(p,function(N){return N instanceof Date?h==null?void 0:h(N):N})),p===null){if(s)return l&&!y?l(e,Te.encoder,v,"key",f):e;p=""}if(j_(p)||N_(p)){if(l){const N=y?e:l(e,Te.encoder,v,"key",f);return[(m==null?void 0:m(N))+"="+(m==null?void 0:m(l(p,Te.encoder,v,"value",f)))]}return[(m==null?void 0:m(e))+"="+(m==null?void 0:m(String(p)))]}const R=[];if(typeof p>"u")return R;let x;if(r==="comma"&&Gt(p))y&&l&&(p=kf(p,l)),x=[{value:p.length>0?p.join(",")||null:void 0}];else if(Gt(c))x=c;else{const N=Object.keys(p);x=u?N.sort(u):N}const T=a?String(e).replace(/\./g,"%2E"):String(e),I=n&&Gt(p)&&p.length===1?T+"[]":T;if(i&&Gt(p)&&p.length===0)return I+"[]";for(let N=0;N<x.length;++N){const M=x[N],B=typeof M=="object"&&typeof M.value<"u"?M.value:p[M];if(o&&B===null)continue;const Se=d&&a?M.replace(/\./g,"%2E"):M,kt=Gt(p)?typeof r=="function"?r(I,Se):I:I+(d?"."+Se:"["+Se+"]");w.set(t,_);const ze=new WeakMap;ze.set(Bl,w),qg(R,Yg(B,kt,r,n,i,s,o,a,r==="comma"&&y&&Gt(p)?null:l,c,u,d,h,f,m,y,v,ze))}return R}function U_(t=Te){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||Te.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=tu;if(typeof t.format<"u"){if(!C_.call(ru,t.format))throw new TypeError("Unknown format option provided.");r=t.format}const n=ru[r];let i=Te.filter;(typeof t.filter=="function"||Gt(t.filter))&&(i=t.filter);let s;if(t.arrayFormat&&t.arrayFormat in Jg?s=t.arrayFormat:"indices"in t?s=t.indices?"indices":"repeat":s=Te.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const o=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:Te.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Te.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Te.allowEmptyArrays,arrayFormat:s,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Te.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?Te.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Te.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:Te.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:Te.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Te.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Te.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Te.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Te.strictNullHandling}}function $_(t,e={}){let r=t;const n=U_(e);let i,s;typeof n.filter=="function"?(s=n.filter,r=s("",r)):Gt(n.filter)&&(s=n.filter,i=s);const o=[];if(typeof r!="object"||r===null)return"";const a=Jg[n.arrayFormat],l=a==="comma"&&n.commaRoundTrip;i||(i=Object.keys(r)),n.sort&&i.sort(n.sort);const c=new WeakMap;for(let h=0;h<i.length;++h){const f=i[h];n.skipNulls&&r[f]===null||qg(o,Yg(r[f],f,a,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}const u=o.join(n.delimiter);let d=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}const kn="4.104.0";let If=!1,ns,Qg,Xg,nu,Zg,ey,ty,ry,ny;function M_(t,e={auto:!1}){if(If)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(ns)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${ns}'\``);If=e.auto,ns=t.kind,Qg=t.fetch,Xg=t.FormData,nu=t.File,Zg=t.ReadableStream,ey=t.getMultipartRequestOptions,ty=t.getDefaultAgent,ry=t.fileFromPath,ny=t.isFsReadStream}class B_{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function F_({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let r,n,i,s;try{r=fetch,n=Request,i=Response,s=Headers}catch(o){throw new Error(`this environment is missing the following Web Fetch API type: ${o.message}. ${e}`)}return{kind:"web",fetch:r,Request:n,Response:i,Headers:s,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(o,a)=>({...a,body:new B_(o)}),getDefaultAgent:o=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:o=>!1}}const iy=()=>{ns||M_(F_(),{auto:!0})};iy();class W extends Error{}class Fe extends W{constructor(e,r,n,i){super(`${Fe.makeMessage(e,r,n)}`),this.status=e,this.headers=i,this.request_id=i==null?void 0:i["x-request-id"],this.error=r;const s=r;this.code=s==null?void 0:s.code,this.param=s==null?void 0:s.param,this.type=s==null?void 0:s.type}static makeMessage(e,r,n){const i=r!=null&&r.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,r,n,i){if(!e||!i)return new Va({message:n,cause:su(r)});const s=r==null?void 0:r.error;return e===400?new sy(e,s,n,i):e===401?new oy(e,s,n,i):e===403?new ay(e,s,n,i):e===404?new ly(e,s,n,i):e===409?new cy(e,s,n,i):e===422?new uy(e,s,n,i):e===429?new dy(e,s,n,i):e>=500?new hy(e,s,n,i):new Fe(e,s,n,i)}}class Et extends Fe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Va extends Fe{constructor({message:e,cause:r}){super(void 0,void 0,e||"Connection error.",void 0),r&&(this.cause=r)}}class Sd extends Va{constructor({message:e}={}){super({message:e??"Request timed out."})}}class sy extends Fe{}class oy extends Fe{}class ay extends Fe{}class ly extends Fe{}class cy extends Fe{}class uy extends Fe{}class dy extends Fe{}class hy extends Fe{}class fy extends W{constructor(){super("Could not parse response content as the length limit was reached")}}class py extends W{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var ho=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},Vr=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},at;class Wa{constructor(){at.set(this,void 0),this.buffer=new Uint8Array,ho(this,at,null,"f")}decode(e){if(e==null)return[];const r=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+r.length);n.set(this.buffer),n.set(r,this.buffer.length),this.buffer=n;const i=[];let s;for(;(s=z_(this.buffer,Vr(this,at,"f")))!=null;){if(s.carriage&&Vr(this,at,"f")==null){ho(this,at,s.index,"f");continue}if(Vr(this,at,"f")!=null&&(s.index!==Vr(this,at,"f")+1||s.carriage)){i.push(this.decodeText(this.buffer.slice(0,Vr(this,at,"f")-1))),this.buffer=this.buffer.slice(Vr(this,at,"f")),ho(this,at,null,"f");continue}const o=Vr(this,at,"f")!==null?s.preceding-1:s.preceding,a=this.decodeText(this.buffer.slice(0,o));i.push(a),this.buffer=this.buffer.slice(s.index),ho(this,at,null,"f")}return i}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new W(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new W(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new W("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}at=new WeakMap;Wa.NEWLINE_CHARS=new Set([`
`,"\r"]);Wa.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function z_(t,e){for(let i=e??0;i<t.length;i++){if(t[i]===10)return{preceding:i,index:i+1,carriage:!1};if(t[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function V_(t){for(let n=0;n<t.length-1;n++){if(t[n]===10&&t[n+1]===10||t[n]===13&&t[n+1]===13)return n+2;if(t[n]===13&&t[n+1]===10&&n+3<t.length&&t[n+2]===13&&t[n+3]===10)return n+4}return-1}function my(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const r=await e.read();return r!=null&&r.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(){const r=e.cancel();return e.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class qt{constructor(e,r){this.iterator=e,this.controller=r}static fromSSEResponse(e,r){let n=!1;async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(const o of W_(e,r))if(!s){if(o.data.startsWith("[DONE]")){s=!0;continue}if(o.event===null||o.event.startsWith("response.")||o.event.startsWith("transcript.")){let a;try{a=JSON.parse(o.data)}catch(l){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),l}if(a&&a.error)throw new Fe(void 0,a.error,void 0,Sy(e.headers));yield a}else{let a;try{a=JSON.parse(o.data)}catch(l){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),l}if(o.event=="error")throw new Fe(void 0,a.error,a.message,void 0);yield{event:o.event,data:a}}}s=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{s||r.abort()}}return new qt(i,r)}static fromReadableStream(e,r){let n=!1;async function*i(){const o=new Wa,a=my(e);for await(const l of a)for(const c of o.decode(l))yield c;for(const l of o.flush())yield l}async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let o=!1;try{for await(const a of i())o||a&&(yield JSON.parse(a));o=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{o||r.abort()}}return new qt(s,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],r=[],n=this.iterator(),i=s=>({next:()=>{if(s.length===0){const o=n.next();e.push(o),r.push(o)}return s.shift()}});return[new qt(()=>i(e),this.controller),new qt(()=>i(r),this.controller)]}toReadableStream(){const e=this;let r;const n=new TextEncoder;return new Zg({async start(){r=e[Symbol.asyncIterator]()},async pull(i){try{const{value:s,done:o}=await r.next();if(o)return i.close();const a=n.encode(JSON.stringify(s)+`
`);i.enqueue(a)}catch(s){i.error(s)}},async cancel(){var i;await((i=r.return)==null?void 0:i.call(r))}})}}async function*W_(t,e){if(!t.body)throw e.abort(),new W("Attempted to iterate over a response with no body");const r=new G_,n=new Wa,i=my(t.body);for await(const s of H_(i))for(const o of n.decode(s)){const a=r.decode(o);a&&(yield a)}for(const s of n.flush()){const o=r.decode(s);o&&(yield o)}}async function*H_(t){let e=new Uint8Array;for await(const r of t){if(r==null)continue;const n=r instanceof ArrayBuffer?new Uint8Array(r):typeof r=="string"?new TextEncoder().encode(r):r;let i=new Uint8Array(e.length+n.length);i.set(e),i.set(n,e.length),e=i;let s;for(;(s=V_(e))!==-1;)yield e.slice(0,s),e=e.slice(s)}e.length>0&&(yield e)}class G_{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,i]=K_(e,":");return i.startsWith(" ")&&(i=i.substring(1)),r==="event"?this.event=i:r==="data"&&this.data.push(i),null}}function K_(t,e){const r=t.indexOf(e);return r!==-1?[t.substring(0,r),e,t.substring(r+e.length)]:[t,"",""]}const gy=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",yy=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Ha(t),Ha=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",J_=t=>yy(t)||gy(t)||ny(t);async function wy(t,e,r){var i;if(t=await t,yy(t))return t;if(gy(t)){const s=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=Ha(s)?[await s.arrayBuffer()]:[s];return new nu(o,e,r)}const n=await q_(t);if(e||(e=Q_(t)??"unknown_file"),!(r!=null&&r.type)){const s=(i=n[0])==null?void 0:i.type;typeof s=="string"&&(r={...r,type:s})}return new nu(n,e,r)}async function q_(t){var r;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Ha(t))e.push(await t.arrayBuffer());else if(X_(t))for await(const n of t)e.push(n);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(r=t==null?void 0:t.constructor)==null?void 0:r.name}; props: ${Y_(t)}`);return e}function Y_(t){return`[${Object.getOwnPropertyNames(t).map(r=>`"${r}"`).join(", ")}]`}function Q_(t){var e;return Fl(t.name)||Fl(t.filename)||((e=Fl(t.path))==null?void 0:e.split(/[\\/]/).pop())}const Fl=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},X_=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",Pf=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",dn=async t=>{const e=await Z_(t.body);return ey(e,t)},Z_=async t=>{const e=new Xg;return await Promise.all(Object.entries(t||{}).map(([r,n])=>iu(e,r,n))),e},iu=async(t,e,r)=>{if(r!==void 0){if(r==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")t.append(e,String(r));else if(J_(r)){const n=await wy(r);t.append(e,n)}else if(Array.isArray(r))await Promise.all(r.map(n=>iu(t,e+"[]",n)));else if(typeof r=="object")await Promise.all(Object.entries(r).map(([n,i])=>iu(t,`${e}[${n}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var Zn={},eb=function(t,e,r,n,i){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,r),r},tb=function(t,e,r,n){if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},fo;iy();async function vy(t){var o;const{response:e}=t;if(t.options.stream)return Lr("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):qt.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const r=e.headers.get("content-type"),n=(o=r==null?void 0:r.split(";")[0])==null?void 0:o.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const a=await e.json();return Lr("response",e.status,e.url,e.headers,a),_y(a,e)}const s=await e.text();return Lr("response",e.status,e.url,e.headers,s),s}function _y(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Ga extends Promise{constructor(e,r=vy){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=r}_thenUnwrap(e){return new Ga(this.responsePromise,async r=>_y(e(await this.parseResponse(r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:r,request_id:r.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,r){return this.parse().then(e,r)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class rb{constructor({baseURL:e,maxRetries:r=2,timeout:n=6e5,httpAgent:i,fetch:s}){this.baseURL=e,this.maxRetries=zl("maxRetries",r),this.timeout=zl("timeout",n),this.httpAgent=i,this.fetch=s??Qg}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ab(),...this.authHeaders(e)}}validateHeaders(e,r){}defaultIdempotencyKey(){return`stainless-node-retry-${db()}`}get(e,r){return this.methodRequest("get",e,r)}post(e,r){return this.methodRequest("post",e,r)}patch(e,r){return this.methodRequest("patch",e,r)}put(e,r){return this.methodRequest("put",e,r)}delete(e,r){return this.methodRequest("delete",e,r)}methodRequest(e,r,n){return this.request(Promise.resolve(n).then(async i=>{const s=i&&Ha(i==null?void 0:i.body)?new DataView(await i.body.arrayBuffer()):(i==null?void 0:i.body)instanceof DataView?i.body:(i==null?void 0:i.body)instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i==null?void 0:i.body)?new DataView(i.body.buffer):i==null?void 0:i.body;return{method:e,path:r,...i,body:s}}))}getAPIList(e,r,n){return this.requestAPIList(r,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:r=0}={}){var y;const n={...e},{method:i,path:s,query:o,headers:a={}}=n,l=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:Pf(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,c=this.calculateContentLength(l),u=this.buildURL(s,o);"timeout"in n&&zl("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const d=n.httpAgent??this.httpAgent??ty(u),h=n.timeout+1e3;typeof((y=d==null?void 0:d.options)==null?void 0:y.timeout)=="number"&&h>(d.options.timeout??0)&&(d.options.timeout=h),this.idempotencyHeader&&i!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const f=this.buildHeaders({options:n,headers:a,contentLength:c,retryCount:r});return{req:{method:i,...l&&{body:l},headers:f,...d&&{agent:d},signal:n.signal??null},url:u,timeout:n.timeout}}buildHeaders({options:e,headers:r,contentLength:n,retryCount:i}){const s={};n&&(s["content-length"]=n);const o=this.defaultHeaders(e);return Cf(s,o),Cf(s,r),Pf(e.body)&&ns!=="node"&&delete s["content-type"],mo(o,"x-stainless-retry-count")===void 0&&mo(r,"x-stainless-retry-count")===void 0&&(s["x-stainless-retry-count"]=String(i)),mo(o,"x-stainless-timeout")===void 0&&mo(r,"x-stainless-timeout")===void 0&&e.timeout&&(s["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(s,r),s}async prepareOptions(e){}async prepareRequest(e,{url:r,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(r=>[...r])):{...e}:{}}makeStatusError(e,r,n,i){return Fe.generate(e,r,n,i)}request(e,r=null){return new Ga(this.makeRequest(e,r))}async makeRequest(e,r){var d,h;const n=await e,i=n.maxRetries??this.maxRetries;r==null&&(r=i),await this.prepareOptions(n);const{req:s,url:o,timeout:a}=this.buildRequest(n,{retryCount:i-r});if(await this.prepareRequest(s,{url:o,options:n}),Lr("request",o,n,s.headers),(d=n.signal)!=null&&d.aborted)throw new Et;const l=new AbortController,c=await this.fetchWithTimeout(o,s,a,l).catch(su);if(c instanceof Error){if((h=n.signal)!=null&&h.aborted)throw new Et;if(r)return this.retryRequest(n,r);throw c.name==="AbortError"?new Sd:new Va({cause:c})}const u=Sy(c.headers);if(!c.ok){if(r&&this.shouldRetry(c)){const p=`retrying, ${r} attempts remaining`;return Lr(`response (error; ${p})`,c.status,o,u),this.retryRequest(n,r,u)}const f=await c.text().catch(p=>su(p).message),m=lb(f),y=m?void 0:f;throw Lr(`response (error; ${r?"(error; no more retries left)":"(error; not retryable)"})`,c.status,o,u,y),this.makeStatusError(c.status,m,y,u)}return{response:c,options:n,controller:l}}requestAPIList(e,r){const n=this.makeRequest(r,null);return new nb(this,n,e)}buildURL(e,r){const n=ub(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return Ey(i)||(r={...i,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(n.search=this.stringifyQuery(r)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([r,n])=>typeof n<"u").map(([r,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(r)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(r)}=`;throw new W(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,r,n,i){const{signal:s,...o}=r||{};s&&s.addEventListener("abort",()=>i.abort());const a=setTimeout(()=>i.abort(),n),l={signal:i.signal,...o};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(a)})}shouldRetry(e){const r=e.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,r,n){let i;const s=n==null?void 0:n["retry-after-ms"];if(s){const a=parseFloat(s);Number.isNaN(a)||(i=a)}const o=n==null?void 0:n["retry-after"];if(o&&!i){const a=parseFloat(o);Number.isNaN(a)?i=Date.parse(o)-Date.now():i=a*1e3}if(!(i&&0<=i&&i<60*1e3)){const a=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(r,a)}return await Ms(i),this.makeRequest(e,r-1)}calculateDefaultRetryTimeoutMillis(e,r){const s=r-e,o=Math.min(.5*Math.pow(2,s),8),a=1-Math.random()*.25;return o*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${kn}`}}class by{constructor(e,r,n,i){fo.set(this,void 0),eb(this,fo,e),this.options=i,this.response=r,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new W("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const r={...this.options};if("params"in e&&typeof r.query=="object")r.query={...r.query,...e.params};else if("url"in e){const n=[...Object.entries(r.query||{}),...e.url.searchParams.entries()];for(const[i,s]of n)e.url.searchParams.set(i,s);r.query=void 0,r.path=e.url.toString()}return await tb(this,fo,"f").requestAPIList(this.constructor,r)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(fo=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const r of e.getPaginatedItems())yield r}}class nb extends Ga{constructor(e,r,n){super(r,async i=>new n(e,i.response,await vy(i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const r of e)yield r}}const Sy=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,r){const n=r.toString();return e[n.toLowerCase()]||e[n]}}),ib={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ge=t=>typeof t=="object"&&t!==null&&!Ey(t)&&Object.keys(t).every(e=>Ry(ib,e)),sb=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kn,"X-Stainless-OS":Of(Deno.build.os),"X-Stainless-Arch":Af(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kn,"X-Stainless-OS":Of(process.platform),"X-Stainless-Arch":Af(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=ob();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":kn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function ob(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:r}of t){const n=r.exec(navigator.userAgent);if(n){const i=n[1]||0,s=n[2]||0,o=n[3]||0;return{browser:e,version:`${i}.${s}.${o}`}}}return null}const Af=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",Of=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let Nf;const ab=()=>Nf??(Nf=sb()),lb=t=>{try{return JSON.parse(t)}catch{return}},cb=/^[a-z][a-z0-9+.-]*:/i,ub=t=>cb.test(t),Ms=t=>new Promise(e=>setTimeout(e,t)),zl=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new W(`${t} must be an integer`);if(e<0)throw new W(`${t} must be a positive integer`);return e},su=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},po=t=>{var e,r,n,i;if(typeof process<"u")return((e=Zn==null?void 0:Zn[t])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(i=(n=(r=Deno.env)==null?void 0:r.get)==null?void 0:n.call(r,t))==null?void 0:i.trim()};function Ey(t){if(!t)return!0;for(const e in t)return!1;return!0}function Ry(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Cf(t,e){for(const r in e){if(!Ry(e,r))continue;const n=r.toLowerCase();if(!n)continue;const i=e[r];i===null?delete t[n]:i!==void 0&&(t[n]=i)}}const Df=new Set(["authorization","api-key"]);function Lr(t,...e){if(typeof process<"u"&&(Zn==null?void 0:Zn.DEBUG)==="true"){const r=e.map(n=>{if(!n)return n;if(n.headers){const s={...n,headers:{...n.headers}};for(const o in n.headers)Df.has(o.toLowerCase())&&(s.headers[o]="REDACTED");return s}let i=null;for(const s in n)Df.has(s.toLowerCase())&&(i??(i={...n}),i[s]="REDACTED");return i??n});console.log(`OpenAI:DEBUG:${t}`,...r)}}const db=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),hb=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",fb=t=>typeof(t==null?void 0:t.get)=="function",mo=(t,e)=>{var n;const r=e.toLowerCase();if(fb(t)){const i=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(s,o,a)=>o+a.toUpperCase());for(const s of[e,r,e.toUpperCase(),i]){const o=t.get(s);if(o)return o}}for(const[i,s]of Object.entries(t))if(i.toLowerCase()===r)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s},pb=t=>{if(typeof Buffer<"u"){const e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(t),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.charCodeAt(i);return Array.from(new Float32Array(n.buffer))}};function Vl(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}class Ka extends by{constructor(e,r,n,i){super(e,r,n,i),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Pe extends by{constructor(e,r,n,i){super(e,r,n,i),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const r=Object.fromEntries(e.url.searchParams);return Object.keys(r).length?r:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const r=(n=e[e.length-1])==null?void 0:n.id;return r?{params:{after:r}}:null}}class G{constructor(e){this._client=e}}let xy=class extends G{list(e,r={},n){return ge(r)?this.list(e,{},r):this._client.getAPIList(`/chat/completions/${e}/messages`,mb,{query:r,...n})}},Ja=class extends G{constructor(){super(...arguments),this.messages=new xy(this._client)}create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}retrieve(e,r){return this._client.get(`/chat/completions/${e}`,r)}update(e,r,n){return this._client.post(`/chat/completions/${e}`,{body:r,...n})}list(e={},r){return ge(e)?this.list({},e):this._client.getAPIList("/chat/completions",qa,{query:e,...r})}del(e,r){return this._client.delete(`/chat/completions/${e}`,r)}};class qa extends Pe{}class mb extends Pe{}Ja.ChatCompletionsPage=qa;Ja.Messages=xy;let Ya=class extends G{constructor(){super(...arguments),this.completions=new Ja(this._client)}};Ya.Completions=Ja;Ya.ChatCompletionsPage=qa;class Ty extends G{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:{Accept:"application/octet-stream",...r==null?void 0:r.headers},__binaryResponse:!0})}}class ky extends G{create(e,r){return this._client.post("/audio/transcriptions",dn({body:e,...r,stream:e.stream??!1,__metadata:{model:e.model}}))}}class Iy extends G{create(e,r){return this._client.post("/audio/translations",dn({body:e,...r,__metadata:{model:e.model}}))}}class Bs extends G{constructor(){super(...arguments),this.transcriptions=new ky(this._client),this.translations=new Iy(this._client),this.speech=new Ty(this._client)}}Bs.Transcriptions=ky;Bs.Translations=Iy;Bs.Speech=Ty;class Ed extends G{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(`/batches/${e}`,r)}list(e={},r){return ge(e)?this.list({},e):this._client.getAPIList("/batches",Rd,{query:e,...r})}cancel(e,r){return this._client.post(`/batches/${e}/cancel`,r)}}class Rd extends Pe{}Ed.BatchesPage=Rd;var Ot=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},he=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},ou,zo,Vo,Fi,zi,Wo,Vi,tr,Wi,va,_a,In,Py;class xd{constructor(){ou.add(this),this.controller=new AbortController,zo.set(this,void 0),Vo.set(this,()=>{}),Fi.set(this,()=>{}),zi.set(this,void 0),Wo.set(this,()=>{}),Vi.set(this,()=>{}),tr.set(this,{}),Wi.set(this,!1),va.set(this,!1),_a.set(this,!1),In.set(this,!1),Ot(this,zo,new Promise((e,r)=>{Ot(this,Vo,e,"f"),Ot(this,Fi,r,"f")}),"f"),Ot(this,zi,new Promise((e,r)=>{Ot(this,Wo,e,"f"),Ot(this,Vi,r,"f")}),"f"),he(this,zo,"f").catch(()=>{}),he(this,zi,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},he(this,ou,"m",Py).bind(this))},0)}_connected(){this.ended||(he(this,Vo,"f").call(this),this._emit("connect"))}get ended(){return he(this,Wi,"f")}get errored(){return he(this,va,"f")}get aborted(){return he(this,_a,"f")}abort(){this.controller.abort()}on(e,r){return(he(this,tr,"f")[e]||(he(this,tr,"f")[e]=[])).push({listener:r}),this}off(e,r){const n=he(this,tr,"f")[e];if(!n)return this;const i=n.findIndex(s=>s.listener===r);return i>=0&&n.splice(i,1),this}once(e,r){return(he(this,tr,"f")[e]||(he(this,tr,"f")[e]=[])).push({listener:r,once:!0}),this}emitted(e){return new Promise((r,n)=>{Ot(this,In,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,r)})}async done(){Ot(this,In,!0,"f"),await he(this,zi,"f")}_emit(e,...r){if(he(this,Wi,"f"))return;e==="end"&&(Ot(this,Wi,!0,"f"),he(this,Wo,"f").call(this));const n=he(this,tr,"f")[e];if(n&&(he(this,tr,"f")[e]=n.filter(i=>!i.once),n.forEach(({listener:i})=>i(...r))),e==="abort"){const i=r[0];!he(this,In,"f")&&!(n!=null&&n.length)&&Promise.reject(i),he(this,Fi,"f").call(this,i),he(this,Vi,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=r[0];!he(this,In,"f")&&!(n!=null&&n.length)&&Promise.reject(i),he(this,Fi,"f").call(this,i),he(this,Vi,"f").call(this,i),this._emit("end")}}_emitFinal(){}}zo=new WeakMap,Vo=new WeakMap,Fi=new WeakMap,zi=new WeakMap,Wo=new WeakMap,Vi=new WeakMap,tr=new WeakMap,Wi=new WeakMap,va=new WeakMap,_a=new WeakMap,In=new WeakMap,ou=new WeakSet,Py=function(e){if(Ot(this,va,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Et),e instanceof Et)return Ot(this,_a,!0,"f"),this._emit("abort",e);if(e instanceof W)return this._emit("error",e);if(e instanceof Error){const r=new W(e.message);return r.cause=e,this._emit("error",r)}return this._emit("error",new W(String(e)))};var $=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},ot=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},$e,au,Kt,Ho,Ct,tn,Wn,qr,ba,ct,Go,Ko,is,Hi,Gi,Lf,jf,Uf,$f,Mf,Bf,Ff;class $t extends xd{constructor(){super(...arguments),$e.add(this),au.set(this,[]),Kt.set(this,{}),Ho.set(this,{}),Ct.set(this,void 0),tn.set(this,void 0),Wn.set(this,void 0),qr.set(this,void 0),ba.set(this,void 0),ct.set(this,void 0),Go.set(this,void 0),Ko.set(this,void 0),is.set(this,void 0)}[(au=new WeakMap,Kt=new WeakMap,Ho=new WeakMap,Ct=new WeakMap,tn=new WeakMap,Wn=new WeakMap,qr=new WeakMap,ba=new WeakMap,ct=new WeakMap,Go=new WeakMap,Ko=new WeakMap,is=new WeakMap,$e=new WeakSet,Symbol.asyncIterator)](){const e=[],r=[];let n=!1;return this.on("event",i=>{const s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(const i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(const s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(const s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,o)=>r.push({resolve:s,reject:o})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const r=new $t;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){var s;const n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=qt.fromReadableStream(e,this.controller);for await(const o of i)$(this,$e,"m",Hi).call(this,o);if((s=i.controller.signal)!=null&&s.aborted)throw new Et;return this._addRun($(this,$e,"m",Gi).call(this))}toReadableStream(){return new qt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,n,i,s){const o=new $t;return o._run(()=>o._runToolAssistantStream(e,r,n,i,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(e,r,n,i,s){var c;const o=s==null?void 0:s.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const a={...i,stream:!0},l=await e.submitToolOutputs(r,n,a,{...s,signal:this.controller.signal});this._connected();for await(const u of l)$(this,$e,"m",Hi).call(this,u);if((c=l.controller.signal)!=null&&c.aborted)throw new Et;return this._addRun($(this,$e,"m",Gi).call(this))}static createThreadAssistantStream(e,r,n){const i=new $t;return i._run(()=>i._threadAssistantStream(e,r,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,r,n,i){const s=new $t;return s._run(()=>s._runAssistantStream(e,r,n,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return $(this,Go,"f")}currentRun(){return $(this,Ko,"f")}currentMessageSnapshot(){return $(this,Ct,"f")}currentRunStepSnapshot(){return $(this,is,"f")}async finalRunSteps(){return await this.done(),Object.values($(this,Kt,"f"))}async finalMessages(){return await this.done(),Object.values($(this,Ho,"f"))}async finalRun(){if(await this.done(),!$(this,tn,"f"))throw Error("Final run was not received.");return $(this,tn,"f")}async _createThreadAssistantStream(e,r,n){var a;const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const s={...r,stream:!0},o=await e.createAndRun(s,{...n,signal:this.controller.signal});this._connected();for await(const l of o)$(this,$e,"m",Hi).call(this,l);if((a=o.controller.signal)!=null&&a.aborted)throw new Et;return this._addRun($(this,$e,"m",Gi).call(this))}async _createAssistantStream(e,r,n,i){var l;const s=i==null?void 0:i.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const o={...n,stream:!0},a=await e.create(r,o,{...i,signal:this.controller.signal});this._connected();for await(const c of a)$(this,$e,"m",Hi).call(this,c);if((l=a.controller.signal)!=null&&l.aborted)throw new Et;return this._addRun($(this,$e,"m",Gi).call(this))}static accumulateDelta(e,r){for(const[n,i]of Object.entries(r)){if(!e.hasOwnProperty(n)){e[n]=i;continue}let s=e[n];if(s==null){e[n]=i;continue}if(n==="index"||n==="type"){e[n]=i;continue}if(typeof s=="string"&&typeof i=="string")s+=i;else if(typeof s=="number"&&typeof i=="number")s+=i;else if(Vl(s)&&Vl(i))s=this.accumulateDelta(s,i);else if(Array.isArray(s)&&Array.isArray(i)){if(s.every(o=>typeof o=="string"||typeof o=="number")){s.push(...i);continue}for(const o of i){if(!Vl(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);const a=o.index;if(a==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof a!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${a}`);const l=s[a];l==null?s.push(o):s[a]=this.accumulateDelta(l,o)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${i}, accValue: ${s}`);e[n]=s}return e}_addRun(e){return e}async _threadAssistantStream(e,r,n){return await this._createThreadAssistantStream(r,e,n)}async _runAssistantStream(e,r,n,i){return await this._createAssistantStream(r,e,n,i)}async _runToolAssistantStream(e,r,n,i,s){return await this._createToolAssistantStream(n,e,r,i,s)}}Hi=function(e){if(!this.ended)switch(ot(this,Go,e,"f"),$(this,$e,"m",Uf).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":$(this,$e,"m",Ff).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":$(this,$e,"m",jf).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":$(this,$e,"m",Lf).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Gi=function(){if(this.ended)throw new W("stream has ended, this shouldn't happen");if(!$(this,tn,"f"))throw Error("Final run has not been received");return $(this,tn,"f")},Lf=function(e){const[r,n]=$(this,$e,"m",Mf).call(this,e,$(this,Ct,"f"));ot(this,Ct,r,"f"),$(this,Ho,"f")[r.id]=r;for(const i of n){const s=r.content[i.index];(s==null?void 0:s.type)=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let s=i.text,o=r.content[i.index];if(o&&o.type=="text")this._emit("textDelta",s,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=$(this,Wn,"f")){if($(this,qr,"f"))switch($(this,qr,"f").type){case"text":this._emit("textDone",$(this,qr,"f").text,$(this,Ct,"f"));break;case"image_file":this._emit("imageFileDone",$(this,qr,"f").image_file,$(this,Ct,"f"));break}ot(this,Wn,i.index,"f")}ot(this,qr,r.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if($(this,Wn,"f")!==void 0){const i=e.data.content[$(this,Wn,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,$(this,Ct,"f"));break;case"text":this._emit("textDone",i.text,$(this,Ct,"f"));break}}$(this,Ct,"f")&&this._emit("messageDone",e.data),ot(this,Ct,void 0,"f")}},jf=function(e){const r=$(this,$e,"m",$f).call(this,e);switch(ot(this,is,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&r.step_details.type=="tool_calls")for(const s of n.step_details.tool_calls)s.index==$(this,ba,"f")?this._emit("toolCallDelta",s,r.step_details.tool_calls[s.index]):($(this,ct,"f")&&this._emit("toolCallDone",$(this,ct,"f")),ot(this,ba,s.index,"f"),ot(this,ct,r.step_details.tool_calls[s.index],"f"),$(this,ct,"f")&&this._emit("toolCallCreated",$(this,ct,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ot(this,is,void 0,"f"),e.data.step_details.type=="tool_calls"&&$(this,ct,"f")&&(this._emit("toolCallDone",$(this,ct,"f")),ot(this,ct,void 0,"f")),this._emit("runStepDone",e.data,r);break}},Uf=function(e){$(this,au,"f").push(e),this._emit("event",e)},$f=function(e){switch(e.event){case"thread.run.step.created":return $(this,Kt,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=$(this,Kt,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const i=$t.accumulateDelta(r,n.delta);$(this,Kt,"f")[e.data.id]=i}return $(this,Kt,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":$(this,Kt,"f")[e.data.id]=e.data;break}if($(this,Kt,"f")[e.data.id])return $(this,Kt,"f")[e.data.id];throw new Error("No snapshot available")},Mf=function(e,r){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const s of i.delta.content)if(s.index in r.content){let o=r.content[s.index];r.content[s.index]=$(this,$e,"m",Bf).call(this,s,o)}else r.content[s.index]=s,n.push(s);return[r,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Bf=function(e,r){return $t.accumulateDelta(r,e)},Ff=function(e){switch(ot(this,Ko,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":ot(this,tn,e.data,"f"),$(this,ct,"f")&&(this._emit("toolCallDone",$(this,ct,"f")),ot(this,ct,void 0,"f"));break}};class Td extends G{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,r){return this._client.get(`/assistants/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,r,n){return this._client.post(`/assistants/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},r){return ge(e)?this.list({},e):this._client.getAPIList("/assistants",kd,{query:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,r){return this._client.delete(`/assistants/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class kd extends Pe{}Td.AssistantsPage=kd;function zf(t){return typeof t.parse=="function"}const ei=t=>(t==null?void 0:t.role)==="assistant",Ay=t=>(t==null?void 0:t.role)==="function",Oy=t=>(t==null?void 0:t.role)==="tool";function Id(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function Fs(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function gb(t,e){return!e||!Ny(e)?{...t,choices:t.choices.map(r=>({...r,message:{...r.message,parsed:null,...r.message.tool_calls?{tool_calls:r.message.tool_calls}:void 0}}))}:Pd(t,e)}function Pd(t,e){const r=t.choices.map(n=>{var i;if(n.finish_reason==="length")throw new fy;if(n.finish_reason==="content_filter")throw new py;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((i=n.message.tool_calls)==null?void 0:i.map(s=>wb(e,s)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?yb(e,n.message.content):null}}});return{...t,choices:r}}function yb(t,e){var r,n;return((r=t.response_format)==null?void 0:r.type)!=="json_schema"?null:((n=t.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function wb(t,e){var n;const r=(n=t.tools)==null?void 0:n.find(i=>{var s;return((s=i.function)==null?void 0:s.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Fs(r)?r.$parseRaw(e.function.arguments):r!=null&&r.function.strict?JSON.parse(e.function.arguments):null}}}function vb(t,e){var n;if(!t)return!1;const r=(n=t.tools)==null?void 0:n.find(i=>{var s;return((s=i.function)==null?void 0:s.name)===e.function.name});return Fs(r)||(r==null?void 0:r.function.strict)||!1}function Ny(t){var e;return Id(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(r=>Fs(r)||r.type==="function"&&r.function.strict===!0))??!1}function _b(t){for(const e of t??[]){if(e.type!=="function")throw new W(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new W(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var et=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Ge,lu,Sa,cu,uu,du,Cy,hu;const Vf=10;class Dy extends xd{constructor(){super(...arguments),Ge.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const r=(n=e.choices[0])==null?void 0:n.message;return r&&this._addMessage(r),e}_addMessage(e,r=!0){if("content"in e||(e.content=null),this.messages.push(e),r){if(this._emit("message",e),(Ay(e)||Oy(e))&&e.content)this._emit("functionCallResult",e.content);else if(ei(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ei(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new W("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),et(this,Ge,"m",lu).call(this)}async finalMessage(){return await this.done(),et(this,Ge,"m",Sa).call(this)}async finalFunctionCall(){return await this.done(),et(this,Ge,"m",cu).call(this)}async finalFunctionCallResult(){return await this.done(),et(this,Ge,"m",uu).call(this)}async totalUsage(){return await this.done(),et(this,Ge,"m",du).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const r=et(this,Ge,"m",Sa).call(this);r&&this._emit("finalMessage",r);const n=et(this,Ge,"m",lu).call(this);n&&this._emit("finalContent",n);const i=et(this,Ge,"m",cu).call(this);i&&this._emit("finalFunctionCall",i);const s=et(this,Ge,"m",uu).call(this);s!=null&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",et(this,Ge,"m",du).call(this))}async _createChatCompletion(e,r,n){const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),et(this,Ge,"m",Cy).call(this,r);const s=await e.chat.completions.create({...r,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Pd(s,r))}async _runChatCompletion(e,r,n){for(const i of r.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,r,n)}async _runFunctions(e,r,n){var h;const i="function",{function_call:s="auto",stream:o,...a}=r,l=typeof s!="string"&&(s==null?void 0:s.name),{maxChatCompletions:c=Vf}=n||{},u={};for(const f of r.functions)u[f.name||f.function.name]=f;const d=r.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(const f of r.messages)this._addMessage(f,!1);for(let f=0;f<c;++f){const y=(h=(await this._createChatCompletion(e,{...a,function_call:s,functions:d,messages:[...this.messages]},n)).choices[0])==null?void 0:h.message;if(!y)throw new W("missing message in ChatCompletion response");if(!y.function_call)return;const{name:v,arguments:w}=y.function_call,p=u[v];if(p){if(l&&l!==v){const R=`Invalid function_call: ${JSON.stringify(v)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:i,name:v,content:R});continue}}else{const R=`Invalid function_call: ${JSON.stringify(v)}. Available options are: ${d.map(x=>JSON.stringify(x.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:v,content:R});continue}let g;try{g=zf(p)?await p.parse(w):w}catch(R){this._addMessage({role:i,name:v,content:R instanceof Error?R.message:String(R)});continue}const _=await p.function(g,this),S=et(this,Ge,"m",hu).call(this,_);if(this._addMessage({role:i,name:v,content:S}),l)return}}async _runTools(e,r,n){var f,m,y;const i="tool",{tool_choice:s="auto",stream:o,...a}=r,l=typeof s!="string"&&((f=s==null?void 0:s.function)==null?void 0:f.name),{maxChatCompletions:c=Vf}=n||{},u=r.tools.map(v=>{if(Fs(v)){if(!v.$callback)throw new W("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:v.$callback,name:v.function.name,description:v.function.description||"",parameters:v.function.parameters,parse:v.$parseRaw,strict:!0}}}return v}),d={};for(const v of u)v.type==="function"&&(d[v.function.name||v.function.function.name]=v.function);const h="tools"in r?u.map(v=>v.type==="function"?{type:"function",function:{name:v.function.name||v.function.function.name,parameters:v.function.parameters,description:v.function.description,strict:v.function.strict}}:v):void 0;for(const v of r.messages)this._addMessage(v,!1);for(let v=0;v<c;++v){const p=(m=(await this._createChatCompletion(e,{...a,tool_choice:s,tools:h,messages:[...this.messages]},n)).choices[0])==null?void 0:m.message;if(!p)throw new W("missing message in ChatCompletion response");if(!((y=p.tool_calls)!=null&&y.length))return;for(const g of p.tool_calls){if(g.type!=="function")continue;const _=g.id,{name:S,arguments:R}=g.function,x=d[S];if(x){if(l&&l!==S){const M=`Invalid tool_call: ${JSON.stringify(S)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:i,tool_call_id:_,content:M});continue}}else{const M=`Invalid tool_call: ${JSON.stringify(S)}. Available options are: ${Object.keys(d).map(B=>JSON.stringify(B)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:_,content:M});continue}let T;try{T=zf(x)?await x.parse(R):R}catch(M){const B=M instanceof Error?M.message:String(M);this._addMessage({role:i,tool_call_id:_,content:B});continue}const I=await x.function(T,this),N=et(this,Ge,"m",hu).call(this,I);if(this._addMessage({role:i,tool_call_id:_,content:N}),l)return}}}}Ge=new WeakSet,lu=function(){return et(this,Ge,"m",Sa).call(this).content??null},Sa=function(){let e=this.messages.length;for(;e-- >0;){const r=this.messages[e];if(ei(r)){const{function_call:n,...i}=r,s={...i,content:r.content??null,refusal:r.refusal??null};return n&&(s.function_call=n),s}}throw new W("stream ended without producing a ChatCompletionMessage with role=assistant")},cu=function(){var e,r;for(let n=this.messages.length-1;n>=0;n--){const i=this.messages[n];if(ei(i)&&(i!=null&&i.function_call))return i.function_call;if(ei(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(r=i.tool_calls.at(-1))==null?void 0:r.function}},uu=function(){for(let e=this.messages.length-1;e>=0;e--){const r=this.messages[e];if(Ay(r)&&r.content!=null||Oy(r)&&r.content!=null&&typeof r.content=="string"&&this.messages.some(n=>{var i;return n.role==="assistant"&&((i=n.tool_calls)==null?void 0:i.some(s=>s.type==="function"&&s.id===r.tool_call_id))}))return r.content}},du=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:r}of this._chatCompletions)r&&(e.completion_tokens+=r.completion_tokens,e.prompt_tokens+=r.prompt_tokens,e.total_tokens+=r.total_tokens);return e},Cy=function(e){if(e.n!=null&&e.n>1)throw new W("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},hu=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class xs extends Dy{static runFunctions(e,r,n){const i=new xs,s={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,r,s)),i}static runTools(e,r,n){const i=new xs,s={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,s)),i}_addMessage(e,r=!0){super._addMessage(e,r),ei(e)&&e.content&&this._emit("content",e.content)}}const Ly=1,jy=2,Uy=4,$y=8,My=16,By=32,Fy=64,zy=128,Vy=256,Wy=zy|Vy,Hy=My|By|Wy|Fy,Gy=Ly|jy|Hy,Ky=Uy|$y,bb=Gy|Ky,Oe={STR:Ly,NUM:jy,ARR:Uy,OBJ:$y,NULL:My,BOOL:By,NAN:Fy,INFINITY:zy,MINUS_INFINITY:Vy,INF:Wy,SPECIAL:Hy,ATOM:Gy,COLLECTION:Ky,ALL:bb};class Sb extends Error{}class Eb extends Error{}function Rb(t,e=Oe.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return xb(t.trim(),e)}const xb=(t,e)=>{const r=t.length;let n=0;const i=h=>{throw new Sb(`${h} at position ${n}`)},s=h=>{throw new Eb(`${h} at position ${n}`)},o=()=>(d(),n>=r&&i("Unexpected end of input"),t[n]==='"'?a():t[n]==="{"?l():t[n]==="["?c():t.substring(n,n+4)==="null"||Oe.NULL&e&&r-n<4&&"null".startsWith(t.substring(n))?(n+=4,null):t.substring(n,n+4)==="true"||Oe.BOOL&e&&r-n<4&&"true".startsWith(t.substring(n))?(n+=4,!0):t.substring(n,n+5)==="false"||Oe.BOOL&e&&r-n<5&&"false".startsWith(t.substring(n))?(n+=5,!1):t.substring(n,n+8)==="Infinity"||Oe.INFINITY&e&&r-n<8&&"Infinity".startsWith(t.substring(n))?(n+=8,1/0):t.substring(n,n+9)==="-Infinity"||Oe.MINUS_INFINITY&e&&1<r-n&&r-n<9&&"-Infinity".startsWith(t.substring(n))?(n+=9,-1/0):t.substring(n,n+3)==="NaN"||Oe.NAN&e&&r-n<3&&"NaN".startsWith(t.substring(n))?(n+=3,NaN):u()),a=()=>{const h=n;let f=!1;for(n++;n<r&&(t[n]!=='"'||f&&t[n-1]==="\\");)f=t[n]==="\\"?!f:!1,n++;if(t.charAt(n)=='"')try{return JSON.parse(t.substring(h,++n-Number(f)))}catch(m){s(String(m))}else if(Oe.STR&e)try{return JSON.parse(t.substring(h,n-Number(f))+'"')}catch{return JSON.parse(t.substring(h,t.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},l=()=>{n++,d();const h={};try{for(;t[n]!=="}";){if(d(),n>=r&&Oe.OBJ&e)return h;const f=a();d(),n++;try{const m=o();Object.defineProperty(h,f,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(Oe.OBJ&e)return h;throw m}d(),t[n]===","&&n++}}catch{if(Oe.OBJ&e)return h;i("Expected '}' at end of object")}return n++,h},c=()=>{n++;const h=[];try{for(;t[n]!=="]";)h.push(o()),d(),t[n]===","&&n++}catch{if(Oe.ARR&e)return h;i("Expected ']' at end of array")}return n++,h},u=()=>{if(n===0){t==="-"&&Oe.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t)}catch(f){if(Oe.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}s(String(f))}}const h=n;for(t[n]==="-"&&n++;t[n]&&!",]}".includes(t[n]);)n++;n==r&&!(Oe.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(t.substring(h,n))}catch{t.substring(h,n)==="-"&&Oe.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(t.substring(h,t.lastIndexOf("e")))}catch(m){s(String(m))}}},d=()=>{for(;n<r&&` 
\r	`.includes(t[n]);)n++};return o()},Wf=t=>Rb(t,Oe.ALL^Oe.NUM);var yn=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},ie=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Re,er,wn,gr,Wl,go,Hl,Gl,Kl,yo,Jl,Hf;class Ts extends Dy{constructor(e){super(),Re.add(this),er.set(this,void 0),wn.set(this,void 0),gr.set(this,void 0),yn(this,er,e,"f"),yn(this,wn,[],"f")}get currentChatCompletionSnapshot(){return ie(this,gr,"f")}static fromReadableStream(e){const r=new Ts(null);return r._run(()=>r._fromReadableStream(e)),r}static createChatCompletion(e,r,n){const i=new Ts(r);return i._run(()=>i._runChatCompletion(e,{...r,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,r,n){var o;super._createChatCompletion;const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),ie(this,Re,"m",Wl).call(this);const s=await e.chat.completions.create({...r,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const a of s)ie(this,Re,"m",Hl).call(this,a);if((o=s.controller.signal)!=null&&o.aborted)throw new Et;return this._addChatCompletion(ie(this,Re,"m",yo).call(this))}async _fromReadableStream(e,r){var o;const n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),ie(this,Re,"m",Wl).call(this),this._connected();const i=qt.fromReadableStream(e,this.controller);let s;for await(const a of i)s&&s!==a.id&&this._addChatCompletion(ie(this,Re,"m",yo).call(this)),ie(this,Re,"m",Hl).call(this,a),s=a.id;if((o=i.controller.signal)!=null&&o.aborted)throw new Et;return this._addChatCompletion(ie(this,Re,"m",yo).call(this))}[(er=new WeakMap,wn=new WeakMap,gr=new WeakMap,Re=new WeakSet,Wl=function(){this.ended||yn(this,gr,void 0,"f")},go=function(r){let n=ie(this,wn,"f")[r.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},ie(this,wn,"f")[r.index]=n,n)},Hl=function(r){var i,s,o,a,l,c,u,d,h,f,m,y,v,w,p;if(this.ended)return;const n=ie(this,Re,"m",Hf).call(this,r);this._emit("chunk",r,n);for(const g of r.choices){const _=n.choices[g.index];g.delta.content!=null&&((i=_.message)==null?void 0:i.role)==="assistant"&&((s=_.message)!=null&&s.content)&&(this._emit("content",g.delta.content,_.message.content),this._emit("content.delta",{delta:g.delta.content,snapshot:_.message.content,parsed:_.message.parsed})),g.delta.refusal!=null&&((o=_.message)==null?void 0:o.role)==="assistant"&&((a=_.message)!=null&&a.refusal)&&this._emit("refusal.delta",{delta:g.delta.refusal,snapshot:_.message.refusal}),((l=g.logprobs)==null?void 0:l.content)!=null&&((c=_.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(u=g.logprobs)==null?void 0:u.content,snapshot:((d=_.logprobs)==null?void 0:d.content)??[]}),((h=g.logprobs)==null?void 0:h.refusal)!=null&&((f=_.message)==null?void 0:f.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(m=g.logprobs)==null?void 0:m.refusal,snapshot:((y=_.logprobs)==null?void 0:y.refusal)??[]});const S=ie(this,Re,"m",go).call(this,_);_.finish_reason&&(ie(this,Re,"m",Kl).call(this,_),S.current_tool_call_index!=null&&ie(this,Re,"m",Gl).call(this,_,S.current_tool_call_index));for(const R of g.delta.tool_calls??[])S.current_tool_call_index!==R.index&&(ie(this,Re,"m",Kl).call(this,_),S.current_tool_call_index!=null&&ie(this,Re,"m",Gl).call(this,_,S.current_tool_call_index)),S.current_tool_call_index=R.index;for(const R of g.delta.tool_calls??[]){const x=(v=_.message.tool_calls)==null?void 0:v[R.index];x!=null&&x.type&&((x==null?void 0:x.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(w=x.function)==null?void 0:w.name,index:R.index,arguments:x.function.arguments,parsed_arguments:x.function.parsed_arguments,arguments_delta:((p=R.function)==null?void 0:p.arguments)??""}):(x==null||x.type,void 0))}}},Gl=function(r,n){var o,a,l;if(ie(this,Re,"m",go).call(this,r).done_tool_calls.has(n))return;const s=(o=r.message.tool_calls)==null?void 0:o[n];if(!s)throw new Error("no tool call snapshot");if(!s.type)throw new Error("tool call snapshot missing `type`");if(s.type==="function"){const c=(l=(a=ie(this,er,"f"))==null?void 0:a.tools)==null?void 0:l.find(u=>u.type==="function"&&u.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:n,arguments:s.function.arguments,parsed_arguments:Fs(c)?c.$parseRaw(s.function.arguments):c!=null&&c.function.strict?JSON.parse(s.function.arguments):null})}else s.type},Kl=function(r){var i,s;const n=ie(this,Re,"m",go).call(this,r);if(r.message.content&&!n.content_done){n.content_done=!0;const o=ie(this,Re,"m",Jl).call(this);this._emit("content.done",{content:r.message.content,parsed:o?o.$parseRaw(r.message.content):null})}r.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:r.message.refusal})),(i=r.logprobs)!=null&&i.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:r.logprobs.content})),(s=r.logprobs)!=null&&s.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:r.logprobs.refusal}))},yo=function(){if(this.ended)throw new W("stream has ended, this shouldn't happen");const r=ie(this,gr,"f");if(!r)throw new W("request ended without sending any chunks");return yn(this,gr,void 0,"f"),yn(this,wn,[],"f"),Tb(r,ie(this,er,"f"))},Jl=function(){var n;const r=(n=ie(this,er,"f"))==null?void 0:n.response_format;return Id(r)?r:null},Hf=function(r){var n,i,s,o;let a=ie(this,gr,"f");const{choices:l,...c}=r;a?Object.assign(a,c):a=yn(this,gr,{...c,choices:[]},"f");for(const{delta:u,finish_reason:d,index:h,logprobs:f=null,...m}of r.choices){let y=a.choices[h];if(y||(y=a.choices[h]={finish_reason:d,index:h,message:{},logprobs:f,...m}),f)if(!y.logprobs)y.logprobs=Object.assign({},f);else{const{content:R,refusal:x,...T}=f;Object.assign(y.logprobs,T),R&&((n=y.logprobs).content??(n.content=[]),y.logprobs.content.push(...R)),x&&((i=y.logprobs).refusal??(i.refusal=[]),y.logprobs.refusal.push(...x))}if(d&&(y.finish_reason=d,ie(this,er,"f")&&Ny(ie(this,er,"f")))){if(d==="length")throw new fy;if(d==="content_filter")throw new py}if(Object.assign(y,m),!u)continue;const{content:v,refusal:w,function_call:p,role:g,tool_calls:_,...S}=u;if(Object.assign(y.message,S),w&&(y.message.refusal=(y.message.refusal||"")+w),g&&(y.message.role=g),p&&(y.message.function_call?(p.name&&(y.message.function_call.name=p.name),p.arguments&&((s=y.message.function_call).arguments??(s.arguments=""),y.message.function_call.arguments+=p.arguments)):y.message.function_call=p),v&&(y.message.content=(y.message.content||"")+v,!y.message.refusal&&ie(this,Re,"m",Jl).call(this)&&(y.message.parsed=Wf(y.message.content))),_){y.message.tool_calls||(y.message.tool_calls=[]);for(const{index:R,id:x,type:T,function:I,...N}of _){const M=(o=y.message.tool_calls)[R]??(o[R]={});Object.assign(M,N),x&&(M.id=x),T&&(M.type=T),I&&(M.function??(M.function={name:I.name??"",arguments:""})),I!=null&&I.name&&(M.function.name=I.name),I!=null&&I.arguments&&(M.function.arguments+=I.arguments,vb(ie(this,er,"f"),M)&&(M.function.parsed_arguments=Wf(M.function.arguments)))}}}return a},Symbol.asyncIterator)](){const e=[],r=[];let n=!1;return this.on("chunk",i=>{const s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(const i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(const s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(const s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,o)=>r.push({resolve:s,reject:o})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new qt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Tb(t,e){const{id:r,choices:n,created:i,model:s,system_fingerprint:o,...a}=t,l={...a,id:r,choices:n.map(({message:c,finish_reason:u,index:d,logprobs:h,...f})=>{if(!u)throw new W(`missing finish_reason for choice ${d}`);const{content:m=null,function_call:y,tool_calls:v,...w}=c,p=c.role;if(!p)throw new W(`missing role for choice ${d}`);if(y){const{arguments:g,name:_}=y;if(g==null)throw new W(`missing function_call.arguments for choice ${d}`);if(!_)throw new W(`missing function_call.name for choice ${d}`);return{...f,message:{content:m,function_call:{arguments:g,name:_},role:p,refusal:c.refusal??null},finish_reason:u,index:d,logprobs:h}}return v?{...f,index:d,finish_reason:u,logprobs:h,message:{...w,role:p,content:m,refusal:c.refusal??null,tool_calls:v.map((g,_)=>{const{function:S,type:R,id:x,...T}=g,{arguments:I,name:N,...M}=S||{};if(x==null)throw new W(`missing choices[${d}].tool_calls[${_}].id
${wo(t)}`);if(R==null)throw new W(`missing choices[${d}].tool_calls[${_}].type
${wo(t)}`);if(N==null)throw new W(`missing choices[${d}].tool_calls[${_}].function.name
${wo(t)}`);if(I==null)throw new W(`missing choices[${d}].tool_calls[${_}].function.arguments
${wo(t)}`);return{...T,id:x,type:R,function:{...M,name:N,arguments:I}}})}}:{...f,message:{...w,content:m,role:p,refusal:c.refusal??null},finish_reason:u,index:d,logprobs:h}}),created:i,model:s,object:"chat.completion",...o?{system_fingerprint:o}:{}};return gb(l,e)}function wo(t){return JSON.stringify(t)}class ti extends Ts{static fromReadableStream(e){const r=new ti(null);return r._run(()=>r._fromReadableStream(e)),r}static runFunctions(e,r,n){const i=new ti(null),s={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,r,s)),i}static runTools(e,r,n){const i=new ti(r),s={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,r,s)),i}}let Jy=class extends G{parse(e,r){return _b(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Pd(n,e))}runFunctions(e,r){return e.stream?ti.runFunctions(this._client,e,r):xs.runFunctions(this._client,e,r)}runTools(e,r){return e.stream?ti.runTools(this._client,e,r):xs.runTools(this._client,e,r)}stream(e,r){return Ts.createChatCompletion(this._client,e,r)}};class fu extends G{constructor(){super(...arguments),this.completions=new Jy(this._client)}}(function(t){t.Completions=Jy})(fu||(fu={}));class qy extends G{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Yy extends G{create(e,r){return this._client.post("/realtime/transcription_sessions",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Qa extends G{constructor(){super(...arguments),this.sessions=new qy(this._client),this.transcriptionSessions=new Yy(this._client)}}Qa.Sessions=qy;Qa.TranscriptionSessions=Yy;class Ad extends G{create(e,r,n){return this._client.post(`/threads/${e}/messages`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,r,n){return this._client.get(`/threads/${e}/messages/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,r,n,i){return this._client.post(`/threads/${e}/messages/${r}`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,r={},n){return ge(r)?this.list(e,{},r):this._client.getAPIList(`/threads/${e}/messages`,Od,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,r,n){return this._client.delete(`/threads/${e}/messages/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Od extends Pe{}Ad.MessagesPage=Od;class Nd extends G{retrieve(e,r,n,i={},s){return ge(i)?this.retrieve(e,r,n,{},i):this._client.get(`/threads/${e}/runs/${r}/steps/${n}`,{query:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,r,n={},i){return ge(n)?this.list(e,r,{},n):this._client.getAPIList(`/threads/${e}/runs/${r}/steps`,Cd,{query:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}}class Cd extends Pe{}Nd.RunStepsPage=Cd;let zs=class extends G{constructor(){super(...arguments),this.steps=new Nd(this._client)}create(e,r,n){const{include:i,...s}=r;return this._client.post(`/threads/${e}/runs`,{query:{include:i},body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:r.stream??!1})}retrieve(e,r,n){return this._client.get(`/threads/${e}/runs/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,r,n,i){return this._client.post(`/threads/${e}/runs/${r}`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,r={},n){return ge(r)?this.list(e,{},r):this._client.getAPIList(`/threads/${e}/runs`,Dd,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,r,n){return this._client.post(`/threads/${e}/runs/${r}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,r,n){const i=await this.create(e,r,n);return await this.poll(e,i.id,n)}createAndStream(e,r,n){return $t.createAssistantStream(e,this._client.beta.threads.runs,r,n)}async poll(e,r,n){const i={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:s,response:o}=await this.retrieve(e,r,{...n,headers:{...n==null?void 0:n.headers,...i}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(n!=null&&n.pollIntervalMs)a=n.pollIntervalMs;else{const l=o.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(a=c)}}await Ms(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,r,n){return $t.createAssistantStream(e,this._client.beta.threads.runs,r,n)}submitToolOutputs(e,r,n,i){return this._client.post(`/threads/${e}/runs/${r}/submit_tool_outputs`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,r,n,i){const s=await this.submitToolOutputs(e,r,n,i);return await this.poll(e,s.id,i)}submitToolOutputsStream(e,r,n,i){return $t.createToolAssistantStream(e,r,this._client.beta.threads.runs,n,i)}};class Dd extends Pe{}zs.RunsPage=Dd;zs.Steps=Nd;zs.RunStepsPage=Cd;class gi extends G{constructor(){super(...arguments),this.runs=new zs(this._client),this.messages=new Ad(this._client)}create(e={},r){return ge(e)?this.create({},e):this._client.post("/threads",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,r){return this._client.get(`/threads/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,r,n){return this._client.post(`/threads/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,r){return this._client.delete(`/threads/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:e.stream??!1})}async createAndRunPoll(e,r){const n=await this.createAndRun(e,r);return await this.runs.poll(n.thread_id,n.id,r)}createAndRunStream(e,r){return $t.createThreadAssistantStream(e,this._client.beta.threads,r)}}gi.Runs=zs;gi.RunsPage=Dd;gi.Messages=Ad;gi.MessagesPage=Od;class yi extends G{constructor(){super(...arguments),this.realtime=new Qa(this._client),this.chat=new fu(this._client),this.assistants=new Td(this._client),this.threads=new gi(this._client)}}yi.Realtime=Qa;yi.Assistants=Td;yi.AssistantsPage=kd;yi.Threads=gi;class Qy extends G{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}}class Xy extends G{retrieve(e,r,n){return this._client.get(`/containers/${e}/files/${r}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}}let Xa=class extends G{constructor(){super(...arguments),this.content=new Xy(this._client)}create(e,r,n){return this._client.post(`/containers/${e}/files`,dn({body:r,...n}))}retrieve(e,r,n){return this._client.get(`/containers/${e}/files/${r}`,n)}list(e,r={},n){return ge(r)?this.list(e,{},r):this._client.getAPIList(`/containers/${e}/files`,Ld,{query:r,...n})}del(e,r,n){return this._client.delete(`/containers/${e}/files/${r}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}};class Ld extends Pe{}Xa.FileListResponsesPage=Ld;Xa.Content=Xy;class Vs extends G{constructor(){super(...arguments),this.files=new Xa(this._client)}create(e,r){return this._client.post("/containers",{body:e,...r})}retrieve(e,r){return this._client.get(`/containers/${e}`,r)}list(e={},r){return ge(e)?this.list({},e):this._client.getAPIList("/containers",jd,{query:e,...r})}del(e,r){return this._client.delete(`/containers/${e}`,{...r,headers:{Accept:"*/*",...r==null?void 0:r.headers}})}}class jd extends Pe{}Vs.ContainerListResponsesPage=jd;Vs.Files=Xa;Vs.FileListResponsesPage=Ld;class Zy extends G{create(e,r){const n=!!e.encoding_format;let i=n?e.encoding_format:"base64";n&&Lr("Request","User defined encoding_format:",e.encoding_format);const s=this._client.post("/embeddings",{body:{...e,encoding_format:i},...r});return n?s:(Lr("response","Decoding base64 embeddings to float32 array"),s._thenUnwrap(o=>(o&&o.data&&o.data.forEach(a=>{const l=a.embedding;a.embedding=pb(l)}),o)))}}class Ud extends G{retrieve(e,r,n,i){return this._client.get(`/evals/${e}/runs/${r}/output_items/${n}`,i)}list(e,r,n={},i){return ge(n)?this.list(e,r,{},n):this._client.getAPIList(`/evals/${e}/runs/${r}/output_items`,$d,{query:n,...i})}}class $d extends Pe{}Ud.OutputItemListResponsesPage=$d;class Ws extends G{constructor(){super(...arguments),this.outputItems=new Ud(this._client)}create(e,r,n){return this._client.post(`/evals/${e}/runs`,{body:r,...n})}retrieve(e,r,n){return this._client.get(`/evals/${e}/runs/${r}`,n)}list(e,r={},n){return ge(r)?this.list(e,{},r):this._client.getAPIList(`/evals/${e}/runs`,Md,{query:r,...n})}del(e,r,n){return this._client.delete(`/evals/${e}/runs/${r}`,n)}cancel(e,r,n){return this._client.post(`/evals/${e}/runs/${r}`,n)}}class Md extends Pe{}Ws.RunListResponsesPage=Md;Ws.OutputItems=Ud;Ws.OutputItemListResponsesPage=$d;class Hs extends G{constructor(){super(...arguments),this.runs=new Ws(this._client)}create(e,r){return this._client.post("/evals",{body:e,...r})}retrieve(e,r){return this._client.get(`/evals/${e}`,r)}update(e,r,n){return this._client.post(`/evals/${e}`,{body:r,...n})}list(e={},r){return ge(e)?this.list({},e):this._client.getAPIList("/evals",Bd,{query:e,...r})}del(e,r){return this._client.delete(`/evals/${e}`,r)}}class Bd extends Pe{}Hs.EvalListResponsesPage=Bd;Hs.Runs=Ws;Hs.RunListResponsesPage=Md;let Fd=class extends G{create(e,r){return this._client.post("/files",dn({body:e,...r}))}retrieve(e,r){return this._client.get(`/files/${e}`,r)}list(e={},r){return ge(e)?this.list({},e):this._client.getAPIList("/files",zd,{query:e,...r})}del(e,r){return this._client.delete(`/files/${e}`,r)}content(e,r){return this._client.get(`/files/${e}/content`,{...r,headers:{Accept:"application/binary",...r==null?void 0:r.headers},__binaryResponse:!0})}retrieveContent(e,r){return this._client.get(`/files/${e}/content`,r)}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:n=30*60*1e3}={}){const i=new Set(["processed","error","deleted"]),s=Date.now();let o=await this.retrieve(e);for(;!o.status||!i.has(o.status);)if(await Ms(r),o=await this.retrieve(e),Date.now()-s>n)throw new Sd({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return o}};class zd extends Pe{}Fd.FileObjectsPage=zd;class e0 extends G{}let t0=class extends G{run(e,r){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...r})}validate(e,r){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...r})}};class Vd extends G{constructor(){super(...arguments),this.graders=new t0(this._client)}}Vd.Graders=t0;class Wd extends G{create(e,r,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Hd,{body:r,method:"post",...n})}retrieve(e,r={},n){return ge(r)?this.retrieve(e,{},r):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:r,...n})}del(e,r,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${r}`,n)}}class Hd extends Ka{}Wd.PermissionCreateResponsesPage=Hd;let Za=class extends G{constructor(){super(...arguments),this.permissions=new Wd(this._client)}};Za.Permissions=Wd;Za.PermissionCreateResponsesPage=Hd;class Gd extends G{list(e,r={},n){return ge(r)?this.list(e,{},r):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Kd,{query:r,...n})}}class Kd extends Pe{}Gd.FineTuningJobCheckpointsPage=Kd;class wi extends G{constructor(){super(...arguments),this.checkpoints=new Gd(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(`/fine_tuning/jobs/${e}`,r)}list(e={},r){return ge(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Jd,{query:e,...r})}cancel(e,r){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},n){return ge(r)?this.listEvents(e,{},r):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,qd,{query:r,...n})}pause(e,r){return this._client.post(`/fine_tuning/jobs/${e}/pause`,r)}resume(e,r){return this._client.post(`/fine_tuning/jobs/${e}/resume`,r)}}class Jd extends Pe{}class qd extends Pe{}wi.FineTuningJobsPage=Jd;wi.FineTuningJobEventsPage=qd;wi.Checkpoints=Gd;wi.FineTuningJobCheckpointsPage=Kd;class Fr extends G{constructor(){super(...arguments),this.methods=new e0(this._client),this.jobs=new wi(this._client),this.checkpoints=new Za(this._client),this.alpha=new Vd(this._client)}}Fr.Methods=e0;Fr.Jobs=wi;Fr.FineTuningJobsPage=Jd;Fr.FineTuningJobEventsPage=qd;Fr.Checkpoints=Za;Fr.Alpha=Vd;class r0 extends G{}class Yd extends G{constructor(){super(...arguments),this.graderModels=new r0(this._client)}}Yd.GraderModels=r0;class n0 extends G{createVariation(e,r){return this._client.post("/images/variations",dn({body:e,...r}))}edit(e,r){return this._client.post("/images/edits",dn({body:e,...r}))}generate(e,r){return this._client.post("/images/generations",{body:e,...r})}}class Qd extends G{retrieve(e,r){return this._client.get(`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",Xd,e)}del(e,r){return this._client.delete(`/models/${e}`,r)}}class Xd extends Ka{}Qd.ModelsPage=Xd;class i0 extends G{create(e,r){return this._client.post("/moderations",{body:e,...r})}}function kb(t,e){return!e||!Pb(e)?{...t,output_parsed:null,output:t.output.map(r=>r.type==="function_call"?{...r,parsed_arguments:null}:r.type==="message"?{...r,content:r.content.map(n=>({...n,parsed:null}))}:r)}:s0(t,e)}function s0(t,e){const r=t.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:Nb(e,i)};if(i.type==="message"){const s=i.content.map(o=>o.type==="output_text"?{...o,parsed:Ib(e,o.text)}:o);return{...i,content:s}}return i}),n=Object.assign({},t,{output:r});return Object.getOwnPropertyDescriptor(t,"output_text")||o0(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const i of n.output)if(i.type==="message"){for(const s of i.content)if(s.type==="output_text"&&s.parsed!==null)return s.parsed}return null}}),n}function Ib(t,e){var r,n,i,s;return((n=(r=t.text)==null?void 0:r.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((i=t.text)==null?void 0:i.format)?((s=t.text)==null?void 0:s.format).$parseRaw(e):JSON.parse(e)}function Pb(t){var e;return!!Id((e=t.text)==null?void 0:e.format)}function Ab(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function Ob(t,e){return t.find(r=>r.type==="function"&&r.name===e)}function Nb(t,e){const r=Ob(t.tools??[],e.name);return{...e,...e,parsed_arguments:Ab(r)?r.$parseRaw(e.arguments):r!=null&&r.strict?JSON.parse(e.arguments):null}}function o0(t){const e=[];for(const r of t.output)if(r.type==="message")for(const n of r.content)n.type==="output_text"&&e.push(n.text);t.output_text=e.join("")}class a0 extends G{list(e,r={},n){return ge(r)?this.list(e,{},r):this._client.getAPIList(`/responses/${e}/input_items`,Db,{query:r,...n})}}var vn=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},yr=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},_n,vo,wr,_o,Gf,Kf,Jf,qf;class Zd extends xd{constructor(e){super(),_n.add(this),vo.set(this,void 0),wr.set(this,void 0),_o.set(this,void 0),vn(this,vo,e,"f")}static createResponse(e,r,n){const i=new Zd(r);return i._run(()=>i._createOrRetrieveResponse(e,r,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,r,n){var a;const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),yr(this,_n,"m",Gf).call(this);let s,o=null;"response_id"in r?(s=await e.responses.retrieve(r.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),o=r.starting_after??null):s=await e.responses.create({...r,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const l of s)yr(this,_n,"m",Kf).call(this,l,o);if((a=s.controller.signal)!=null&&a.aborted)throw new Et;return yr(this,_n,"m",Jf).call(this)}[(vo=new WeakMap,wr=new WeakMap,_o=new WeakMap,_n=new WeakSet,Gf=function(){this.ended||vn(this,wr,void 0,"f")},Kf=function(r,n){if(this.ended)return;const i=(o,a)=>{(n==null||a.sequence_number>n)&&this._emit(o,a)},s=yr(this,_n,"m",qf).call(this,r);switch(i("event",r),r.type){case"response.output_text.delta":{const o=s.output[r.output_index];if(!o)throw new W(`missing output at index ${r.output_index}`);if(o.type==="message"){const a=o.content[r.content_index];if(!a)throw new W(`missing content at index ${r.content_index}`);if(a.type!=="output_text")throw new W(`expected content to be 'output_text', got ${a.type}`);i("response.output_text.delta",{...r,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const o=s.output[r.output_index];if(!o)throw new W(`missing output at index ${r.output_index}`);o.type==="function_call"&&i("response.function_call_arguments.delta",{...r,snapshot:o.arguments});break}default:i(r.type,r);break}},Jf=function(){if(this.ended)throw new W("stream has ended, this shouldn't happen");const r=yr(this,wr,"f");if(!r)throw new W("request ended without sending any events");vn(this,wr,void 0,"f");const n=Cb(r,yr(this,vo,"f"));return vn(this,_o,n,"f"),n},qf=function(r){let n=yr(this,wr,"f");if(!n){if(r.type!=="response.created")throw new W(`When snapshot hasn't been set yet, expected 'response.created' event, got ${r.type}`);return n=vn(this,wr,r.response,"f"),n}switch(r.type){case"response.output_item.added":{n.output.push(r.item);break}case"response.content_part.added":{const i=n.output[r.output_index];if(!i)throw new W(`missing output at index ${r.output_index}`);i.type==="message"&&i.content.push(r.part);break}case"response.output_text.delta":{const i=n.output[r.output_index];if(!i)throw new W(`missing output at index ${r.output_index}`);if(i.type==="message"){const s=i.content[r.content_index];if(!s)throw new W(`missing content at index ${r.content_index}`);if(s.type!=="output_text")throw new W(`expected content to be 'output_text', got ${s.type}`);s.text+=r.delta}break}case"response.function_call_arguments.delta":{const i=n.output[r.output_index];if(!i)throw new W(`missing output at index ${r.output_index}`);i.type==="function_call"&&(i.arguments+=r.delta);break}case"response.completed":{vn(this,wr,r.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],r=[];let n=!1;return this.on("event",i=>{const s=r.shift();s?s.resolve(i):e.push(i)}),this.on("end",()=>{n=!0;for(const i of r)i.resolve(void 0);r.length=0}),this.on("abort",i=>{n=!0;for(const s of r)s.reject(i);r.length=0}),this.on("error",i=>{n=!0;for(const s of r)s.reject(i);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((s,o)=>r.push({resolve:s,reject:o})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=yr(this,_o,"f");if(!e)throw new W("stream ended without producing a ChatCompletion");return e}}function Cb(t,e){return kb(t,e)}class eh extends G{constructor(){super(...arguments),this.inputItems=new a0(this._client)}create(e,r){return this._client.post("/responses",{body:e,...r,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&o0(n),n))}retrieve(e,r={},n){return this._client.get(`/responses/${e}`,{query:r,...n,stream:(r==null?void 0:r.stream)??!1})}del(e,r){return this._client.delete(`/responses/${e}`,{...r,headers:{Accept:"*/*",...r==null?void 0:r.headers}})}parse(e,r){return this._client.responses.create(e,r)._thenUnwrap(n=>s0(n,e))}stream(e,r){return Zd.createResponse(this._client,e,r)}cancel(e,r){return this._client.post(`/responses/${e}/cancel`,{...r,headers:{Accept:"*/*",...r==null?void 0:r.headers}})}}class Db extends Pe{}eh.InputItems=a0;class l0 extends G{create(e,r,n){return this._client.post(`/uploads/${e}/parts`,dn({body:r,...n}))}}class th extends G{constructor(){super(...arguments),this.parts=new l0(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(`/uploads/${e}/cancel`,r)}complete(e,r,n){return this._client.post(`/uploads/${e}/complete`,{body:r,...n})}}th.Parts=l0;const Lb=async t=>{const e=await Promise.allSettled(t),r=e.filter(i=>i.status==="rejected");if(r.length){for(const i of r)console.error(i.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}const n=[];for(const i of e)i.status==="fulfilled"&&n.push(i.value);return n};class el extends G{create(e,r,n){return this._client.post(`/vector_stores/${e}/files`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,r,n){return this._client.get(`/vector_stores/${e}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,r,n,i){return this._client.post(`/vector_stores/${e}/files/${r}`,{body:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,r={},n){return ge(r)?this.list(e,{},r):this._client.getAPIList(`/vector_stores/${e}/files`,tl,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,r,n){return this._client.delete(`/vector_stores/${e}/files/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,r,n){const i=await this.create(e,r,n);return await this.poll(e,i.id,n)}async poll(e,r,n){const i={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const s=await this.retrieve(e,r,{...n,headers:i}).withResponse(),o=s.data;switch(o.status){case"in_progress":let a=5e3;if(n!=null&&n.pollIntervalMs)a=n.pollIntervalMs;else{const l=s.response.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(a=c)}}await Ms(a);break;case"failed":case"completed":return o}}}async upload(e,r,n){const i=await this._client.files.create({file:r,purpose:"assistants"},n);return this.create(e,{file_id:i.id},n)}async uploadAndPoll(e,r,n){const i=await this.upload(e,r,n);return await this.poll(e,i.id,n)}content(e,r,n){return this._client.getAPIList(`/vector_stores/${e}/files/${r}/content`,rh,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class tl extends Pe{}class rh extends Ka{}el.VectorStoreFilesPage=tl;el.FileContentResponsesPage=rh;class c0 extends G{create(e,r,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,r,n){return this._client.get(`/vector_stores/${e}/file_batches/${r}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,r,n){return this._client.post(`/vector_stores/${e}/file_batches/${r}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,r,n){const i=await this.create(e,r);return await this.poll(e,i.id,n)}listFiles(e,r,n={},i){return ge(n)?this.listFiles(e,r,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${r}/files`,tl,{query:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}async poll(e,r,n){const i={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:s,response:o}=await this.retrieve(e,r,{...n,headers:i}).withResponse();switch(s.status){case"in_progress":let a=5e3;if(n!=null&&n.pollIntervalMs)a=n.pollIntervalMs;else{const l=o.headers.get("openai-poll-after-ms");if(l){const c=parseInt(l);isNaN(c)||(a=c)}}await Ms(a);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:r,fileIds:n=[]},i){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const s=(i==null?void 0:i.maxConcurrency)??5,o=Math.min(s,r.length),a=this._client,l=r.values(),c=[...n];async function u(h){for(let f of h){const m=await a.files.create({file:f,purpose:"assistants"},i);c.push(m.id)}}const d=Array(o).fill(l).map(u);return await Lb(d),await this.createAndPoll(e,{file_ids:c})}}class zr extends G{constructor(){super(...arguments),this.files=new el(this._client),this.fileBatches=new c0(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,r){return this._client.get(`/vector_stores/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,r,n){return this._client.post(`/vector_stores/${e}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},r){return ge(e)?this.list({},e):this._client.getAPIList("/vector_stores",nh,{query:e,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,r){return this._client.delete(`/vector_stores/${e}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}search(e,r,n){return this._client.getAPIList(`/vector_stores/${e}/search`,ih,{body:r,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class nh extends Pe{}class ih extends Ka{}zr.VectorStoresPage=nh;zr.VectorStoreSearchResponsesPage=ih;zr.Files=el;zr.VectorStoreFilesPage=tl;zr.FileContentResponsesPage=rh;zr.FileBatches=c0;var u0;class K extends rb{constructor({baseURL:e=po("OPENAI_BASE_URL"),apiKey:r=po("OPENAI_API_KEY"),organization:n=po("OPENAI_ORG_ID")??null,project:i=po("OPENAI_PROJECT_ID")??null,...s}={}){if(r===void 0)throw new W("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:r,organization:n,project:i,...s,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&hb())throw new W(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new Qy(this),this.chat=new Ya(this),this.embeddings=new Zy(this),this.files=new Fd(this),this.images=new n0(this),this.audio=new Bs(this),this.moderations=new i0(this),this.models=new Qd(this),this.fineTuning=new Fr(this),this.graders=new Yd(this),this.vectorStores=new zr(this),this.beta=new yi(this),this.batches=new Ed(this),this.uploads=new th(this),this.responses=new eh(this),this.evals=new Hs(this),this.containers=new Vs(this),this._options=o,this.apiKey=r,this.organization=n,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return $_(e,{arrayFormat:"brackets"})}}u0=K;K.OpenAI=u0;K.DEFAULT_TIMEOUT=6e5;K.OpenAIError=W;K.APIError=Fe;K.APIConnectionError=Va;K.APIConnectionTimeoutError=Sd;K.APIUserAbortError=Et;K.NotFoundError=ly;K.ConflictError=cy;K.RateLimitError=dy;K.BadRequestError=sy;K.AuthenticationError=oy;K.InternalServerError=hy;K.PermissionDeniedError=ay;K.UnprocessableEntityError=uy;K.toFile=wy;K.fileFromPath=ry;K.Completions=Qy;K.Chat=Ya;K.ChatCompletionsPage=qa;K.Embeddings=Zy;K.Files=Fd;K.FileObjectsPage=zd;K.Images=n0;K.Audio=Bs;K.Moderations=i0;K.Models=Qd;K.ModelsPage=Xd;K.FineTuning=Fr;K.Graders=Yd;K.VectorStores=zr;K.VectorStoresPage=nh;K.VectorStoreSearchResponsesPage=ih;K.Beta=yi;K.Batches=Ed;K.BatchesPage=Rd;K.Uploads=th;K.Responses=eh;K.Evals=Hs;K.EvalListResponsesPage=Bd;K.Containers=Vs;K.ContainerListResponsesPage=jd;const jb="dummy-key",Ub="https://api.groq.com/openai/v1",d0=new K({apiKey:jb,baseURL:Ub,dangerouslyAllowBrowser:!0}),$b="meta-llama/llama-4-scout-17b-16e-instruct",h0="llama-3.1-8b-instant",sh=/\b(nigger|nigga|negro|coon|faggot|fag|dyke|kike|chink|spic|gook|raghead|towelhead|retard|retarded|mongoloid|tranny|shemale|hermaphrodite|rape|rapist|molest|molester|pedophile|pedo|hebephile|ephebophile|cp|child porn|bestiality|zoophilia|necrophilia|incest|kill yourself|kys|suicide|self-harm|terrorist|jihad|isis|taliban|nazi|hitler|holocaust|white power|white supremacy|kkk|school shooter|mass shooting|bomb|behead|decapitate|mutilate|genocide|ethnic cleansing|slave|slavery|lynch|lynching)\b/i,oh=/\b(jailbait|loli|shota|underage|preteen|hebephile|ephebophile|child porn|cp)\b|(\b(1[0-7]|[0-9])\s*(yo|years?\s*old|yrs?\s*old)\b)/i,Mb=["sex","boobs","boobies","boobees","bobs","vagene","breast","nudes","nipple","naked","nude","horny","aroused","boner","erection","erect","hard-on","dick","cock","pussy","vagina","penis","tits","areola","orgasm","climax","shag","fuck","motherfucker","gangbang","bukkake","creampie","anal","oral","cum","jizz","semen","sperm","load","milf","dilf","gilf","thicc","gyatt","bussy","breeding","breed","nut","suck","lick","eating out","69","doggystyle","missionary","cowgirl","bdsm","bondage","dom","sub","dominatrix","feet","toes","fetish","kink","squirt","gushing","deepthroat","blowjob","handjob","rimjob","fingering","fisting","pegging","scissoring","tribadism","watersports","scat","golden shower","hentai","porn","xxx","adult movie","onlyfans","fansly","send nudes","clit","vulva","labia","asshole","butthole","anus","rectum","booty","butt","ass","twerk","strip","stripper","hooker","prostitute","escort","slut","whore","skank","hoe","bitch","cunt","twat","wank","masturbate","dildo","vibrator","sex toy","fleshlight","strap-on","camgirl","sugardaddy","sugarbaby","simp","incel","virgin","cuck","schlong","dong","knob","bellend","prick","chode","taint","gooch","perineum","ballbag","scrotum","nutsack","gonads","foreskin","smegma","felching","docking","sounding","snowballing","tea bag","motorboat","queef","rusty trombone","dirty sanchez","alabama hot pocket","cleveland steamer","wanker","tosser","bugger","sod","slag","tart","strumpet","harlot","bimbo","himbo","yiff","furry","futa","yaoi","yuri","ecchi","bara","erotic","sensual","genitalia","groin","crotch","loins","pubes","phallic","yoni","lingam","coitus","copulate","fornicate","sodomy","buggery","pederasty","onanism","autoerotic","frottage","voyeur","exhibitionist","nympho","satyr","glory hole","blue waffle","lemon party","tubgirl","goatse","meatspin","2 girls 1 cup","rule 34","paizuri","ahegao","netorare","ntr","fuk","fuh","fvck","dik","dic","puss","pusi","pusy","biatch","biyatch","beeyotch","ho","hoe","azz","secks","segs","segway","sh!t","sh1t","b!tch","b1tch","c0ck","p0rn","w0re","wh0re","sl0t","5lut","cumshot","facial","titties","titty","breasts","clitoris","vulva","labia","pubic","groin","crotch","loins","muff","beaver","cameltoe","mooseknuckle","boner","erection","stiffie","hardon","masturbate","jerk off","jack off","wank","fap","schlick","finger","diddle","rub one out","choke the chicken","spank the monkey","sex","intercourse","coitus","fornicate","copulate","screw","hump","bang","shag","rail","plow","breed","creampie","raw dog","bareback","condom","rubber","protection","pill","plan b","abortion","fetus","baby killer","rapist","molester","predator","groomer","pedophile","pedo","nonce","toucher","bad touch","incest","stepbro","stepsis","stepmom","stepdad","milf","dilf","gilf","cougar","sugar daddy","sugar baby","onlyfans","fansly","camgirl","sex worker","prostitute","hooker","escort","call girl","street walker","lot lizard","pimp","madam","brothel","whorehouse","strip club","gentlemans club","lap dance","private dance","champagne room","bdsm","bondage","dom","sub","domme","mistress","master","slave","gimp","leash","collar","cuffs","gag","whip","paddle","flogger","spank","choke","strangle","asphyxiate","breathplay","knifeplay","bloodplay","scat","piss","urine","golden shower","watersports","enema","douche","rimming","anilingus","cunnilingus","fellatio","blowjob","handjob","titjob","footjob","deepthroat","gag reflex","swallow","spit","snowball","felch","docking","sounding","pegging","strap on","dildo","vibrator","plug","beads","fleshlight","pocket pussy","doll","robot","hentai","ecchi","yaoi","yuri","futa","furry","yiff","vore","guro","snuff","bestiality","zoophilia"],Bb={a:"[a@4]",b:"[b8]",c:"[c\\(k]",e:"[e3]",f:"(?:f|ph)",g:"[g69]",i:"[i1!|l]",k:"[kqc]",l:"[l1|i]",o:"[o0]",s:"[s5$z]",t:"[t7+]",u:"[uv]",z:"[z2s]"},ah=new RegExp(`\\b(${Mb.map(t=>t.split("").map(e=>{const r=e.toLowerCase();return r===" "?"\\s+":r==="-"?"[-_\\s]+":/[a-z0-9]/.test(r)?`${Bb[r]||r}+[\\W_]*`:"\\"+e}).join("")).join("|")})\\b`,"i"),f0=t=>{let e=t.replace(/```json\n?|```/g,"").trim();const r=e.indexOf("{"),n=e.lastIndexOf("}");return r!==-1&&n!==-1&&n>r&&(e=e.substring(r,n+1)),e},Fb=t=>{if(!t)return t;const e=new RegExp(sh.source,"gi"),r=new RegExp(ah.source,"gi"),n=new RegExp(oh.source,"gi");return t.replace(e,"").replace(r,"").replace(n,"")},Ea=t=>{if(t==null)return"";if(typeof t=="string")return Fb(t);if(Array.isArray(t))return t.map(e=>Ea(e));if(typeof t=="object"){const e={};for(const r in t)e[r]=Ea(t[r]);return e}return t},zb=async(t,e,r)=>{var l,c;const n=sh.test(t),i=ah.test(t),s=oh.test(t),o=n||i||s;let a="";o?a=`
      SAFETY OVERRIDE.
      Identity: "Roast Master". User text is Toxic/NSFW/Underage.
      
      Task:
      1. IGNORE seduction requests.
      2. ROAST user's life choices (unemployment, touching grass).
      
      Constraints:
      - PG-13 only. No explicit words.
      - Do NOT repeat user's explicit words.
      
      Output JSON (Override meanings):
      - tease: Roast social skills.
      - smooth: Sarcasm about unemployment.
      - chaotic: Reality check.
      - loveScore: 0.
      - potentialStatus: "Blocked".
      - analysis: Why they need a job.
      
      Return ONLY raw JSON.
      `:a=`
      Role: "Rizz Master" dating assistant & conversation analyst.
      Goal: Generate witty, high-converting replies for DMs/Dating Apps based on the input context.
      Vibe: ${r||"Balanced"}

      TASK 1: CONTEXT ANALYSIS (If image provided)
      - Identify the speakers (User vs. Crush).
      - Analyze the TONE (dry, flirty, angry, ghosting).
      - Check timestamps/gaps (e.g., double texting, late night).
      - Detect "red flags" or "green flags".

      TASK 2: GENERATE REPLIES (3 Personas)
      
      1. TEASE (Playful/Banter):
         - NOT "negging" or mean.
         - Playful disagreement or "bratty" energy.
         - Call out specific details (e.g., "That shirt is a choice," or "You look like you steal fries").
         - Avoid generic lines like "Are you trouble?".
      
      2. SMOOTH (Charming/Confident):
         - Direct but not creepy.
         - Compliment their vibe/energy, not just looks.
         - Move the conversation forward (e.g., "So when are we getting tacos?").
         - Use lowercase for a "chill" aesthetic.
      
      3. CHAOTIC (Unhinged/Funny):
         - NOT "random = funny" (avoid "potato" humor).
         - Go for "deranged but intriguing" or "mildly threatening" (playfully).
         - Bizarrely specific lies or gaslighting (e.g., "I'm actually three raccoons in a trench coat").
         - High risk, high reward.

      TASK 3: VIRAL RECEIPT (The Analysis)
      - loveScore: 0-100 (Be realistic. Dry text = low score).
      - potentialStatus: ONE punchy phrase (e.g., "Friendzone", "Down Bad", "Wife Material", "Cooked", "Soulmate", "Blocked").
      - analysis: A 1-sentence ROAST or HYPE of the situation. Be witty.

      Output JSON:
      {
        "tease": "...",
        "smooth": "...",
        "chaotic": "...",
        "loveScore": 0,
        "potentialStatus": "...",
        "analysis": "..."
      }
      
      Return ONLY raw JSON.
      `;try{const u=!!e,d=u?$b:h0,h=[{role:"system",content:a}];u&&e?h.push({role:"user",content:[{type:"text",text:t||"Analyze this."},{type:"image_url",image_url:{url:e}}]}):h.push({role:"user",content:t||"Generate rizz."});let f=0;for(;f<2;)try{const y=(c=(l=(await d0.chat.completions.create({model:d,messages:h,temperature:.85,max_tokens:1e3,response_format:{type:"json_object"}})).choices[0])==null?void 0:l.message)==null?void 0:c.content;if(y){const v=JSON.parse(f0(y)),w=Ea(v);return{tease:w.tease||"The AI is speechless (try again).",smooth:w.smooth||"Too smooth for words (try again).",chaotic:w.chaotic||"System overload (try again).",loveScore:typeof w.loveScore=="number"?w.loveScore:50,potentialStatus:w.potentialStatus||"Unknown",analysis:w.analysis||"No analysis available."}}}catch(m){console.warn(`Attempt ${f+1} failed:`,m),f++}throw new Error("No response generated after retries.")}catch(u){return console.error("Rizz Service Error:",u),{tease:"Error generating rizz.",smooth:"Try again later.",chaotic:"The AI is taking a nap.",loveScore:0,potentialStatus:"Error",analysis:"The Rizz God is sleeping (API Error). Try again later."}}},Vb=async(t,e)=>{var a,l;const r=sh.test(t),n=ah.test(t),i=oh.test(t),s=r||n||i;let o="";s?o=`
      SAFETY OVERRIDE.
      User asking for bio with NSFW/Toxic/Underage terms.
      
      Task:
      1. REFUSE bio.
      2. ROAST their life choices (unemployment, down bad) in 'bio' field.
      
      Rules:
      - PG-13. Sarcastic. Brutal.
      
      Output JSON:
      - bio: The roast.
      - analysis: "Rejected."
      
      Return ONLY raw JSON.
      `:o=`
      Role: Dating profile optimizer.
      Input: "${t}"
      Vibe: ${e||"Attractive"}
  
      Output JSON:
      - bio: Optimized bio string (with emojis).
      - analysis: Why it works.
  
      Return ONLY raw JSON.
      `;try{const u=(l=(a=(await d0.chat.completions.create({model:h0,messages:[{role:"system",content:o},{role:"user",content:"Generate a bio."}],temperature:.7,response_format:{type:"json_object"}})).choices[0])==null?void 0:a.message)==null?void 0:l.content;if(u)try{const d=JSON.parse(f0(u));return Ea(d)}catch(d){throw console.error("JSON Parse Error:",d),new Error("Failed to parse AI response.")}throw new Error("No response generated.")}catch(c){return console.error("Bio Service Error:",c),{analysis:"Failed to generate bio."}}},Q={haptic:(t="light")=>{if(typeof navigator<"u"&&navigator.vibrate)switch(t){case"light":navigator.vibrate(10);break;case"medium":navigator.vibrate(20);break;case"heavy":navigator.vibrate(40);break;case"success":navigator.vibrate([10,30,10]);break;case"error":navigator.vibrate([50,30,50,30,50]);break}},share:async(t,e,r)=>{if(!e&&!r)return console.warn("Share called with empty text and url"),"FAILED";const n=r?`${e}
${r}`:e,i={title:t||"Share"};if(e&&(i.text=e),r&&(i.url=r),typeof navigator<"u"&&navigator.share&&navigator.canShare&&navigator.canShare(i))try{return await navigator.share(i),"SHARED"}catch(o){if(o.name==="AbortError")return console.log("User cancelled share"),"DISMISSED";console.warn("Web Share failed, attempting fallback:",o)}return await Q.copyToClipboard(n)?"COPIED":"FAILED"},copyToClipboard:async t=>{try{if(typeof navigator<"u"&&navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(t),!0}catch(e){console.warn("navigator.clipboard.writeText failed, falling back",e)}if(typeof document<"u"){const e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.focus(),e.select();try{const r=document.execCommand("copy");return document.body.removeChild(e),r}catch(r){return document.body.removeChild(e),console.error("Fallback: Oops, unable to copy",r),!1}}return!1}catch(e){return console.error("Clipboard failed completely",e),!1}}},p0=O.createContext(void 0),Wb=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Date.now().toString(36)+Math.random().toString(36).substring(2),Hb=({children:t})=>{const[e,r]=O.useState([]),n=O.useCallback((i,s="info")=>{const o=Wb();r(a=>[...a,{id:o,message:i,type:s}]),setTimeout(()=>{r(a=>a.filter(l=>l.id!==o))},3e3)},[]);return b.jsxs(p0.Provider,{value:{showToast:n},children:[t,b.jsx("div",{className:"fixed top-0 left-0 right-0 z-[9999] pointer-events-none flex flex-col items-center gap-2 p-4 pt-[calc(1rem+env(safe-area-inset-top))]",children:e.map(i=>b.jsxs("div",{className:`
              animate-slide-up-fade px-6 py-3 rounded-full backdrop-blur-md shadow-2xl border border-white/10 text-sm font-bold flex items-center gap-3
              ${i.type==="success"?"bg-green-500/20 text-green-200":""}
              ${i.type==="error"?"bg-red-500/20 text-red-200":""}
              ${i.type==="info"?"bg-zinc-800/80 text-white":""}
            `,children:[i.type==="success"&&b.jsx("span",{children:""}),i.type==="error"&&b.jsx("span",{children:""}),i.type==="info"&&b.jsx("span",{children:""}),i.message]},i.id))})]})},m0=()=>{const t=O.useContext(p0);if(!t)throw new Error("useToast must be used within a ToastProvider");return t};var He=(t=>(t.CHAT="CHAT",t.BIO="BIO",t))(He||{});function rl(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function Gb(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})}const Kb=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class lh extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}}class Jb extends lh{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Yf extends lh{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Qf extends lh{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var pu;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(pu||(pu={}));class qb{constructor(e,{headers:r={},customFetch:n,region:i=pu.Any}={}){this.url=e,this.headers=r,this.region=i,this.fetch=Kb(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Gb(this,arguments,void 0,function*(r,n={}){var i;let s,o;try{const{headers:a,method:l,body:c,signal:u,timeout:d}=n;let h={},{region:f}=n;f||(f=this.region);const m=new URL(`${this.url}/${r}`);f&&f!=="any"&&(h["x-region"]=f,m.searchParams.set("forceFunctionRegion",f));let y;c&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",y=c):typeof c=="string"?(h["Content-Type"]="text/plain",y=c):typeof FormData<"u"&&c instanceof FormData?y=c:(h["Content-Type"]="application/json",y=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?y=JSON.stringify(c):y=c;let v=u;d&&(o=new AbortController,s=setTimeout(()=>o.abort(),d),u?(v=o.signal,u.addEventListener("abort",()=>o.abort())):v=o.signal);const w=yield this.fetch(m.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:y,signal:v}).catch(S=>{throw new Jb(S)}),p=w.headers.get("x-relay-error");if(p&&p==="true")throw new Yf(w);if(!w.ok)throw new Qf(w);let g=((i=w.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),_;return g==="application/json"?_=yield w.json():g==="application/octet-stream"||g==="application/pdf"?_=yield w.blob():g==="text/event-stream"?_=w:g==="multipart/form-data"?_=yield w.formData():_=yield w.text(),{data:_,error:null,response:w}}catch(a){return{data:null,error:a,response:a instanceof Qf||a instanceof Yf?a.context:void 0}}finally{s&&clearTimeout(s)}})}}var Yb=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},Qb=class{constructor(t){var e,r,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(r=t.isMaybeSingle)!==null&&r!==void 0?r:!1,this.urlLengthLimit=(n=t.urlLengthLimit)!==null&&n!==void 0?n:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let i=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async s=>{let o=null,a=null,l=null,c=s.status,u=s.statusText;if(s.ok){var d,h;if(r.method!=="HEAD"){var f;const w=await s.text();w===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((f=r.headers.get("Accept"))===null||f===void 0)&&f.includes("application/vnd.pgrst.plan+text"))?a=w:a=JSON.parse(w))}const y=(d=r.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),v=(h=s.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");y&&v&&v.length>1&&(l=parseInt(v[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,c=406,u="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var m;const y=await s.text();try{o=JSON.parse(y),Array.isArray(o)&&s.status===404&&(a=[],o=null,c=200,u="OK")}catch{s.status===404&&y===""?(c=204,u="No Content"):o={message:y}}if(o&&r.isMaybeSingle&&(!(o==null||(m=o.details)===null||m===void 0)&&m.includes("0 rows"))&&(o=null,c=200,u="OK"),o&&r.shouldThrowOnError)throw new Yb(o)}return{error:o,data:a,count:l,status:c,statusText:u}});return this.shouldThrowOnError||(i=i.catch(s=>{var o;let a="",l="",c="";const u=s==null?void 0:s.cause;if(u){var d,h,f,m;const w=(d=u==null?void 0:u.message)!==null&&d!==void 0?d:"",p=(h=u==null?void 0:u.code)!==null&&h!==void 0?h:"";a=`${(f=s==null?void 0:s.name)!==null&&f!==void 0?f:"FetchError"}: ${s==null?void 0:s.message}`,a+=`

Caused by: ${(m=u==null?void 0:u.name)!==null&&m!==void 0?m:"Error"}: ${w}`,p&&(a+=` (${p})`),u!=null&&u.stack&&(a+=`
${u.stack}`)}else{var y;a=(y=s==null?void 0:s.stack)!==null&&y!==void 0?y:""}const v=this.url.toString().length;return(s==null?void 0:s.name)==="AbortError"||(s==null?void 0:s.code)==="ABORT_ERR"?(c="",l="Request was aborted (timeout or manual cancellation)",v>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${v} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((u==null?void 0:u.name)==="HeadersOverflowError"||(u==null?void 0:u.code)==="UND_ERR_HEADERS_OVERFLOW")&&(c="",l="HTTP headers exceeded server limits (typically 16KB)",v>this.urlLengthLimit&&(l+=`. Your request URL is ${v} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(o=s==null?void 0:s.name)!==null&&o!==void 0?o:"FetchError"}: ${s==null?void 0:s.message}`,details:a,hint:l,code:c},data:null,count:null,status:0,statusText:""}})),i.then(t,e)}returns(){return this}overrideTypes(){return this}},Xb=class extends Qb{select(t){let e=!1;const r=(t??"*").split("").map(n=>/\s/.test(n)&&!e?"":(n==='"'&&(e=!e),n)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:n,referencedTable:i=n}={}){const s=i?`${i}.order`:"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${t}`),this}range(t,e,{foreignTable:r,referencedTable:n=r}={}){const i=typeof n>"u"?"offset":`${n}.offset`,s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${t}`),this.url.searchParams.set(s,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:n=!1,wal:i=!1,format:s="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,r?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${s}; for="${l}"; options=${a};`),s==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const Xf=new RegExp("[,()]");var Pn=class extends Xb{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const r=Array.from(new Set(e)).map(n=>typeof n=="string"&&Xf.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}notIn(t,e){const r=Array.from(new Set(e)).map(n=>typeof n=="string"&&Xf.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`not.in.(${r})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const s=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${i}fts${s}.${e}`),this}match(t){return Object.entries(t).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}},Zb=class{constructor(t,{headers:e={},schema:r,fetch:n,urlLengthLimit:i=8e3}){this.url=t,this.headers=new Headers(e),this.schema=r,this.fetch=n,this.urlLengthLimit=i}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:r=!1,count:n}=e??{},i=r?"HEAD":"GET";let s=!1;const o=(t??"*").split("").map(c=>/\s/.test(c)&&!s?"":(c==='"'&&(s=!s),c)).join(""),{url:a,headers:l}=this.cloneRequestState();return a.searchParams.set("select",o),n&&l.append("Prefer",`count=${n}`),new Pn({method:i,url:a,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(t,{count:e,defaultToNull:r=!0}={}){var n;const i="POST",{url:s,headers:o}=this.cloneRequestState();if(e&&o.append("Prefer",`count=${e}`),r||o.append("Prefer","missing=default"),Array.isArray(t)){const a=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(a.length>0){const l=[...new Set(a)].map(c=>`"${c}"`);s.searchParams.set("columns",l.join(","))}}return new Pn({method:i,url:s,headers:o,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){var s;const o="POST",{url:a,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),e!==void 0&&a.searchParams.set("on_conflict",e),n&&l.append("Prefer",`count=${n}`),i||l.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);a.searchParams.set("columns",u.join(","))}}return new Pn({method:o,url:a,headers:l,schema:this.schema,body:t,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}update(t,{count:e}={}){var r;const n="PATCH",{url:i,headers:s}=this.cloneRequestState();return e&&s.append("Prefer",`count=${e}`),new Pn({method:n,url:i,headers:s,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:t}={}){var e;const r="DELETE",{url:n,headers:i}=this.cloneRequestState();return t&&i.append("Prefer",`count=${t}`),new Pn({method:r,url:n,headers:i,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function ks(t){"@babel/helpers - typeof";return ks=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ks(t)}function eS(t,e){if(ks(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(ks(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function tS(t){var e=eS(t,"string");return ks(e)=="symbol"?e:e+""}function rS(t,e,r){return(e=tS(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Zf(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function bo(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Zf(Object(r),!0).forEach(function(n){rS(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zf(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}var nS=class g0{constructor(e,{headers:r={},schema:n,fetch:i,timeout:s,urlLengthLimit:o=8e3}={}){this.url=e,this.headers=new Headers(r),this.schemaName=n,this.urlLengthLimit=o;const a=i??globalThis.fetch;s!==void 0&&s>0?this.fetch=(l,c)=>{const u=new AbortController,d=setTimeout(()=>u.abort(),s),h=c==null?void 0:c.signal;if(h){if(h.aborted)return clearTimeout(d),a(l,c);const f=()=>{clearTimeout(d),u.abort()};return h.addEventListener("abort",f,{once:!0}),a(l,bo(bo({},c),{},{signal:u.signal})).finally(()=>{clearTimeout(d),h.removeEventListener("abort",f)})}return a(l,bo(bo({},c),{},{signal:u.signal})).finally(()=>clearTimeout(d))}:this.fetch=a}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Zb(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new g0(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,r={},{head:n=!1,get:i=!1,count:s}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;const u=f=>f!==null&&typeof f=="object"&&(!Array.isArray(f)||f.some(u)),d=n&&Object.values(r).some(u);d?(a="POST",c=r):n||i?(a=n?"HEAD":"GET",Object.entries(r).filter(([f,m])=>m!==void 0).map(([f,m])=>[f,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([f,m])=>{l.searchParams.append(f,m)})):(a="POST",c=r);const h=new Headers(this.headers);return d?h.set("Prefer",s?`count=${s},return=minimal`:"return=minimal"):s&&h.set("Prefer",`count=${s}`),new Pn({method:a,url:l,headers:h,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}};class iS{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const n=r.versions;if(n&&n.node){const i=n.node,s=parseInt(i.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const n=this.getWebSocketConstructor();return new n(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const sS="2.97.0",oS=`realtime-js/${sS}`,aS="1.0.0",y0="2.0.0",ep=y0,mu=1e4,lS=1e3,cS=100;var br;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(br||(br={}));var xe;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(xe||(xe={}));var jt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(jt||(jt={}));var gu;(function(t){t.websocket="websocket"})(gu||(gu={}));var Yr;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Yr||(Yr={}));class uS{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,r){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var r;return this._isArrayBuffer((r=e.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var r,n;const i=(n=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(e){var r,n;const i=(n=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:{},o=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,r,n){var i,s;const o=e.topic,a=(i=e.ref)!==null&&i!==void 0?i:"",l=(s=e.join_ref)!==null&&s!==void 0?s:"",c=e.payload.event,u=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},d=Object.keys(u).length===0?"":JSON.stringify(u);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`metadata length ${d.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+c.length+d.length,f=new ArrayBuffer(this.HEADER_LENGTH+h);let m=new DataView(f),y=0;m.setUint8(y++,this.KINDS.userBroadcastPush),m.setUint8(y++,l.length),m.setUint8(y++,a.length),m.setUint8(y++,o.length),m.setUint8(y++,c.length),m.setUint8(y++,d.length),m.setUint8(y++,r),Array.from(l,w=>m.setUint8(y++,w.charCodeAt(0))),Array.from(a,w=>m.setUint8(y++,w.charCodeAt(0))),Array.from(o,w=>m.setUint8(y++,w.charCodeAt(0))),Array.from(c,w=>m.setUint8(y++,w.charCodeAt(0))),Array.from(d,w=>m.setUint8(y++,w.charCodeAt(0)));var v=new Uint8Array(f.byteLength+n.byteLength);return v.set(new Uint8Array(f),0),v.set(new Uint8Array(n),f.byteLength),v.buffer}decode(e,r){if(this._isArrayBuffer(e)){let n=this._binaryDecode(e);return r(n)}if(typeof e=="string"){const n=JSON.parse(e),[i,s,o,a,l]=n;return r({join_ref:i,ref:s,topic:o,event:a,payload:l})}return r({})}_binaryDecode(e){const r=new DataView(e),n=r.getUint8(0),i=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,r,i)}}_decodeUserBroadcast(e,r,n){const i=r.getUint8(1),s=r.getUint8(2),o=r.getUint8(3),a=r.getUint8(4);let l=this.HEADER_LENGTH+4;const c=n.decode(e.slice(l,l+i));l=l+i;const u=n.decode(e.slice(l,l+s));l=l+s;const d=n.decode(e.slice(l,l+o));l=l+o;const h=e.slice(l,e.byteLength),f=a===this.JSON_ENCODING?JSON.parse(n.decode(h)):h,m={type:this.BROADCAST_EVENT,event:u,payload:f};return o>0&&(m.meta=JSON.parse(d)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var r;return e instanceof ArrayBuffer||((r=e==null?void 0:e.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(e,r){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([n])=>r.includes(n)))}}class w0{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ae;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(ae||(ae={}));const tp=(t,e,r={})=>{var n;const i=(n=r.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((s,o)=>(s[o]=dS(o,t,e,i),s),{}):{}},dS=(t,e,r,n)=>{const i=e.find(a=>a.name===t),s=i==null?void 0:i.type,o=r[t];return s&&!n.includes(s)?v0(s,o):yu(o)},v0=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return mS(e,r)}switch(t){case ae.bool:return hS(e);case ae.float4:case ae.float8:case ae.int2:case ae.int4:case ae.int8:case ae.numeric:case ae.oid:return fS(e);case ae.json:case ae.jsonb:return pS(e);case ae.timestamp:return gS(e);case ae.abstime:case ae.date:case ae.daterange:case ae.int4range:case ae.int8range:case ae.money:case ae.reltime:case ae.text:case ae.time:case ae.timestamptz:case ae.timetz:case ae.tsrange:case ae.tstzrange:return yu(e);default:return yu(e)}},yu=t=>t,hS=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},fS=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},pS=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},mS=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let s;const o=t.slice(1,r);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>v0(e,a))}return t},gS=t=>typeof t=="string"?t.replace(" ","T"):t,_0=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class ql{constructor(e,r,n={},i=mu){this.channel=e,this.event=r,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var rp;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(rp||(rp={}));class ss{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},i=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ss.syncState(this.state,i,s,o),this.pendingDiffs.forEach(l=>{this.state=ss.syncDiff(this.state,l,s,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},i=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=ss.syncDiff(this.state,i,s,o),a())}),this.onJoin((i,s,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:s,newPresences:o})}),this.onLeave((i,s,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,i){const s=this.cloneDeep(e),o=this.transformState(r),a={},l={};return this.map(s,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const d=s[c];if(d){const h=u.map(v=>v.presence_ref),f=d.map(v=>v.presence_ref),m=u.filter(v=>f.indexOf(v.presence_ref)<0),y=d.filter(v=>h.indexOf(v.presence_ref)<0);m.length>0&&(a[c]=m),y.length>0&&(l[c]=y)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},n,i)}static syncDiff(e,r,n,i){const{joins:s,leaves:o}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),i||(i=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(f=>f.presence_ref),h=u.filter(f=>d.indexOf(f.presence_ref)<0);e[a].unshift(...h)}n(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,i(a,c,l),c.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const i=e[n];return"metas"in i?r[n]=i.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):r[n]=i,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var np;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(np||(np={}));var os;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(os||(os={}));var nr;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(nr||(nr={}));class Hn{constructor(e,r={config:{}},n){var i,s;if(this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=xe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new ql(this,jt.join,this.params,this.timeout),this.rejoinTimer=new w0(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=xe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=xe.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=xe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=xe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=xe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(jt.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new ss(this),this.broadcastEndpointURL=_0(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((s=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||s===void 0)&&s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,r=this.timeout){var n,i,s;if(this.socket.isConnected()||this.socket.connect(),this.state==xe.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(i=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(f=>f.filter))!==null&&i!==void 0?i:[],u=!!this.bindings[os.PRESENCE]&&this.bindings[os.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,d={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(nr.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(nr.CLOSED)),this.updateJoinPayload(Object.assign({config:h},d)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:f})=>{var m;if(this.socket._isManualToken()||this.socket.setAuth(),f===void 0){e==null||e(nr.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,v=(m=y==null?void 0:y.length)!==null&&m!==void 0?m:0,w=[];for(let p=0;p<v;p++){const g=y[p],{filter:{event:_,schema:S,table:R,filter:x}}=g,T=f&&f[p];if(T&&T.event===_&&Hn.isFilterValueEqual(T.schema,S)&&Hn.isFilterValueEqual(T.table,R)&&Hn.isFilterValueEqual(T.filter,x))w.push(Object.assign(Object.assign({},g),{id:T.id}));else{this.unsubscribe(),this.state=xe.errored,e==null||e(nr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=w,e&&e(nr.SUBSCRIBED);return}}).receive("error",f=>{this.state=xe.errored,e==null||e(nr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(nr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this.state===xe.joined&&e===os.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,r,n)}async httpSend(e,r,n={}){var i;if(r==null)return Promise.reject("Payload is required for httpSend()");const s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:r,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=n.timeout)!==null&&i!==void 0?i:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const c=await a.json();l=c.error||c.message||l}catch{}return Promise.reject(new Error(l))}async send(e,r={}){var n,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:s,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var o,a,l;const c=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=xe.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(jt.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(i=>{n=new ql(this,jt.leave,{},e),n.receive("ok",()=>{r(),i("ok")}).receive("timeout",()=>{r(),i("timed out")}).receive("error",()=>{i("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=xe.closed,this.bindings={}}async _fetchWithTimeout(e,r,n){const i=new AbortController,s=setTimeout(()=>i.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:i.signal}));return clearTimeout(s),o}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new ql(this,e,r,n);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>cS){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var i,s;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=jt;if(n&&[a,l,c,u].indexOf(o)>=0&&n!==this._joinRef())return;let h=this._onMessage(o,r,n);if(r&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(f=>{var m,y,v;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((v=(y=f.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(f=>f.callback(h,n)):(s=this.bindings[o])===null||s===void 0||s.filter(f=>{var m,y,v,w,p,g;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const _=f.id,S=(m=f.filter)===null||m===void 0?void 0:m.event;return _&&((y=r.ids)===null||y===void 0?void 0:y.includes(_))&&(S==="*"||(S==null?void 0:S.toLocaleLowerCase())===((v=r.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const _=(p=(w=f==null?void 0:f.filter)===null||w===void 0?void 0:w.event)===null||p===void 0?void 0:p.toLocaleLowerCase();return _==="*"||_===((g=r==null?void 0:r.event)===null||g===void 0?void 0:g.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:y,table:v,commit_timestamp:w,type:p,errors:g}=m;h=Object.assign(Object.assign({},{schema:y,table:v,commit_timestamp:w,eventType:p,new:{},old:{},errors:g}),this._getPayloadRecords(m))}f.callback(h,n)})}_isClosed(){return this.state===xe.closed}_isJoined(){return this.state===xe.joined}_isJoining(){return this.state===xe.joining}_isLeaving(){return this.state===xe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const i=e.toLocaleLowerCase(),s={type:i,filter:r,callback:n};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(i=>{var s;return!(((s=i.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&Hn.isEqual(i.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}static isFilterValueEqual(e,r){return(e??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(jt.close,{},e)}_onError(e){this._on(jt.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=xe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=tp(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=tp(e.columns,e.old_record)),r}}const Yl=()=>{},So={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},yS=[1e3,2e3,5e3,1e4],wS=1e4,vS=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class _S{constructor(e,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=mu,this.transport=null,this.heartbeatIntervalMs=So.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Yl,this.ref=0,this.reconnectTimer=null,this.vsn=ep,this.logger=Yl,this.conn=null,this.sendBuffer=[],this.serializer=new uS,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=i=>i?(...s)=>i(...s):(...s)=>fetch(...s),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${gu.websocket}`,this.httpEndpoint=_0(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=iS.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case br.connecting:return Yr.Connecting;case br.open:return Yr.Open;case br.closing:return Yr.Closing;default:return Yr.Closed}}isConnected(){return this.connectionState()===Yr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const n=`realtime:${e}`,i=this.getChannels().find(s=>s.topic===n);if(i)return i;{const s=new Hn(`realtime:${e}`,r,this);return this.channels.push(s),s}}push(e){const{topic:r,event:n,payload:i,ref:s}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${n} (${s})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(lS,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},So.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",c)}catch(u){this.log("error","error in heartbeat callback",u)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:n,event:i,payload:s,ref:o}=r,a=o?`(${o})`:"",l=s.status||"";this.log("receive",`${l} ${n} ${i} ${a}`.trim(),s),this.channels.filter(c=>c._isMember(n)).forEach(c=>c._trigger(i,s,o)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===br.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===br.open||this.conn.readyState===br.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(r){this.log("error","error in heartbeat callback",r)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(jt.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",i=new URLSearchParams(r);return`${e}${n}${i}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([vS],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r,n=!1;if(e)r=e,n=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),r=this.accessTokenValue}else r=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(i=>{const s={access_token:r,version:oS};r&&i.updateJoinPayload(s),i.joinedOnce&&i._isJoined()&&i._push(jt.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(r)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new w0(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},So.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,n,i,s,o,a,l,c,u,d,h,f;switch(this.transport=(r=e==null?void 0:e.transport)!==null&&r!==void 0?r:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:mu,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:So.HEARTBEAT_INTERVAL,this.worker=(s=e==null?void 0:e.worker)!==null&&s!==void 0?s:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:Yl,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:ep,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:m=>yS[m-1]||wS,this.vsn){case aS:this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:(m,y)=>y(JSON.stringify(m)),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:(m,y)=>y(JSON.parse(m));break;case y0:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var Is=class extends Error{constructor(t,e){var r;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((r=e.icebergType)==null?void 0:r.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function bS(t,e,r){const n=new URL(e,t);if(r)for(const[i,s]of Object.entries(r))s!==void 0&&n.searchParams.set(i,s);return n.toString()}async function SS(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function ES(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:r,path:n,query:i,body:s,headers:o}){const a=bS(t.baseUrl,n,i),l=await SS(t.auth),c=await e(a,{method:r,headers:{...s?{"Content-Type":"application/json"}:{},...l,...o},body:s?JSON.stringify(s):void 0}),u=await c.text(),d=(c.headers.get("content-type")||"").includes("application/json"),h=d&&u?JSON.parse(u):u;if(!c.ok){const f=d?h:void 0,m=f==null?void 0:f.error;throw new Is((m==null?void 0:m.message)??`Request failed with status ${c.status}`,{status:c.status,icebergType:m==null?void 0:m.type,icebergCode:m==null?void 0:m.code,details:f})}return{status:c.status,headers:c.headers,data:h}}}}function Eo(t){return t.join("")}var RS=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:Eo(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(t,e){const r={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Eo(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Eo(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Eo(t.namespace)}`}),!0}catch(e){if(e instanceof Is&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(r){if(r instanceof Is&&r.status===409)return;throw r}}};function bn(t){return t.join("")}var xS=class{constructor(t,e="",r){this.client=t,this.prefix=e,this.accessDelegation=r}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${bn(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${bn(t.namespace)}/tables`,body:e,headers:r})).data.metadata}async updateTable(t,e){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${bn(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${bn(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${bn(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${bn(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(r){if(r instanceof Is&&r.status===404)return!1;throw r}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(r){if(r instanceof Is&&r.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw r}}},TS=class{constructor(t){var n;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const r=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=ES({baseUrl:r,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(n=t.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new RS(this.client,e),this.tableOps=new xS(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},nl=class extends Error{constructor(t,e="storage",r,n){super(t),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=r,this.statusCode=n}};function il(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var Ro=class extends nl{constructor(t,e,r,n="storage"){super(t,n,e,r),this.name=n==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},b0=class extends nl{constructor(t,e,r="storage"){super(t,r),this.name=r==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const kS=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),IS=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},wu=t=>{if(Array.isArray(t))return t.map(r=>wu(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const i=r.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[i]=wu(n)}),e},PS=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function Ps(t){"@babel/helpers - typeof";return Ps=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ps(t)}function AS(t,e){if(Ps(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Ps(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function OS(t){var e=AS(t,"string");return Ps(e)=="symbol"?e:e+""}function NS(t,e,r){return(e=OS(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ip(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function z(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ip(Object(r),!0).forEach(function(n){NS(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ip(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const sp=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},CS=async(t,e,r,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(r!=null&&r.noResolveJson)){const i=t,s=i.status||500;if(typeof i.json=="function")i.json().then(o=>{const a=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||s+"";e(new Ro(sp(o),s,a,n))}).catch(()=>{if(n==="vectors"){const o=s+"";e(new Ro(i.statusText||`HTTP ${s} error`,s,o,n))}else{const o=s+"";e(new Ro(i.statusText||`HTTP ${s} error`,s,o,n))}});else{const o=s+"";e(new Ro(i.statusText||`HTTP ${s} error`,s,o,n))}}else e(new b0(sp(t),t,n))},DS=(t,e,r,n)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||t==="HEAD"||!n?z(z({},i),r):(IS(n)?(i.headers=z({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(n)):i.body=n,e!=null&&e.duplex&&(i.duplex=e.duplex),z(z({},i),r))};async function Di(t,e,r,n,i,s,o){return new Promise((a,l)=>{t(r,DS(e,n,i,s)).then(c=>{if(!c.ok)throw c;if(n!=null&&n.noResolveJson)return c;if(o==="vectors"){const u=c.headers.get("content-type");if(c.headers.get("content-length")==="0"||c.status===204)return{};if(!u||!u.includes("application/json"))return{}}return c.json()}).then(c=>a(c)).catch(c=>CS(c,l,n,o))})}function S0(t="storage"){return{get:async(e,r,n,i)=>Di(e,"GET",r,n,i,void 0,t),post:async(e,r,n,i,s)=>Di(e,"POST",r,i,s,n,t),put:async(e,r,n,i,s)=>Di(e,"PUT",r,i,s,n,t),head:async(e,r,n,i)=>Di(e,"HEAD",r,z(z({},n),{},{noResolveJson:!0}),i,void 0,t),remove:async(e,r,n,i,s)=>Di(e,"DELETE",r,i,s,n,t)}}const LS=S0("storage"),{get:As,post:Dt,put:vu,head:jS,remove:ch}=LS,dt=S0("vectors");var vi=class{constructor(t,e={},r,n="storage"){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.fetch=kS(r),this.namespace=n}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=z(z({},this.headers),{},{[t]:e}),this}async handleOperation(t){var e=this;try{return{data:await t(),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(il(r))return{data:null,error:r};throw r}}},US=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(il(e))return{data:null,error:e};throw e}}};let E0;E0=Symbol.toStringTag;var $S=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[E0]="BlobDownloadBuilder",this.promise=null}asStream(){return new US(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(il(e))return{data:null,error:e};throw e}}};const MS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},op={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var BS=class extends vi{constructor(t,e={},r,n){super(t,e,n,"storage"),this.bucketId=r}async uploadOrUpdate(t,e,r,n){var i=this;return i.handleOperation(async()=>{let s;const o=z(z({},op),n);let a=z(z({},i.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),l&&s.append("metadata",i.encodeMetadata(l)),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.has("cacheControl")||s.append("cacheControl",o.cacheControl),l&&!s.has("metadata")&&s.append("metadata",i.encodeMetadata(l))):(s=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=i.toBase64(i.encodeMetadata(l))),(typeof ReadableStream<"u"&&s instanceof ReadableStream||s&&typeof s=="object"&&"pipe"in s&&typeof s.pipe=="function")&&!o.duplex&&(o.duplex="half")),n!=null&&n.headers&&(a=z(z({},a),n.headers));const c=i._removeEmptyFolders(e),u=i._getFinalPath(c),d=await(t=="PUT"?vu:Dt)(i.fetch,`${i.url}/object/${u}`,s,z({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{path:c,id:d.Id,fullPath:d.Key}})}async upload(t,e,r){return this.uploadOrUpdate("POST",t,e,r)}async uploadToSignedUrl(t,e,r,n){var i=this;const s=i._removeEmptyFolders(t),o=i._getFinalPath(s),a=new URL(i.url+`/object/upload/sign/${o}`);return a.searchParams.set("token",e),i.handleOperation(async()=>{let l;const c=z({upsert:op.upsert},n),u=z(z({},i.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType),{path:s,fullPath:(await vu(i.fetch,a.toString(),l,{headers:u})).Key}})}async createSignedUploadUrl(t,e){var r=this;return r.handleOperation(async()=>{let n=r._getFinalPath(t);const i=z({},r.headers);e!=null&&e.upsert&&(i["x-upsert"]="true");const s=await Dt(r.fetch,`${r.url}/object/upload/sign/${n}`,{},{headers:i}),o=new URL(r.url+s.url),a=o.searchParams.get("token");if(!a)throw new nl("No token returned by API");return{signedUrl:o.toString(),path:t,token:a}})}async update(t,e,r){return this.uploadOrUpdate("PUT",t,e,r)}async move(t,e,r){var n=this;return n.handleOperation(async()=>await Dt(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r==null?void 0:r.destinationBucket},{headers:n.headers}))}async copy(t,e,r){var n=this;return n.handleOperation(async()=>({path:(await Dt(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r==null?void 0:r.destinationBucket},{headers:n.headers})).Key}))}async createSignedUrl(t,e,r){var n=this;return n.handleOperation(async()=>{let i=n._getFinalPath(t),s=await Dt(n.fetch,`${n.url}/object/sign/${i}`,z({expiresIn:e},r!=null&&r.transform?{transform:r.transform}:{}),{headers:n.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{signedUrl:encodeURI(`${n.url}${s.signedURL}${o}`)}})}async createSignedUrls(t,e,r){var n=this;return n.handleOperation(async()=>{const i=await Dt(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:e,paths:t},{headers:n.headers}),s=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i.map(o=>z(z({},o),{},{signedUrl:o.signedURL?encodeURI(`${n.url}${o.signedURL}${s}`):null}))})}download(t,e,r){const n=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),s=i?`?${i}`:"",o=this._getFinalPath(t),a=()=>As(this.fetch,`${this.url}/${n}/${o}${s}`,{headers:this.headers,noResolveJson:!0},r);return new $S(a,this.shouldThrowOnError)}async info(t){var e=this;const r=e._getFinalPath(t);return e.handleOperation(async()=>wu(await As(e.fetch,`${e.url}/object/info/${r}`,{headers:e.headers})))}async exists(t){var e=this;const r=e._getFinalPath(t);try{return await jS(e.fetch,`${e.url}/object/${r}`,{headers:e.headers}),{data:!0,error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(il(n)&&n instanceof b0){const i=n.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:n}}throw n}}getPublicUrl(t,e){const r=this._getFinalPath(t),n=[],i=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&n.push(i);const s=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&n.push(o);let a=n.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${s}/public/${r}${a}`)}}}async remove(t){var e=this;return e.handleOperation(async()=>await ch(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}))}async list(t,e,r){var n=this;return n.handleOperation(async()=>{const i=z(z(z({},MS),e),{},{prefix:t||""});return await Dt(n.fetch,`${n.url}/object/list/${n.bucketId}`,i,{headers:n.headers},r)})}async listV2(t,e){var r=this;return r.handleOperation(async()=>{const n=z({},t);return await Dt(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,n,{headers:r.headers},e)})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const FS="2.97.0",Gs={"X-Client-Info":`storage-js/${FS}`};var zS=class extends vi{constructor(t,e={},r,n){const i=new URL(t);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase."));const s=i.href.replace(/\/$/,""),o=z(z({},Gs),e);super(s,o,r,"storage")}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const r=e.listBucketOptionsToQueryString(t);return await As(e.fetch,`${e.url}/bucket${r}`,{headers:e.headers})})}async getBucket(t){var e=this;return e.handleOperation(async()=>await As(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}))}async createBucket(t,e={public:!1}){var r=this;return r.handleOperation(async()=>await Dt(r.fetch,`${r.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async updateBucket(t,e){var r=this;return r.handleOperation(async()=>await vu(r.fetch,`${r.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}))}async emptyBucket(t){var e=this;return e.handleOperation(async()=>await Dt(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await ch(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},VS=class extends vi{constructor(t,e={},r){const n=t.replace(/\/$/,""),i=z(z({},Gs),e);super(n,i,r,"storage")}async createBucket(t){var e=this;return e.handleOperation(async()=>await Dt(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}))}async listBuckets(t){var e=this;return e.handleOperation(async()=>{const r=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&r.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&r.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&r.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&r.set("sortOrder",t.sortOrder),t!=null&&t.search&&r.set("search",t.search);const n=r.toString(),i=n?`${e.url}/bucket?${n}`:`${e.url}/bucket`;return await As(e.fetch,i,{headers:e.headers})})}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await ch(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}))}from(t){var e=this;if(!PS(t))throw new nl("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new TS({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(r,{get(i,s){const o=i[s];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(i,a),error:null}}catch(l){if(n)throw l;return{data:null,error:l}}}}})}},WS=class extends vi{constructor(t,e={},r){const n=t.replace(/\/$/,""),i=z(z({},Gs),{},{"Content-Type":"application/json"},e);super(n,i,r,"vectors")}async createIndex(t){var e=this;return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{})}async getIndex(t,e){var r=this;return r.handleOperation(async()=>await dt.post(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers}))}async listIndexes(t){var e=this;return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}))}async deleteIndex(t,e){var r=this;return r.handleOperation(async()=>await dt.post(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers})||{})}},HS=class extends vi{constructor(t,e={},r){const n=t.replace(/\/$/,""),i=z(z({},Gs),{},{"Content-Type":"application/json"},e);super(n,i,r,"vectors")}async putVectors(t){var e=this;if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{})}async getVectors(t){var e=this;return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}))}async listVectors(t){var e=this;if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}))}async queryVectors(t){var e=this;return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}))}async deleteVectors(t){var e=this;if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{})}},GS=class extends vi{constructor(t,e={},r){const n=t.replace(/\/$/,""),i=z(z({},Gs),{},{"Content-Type":"application/json"},e);super(n,i,r,"vectors")}async createBucket(t){var e=this;return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}async getBucket(t){var e=this;return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}))}async listBuckets(t={}){var e=this;return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}))}async deleteBucket(t){var e=this;return e.handleOperation(async()=>await dt.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{})}},KS=class extends GS{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new JS(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,r=this;return e().call(r,t)}async getBucket(t){var e=()=>super.getBucket,r=this;return e().call(r,t)}async listBuckets(t={}){var e=()=>super.listBuckets,r=this;return e().call(r,t)}async deleteBucket(t){var e=()=>super.deleteBucket,r=this;return e().call(r,t)}},JS=class extends WS{constructor(t,e,r,n){super(t,e,n),this.vectorBucketName=r}async createIndex(t){var e=()=>super.createIndex,r=this;return e().call(r,z(z({},t),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,r=this;return e().call(r,z(z({},t),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,r=this;return e().call(r,r.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,r=this;return e().call(r,r.vectorBucketName,t)}index(t){return new qS(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},qS=class extends HS{constructor(t,e,r,n,i){super(t,e,i),this.vectorBucketName=r,this.indexName=n}async putVectors(t){var e=()=>super.putVectors,r=this;return e().call(r,z(z({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(t){var e=()=>super.getVectors,r=this;return e().call(r,z(z({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,r=this;return e().call(r,z(z({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,r=this;return e().call(r,z(z({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,r=this;return e().call(r,z(z({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},YS=class extends zS{constructor(t,e={},r,n){super(t,e,r,n)}from(t){return new BS(this.url,this.headers,t,this.fetch)}get vectors(){return new KS(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new VS(this.url+"/iceberg",this.headers,this.fetch)}};const R0="2.97.0",An=30*1e3,_u=3,Ql=_u*An,QS="http://localhost:9999",XS="supabase.auth.token",ZS={"X-Client-Info":`gotrue-js/${R0}`},bu="X-Supabase-Api-Version",x0={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},eE=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,tE=10*60*1e3;class Os extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function U(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class rE extends Os{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function nE(t){return U(t)&&t.name==="AuthApiError"}class Qr extends Os{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class fr extends Os{constructor(e,r,n,i){super(e,n,i),this.name=r,this.status=n}}class lt extends fr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Xl(t){return U(t)&&t.name==="AuthSessionMissingError"}class Sn extends fr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class xo extends fr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class To extends fr{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function iE(t){return U(t)&&t.name==="AuthImplicitGrantRedirectError"}class ap extends fr{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class sE extends fr{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Su extends fr{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function Zl(t){return U(t)&&t.name==="AuthRetryableFetchError"}class lp extends fr{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class Eu extends fr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ra="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),cp=` 	
\r=`.split(""),oE=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<cp.length;e+=1)t[cp[e].charCodeAt(0)]=-2;for(let e=0;e<Ra.length;e+=1)t[Ra[e].charCodeAt(0)]=e;return t})();function up(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(Ra[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(Ra[n]),e.queuedBits-=6}}function T0(t,e,r){const n=oE[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function dp(t){const e=[],r=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},s=o=>{cE(o,n,r)};for(let o=0;o<t.length;o+=1)T0(t.charCodeAt(o),i,s);return e.join("")}function aE(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function lE(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const i=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|i)+65536,r+=1}aE(n,e)}}function cE(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if(!(t>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function ri(t){const e=[],r={queue:0,queuedBits:0},n=i=>{e.push(i)};for(let i=0;i<t.length;i+=1)T0(t.charCodeAt(i),r,n);return new Uint8Array(e)}function uE(t){const e=[];return lE(t,r=>e.push(r)),new Uint8Array(e)}function rn(t){const e=[],r={queue:0,queuedBits:0},n=i=>{e.push(i)};return t.forEach(i=>up(i,r,n)),up(null,r,n),e.join("")}function dE(t){return Math.round(Date.now()/1e3)+t}function hE(){return Symbol("auth-callback")}const je=()=>typeof window<"u"&&typeof document<"u",Wr={tested:!1,writable:!1},k0=()=>{if(!je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Wr.tested)return Wr.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Wr.tested=!0,Wr.writable=!0}catch{Wr.tested=!0,Wr.writable=!1}return Wr.writable};function fE(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((i,s)=>{e[s]=i})}catch{}return r.searchParams.forEach((n,i)=>{e[i]=n}),e}const I0=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),pE=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",On=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},Hr=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Le=async(t,e)=>{await t.removeItem(e)};class sl{constructor(){this.promise=new sl.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}sl.promiseConstructor=Promise;function ko(t){const e=t.split(".");if(e.length!==3)throw new Eu("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!eE.test(e[n]))throw new Eu("JWT not in base64url format");return{header:JSON.parse(dp(e[0])),payload:JSON.parse(dp(e[1])),signature:ri(e[2]),raw:{header:e[0],payload:e[1]}}}async function mE(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function gE(t,e){return new Promise((n,i)=>{(async()=>{for(let s=0;s<1/0;s++)try{const o=await t(s);if(!e(s,null,o)){n(o);return}}catch(o){if(!e(s,o)){i(o);return}}})()})}function yE(t){return("0"+t.toString(16)).substr(-2)}function wE(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let i="";for(let s=0;s<56;s++)i+=r.charAt(Math.floor(Math.random()*n));return i}return crypto.getRandomValues(e),Array.from(e,yE).join("")}async function vE(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),i=new Uint8Array(n);return Array.from(i).map(s=>String.fromCharCode(s)).join("")}async function _E(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await vE(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function En(t,e,r=!1){const n=wE();let i=n;r&&(i+="/PASSWORD_RECOVERY"),await On(t,`${e}-code-verifier`,i);const s=await _E(n);return[s,n===s?"plain":"s256"]}const bE=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function SE(t){const e=t.headers.get(bu);if(!e||!e.match(bE))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function EE(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function RE(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const xE=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Rn(t){if(!xE.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ec(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function TE(t,e){return new Proxy(t,{get:(r,n,i)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const s=n.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)"||s==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,i)}return!e.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(r,n,i)}})}function hp(t){return JSON.parse(JSON.stringify(t))}const Jr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),kE=[502,503,504];async function fp(t){var e;if(!pE(t))throw new Su(Jr(t),0);if(kE.includes(t.status))throw new Su(Jr(t),t.status);let r;try{r=await t.json()}catch(s){throw new Qr(Jr(s),s)}let n;const i=SE(t);if(i&&i.getTime()>=x0["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new lp(Jr(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new lt}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((s,o)=>s&&typeof o=="string",!0))throw new lp(Jr(r),t.status,r.weak_password.reasons);throw new rE(Jr(r),t.status||500,n)}const IE=(t,e,r,n)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(n),Object.assign(Object.assign({},i),r))};async function V(t,e,r,n){var i;const s=Object.assign({},n==null?void 0:n.headers);s[bu]||(s[bu]=x0["2024-01-01"].name),n!=null&&n.jwt&&(s.Authorization=`Bearer ${n.jwt}`);const o=(i=n==null?void 0:n.query)!==null&&i!==void 0?i:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await PE(t,e,r+a,{headers:s,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function PE(t,e,r,n,i,s){const o=IE(e,n,i,s);let a;try{a=await t(r,Object.assign({},o))}catch(l){throw console.error(l),new Su(Jr(l),0)}if(a.ok||await fp(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(l){await fp(l)}}function At(t){var e;let r=null;NE(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=dE(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function pp(t){const e=At(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Rr(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function AE(t){return{data:t,error:null}}function OE(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:i,verification_type:s}=t,o=rl(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:n,redirect_to:i,verification_type:s},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function mp(t){return t}function NE(t){return t.access_token&&t.refresh_token&&t.expires_in}const tc=["global","local","others"];class CE{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=I0(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,r=tc[0]){if(tc.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${tc.join(", ")}`);try{return await V(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(U(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await V(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Rr})}catch(n){if(U(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=rl(e,["options"]),i=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(i.new_email=n==null?void 0:n.newEmail,delete i.newEmail),await V(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:OE,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(U(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await V(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Rr})}catch(r){if(U(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,i,s,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await V(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(s=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:mp});if(u.error)throw u.error;const d=await u.json(),h=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);c[`${v}Page`]=y}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(U(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){Rn(e);try{return await V(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Rr})}catch(r){if(U(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){Rn(e);try{return await V(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:Rr})}catch(n){if(U(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){Rn(e);try{return await V(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:Rr})}catch(n){if(U(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Rn(e.userId);try{const{data:r,error:n}=await V(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:r,error:n}}catch(r){if(U(r))return{data:null,error:r};throw r}}async _deleteFactor(e){Rn(e.userId),Rn(e.id);try{return{data:await V(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(U(r))return{data:null,error:r};throw r}}async _listOAuthClients(e){var r,n,i,s,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await V(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(s=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:mp});if(u.error)throw u.error;const d=await u.json(),h=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);c[`${v}Page`]=y}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(U(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await V(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(U(r))return{data:null,error:r};throw r}}async _getOAuthClient(e){try{return await V(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(U(r))return{data:null,error:r};throw r}}async _updateOAuthClient(e,r){try{return await V(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(U(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await V(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(U(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(e){try{return await V(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(U(r))return{data:null,error:r};throw r}}}function gp(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const xn={debug:!!(globalThis&&k0()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class P0 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class yp extends P0{}async function DE(t,e,r){xn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;e>0&&setTimeout(()=>{n.abort(),xn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve();try{return await globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async i=>{if(i){xn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,i.name);try{return await r()}finally{xn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,i.name)}}else{if(e===0)throw xn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new yp(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(xn.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}})}catch(i){throw(i==null?void 0:i.name)==="AbortError"?new yp(`Acquiring an exclusive Navigator LockManager lock "${t}" timed out waiting ${e}ms`):i}}function LE(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function A0(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function jE(t){return parseInt(t,16)}function UE(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function $E(t){var e;const{chainId:r,domain:n,expirationTime:i,issuedAt:s=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:d,version:h}=t;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=A0(t.address),m=u?`${u}://${n}`:n,y=t.statement?`${t.statement}
`:"",v=`${m} wants you to sign in with your Ethereum account:
${f}

${y}`;let w=`URI: ${d}
Version: ${h}
Chain ID: ${r}${o?`
Nonce: ${o}`:""}
Issued At: ${s.toISOString()}`;if(i&&(w+=`
Expiration Time: ${i.toISOString()}`),a&&(w+=`
Not Before: ${a.toISOString()}`),l&&(w+=`
Request ID: ${l}`),c){let p=`
Resources:`;for(const g of c){if(!g||typeof g!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${g}`);p+=`
- ${g}`}w+=p}return`${v}
${w}`}class _e extends Error{constructor({message:e,code:r,cause:n,name:i}){var s;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(s=i??(n instanceof Error?n.name:void 0))!==null&&s!==void 0?s:"Unknown Error",this.code=r}}class xa extends _e{constructor(e,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:e}),this.name="WebAuthnUnknownError",this.originalError=r}}function ME({error:t,options:e}){var r,n,i;const{publicKey:s}=e;if(!s)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new _e({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((r=s.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new _e({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((n=s.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new _e({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((i=s.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new _e({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new _e({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new _e({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return s.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new _e({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new _e({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(O0(o)){if(s.rp.id!==o)return new _e({message:`The RP ID "${s.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new _e({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(s.user.id.byteLength<1||s.user.id.byteLength>64)return new _e({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new _e({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new _e({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function BE({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new _e({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new _e({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const n=window.location.hostname;if(O0(n)){if(r.rpId!==n)return new _e({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new _e({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new _e({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new _e({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class FE{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const zE=new FE;function VE(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:n}=t,i=rl(t,["challenge","user","excludeCredentials"]),s=ri(e).buffer,o=Object.assign(Object.assign({},r),{id:ri(r.id).buffer}),a=Object.assign(Object.assign({},i),{challenge:s,user:o});if(n&&n.length>0){a.excludeCredentials=new Array(n.length);for(let l=0;l<n.length;l++){const c=n[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:ri(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function WE(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,n=rl(t,["challenge","allowCredentials"]),i=ri(e).buffer,s=Object.assign(Object.assign({},n),{challenge:i});if(r&&r.length>0){s.allowCredentials=new Array(r.length);for(let o=0;o<r.length;o++){const a=r[o];s.allowCredentials[o]=Object.assign(Object.assign({},a),{id:ri(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return s}function HE(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:rn(new Uint8Array(t.response.attestationObject)),clientDataJSON:rn(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function GE(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t,n=t.getClientExtensionResults(),i=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:rn(new Uint8Array(i.authenticatorData)),clientDataJSON:rn(new Uint8Array(i.clientDataJSON)),signature:rn(new Uint8Array(i.signature)),userHandle:i.userHandle?rn(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function O0(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function wp(){var t,e;return!!(je()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function KE(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new xa("Browser returned unexpected credential type",e)}:{data:null,error:new xa("Empty credential response",e)}}catch(e){return{data:null,error:ME({error:e,options:t})}}}async function JE(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new xa("Browser returned unexpected credential type",e)}:{data:null,error:new xa("Empty credential response",e)}}catch(e){return{data:null,error:BE({error:e,options:t})}}}const qE={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},YE={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Ta(...t){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),r=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),n={};for(const i of t)if(i)for(const s in i){const o=i[s];if(o!==void 0)if(Array.isArray(o))n[s]=o;else if(r(o))n[s]=o;else if(e(o)){const a=n[s];e(a)?n[s]=Ta(a,o):n[s]=Ta(o)}else n[s]=o}return n}function QE(t,e){return Ta(qE,t,e||{})}function XE(t,e){return Ta(YE,t,e||{})}class ZE{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:r,friendlyName:n,signal:i},s){var o;try{const{data:a,error:l}=await this.client.mfa.challenge({factorId:e,webauthn:r});if(!a)return{data:null,error:l};const c=i??zE.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:u}=a.webauthn.credential_options.publicKey;if(!u.name){const d=n;if(d)u.name=`${u.id}:${d}`;else{const f=(await this.client.getUser()).data.user,m=((o=f==null?void 0:f.user_metadata)===null||o===void 0?void 0:o.name)||(f==null?void 0:f.email)||(f==null?void 0:f.id)||"User";u.name=`${u.id}:${m}`}}u.displayName||(u.displayName=u.name)}switch(a.webauthn.type){case"create":{const u=QE(a.webauthn.credential_options.publicKey,s==null?void 0:s.create),{data:d,error:h}=await KE({publicKey:u,signal:c});return d?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:d}},error:null}:{data:null,error:h}}case"request":{const u=XE(a.webauthn.credential_options.publicKey,s==null?void 0:s.request),{data:d,error:h}=await JE(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:u,signal:c}));return d?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:d}},error:null}:{data:null,error:h}}}}catch(a){return U(a)?{data:null,error:a}:{data:null,error:new Qr("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},s){if(!r)return{data:null,error:new Os("rpId is required for WebAuthn authentication")};try{if(!wp())return{data:null,error:new Qr("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:r,rpOrigins:n},signal:i},{request:s});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:r,rpOrigins:n,credential_response:l.credential_response}})}catch(o){return U(o)?{data:null,error:o}:{data:null,error:new Qr("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},s){if(!r)return{data:null,error:new Os("rpId is required for WebAuthn registration")};try{if(!wp())return{data:null,error:new Qr("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(u=>{var d;return(d=u.data)===null||d===void 0?void 0:d.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:i},{create:s});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:r,rpOrigins:n,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(o){return U(o)?{data:null,error:o}:{data:null,error:new Qr("Unexpected error in register",o)}}}}LE();const eR={url:QS,storageKey:XS,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ZS,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function vp(t,e,r){return await r()}const Tn={};class Ns{get jwks(){var e,r;return(r=(e=Tn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Tn[this.storageKey]=Object.assign(Object.assign({},Tn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Tn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Tn[this.storageKey]=Object.assign(Object.assign({},Tn[this.storageKey]),{cachedAt:e})}constructor(e){var r,n,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},eR),e);if(this.storageKey=s.storageKey,this.instanceID=(r=Ns.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,Ns.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.instanceID>0&&je()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new CE({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=I0(s.fetch),this.lock=s.lock||vp,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,this.lockAcquireTimeout=s.lockAcquireTimeout,s.lock?this.lock=s.lock:this.persistSession&&je()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=DE:this.lock=vp,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new ZE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:k0()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=gp(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=gp(this.memoryStorage)),je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o);try{await this._notifyAllSubscribers(o.data.event,o.data.session,!1)}catch(a){this._debug("#broadcastChannel","error",a)}})}s.skipAutoInitialize||this.initialize().catch(o=>{this._debug("#initialize()","error",o)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${R0}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r={},n="none";if(je()&&(r=fE(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),je()&&this.detectSessionInUrl&&n!=="none"){const{data:i,error:s}=await this._getSessionFromURL(r,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),iE(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return{error:s}}const{session:o,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return U(r)?this._returnResult({error:r}):this._returnResult({error:new Qr("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,i;try{const s=await V(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:At}),{data:o,error:a}=s;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(U(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signUp(e){var r,n,i;try{let s;if("email"in e){const{email:u,password:d,options:h}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await En(this.storage,this.storageKey)),s=await V(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:u,password:d,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:m},xform:At})}else if("phone"in e){const{phone:u,password:d,options:h}=e;s=await V(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},channel:(i=h==null?void 0:h.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:At})}else throw new xo("You must provide either an email or phone number and a password");const{data:o,error:a}=s;if(a||!o)return await Le(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(s){if(await Le(this.storage,`${this.storageKey}-code-verifier`),U(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithPassword(e){try{let r;if("email"in e){const{email:s,password:o,options:a}=e;r=await V(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:pp})}else if("phone"in e){const{phone:s,password:o,options:a}=e;r=await V(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:pp})}else throw new xo("You must provide either an email or phone number and a password");const{data:n,error:i}=r;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!n||!n.session||!n.user){const s=new Sn;return this._returnResult({data:{user:null,session:null},error:s})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:i})}catch(r){if(U(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(e){var r,n,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;switch(r){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(e){var r,n,i,s,o,a,l,c,u,d,h;let f,m;if("message"in e)f=e.message,m=e.signature;else{const{chain:y,wallet:v,statement:w,options:p}=e;let g;if(je())if(typeof v=="object")g=v;else{const I=window;if("ethereum"in I&&typeof I.ethereum=="object"&&"request"in I.ethereum&&typeof I.ethereum.request=="function")g=I.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(p!=null&&p.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=v}const _=new URL((r=p==null?void 0:p.url)!==null&&r!==void 0?r:window.location.href),S=await g.request({method:"eth_requestAccounts"}).then(I=>I).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!S||S.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const R=A0(S[0]);let x=(n=p==null?void 0:p.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!x){const I=await g.request({method:"eth_chainId"});x=jE(I)}const T={domain:_.host,address:R,statement:w,uri:_.href,version:"1",chainId:x,nonce:(i=p==null?void 0:p.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(o=(s=p==null?void 0:p.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=p==null?void 0:p.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=p==null?void 0:p.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=p==null?void 0:p.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=p==null?void 0:p.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=$E(T),m=await g.request({method:"personal_sign",params:[UE(f),R]})}try{const{data:y,error:v}=await V(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:m},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:At});if(v)throw v;if(!y||!y.session||!y.user){const w=new Sn;return this._returnResult({data:{user:null,session:null},error:w})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:v})}catch(y){if(U(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(e){var r,n,i,s,o,a,l,c,u,d,h,f;let m,y;if("message"in e)m=e.message,y=e.signature;else{const{chain:v,wallet:w,statement:p,options:g}=e;let _;if(je())if(typeof w=="object")_=w;else{const R=window;if("solana"in R&&typeof R.solana=="object"&&("signIn"in R.solana&&typeof R.solana.signIn=="function"||"signMessage"in R.solana&&typeof R.solana.signMessage=="function"))_=R.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!(g!=null&&g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=w}const S=new URL((r=g==null?void 0:g.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in _&&_.signIn){const R=await _.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},g==null?void 0:g.signInWithSolana),{version:"1",domain:S.host,uri:S.href}),p?{statement:p}:null));let x;if(Array.isArray(R)&&R[0]&&typeof R[0]=="object")x=R[0];else if(R&&typeof R=="object"&&"signedMessage"in R&&"signature"in R)x=R;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in x&&"signature"in x&&(typeof x.signedMessage=="string"||x.signedMessage instanceof Uint8Array)&&x.signature instanceof Uint8Array)m=typeof x.signedMessage=="string"?x.signedMessage:new TextDecoder().decode(x.signedMessage),y=x.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in _)||typeof _.signMessage!="function"||!("publicKey"in _)||typeof _!="object"||!_.publicKey||!("toBase58"in _.publicKey)||typeof _.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${S.host} wants you to sign in with your Solana account:`,_.publicKey.toBase58(),...p?["",p,""]:[""],"Version: 1",`URI: ${S.href}`,`Issued At: ${(i=(n=g==null?void 0:g.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((s=g==null?void 0:g.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...!((o=g==null?void 0:g.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...!((a=g==null?void 0:g.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...!((l=g==null?void 0:g.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...!((c=g==null?void 0:g.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...!((d=(u=g==null?void 0:g.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...g.signInWithSolana.resources.map(x=>`- ${x}`)]:[]].join(`
`);const R=await _.signMessage(new TextEncoder().encode(m),"utf8");if(!R||!(R instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=R}}try{const{data:v,error:w}=await V(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:rn(y)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:At});if(w)throw w;if(!v||!v.session||!v.user){const p=new Sn;return this._returnResult({data:{user:null,session:null},error:p})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:w})}catch(v){if(U(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async _exchangeCodeForSession(e){const r=await Hr(this.storage,`${this.storageKey}-code-verifier`),[n,i]=(r??"").split("/");try{if(!n&&this.flowType==="pkce")throw new sE;const{data:s,error:o}=await V(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:At});if(await Le(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!s||!s.session||!s.user){const a=new Sn;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:o})}catch(s){if(await Le(this.storage,`${this.storageKey}-code-verifier`),U(s))return this._returnResult({data:{user:null,session:null,redirectType:null},error:s});throw s}}async signInWithIdToken(e){try{const{options:r,provider:n,token:i,access_token:s,nonce:o}=e,a=await V(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:i,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:At}),{data:l,error:c}=a;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const u=new Sn;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(r){if(U(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(e){var r,n,i,s,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await En(this.storage,this.storageKey));const{error:d}=await V(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await V(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u})}throw new xo("You must provide either an email or phone number.")}catch(a){if(await Le(this.storage,`${this.storageKey}-code-verifier`),U(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var r,n;try{let i,s;"options"in e&&(i=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await V(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:At});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(U(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var r,n,i,s,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await En(this.storage,this.storageKey));const c=await V(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:AE});return!((s=c.data)===null||s===void 0)&&s.url&&je()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(a){if(await Le(this.storage,`${this.storageKey}-code-verifier`),U(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new lt;const{error:i}=await V(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(U(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:i,options:s}=e,{error:o}=await V(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},redirectTo:s==null?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:n,type:i,options:s}=e,{data:o,error:a}=await V(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new xo("You must provide either an email or phone number and a type")}catch(r){if(U(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await Hr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Ql:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await Hr(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=ec()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=TE(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(e){try{return e?await V(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Rr}):await this._useSession(async r=>{var n,i,s;const{data:o,error:a}=r;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new lt}:await V(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:Rr})})}catch(r){if(U(r))return Xl(r)&&(await this._removeSession(),await Le(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:i,error:s}=n;if(s)throw s;if(!i.session)throw new lt;const o=i.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await En(this.storage,this.storageKey));const{data:c,error:u}=await V(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Rr});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(n){if(await Le(this.storage,`${this.storageKey}-code-verifier`),U(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new lt;const r=Date.now()/1e3;let n=r,i=!0,s=null;const{payload:o}=ko(e.access_token);if(o.exp&&(n=o.exp,i=n<=r),i){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(r){if(U(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:o,error:a}=r;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new lt;const{data:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(U(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(e,r){try{if(!je())throw new To("No browser detected.");if(e.error||e.error_description||e.error_code)throw new To(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new ap("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new To("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ap("No code detected.");const{data:p,error:g}=await this._exchangeCodeForSession(e.code);if(g)throw g;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:p.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:i,access_token:s,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!o||!c)throw new To("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const f=h-u;f*1e3<=An&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);const m=h-d;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,u);const{data:y,error:v}=await this._getUser(s);if(v)throw v;const w={provider_token:n,provider_refresh_token:i,access_token:s,expires_in:d,expires_at:h,refresh_token:o,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:w,redirectType:e.type},error:null})}catch(n){if(U(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await Hr(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:i,error:s}=r;if(s&&!Xl(s))return this._returnResult({error:s});const o=(n=i.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(nE(a)&&(a.status===404||a.status===401||a.status===403)||Xl(a)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Le(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const r=hE(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,i;try{const{data:{session:s},error:o}=r;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let n=null,i=null;this.flowType==="pkce"&&([n,i]=await En(this.storage,this.storageKey,!0));try{return await V(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(await Le(this.storage,`${this.storageKey}-code-verifier`),U(s))return this._returnResult({data:null,error:s});throw s}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(r){if(U(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var r;try{const{data:n,error:i}=await this._useSession(async s=>{var o,a,l,c,u;const{data:d,error:h}=s;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await V(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(i)throw i;return je()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:e.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(U(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async r=>{var n;try{const{error:i,data:{session:s}}=r;if(i)throw i;const{options:o,provider:a,token:l,access_token:c,nonce:u}=e,d=await V(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=s==null?void 0:s.access_token)!==null&&n!==void 0?n:void 0,body:{provider:a,id_token:l,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:At}),{data:h,error:f}=d;return f?this._returnResult({data:{user:null,session:null},error:f}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new Sn}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:f}))}catch(i){if(await Le(this.storage,`${this.storageKey}-code-verifier`),U(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,i;const{data:s,error:o}=r;if(o)throw o;return await V(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0})})}catch(r){if(U(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await gE(async i=>(i>0&&await mE(200*Math.pow(2,i-1)),this._debug(r,"refreshing attempt",i),await V(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:At})),(i,s)=>{const o=200*Math.pow(2,i);return s&&Zl(s)&&Date.now()+o-n<An})}catch(n){if(this._debug(r,"error",n),U(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),je()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const i=await Hr(this.storage,this.storageKey);if(i&&this.userStorage){let o=await Hr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await On(this.userStorage,this.storageKey+"-user",o)),i.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:ec()}else if(i&&!i.user&&!i.user){const o=await Hr(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(i.user=o.user,await Le(this.storage,this.storageKey+"-user"),await On(this.storage,this.storageKey,i)):i.user=ec()}if(this._debug(n,"session from storage",i),!this._isValidSession(i)){this._debug(n,"session is not valid"),i!==null&&await this._removeSession();return}const s=((r=i.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Ql;if(this._debug(n,`session has${s?"":" not"} expired with margin of ${Ql}s`),s){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),Zl(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(i.access_token);!a&&(o!=null&&o.user)?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(n,"error",i),console.error(i);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new lt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new sl;const{data:s,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new lt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={data:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(i,"error",s),U(s)){const o={data:null,error:s};return Zl(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,r,n=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(l){s.push(l)}});if(await Promise.all(o),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Le(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},e),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await On(this.userStorage,this.storageKey+"-user",{user:r.user});const i=Object.assign({},r);delete i.user;const s=hp(i);await On(this.storage,this.storageKey,s)}else{const i=hp(r);await On(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Le(this.storage,this.storageKey),await Le(this.storage,this.storageKey+"-code-verifier"),await Le(this.storage,this.storageKey+"-user"),this.userStorage&&await Le(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&je()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),An);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((n.expires_at*1e3-e)/An);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${An}ms, refresh threshold is ${_u} ticks`),i<=_u&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof P0)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!je()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const i=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&i.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&i.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[s,o]=await En(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(n!=null&&n.queryParams){const s=new URLSearchParams(n.queryParams);i.push(s.toString())}return n!=null&&n.skipBrowserRedirect&&i.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:i,error:s}=r;return s?this._returnResult({data:null,error:s}):await V(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(U(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,i;const{data:s,error:o}=r;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await V(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return c?this._returnResult({data:null,error:c}):(e.factorType==="totp"&&l.type==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(r){if(U(r))return this._returnResult({data:null,error:r});throw r}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var n;const{data:i,error:s}=r;if(s)return this._returnResult({data:null,error:s});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?HE(e.webauthn.credential_response):GE(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await V(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(r){if(U(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var n;const{data:i,error:s}=r;if(s)return this._returnResult({data:null,error:s});const o=await V(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:VE(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:WE(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(U(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){var e;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const i={all:[],phone:[],totp:[],webauthn:[]};for(const s of(e=r==null?void 0:r.factors)!==null&&e!==void 0?e:[])i.all.push(s),s.status==="verified"&&i[s.factor_type].push(s);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(e){var r,n,i,s;if(e)try{const{payload:f}=ko(e);let m=null;f.aal&&(m=f.aal);let y=m;const{data:{user:v},error:w}=await this.getUser(e);if(w)return this._returnResult({data:null,error:w});((n=(r=v==null?void 0:v.factors)===null||r===void 0?void 0:r.filter(_=>_.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(y="aal2");const g=f.amr||[];return{data:{currentLevel:m,nextLevel:y,currentAuthenticationMethods:g},error:null}}catch(f){if(U(f))return this._returnResult({data:null,error:f});throw f}const{data:{session:o},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=ko(o.access_token);let c=null;l.aal&&(c=l.aal);let u=c;((s=(i=o.user.factors)===null||i===void 0?void 0:i.filter(f=>f.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(u="aal2");const h=l.amr||[];return{data:{currentLevel:c,nextLevel:u,currentAuthenticationMethods:h},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async r=>{const{data:{session:n},error:i}=r;return i?this._returnResult({data:null,error:i}):n?await V(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:n.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new lt})})}catch(r){if(U(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(e,r){try{return await this._useSession(async n=>{const{data:{session:i},error:s}=n;if(s)return this._returnResult({data:null,error:s});if(!i)return this._returnResult({data:null,error:new lt});const o=await V(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&je()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(U(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,r){try{return await this._useSession(async n=>{const{data:{session:i},error:s}=n;if(s)return this._returnResult({data:null,error:s});if(!i)return this._returnResult({data:null,error:new lt});const o=await V(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&je()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(U(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;return n?this._returnResult({data:null,error:n}):r?await V(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new lt})})}catch(e){if(U(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async r=>{const{data:{session:n},error:i}=r;return i?this._returnResult({data:null,error:i}):n?(await V(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new lt})})}catch(r){if(U(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(a=>a.kid===e);if(n)return n;const i=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+tE>i)return n;const{data:s,error:o}=await V(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=i,n=s.keys.find(a=>a.kid===e),!n)?null:n}async getClaims(e,r={}){try{let n=e;if(!n){const{data:f,error:m}=await this.getSession();if(m||!f.session)return this._returnResult({data:null,error:m});n=f.session.access_token}const{header:i,payload:s,signature:o,raw:{header:a,payload:l}}=ko(n);r!=null&&r.allowExpired||EE(s.exp);const c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!c){const{error:f}=await this.getUser(n);if(f)throw f;return{data:{claims:s,header:i,signature:o},error:null}}const u=RE(i.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,uE(`${a}.${l}`)))throw new Eu("Invalid JWT signature");return{data:{claims:s,header:i,signature:o},error:null}}catch(n){if(U(n))return this._returnResult({data:null,error:n});throw n}}}Ns.nextInstanceID={};const tR=Ns,rR="2.97.0";let Ki="";typeof Deno<"u"?Ki="deno":typeof document<"u"?Ki="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ki="react-native":Ki="node";const nR={"X-Client-Info":`supabase-js-${Ki}/${rR}`},iR={headers:nR},sR={schema:"public"},oR={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},aR={};function Cs(t){"@babel/helpers - typeof";return Cs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cs(t)}function lR(t,e){if(Cs(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Cs(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function cR(t){var e=lR(t,"string");return Cs(e)=="symbol"?e:e+""}function uR(t,e,r){return(e=cR(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _p(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function ye(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_p(Object(r),!0).forEach(function(n){uR(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_p(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const dR=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),hR=()=>Headers,fR=(t,e,r)=>{const n=dR(r),i=hR();return async(s,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let c=new i(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(s,ye(ye({},o),{},{headers:c}))}};function pR(t){return t.endsWith("/")?t:t+"/"}function mR(t,e){var r,n;const{db:i,auth:s,realtime:o,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,h={db:ye(ye({},l),i),auth:ye(ye({},c),s),realtime:ye(ye({},u),o),storage:{},global:ye(ye(ye({},d),a),{},{headers:ye(ye({},(r=d==null?void 0:d.headers)!==null&&r!==void 0?r:{}),(n=a==null?void 0:a.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function gR(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(pR(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var yR=class extends tR{constructor(t){super(t)}},wR=class{constructor(t,e,r){var n,i;this.supabaseUrl=t,this.supabaseKey=e;const s=gR(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",s),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",s),this.storageUrl=new URL("storage/v1",s),this.functionsUrl=new URL("functions/v1",s);const o=`sb-${s.hostname.split(".")[0]}-auth-token`,a={db:sR,realtime:aR,auth:ye(ye({},oR),{},{storageKey:o}),global:iR},l=mR(r??{},a);if(this.storageKey=(n=l.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=l.global.headers)!==null&&i!==void 0?i:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(u,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}});else{var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch)}this.fetch=fR(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(ye({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(u=>this.realtime.setAuth(u)).catch(u=>console.warn("Failed to set initial Realtime auth token:",u)),this.rest=new nS(new URL("rest/v1",s).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new YS(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new qb(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,r)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,r;if(t.accessToken)return await t.accessToken();const{data:n}=await t.auth.getSession();return(e=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:n,userStorage:i,storageKey:s,flowType:o,lock:a,debug:l,throwOnError:c},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new yR({url:this.authUrl.href,headers:ye(ye({},h),u),storageKey:s,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:n,userStorage:i,flowType:o,lock:a,debug:l,throwOnError:c,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new _S(this.realtimeUrl.href,ye(ye({},t),{},{params:ye(ye({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const vR=(t,e,r)=>new wR(t,e,r);function _R(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const r=e.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}_R()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const ni={},bp=(ni==null?void 0:ni.VITE_SUPABASE_URL)||"",Sp=(ni==null?void 0:ni.VITE_SUPABASE_ANON_KEY)||"",re=bp&&Sp?vR(bp,Sp):null,rc=O.memo(({label:t,content:e,icon:r,color:n,isSaved:i,onSave:s,onShare:o,onReport:a,delay:l=0})=>{const{showToast:c}=m0(),u=async()=>{Q.haptic("light"),await Q.copyToClipboard(e)&&c("Copied to clipboard!","success")};return b.jsxs("div",{className:"glass rounded-2xl p-4 md:p-5 border border-white/5 hover:border-white/20 transition-all duration-300 group opacity-0 animate-fade-in-up active:scale-[0.99]",style:{animationDelay:`${l}s`,animationFillMode:"forwards"},children:[b.jsxs("div",{className:"flex justify-between items-start mb-2",children:[b.jsxs("div",{className:"flex items-center gap-2 select-none",children:[b.jsx("span",{className:"text-xl",children:r}),b.jsx("span",{className:`text-xs font-bold uppercase tracking-widest bg-gradient-to-r ${n} bg-clip-text text-transparent`,children:t})]}),b.jsxs("div",{className:"flex gap-1 opacity-60 group-hover:opacity-100 transition-opacity",children:[b.jsx("button",{onClick:u,className:"p-1.5 rounded-lg hover:bg-white/10 text-white/70 hover:text-white transition-colors active:scale-95",title:"Copy to Clipboard",children:b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})})}),b.jsx("button",{onClick:o,className:"p-1.5 rounded-lg hover:bg-white/10 text-white/70 hover:text-white transition-colors active:scale-95",title:"Share",children:b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),b.jsx("button",{onClick:s,className:`p-1.5 rounded-lg hover:bg-white/10 transition-colors active:scale-95 ${i?"text-pink-500":"text-white/70 hover:text-pink-400"}`,title:"Save",children:b.jsx("svg",{className:"w-4 h-4",fill:i?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),b.jsx("button",{onClick:a,className:"p-1.5 rounded-lg hover:bg-white/10 text-white/70 hover:text-red-400 transition-colors active:scale-95",title:"Report Issue",children:b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"})})})]})]}),b.jsxs("div",{className:"text-white text-base md:text-lg font-medium leading-relaxed cursor-pointer hover:opacity-80 transition-opacity",onClick:u,title:"Click to Copy",children:['"',e,'"']})]})}),bR=({type:t,onClose:e})=>b.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[b.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-md",onClick:e}),b.jsxs("div",{className:"relative bg-[#0a0a0a] rounded-3xl w-full max-w-2xl max-h-[80vh] border border-white/10 shadow-2xl flex flex-col animate-scale-in",children:[b.jsxs("div",{className:"p-6 border-b border-white/10 flex justify-between items-center bg-white/5 rounded-t-3xl",children:[b.jsx("h2",{className:"text-xl font-bold text-white",children:t==="privacy"?"Privacy Policy":"Terms of Service"}),b.jsx("button",{onClick:e,className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-white/50 hover:text-white hover:bg-white/20 transition-all",children:""})]}),b.jsx("div",{className:"p-6 md:p-8 overflow-y-auto text-white/70 text-sm leading-relaxed space-y-6 custom-scrollbar",children:t==="privacy"?b.jsxs(b.Fragment,{children:[b.jsxs("section",{children:[b.jsx("h3",{className:"text-white font-bold mb-2",children:"Privacy Summary"}),b.jsx("p",{children:"We respect your privacy. This app collects minimal data (e.g., email, credits) to operate the service. User inputs are processed by third-party AI providers for generation only. We do not sell your personal data."}),b.jsx("p",{className:"mt-4 text-xs opacity-50",children:"For full details, please check the Privacy Policy link on our App Store / Play Store listing."})]}),b.jsxs("section",{children:[b.jsx("h3",{className:"text-white font-bold mb-2",children:"Account Deletion"}),b.jsx("p",{children:"You may request the deletion of your account and all associated data at any time via the in-app support or by contacting us."})]})]}):b.jsxs(b.Fragment,{children:[b.jsxs("section",{children:[b.jsx("h3",{className:"text-white font-bold mb-2",children:"Terms Overview"}),b.jsx("p",{children:"Rizz Master is for entertainment purposes only. AI-generated advice may be inaccurate or inappropriate; please use your own judgment."})]}),b.jsxs("section",{children:[b.jsx("h3",{className:"text-white font-bold mb-2",children:"User Conduct"}),b.jsx("p",{children:"You agree not to use this service to generate harmful, illegal, or harassing content. We reserve the right to ban users who violate this policy."}),b.jsx("p",{className:"mt-4 text-xs opacity-50",children:"For full terms, please check the Terms of Service link on our App Store / Play Store listing."})]})]})}),b.jsx("div",{className:"p-6 border-t border-white/10 bg-black/20 rounded-b-3xl",children:b.jsx("button",{onClick:e,className:"w-full py-3 bg-white text-black font-bold rounded-xl hover:bg-gray-200 transition-colors",children:"Understood"})})]})]});/*! Capacitor: https://capacitorjs.com/ - MIT License */const SR=t=>{const e=new Map;e.set("web",{name:"web"});const r=t.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:e},n=(s,o)=>{r.platforms.set(s,o)},i=s=>{r.platforms.has(s)&&(r.currentPlatform=r.platforms.get(s))};return r.addPlatform=n,r.setPlatform=i,r},ER=t=>t.CapacitorPlatforms=SR(t),N0=ER(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});N0.addPlatform;N0.setPlatform;var di;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(di||(di={}));class nc extends Error{constructor(e,r,n){super(e),this.message=e,this.code=r,this.data=n}}const RR=t=>{var e,r;return t!=null&&t.androidBridge?"android":!((r=(e=t==null?void 0:t.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},xR=t=>{var e,r,n,i,s;const o=t.CapacitorCustomPlatform||null,a=t.Capacitor||{},l=a.Plugins=a.Plugins||{},c=t.CapacitorPlatforms,u=()=>o!==null?o.name:RR(t),d=((e=c==null?void 0:c.currentPlatform)===null||e===void 0?void 0:e.getPlatform)||u,h=()=>d()!=="web",f=((r=c==null?void 0:c.currentPlatform)===null||r===void 0?void 0:r.isNativePlatform)||h,m=x=>{const T=_.get(x);return!!(T!=null&&T.platforms.has(d())||w(x))},y=((n=c==null?void 0:c.currentPlatform)===null||n===void 0?void 0:n.isPluginAvailable)||m,v=x=>{var T;return(T=a.PluginHeaders)===null||T===void 0?void 0:T.find(I=>I.name===x)},w=((i=c==null?void 0:c.currentPlatform)===null||i===void 0?void 0:i.getPluginHeader)||v,p=x=>t.console.error(x),g=(x,T,I)=>Promise.reject(`${I} does not have an implementation of "${T}".`),_=new Map,S=(x,T={})=>{const I=_.get(x);if(I)return console.warn(`Capacitor plugin "${x}" already registered. Cannot register plugins twice.`),I.proxy;const N=d(),M=w(x);let B;const Se=async()=>(!B&&N in T?B=typeof T[N]=="function"?B=await T[N]():B=T[N]:o!==null&&!B&&"web"in T&&(B=typeof T.web=="function"?B=await T.web():B=T.web),B),kt=(L,J)=>{var Z,De;if(M){const oe=M==null?void 0:M.methods.find(se=>J===se.name);if(oe)return oe.rtype==="promise"?se=>a.nativePromise(x,J.toString(),se):(se,Ze)=>a.nativeCallback(x,J.toString(),se,Ze);if(L)return(Z=L[J])===null||Z===void 0?void 0:Z.bind(L)}else{if(L)return(De=L[J])===null||De===void 0?void 0:De.bind(L);throw new nc(`"${x}" plugin is not implemented on ${N}`,di.Unimplemented)}},ze=L=>{let J;const Z=(...De)=>{const oe=Se().then(se=>{const Ze=kt(se,L);if(Ze){const yt=Ze(...De);return J=yt==null?void 0:yt.remove,yt}else throw new nc(`"${x}.${L}()" is not implemented on ${N}`,di.Unimplemented)});return L==="addListener"&&(oe.remove=async()=>J()),oe};return Z.toString=()=>`${L.toString()}() { [capacitor code] }`,Object.defineProperty(Z,"name",{value:L,writable:!1,configurable:!1}),Z},pr=ze("addListener"),Xt=ze("removeListener"),C=(L,J)=>{const Z=pr({eventName:L},J),De=async()=>{const se=await Z;Xt({eventName:L,callbackId:se},J)},oe=new Promise(se=>Z.then(()=>se({remove:De})));return oe.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await De()},oe},H=new Proxy({},{get(L,J){switch(J){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return M?C:pr;case"removeListener":return Xt;default:return ze(J)}}});return l[x]=H,_.set(x,{name:x,proxy:H,platforms:new Set([...Object.keys(T),...M?[N]:[]])}),H},R=((s=c==null?void 0:c.currentPlatform)===null||s===void 0?void 0:s.registerPlugin)||S;return a.convertFileSrc||(a.convertFileSrc=x=>x),a.getPlatform=d,a.handleError=p,a.isNativePlatform=f,a.isPluginAvailable=y,a.pluginMethodNoop=g,a.registerPlugin=R,a.Exception=nc,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a.platform=a.getPlatform(),a.isNative=a.isNativePlatform(),a},TR=t=>t.Capacitor=xR(t),X=TR(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),_i=X.registerPlugin;X.Plugins;class C0{constructor(e){this.listeners={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,r){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(r);const i=this.windowListeners[e];i&&!i.registered&&this.addWindowListener(i);const s=async()=>this.removeListener(e,r),o=Promise.resolve({remove:s});return Object.defineProperty(o,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await s()}}),o}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,r){const n=this.listeners[e];n&&n.forEach(i=>i(r))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,r){this.windowListeners[r]={registered:!1,windowEventName:e,pluginEventName:r,handler:n=>{this.notifyListeners(r,n)}}}unimplemented(e="not implemented"){return new X.Exception(e,di.Unimplemented)}unavailable(e="not available"){return new X.Exception(e,di.Unavailable)}async removeListener(e,r){const n=this.listeners[e];if(!n)return;const i=n.indexOf(r);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const Ep=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Rp=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class kR extends C0{async getCookies(){const e=document.cookie,r={};return e.split(";").forEach(n=>{if(n.length<=0)return;let[i,s]=n.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=Rp(i).trim(),s=Rp(s).trim(),r[i]=s}),r}async setCookie(e){try{const r=Ep(e.key),n=Ep(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${r}=${n||""}${i}; path=${s}; ${o};`}catch(r){return Promise.reject(r)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const r of e)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}_i("CapacitorCookies",{web:()=>new kR});const IR=async t=>new Promise((e,r)=>{const n=new FileReader;n.onload=()=>{const i=n.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},n.onerror=i=>r(i),n.readAsDataURL(t)}),PR=(t={})=>{const e=Object.keys(t);return Object.keys(t).map(i=>i.toLocaleLowerCase()).reduce((i,s,o)=>(i[s]=t[e[o]],i),{})},AR=(t,e=!0)=>t?Object.entries(t).reduce((n,i)=>{const[s,o]=i;let a,l;return Array.isArray(o)?(l="",o.forEach(c=>{a=e?encodeURIComponent(c):c,l+=`${s}=${a}&`}),l.slice(0,-1)):(a=e?encodeURIComponent(o):o,l=`${s}=${a}`),`${n}&${l}`},"").substr(1):null,OR=(t,e={})=>{const r=Object.assign({method:t.method||"GET",headers:t.headers},e),i=PR(t.headers)["content-type"]||"";if(typeof t.data=="string")r.body=t.data;else if(i.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[o,a]of Object.entries(t.data||{}))s.set(o,a);r.body=s.toString()}else if(i.includes("multipart/form-data")||t.data instanceof FormData){const s=new FormData;if(t.data instanceof FormData)t.data.forEach((a,l)=>{s.append(l,a)});else for(const a of Object.keys(t.data))s.append(a,t.data[a]);r.body=s;const o=new Headers(r.headers);o.delete("content-type"),r.headers=o}else(i.includes("application/json")||typeof t.data=="object")&&(r.body=JSON.stringify(t.data));return r};class NR extends C0{async request(e){const r=OR(e,e.webFetchExtra),n=AR(e.params,e.shouldEncodeUrlParams),i=n?`${e.url}?${n}`:e.url,s=await fetch(i,r),o=s.headers.get("content-type")||"";let{responseType:a="text"}=s.ok?e:{};o.includes("application/json")&&(a="json");let l,c;switch(a){case"arraybuffer":case"blob":c=await s.blob(),l=await IR(c);break;case"json":l=await s.json();break;case"document":case"text":default:l=await s.text()}const u={};return s.headers.forEach((d,h)=>{u[h]=d}),{data:l,headers:u,status:s.status,url:s.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}_i("CapacitorHttp",{web:()=>new NR});const Ru=_i("GoogleAuth",{web:()=>mi(()=>import("./web-R-o6B36g.js"),[],import.meta.url).then(t=>new t.GoogleAuthWeb)}),ic={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},CR=({onGuestLogin:t})=>{const[e,r]=O.useState(!1),[n,i]=O.useState(!1),[s,o]=O.useState(""),[a,l]=O.useState(""),[c,u]=O.useState(!1),[d,h]=O.useState(null),[f,m]=O.useState(null),[y,v]=O.useState(null),w=async()=>{if(!re){alert("Supabase not configured. Using Guest Mode."),t();return}try{if(X.isNativePlatform()){if(console.log("Starting Native Google Sign-In"),!void 0){alert("Config Error: VITE_GOOGLE_CLIENT_ID is missing. Google Login cannot proceed.");return}let _;try{_=await Ru.signIn(),console.log("Google Plugin Success:",_)}catch(S){console.error("Google Plugin Error:",S);const R=JSON.stringify(S);R.includes("10")||S.code&&S.code==="10"?alert(`Google Sign-In Failed (Error 10).

This is a SHA-1 FINGERPRINT MISMATCH.

You are likely running a Debug build but registered the Release SHA-1.

Fix: Add your DEBUG Keystore SHA-1 to Google Cloud Console.`):alert(`Google Sign-In Failed: ${S.message||R}`);return}if(_.authentication.idToken){const{error:S}=await re.auth.signInWithIdToken({provider:"google",token:_.authentication.idToken});if(S)throw console.error("Supabase Auth Error:",S),S.message.includes("audience")?alert(`Login Failed: AUDIENCE MISMATCH.

The ID Token was issued for the wrong Client ID.
Ensure 'serverClientId' in capacitor.config.json matches your Supabase Web Client ID.`):alert(`Supabase Login Failed: ${S.message}`),S;return}else throw new Error("No ID token returned from Google. Ensure 'serverClientId' is configured.")}else{const g=(ic==null?void 0:ic.VITE_AUTH_REDIRECT_URL)||window.location.origin,{error:_}=await re.auth.signInWithOAuth({provider:"google",options:{redirectTo:g,queryParams:{access_type:"offline",prompt:"consent"}}});if(_)throw _}}catch(g){if(console.error("General Login Error:",g),!X.isNativePlatform()){const _=g.message||g.msg||JSON.stringify(g);alert(`Login failed: ${_}`)}}},p=async g=>{if(g.preventDefault(),!re){alert("Supabase not configured. Using Guest Mode."),t();return}u(!0),h(null),m(null);try{if(n){const{error:_}=await re.auth.signUp({email:s,password:a});if(_)throw _;m("Success! Check your email to confirm sign up.")}else{const{error:_}=await re.auth.signInWithPassword({email:s,password:a});if(_)throw _}}catch(_){h(_.message||"An error occurred")}finally{u(!1)}};return b.jsxs("div",{className:"min-h-screen flex bg-black overflow-hidden relative",children:[y&&b.jsx(bR,{type:y,onClose:()=>v(null)}),b.jsxs("div",{className:"absolute top-0 left-0 w-full h-full md:hidden z-0",children:[b.jsx("div",{className:"absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-rose-600/20 rounded-full blur-[120px]"}),b.jsx("div",{className:"absolute bottom-[-20%] right-[-10%] w-[500px] h-[500px] bg-pink-600/20 rounded-full blur-[120px]"})]}),b.jsxs("div",{className:"hidden md:flex w-1/2 relative items-center justify-center p-12 overflow-hidden bg-[#0a0a0a]",children:[b.jsx("div",{className:"absolute top-1/4 left-1/4 w-[400px] h-[400px] bg-rose-500/10 rounded-full blur-[100px] animate-pulse-glow"}),b.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-[300px] h-[300px] bg-amber-500/10 rounded-full blur-[80px] animate-float"}),b.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-50 contrast-150"}),b.jsxs("div",{className:"relative z-10 text-center",children:[b.jsx("div",{className:"mb-6 inline-block",children:b.jsx("h1",{className:"text-7xl font-black tracking-tighter bg-gradient-to-r from-rose-400 via-amber-200 to-rose-400 bg-clip-text text-transparent pb-2 animate-text-shimmer drop-shadow-2xl",children:"Rizz Master"})}),b.jsx("p",{className:"text-white/60 text-xl font-light tracking-wide max-w-sm mx-auto leading-relaxed mb-10",children:"AI-Powered Dating Assistant"}),b.jsxs("div",{className:"grid gap-4 text-left max-w-sm mx-auto",children:[b.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/5 backdrop-blur-sm hover:bg-white/10 transition-colors group",children:[b.jsx("div",{className:"w-12 h-12 rounded-full bg-rose-500/20 flex items-center justify-center text-2xl group-hover:scale-110 transition-transform",children:""}),b.jsxs("div",{children:[b.jsx("h3",{className:"font-bold text-white text-base",children:"Instant Replies"}),b.jsx("p",{className:"text-white/40 text-xs",children:"Generate witty responses in seconds"})]})]}),b.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/5 backdrop-blur-sm hover:bg-white/10 transition-colors group",children:[b.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-500/20 flex items-center justify-center text-2xl group-hover:scale-110 transition-transform",children:""}),b.jsxs("div",{children:[b.jsx("h3",{className:"font-bold text-white text-base",children:"Screenshot Analysis"}),b.jsx("p",{className:"text-white/40 text-xs",children:"Upload chats, get context-aware rizz"})]})]}),b.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-2xl bg-white/5 border border-white/5 backdrop-blur-sm hover:bg-white/10 transition-colors group",children:[b.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center text-2xl group-hover:scale-110 transition-transform",children:""}),b.jsxs("div",{children:[b.jsx("h3",{className:"font-bold text-white text-base",children:"Profile Bios"}),b.jsx("p",{className:"text-white/40 text-xs",children:"Stand out with custom bio generation"})]})]})]})]})]}),b.jsx("div",{className:"w-full md:w-1/2 flex items-center justify-center p-6 md:p-12 relative z-10",children:b.jsxs("div",{className:"w-full max-w-md animate-fade-in-up",children:[b.jsxs("div",{className:"md:hidden text-center mb-10",children:[b.jsx("h1",{className:"text-5xl font-black tracking-tighter bg-gradient-to-r from-rose-400 via-amber-200 to-rose-400 bg-clip-text text-transparent pb-2 animate-text-shimmer",children:"Rizz Master"}),b.jsx("p",{className:"text-white/60 text-sm",children:"AI-Powered Dating Assistant"})]}),b.jsxs("div",{className:"glass md:bg-transparent md:backdrop-filter-none p-8 md:p-0 rounded-3xl md:rounded-none border border-white/10 md:border-none shadow-2xl md:shadow-none",children:[b.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white mb-2 md:mb-3",children:n?"Create Account":"Welcome Back"}),b.jsx("p",{className:"text-white/40 text-sm mb-8",children:n?"Join Rizz Master today.":"Sign in to continue."}),e?b.jsxs("form",{onSubmit:p,className:"space-y-5 text-left animate-fade-in",children:[b.jsxs("button",{type:"button",onClick:()=>{r(!1),h(null),m(null)},className:"text-white/50 hover:text-white text-xs uppercase tracking-widest flex items-center gap-2 transition-colors mb-2",children:[b.jsx("span",{children:""})," Back to methods"]}),d&&b.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-200 text-sm",children:d}),f&&b.jsx("div",{className:"p-3 bg-green-500/10 border border-green-500/20 rounded-lg text-green-200 text-sm",children:f}),b.jsxs("div",{className:"space-y-1",children:[b.jsx("label",{className:"block text-xs font-bold text-white/50 uppercase tracking-widest ml-1",children:"Email"}),b.jsx("input",{type:"email",required:!0,value:s,onChange:g=>o(g.target.value),className:"w-full bg-white/5 border-b border-white/20 focus:border-rose-500 rounded-t-lg px-4 py-3 text-white focus:outline-none focus:bg-white/10 transition-all placeholder:text-white/20",placeholder:"you@example.com"})]}),b.jsxs("div",{className:"space-y-1",children:[b.jsx("label",{className:"block text-xs font-bold text-white/50 uppercase tracking-widest ml-1",children:"Password"}),b.jsx("input",{type:"password",required:!0,value:a,onChange:g=>l(g.target.value),className:"w-full bg-white/5 border-b border-white/20 focus:border-rose-500 rounded-t-lg px-4 py-3 text-white focus:outline-none focus:bg-white/10 transition-all placeholder:text-white/20",placeholder:"",minLength:6})]}),b.jsx("button",{type:"submit",disabled:c,className:"w-full py-4 bg-white text-black rounded-xl font-bold hover:bg-gray-200 transition-all active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed mt-4",children:c?"Processing...":n?"Create Account":"Sign In"}),b.jsx("div",{className:"text-center mt-6",children:b.jsxs("button",{type:"button",onClick:()=>{i(!n),h(null),m(null)},className:"text-xs text-white/40 hover:text-white transition-colors",children:[n?"Already have an account? ":"Don't have an account? ",b.jsx("span",{className:"text-white font-semibold underline decoration-white/30 underline-offset-4",children:n?"Sign In":"Sign Up"})]})})]}):b.jsxs("div",{className:"space-y-4",children:[b.jsxs("button",{onClick:w,className:"w-full py-4 bg-white text-black rounded-xl font-bold flex items-center justify-center gap-3 hover:bg-gray-100 transition-all active:scale-[0.98] group",children:[b.jsx("img",{src:"https://www.svgrepo.com/show/475656/google-color.svg",alt:"G",className:"w-5 h-5 group-hover:scale-110 transition-transform"}),"Continue with Google"]}),b.jsxs("button",{onClick:()=>r(!0),className:"w-full py-4 bg-transparent border border-white/10 text-white rounded-xl font-bold hover:bg-white/5 transition-all active:scale-[0.98] flex items-center justify-center gap-3",children:[b.jsx("svg",{className:"w-5 h-5 opacity-70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Sign in with Email"]}),b.jsxs("div",{className:"flex items-center gap-4 py-4 opacity-50",children:[b.jsx("div",{className:"h-px bg-white/20 flex-1"}),b.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest text-white/50",children:"Or"}),b.jsx("div",{className:"h-px bg-white/20 flex-1"})]}),b.jsx("button",{onClick:t,className:"w-full py-4 bg-white/5 text-white/60 rounded-xl font-medium text-sm hover:bg-white/10 hover:text-white transition-all active:scale-[0.98]",children:"Continue as Guest"})]}),b.jsx("div",{className:"mt-8 pt-6 border-t border-white/5 text-center",children:b.jsxs("p",{className:"text-[10px] text-white/20 leading-relaxed max-w-xs mx-auto",children:["By entering the Rizz Master terminal, you agree to our"," ",b.jsx("button",{onClick:()=>v("terms"),className:"text-white/40 hover:text-white underline decoration-white/10 hover:decoration-white/50 transition-all",children:"Terms of Service"})," & ",b.jsx("button",{onClick:()=>v("privacy"),className:"text-white/40 hover:text-white underline decoration-white/10 hover:decoration-white/50 transition-all",children:"Privacy Policy"}),"."]})})]})]})})]})},DR=({className:t="",onNavigate:e})=>b.jsx("footer",{className:`w-full border-t border-white/5 bg-gradient-to-t from-black via-black/80 to-transparent ${t}`,style:{paddingTop:"2rem",paddingBottom:"calc(2rem + env(safe-area-inset-bottom))"},children:b.jsxs("div",{className:"max-w-4xl mx-auto px-4 flex flex-col items-center gap-8",children:[b.jsxs("div",{className:"flex flex-col items-center gap-2",children:[b.jsxs("div",{className:"flex items-center gap-2 opacity-40 grayscale hover:grayscale-0 hover:opacity-100 transition-all duration-500 cursor-default",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsx("span",{className:"font-bold text-white tracking-tighter",children:"Rizz Master"})]}),b.jsxs("p",{className:"text-[10px] text-white/20 font-medium tracking-widest uppercase",children:[" ",new Date().getFullYear()," AI Powered Dating Assistant"]})]}),b.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[b.jsx("button",{onClick:()=>e("PRIVACY"),className:"px-4 py-2 text-[10px] font-bold text-white/50 bg-white/5 hover:bg-white/10 hover:text-white rounded-lg transition-all uppercase tracking-widest border border-white/5 hover:border-white/20 active:scale-95",children:"Privacy"}),b.jsx("button",{onClick:()=>e("TERMS"),className:"px-4 py-2 text-[10px] font-bold text-white/50 bg-white/5 hover:bg-white/10 hover:text-white rounded-lg transition-all uppercase tracking-widest border border-white/5 hover:border-white/20 active:scale-95",children:"Terms"}),b.jsx("button",{onClick:()=>e("SUPPORT"),className:"px-4 py-2 text-[10px] font-bold text-white/50 bg-white/5 hover:bg-white/10 hover:text-white rounded-lg transition-all uppercase tracking-widest border border-white/5 hover:border-white/20 active:scale-95",children:"Support"})]}),b.jsx("div",{className:"text-[9px] text-white/10 font-mono select-none",children:"v1.0.2 (Mobile)"})]})}),Li=_i("App",{web:()=>mi(()=>import("./web-DwqXGO8_.js"),[],import.meta.url).then(t=>new t.AppWeb)});var xu;(function(t){t.Dark="DARK",t.Light="LIGHT",t.Default="DEFAULT"})(xu||(xu={}));var xp;(function(t){t.None="NONE",t.Slide="SLIDE",t.Fade="FADE"})(xp||(xp={}));const ji=_i("StatusBar");var Tp;(function(t){t.General="General",t.ParentalGuidance="ParentalGuidance",t.Teen="Teen",t.MatureAudience="MatureAudience"})(Tp||(Tp={}));var kp;(function(t){t.SizeChanged="bannerAdSizeChanged",t.Loaded="bannerAdLoaded",t.FailedToLoad="bannerAdFailedToLoad",t.Opened="bannerAdOpened",t.Closed="bannerAdClosed",t.AdImpression="bannerAdImpression"})(kp||(kp={}));var Tu;(function(t){t.TOP_CENTER="TOP_CENTER",t.CENTER="CENTER",t.BOTTOM_CENTER="BOTTOM_CENTER"})(Tu||(Tu={}));var ku;(function(t){t.BANNER="BANNER",t.FULL_BANNER="FULL_BANNER",t.LARGE_BANNER="LARGE_BANNER",t.MEDIUM_RECTANGLE="MEDIUM_RECTANGLE",t.LEADERBOARD="LEADERBOARD",t.ADAPTIVE_BANNER="ADAPTIVE_BANNER",t.SMART_BANNER="SMART_BANNER"})(ku||(ku={}));var as;(function(t){t.Loaded="interstitialAdLoaded",t.FailedToLoad="interstitialAdFailedToLoad",t.Showed="interstitialAdShowed",t.FailedToShow="interstitialAdFailedToShow",t.Dismissed="interstitialAdDismissed"})(as||(as={}));var Gn;(function(t){t.Loaded="onRewardedVideoAdLoaded",t.FailedToLoad="onRewardedVideoAdFailedToLoad",t.Showed="onRewardedVideoAdShowed",t.FailedToShow="onRewardedVideoAdFailedToShow",t.Dismissed="onRewardedVideoAdDismissed",t.Rewarded="onRewardedVideoAdReward"})(Gn||(Gn={}));var Ip;(function(t){t.NOT_REQUIRED="NOT_REQUIRED",t.OBTAINED="OBTAINED",t.REQUIRED="REQUIRED",t.UNKNOWN="UNKNOWN"})(Ip||(Ip={}));var Pp;(function(t){t[t.DISABLED=0]="DISABLED",t[t.EEA=1]="EEA",t[t.NOT_EEA=2]="NOT_EEA"})(Pp||(Pp={}));const Ae=_i("AdMob",{web:()=>mi(()=>import("./web-CCRJQ1LA.js"),[],import.meta.url).then(t=>new t.AdMobWeb)}),Pt={initialized:!1,async initialize(){if(X.isNativePlatform()&&!this.initialized)try{try{await Ae.requestTrackingAuthorization()}catch(t){console.warn("Tracking authorization skipped:",t)}await Ae.initialize({initializeForTesting:!0}),this.initialized=!0,console.log("AdMob Initialized")}catch(t){console.error("AdMob initialization failed",t)}},async showBanner(t){if(X.isNativePlatform())try{await this.initialize();try{await Ae.hideBanner(),await Ae.removeBanner()}catch{}const e={adId:t,adSize:ku.ADAPTIVE_BANNER,position:Tu.BOTTOM_CENTER,margin:0,isTesting:!0,npa:!0};await Ae.showBanner(e),console.log("AdMob Banner Request Sent")}catch(e){console.error("AdMob Show Banner Error:",e)}},async hideBanner(){if(X.isNativePlatform())try{await Ae.hideBanner(),await Ae.removeBanner()}catch(t){console.error("AdMob Hide Banner Error:",t)}},async showInterstitial(t){return X.isNativePlatform()?(await this.initialize(),new Promise(async e=>{let r=[];const n=async()=>{for(const i of r)i&&typeof i.remove=="function"&&await i.remove();r=[]};try{const i=await Ae.addListener(as.Dismissed,()=>{console.log("AdMob Interstitial Dismissed"),n(),e(!0)});r.push(i);const s=await Ae.addListener(as.FailedToLoad,l=>{console.error("AdMob Interstitial Failed to load",l),n(),e(!1)});r.push(s);const o=await Ae.addListener(as.FailedToShow,l=>{console.error("AdMob Interstitial Failed to show",l),n(),e(!1)});r.push(o);const a={adId:t,isTesting:!0};await Ae.prepareInterstitial(a),await Ae.showInterstitial()}catch(i){console.error("AdMob Interstitial Execution Error",i),await n(),e(!1)}})):!1},async showRewardVideo(t){return X.isNativePlatform()?(await this.initialize(),new Promise(async e=>{let r=!1,n=[];const i=async()=>{for(const s of n)s&&typeof s.remove=="function"&&await s.remove();n=[]};try{const s=await Ae.addListener(Gn.Rewarded,u=>{console.log("AdMob Reward Earned",u),r=!0});n.push(s);const o=await Ae.addListener(Gn.Dismissed,()=>{console.log("AdMob Ad Dismissed"),i(),e(r)});n.push(o);const a=await Ae.addListener(Gn.FailedToLoad,u=>{console.error("AdMob Failed to load",u),i(),e(!1)});n.push(a);const l=await Ae.addListener(Gn.FailedToShow,u=>{console.error("AdMob Failed to show",u),i(),e(!1)});n.push(l);const c={adId:t,isTesting:!0};await Ae.prepareRewardVideoAd(c),await Ae.showRewardVideoAd()}catch(s){console.error("AdMob Execution Error",s),await i(),e(!1)}})):!1}};var A=mh&&mh.__awaiter||function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})},E;(function(t){(function(n){n[n.SETUP=6777001]="SETUP",n[n.LOAD=6777002]="LOAD",n[n.PURCHASE=6777003]="PURCHASE",n[n.LOAD_RECEIPTS=6777004]="LOAD_RECEIPTS",n[n.CLIENT_INVALID=6777005]="CLIENT_INVALID",n[n.PAYMENT_CANCELLED=6777006]="PAYMENT_CANCELLED",n[n.PAYMENT_INVALID=6777007]="PAYMENT_INVALID",n[n.PAYMENT_NOT_ALLOWED=6777008]="PAYMENT_NOT_ALLOWED",n[n.UNKNOWN=6777010]="UNKNOWN",n[n.REFRESH_RECEIPTS=6777011]="REFRESH_RECEIPTS",n[n.INVALID_PRODUCT_ID=6777012]="INVALID_PRODUCT_ID",n[n.FINISH=6777013]="FINISH",n[n.COMMUNICATION=6777014]="COMMUNICATION",n[n.SUBSCRIPTIONS_NOT_AVAILABLE=6777015]="SUBSCRIPTIONS_NOT_AVAILABLE",n[n.MISSING_TOKEN=6777016]="MISSING_TOKEN",n[n.VERIFICATION_FAILED=6777017]="VERIFICATION_FAILED",n[n.BAD_RESPONSE=6777018]="BAD_RESPONSE",n[n.REFRESH=6777019]="REFRESH",n[n.PAYMENT_EXPIRED=6777020]="PAYMENT_EXPIRED",n[n.DOWNLOAD=6777021]="DOWNLOAD",n[n.SUBSCRIPTION_UPDATE_NOT_AVAILABLE=6777022]="SUBSCRIPTION_UPDATE_NOT_AVAILABLE",n[n.PRODUCT_NOT_AVAILABLE=6777023]="PRODUCT_NOT_AVAILABLE",n[n.CLOUD_SERVICE_PERMISSION_DENIED=6777024]="CLOUD_SERVICE_PERMISSION_DENIED",n[n.CLOUD_SERVICE_NETWORK_CONNECTION_FAILED=6777025]="CLOUD_SERVICE_NETWORK_CONNECTION_FAILED",n[n.CLOUD_SERVICE_REVOKED=6777026]="CLOUD_SERVICE_REVOKED",n[n.PRIVACY_ACKNOWLEDGEMENT_REQUIRED=6777027]="PRIVACY_ACKNOWLEDGEMENT_REQUIRED",n[n.UNAUTHORIZED_REQUEST_DATA=6777028]="UNAUTHORIZED_REQUEST_DATA",n[n.INVALID_OFFER_IDENTIFIER=6777029]="INVALID_OFFER_IDENTIFIER",n[n.INVALID_OFFER_PRICE=6777030]="INVALID_OFFER_PRICE",n[n.INVALID_SIGNATURE=6777031]="INVALID_SIGNATURE",n[n.MISSING_OFFER_PARAMS=6777032]="MISSING_OFFER_PARAMS",n[n.VALIDATOR_SUBSCRIPTION_EXPIRED=6778003]="VALIDATOR_SUBSCRIPTION_EXPIRED"})(t.ErrorCode||(t.ErrorCode={}));function r(n,i,s,o){return{isError:!0,code:n,message:i,platform:s,productId:o}}t.storeError=r})(E||(E={}));var E;(function(t){class e{constructor(n,i){this.config=n,n.url||(n.url="https://validator.iaptic.com"),this.store=i??t.store,this.log=this.store.log.child("Iaptic")}get braintreeClientTokenProvider(){return n=>{this.log.info("Calling Braintree clientTokenProvider"),t.Utils.ajax(this.log,{url:`${this.config.url}/v3/braintree/client-token?appName=${this.config.appName}&apiKey=${this.config.apiKey}`,method:"POST",data:{applicationUsername:t.store.getApplicationUsername(),customerId:t.Braintree.customerId},success:i=>{this.log.info("clientTokenProvider success: "+JSON.stringify(i)),n(i.clientToken)},error:i=>{this.log.info("clientTokenProvider error: "+JSON.stringify(i)),n(t.storeError(i,"ERROR "+i,t.Platform.BRAINTREE,null))}})}}get appStoreDiscountEligibilityDeterminer(){let n;this.log.debug("AppStore eligibility determiner is listening..."),this.store.when().verified(o=>{o.platform===t.Platform.APPLE_APPSTORE&&(this.log.debug("Got a verified AppStore receipt."),n=o)},"appStoreDiscountEligibilityDeterminer_listening");const i=(o,a,l)=>{if(this.log.debug("AppStore eligibility determiner"),n)return this.log.debug("Using cached receipt"),l(s(n,a));const c=u=>{u.platform===t.Platform.APPLE_APPSTORE&&(this.log.debug("Receipt is verified, let's analyze the content and respond."),this.store.off(c),l(s(u,a)))};this.log.debug("Waiting for receipt"),this.store.when().verified(c,"appStoreDiscountEligibilityDeterminer_waiting")};return i.cacheReceipt=function(o){n=o},i;function s(o,a){const l=o.raw.ineligible_for_intro_price;return a.map(c=>{var u;return c.discountType==="Introductory"&&l&&l.find(d=>c.productId===d)?!1:c.discountType==="Subscription"?!!((u=o.raw.collection)===null||u===void 0?void 0:u.find(h=>h.id===c.productId)):!0})}}get validator(){return`${this.config.url}/v1/validate?appName=${this.config.appName}&apiKey=${this.config.apiKey}`}}t.Iaptic=e})(E||(E={}));var E;(function(t){let e;(function(o){o[o.QUIET=0]="QUIET",o[o.ERROR=1]="ERROR",o[o.WARNING=2]="WARNING",o[o.INFO=3]="INFO",o[o.DEBUG=4]="DEBUG"})(e=t.LogLevel||(t.LogLevel={}));class r{constructor(a,l=""){this.prefix="",this.store=a,this.prefix=l||"CdvPurchase"}child(a){return new r(this.store,this.prefix+"."+a)}error(a){s(this.store.verbosity,e.ERROR,this.prefix,a);try{throw new Error(i(a))}catch(l){s(this.store.verbosity,e.ERROR,this.prefix,l.stack)}}warn(a){s(this.store.verbosity,e.WARNING,this.prefix,a)}info(a){s(this.store.verbosity,e.INFO,this.prefix,a)}debug(a){s(this.store.verbosity,e.DEBUG,this.prefix,a)}logCallbackException(a,l){if(this.warn("A callback in '"+a+"' failed with an exception."),typeof l=="string")this.warn("           "+l);else if(l){const c=l;c.fileName&&this.warn("           "+c.fileName+":"+c.lineNumber),l.message&&this.warn("           "+l.message),l.stack&&this.warn("           "+l.stack)}}}r.console=window.console,t.Logger=r;const n=["QUIET","ERROR","WARNING","INFO","DEBUG"];function i(o){return typeof o!="string"&&(o=JSON.stringify(o)),o}function s(o,a,l,c){var u=o===!0?1:o;if(a>u)return;typeof c!="string"&&(c=JSON.stringify(c));const d=l?`[${l}] `:"",h=a===e.ERROR?f=>r.console.error(f):a===e.WARNING?f=>r.console.warn(f):f=>r.console.log(f);n[a]?h(`${d}${n[a]}: ${c}`):h(`${d}${c}`)}})(E||(E={}));var E;(function(t){(function(e){e.nonEnumerable=(r,n,i)=>{if(i)return i.enumerable=!1,i;Object.defineProperty(r,n,{set(s){Object.defineProperty(this,n,{value:s,writable:!0,configurable:!0})},configurable:!0})}})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){class e{constructor(n,i){this.className="Product",this.title="",this.description="",this.platform=n.platform,this.type=n.type,this.id=n.id,this.group=n.group,this.offers=[],Object.defineProperty(this,"pricing",{enumerable:!1,get:()=>{var s;return(s=this.offers[0])===null||s===void 0?void 0:s.pricingPhases[0]}}),Object.defineProperty(this,"canPurchase",{enumerable:!1,get:()=>i.canPurchase(this)}),Object.defineProperty(this,"owned",{enumerable:!1,get:()=>i.owned(this)})}get pricing(){var n;return(n=this.offers[0])===null||n===void 0?void 0:n.pricingPhases[0]}get canPurchase(){return!1}get owned(){return!1}getOffer(n=""){return n?this.offers.find(i=>i.id===n):this.offers[0]}addOffer(n){return this.getOffer(n.id)?this:(this.offers.push(n),this)}}t.Product=e})(E||(E={}));var E;(function(t){(function(e){function r(n){const i=[];for(let s in n)n.hasOwnProperty(s)&&i.push(n[s]);return i}e.objectValues=r})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){function r(n){switch(n){case t.Platform.APPLE_APPSTORE:return"App Store";case t.Platform.GOOGLE_PLAY:return"Google Play";case t.Platform.WINDOWS_STORE:return"Windows Store";case t.Platform.BRAINTREE:return"Braintree";case t.Platform.TEST:return"Test";default:return n}}e.platformName=r})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(){this.array=[]}get length(){return this.array.length}get(){return this.array.concat()}add(o){this.has(o)||this.array.push(o)}clear(){for(;this.array.length!==0;)this.array.pop()}has(o){return!!this.array.find(a=>a===o)}}e.ReceiptsToValidate=r;class n{constructor(o,a){this.receiptsToValidate=new r,this.verifiedReceipts=[],this.numRequests=0,this.numResponses=0,this.cache={},this.controller=o,this.log=a.child("Validator")}incrRequestsCounter(){this.numRequests=this.numRequests+1|0,this.log.debug(`Validation requests=${this.numRequests} responses=${this.numResponses}`)}incrResponsesCounter(){this.numResponses=this.numResponses+1|0,this.log.debug(`Validation requests=${this.numRequests} responses=${this.numResponses}`)}addVerifiedReceipt(o,a){for(const c of this.verifiedReceipts)if(c.platform===o.platform&&c.id===a.id)return this.log.debug("Updating existing receipt."),c.set(o,a),c;this.log.debug("Register a new verified receipt.");const l=new t.VerifiedReceipt(o,a,this.controller);return this.verifiedReceipts.push(l),l}add(o){this.log.debug("Schedule validation: "+JSON.stringify(o));const a=o instanceof t.Transaction?o.parentReceipt:o;this.receiptsToValidate.has(a)||(this.incrRequestsCounter(),this.receiptsToValidate.add(a))}run(){const o=this.receiptsToValidate.get();this.receiptsToValidate.clear();const a=l=>A(this,void 0,void 0,function*(){var c;const{receipt:u,payload:d}=l;this.incrResponsesCounter();try{const h=this.controller.adapters.find(u.platform);if(yield h==null?void 0:h.handleReceiptValidationResponse(u,d),d.ok){const f=this.addVerifiedReceipt(u,d.data);this.controller.verifiedCallbacks.trigger(f,"payload_ok")}else if(d.code===t.ErrorCode.VALIDATOR_SUBSCRIPTION_EXPIRED){const f=(c=u.lastTransaction())===null||c===void 0?void 0:c.transactionId,m=f?this.verifiedReceipts.find(y=>{var v;return((v=y.collection[0])===null||v===void 0?void 0:v.transactionId)===f}):void 0;m?(m==null||m.collection.forEach(y=>{y.transactionId===f&&(y.isExpired=!0)}),this.controller.verifiedCallbacks.trigger(m,"payload_expired")):this.controller.unverifiedCallbacks.trigger({receipt:u,payload:d},"no_verified_receipt")}else this.controller.unverifiedCallbacks.trigger({receipt:u,payload:d},"validator_error")}catch(h){this.log.error("Exception probably caused by an invalid response from the validator."+h.message),this.controller.unverifiedCallbacks.trigger({receipt:u,payload:{ok:!1,code:t.ErrorCode.VERIFICATION_FAILED,message:h.message}},"validator_exception")}});o.forEach(l=>this.runOnReceipt(l,a))}runOnReceipt(o,a){var l,c;return A(this,void 0,void 0,function*(){if(o.platform===t.Platform.TEST)return this.log.debug("Using Test Adapter mock verify function."),t.Test.Adapter.verify(o,a);if(!this.controller.validator){this.incrResponsesCounter(),a({receipt:o,payload:{ok:!0,data:{id:((c=(l=o.transactions)===null||l===void 0?void 0:l[0])===null||c===void 0?void 0:c.transactionId)||"unknown",latest_receipt:!0,transaction:{type:"test"}}}});return}const u=yield this.buildRequestBody(o);if(!u){this.incrResponsesCounter();return}if(typeof this.controller.validator=="function")return this.runValidatorFunction(this.controller.validator,o,u,a);const d=typeof this.controller.validator=="string"?{url:this.controller.validator,timeout:2e4}:this.controller.validator;return this.runValidatorRequest(d,o,u,a)})}runValidatorFunction(o,a,l,c){try{o(l,u=>c({receipt:a,payload:u}))}catch(u){this.log.warn("user provided validator function failed with error: "+(u==null?void 0:u.stack))}}buildRequestBody(o){var a,l,c;return A(this,void 0,void 0,function*(){const u=this.controller.adapters.find(o.platform),d=yield u==null?void 0:u.receiptValidationBody(o);if(d){if(d.additionalData=Object.assign(Object.assign({},(a=d.additionalData)!==null&&a!==void 0?a:{}),{applicationUsername:this.controller.getApplicationUsername()}),d.additionalData.applicationUsername||delete d.additionalData.applicationUsername,d.device=Object.assign(Object.assign({},(l=d.device)!==null&&l!==void 0?l:{}),t.Validator.Internal.getDeviceInfo(this.controller)),((c=d.offers)===null||c===void 0?void 0:c.length)===1){const h=d.offers[0];if(h.pricingPhases.length===1){const f=h.pricingPhases[0];d.currency=f.currency,d.priceMicros=f.priceMicros}else if(h.pricingPhases.length===2){const f=h.pricingPhases[1];d.currency=f.currency,d.priceMicros=f.priceMicros;const m=h.pricingPhases[0];d.introPriceMicros=m.priceMicros}}return d}})}removeExpiredCache(){const o=+new Date,a=[];for(const l in this.cache)this.cache[l].expires<o&&a.push(l);for(const l of a)delete this.cache[l]}runValidatorRequest(o,a,l,c){this.removeExpiredCache();const u=t.Utils.md5(JSON.stringify(l.transaction)),d=this.cache[u];if(d)return this.log.debug("validator cache hit, using cached response"),c({receipt:a,payload:d.payload});t.Utils.ajax(this.log.child("Ajax"),{url:o.url,method:"POST",customHeaders:o.headers,timeout:o.timeout,data:l,success:h=>{var f;if(this.log.debug("validator success, response: "+JSON.stringify(h)),!i(h))return c({receipt:a,payload:{ok:!1,code:t.ErrorCode.BAD_RESPONSE,message:"Validator responded with invalid data",data:{latest_receipt:(f=h==null?void 0:h.data)===null||f===void 0?void 0:f.latest_receipt}}});this.cache[u]={payload:h,expires:+new Date+12e4},c({receipt:a,payload:h})},error:(h,f,m)=>{var y="Error "+h+": "+f;this.log.debug("validator failed, response: "+JSON.stringify(y)),this.log.debug("body => "+JSON.stringify(m)),c({receipt:a,payload:{ok:!1,message:y,code:t.ErrorCode.COMMUNICATION,status:h,data:{}}})}})}}e.Validator=n;function i(s){return!!s&&typeof s=="object"&&"ok"in s&&typeof s.ok=="boolean"}})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(){this.list=[]}static registerAdapter(i,s){this.adapterFactories[i]=s}static hasAdapterFactory(i){return i in this.adapterFactories}static createAdapter(i,s,o){const a=this.adapterFactories[i];if(a)return a(s,o)}add(i,s,o){s.forEach(a=>{if(i.info(""),!this.find(a.platform))switch(a.platform){case t.Platform.APPLE_APPSTORE:return this.list.push(new t.AppleAppStore.Adapter(o,a.options||{}));case t.Platform.GOOGLE_PLAY:return this.list.push(new t.GooglePlay.Adapter(o));case t.Platform.BRAINTREE:return a.options||i.error("Options missing for Braintree initialization. Use {platform: Platform.BRAINTREE, options: {...}} in your call to store.initialize"),this.list.push(new t.Braintree.Adapter(o,a.options));case t.Platform.TEST:return this.list.push(new t.Test.Adapter(o));case t.Platform.IAPTIC_JS:return a.options||i.error("Options missing for IapticJS initialization. Use {platform: Platform.IAPTIC_JS, options: {...}} in your call to store.initialize"),this.list.push(new t.IapticJS.Adapter(o,a.options));default:const l=r.createAdapter(a.platform,o,a.options||{});if(l)return this.list.push(l);i.warn(`No adapter found for platform: ${a.platform}`);return}})}initialize(i,s){return A(this,void 0,void 0,function*(){typeof i=="string"&&(i=[i]);const o=i.map(u=>typeof u=="string"?{platform:u}:u).filter(u=>!this.find(u.platform)),a=s.log.child("Adapters");a.info("Adding platforms: "+JSON.stringify(o)),this.add(a,o,s);const l=s.registeredProducts.byPlatform();return(yield Promise.all(o.map(u=>A(this,void 0,void 0,function*(){var d,h,f;const m=(f=(h=(d=l.filter(_=>_.platform===u.platform))===null||d===void 0?void 0:d[0])===null||h===void 0?void 0:h.products)!==null&&f!==void 0?f:[],y=this.find(u.platform);if(!y)return;if(a.info(`${y.name} initializing...`),!y.isSupported){a.info(`${y.name} is not supported.`);return}const v=yield y.initialize();if(y.ready=!0,a.info(`${y.name} initialized. ${v?JSON.stringify(v):""}`),v!=null&&v.code)return v;if(a.info(`${y.name} products: ${JSON.stringify(m)}`),m.length===0)return;let w=[],p=[];y.supportsParallelLoading?[w,p]=yield Promise.all([y.loadProducts(m),y.loadReceipts()]):(w=yield y.loadProducts(m),p=yield y.loadReceipts()),a.info(`${y.name} products loaded: ${JSON.stringify(w)}`);const g=w.filter(_=>_ instanceof t.Product);return s.listener.productsUpdated(u.platform,g),a.info(`${y.name} receipts loaded: ${JSON.stringify(p)}`),w.filter(_=>"code"in _&&"message"in _)[0]})))).filter(u=>u)})}find(i){return this.list.filter(s=>s.id===i)[0]}findReady(i){return this.list.filter(s=>(!i||s.id===i)&&s.ready)[0]}}r.adapterFactories={},e.Adapters=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(i,s){this.supportedPlatforms=[],this.platformWithReceiptsReady=[],this.lastTransactionState={},this.lastCallTimeForState={},this.updatedReceiptsToProcess=[],this.delegate=i,this.log=s.child("AdapterListener")}static makeTransactionToken(i){return i.platform+"|"+i.transactionId}setSupportedPlatforms(i){this.log.debug(`setSupportedPlatforms: ${i.join(",")} (${this.platformWithReceiptsReady.length} have their receipts ready)`),this.supportedPlatforms=i,this.supportedPlatforms.length===this.platformWithReceiptsReady.length&&(this.log.debug("triggering receiptsReady()"),this.delegate.receiptsReadyCallbacks.trigger(void 0,"adapterListener_setSupportedPlatforms"))}receiptsReady(i){if(this.supportedPlatforms.length>0&&this.platformWithReceiptsReady.length===this.supportedPlatforms.length){this.log.debug("receiptsReady: "+i+"(skipping)");return}this.platformWithReceiptsReady.indexOf(i)<0&&(this.platformWithReceiptsReady.push(i),this.log.debug(`receiptsReady: ${i} (${this.platformWithReceiptsReady.length}/${this.supportedPlatforms.length})`),this.platformWithReceiptsReady.length===this.supportedPlatforms.length&&(this.log.debug("triggering receiptsReady()"),this.delegate.receiptsReadyCallbacks.trigger(void 0,"adapterListener_receiptsReady")))}productsUpdated(i,s){s.forEach(o=>this.delegate.updatedCallbacks.trigger(o,"adapterListener_productsUpdated"))}receiptsUpdated(i,s){this.log.debug("receiptsUpdated: "+JSON.stringify(s.map(o=>({platform:o.platform,transactions:o.transactions}))));for(const o of s)this.updatedReceiptsToProcess.indexOf(o)<0&&this.updatedReceiptsToProcess.push(o);this.updatedReceiptsProcessor!==void 0&&clearTimeout(this.updatedReceiptsProcessor),this.updatedReceiptsProcessor=setTimeout(()=>{this._processUpdatedReceipts()},500)}_processUpdatedReceipts(){this.log.debug("processing "+this.updatedReceiptsToProcess.length+" updated receipts");const i=+new Date,s=this.updatedReceiptsToProcess;this.updatedReceiptsToProcess=[],s.forEach(o=>{this.delegate.updatedReceiptCallbacks.trigger(o,"adapterListener_receiptsUpdated"),o.transactions.forEach(a=>{var l;const c=r.makeTransactionToken(a),u=c+"@"+a.state,d=this.lastTransactionState[c];if(a.state===t.TransactionState.APPROVED){const h=(l=this.lastCallTimeForState[u])!==null&&l!==void 0?l:0;i-h>6e4?(this.lastCallTimeForState[u]=i,this.delegate.approvedCallbacks.trigger(a,"adapterListener_receiptsUpdated_approved")):this.log.debug(`Skipping ${u}, because it has been last called ${h>0?Math.round(i-h)+"ms ago ("+i+"-"+h+")":"never"}`)}else d!==a.state&&(a.state===t.TransactionState.INITIATED?(this.lastCallTimeForState[u]=i,this.delegate.initiatedCallbacks.trigger(a,"adapterListener_receiptsUpdated_initiated")):a.state===t.TransactionState.FINISHED?(this.lastCallTimeForState[u]=i,this.delegate.finishedCallbacks.trigger(a,"adapterListener_receiptsUpdated_finished")):a.state===t.TransactionState.PENDING&&(this.lastCallTimeForState[u]=i,this.delegate.pendingCallbacks.trigger(a,"adapterListener_receiptsUpdated_pending")));this.lastTransactionState[c]=a.state})})}}e.StoreAdapterListener=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(i,s,o=!1){this.callbacks=[],this.numTriggers=0,this.logger=i,this.className=s,this.finalStateMode=o}push(i,s){if(this.finalStateMode&&this.numTriggers>0)i(this.lastTriggerArgument);else{for(const o of this.callbacks)if(o.callback===i)throw new Error("REGISTERING THE SAME CALLBACK TWICE? This is indicative of a bug in your integration.");this.callbacks.push({callback:i,callbackName:s})}}trigger(i,s){this.lastTriggerArgument=i,this.numTriggers++;const o=this.callbacks;this.finalStateMode&&(this.callbacks=[]),o.forEach(a=>{t.Utils.safeCall(this.logger,this.className,a.callback,i,a.callbackName,s)})}remove(i){this.callbacks=this.callbacks.filter(s=>s.callback!==i)}}e.Callbacks=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(i){this.isReady=!1,this.readyCallbacks=[],this.logger=i}add(i){if(this.isReady)return setTimeout(i,0);this.readyCallbacks.push(i)}trigger(i){this.isReady=!0,this.readyCallbacks.forEach(s=>t.Utils.safeCall(this.logger,"ready()",s,void 0,void 0,i)),this.readyCallbacks=[]}remove(i){this.readyCallbacks=this.readyCallbacks.filter(s=>s!==i)}}e.ReadyCallbacks=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){function r(i){return typeof i!="object"?!1:i.hasOwnProperty("platform")&&i.hasOwnProperty("id")&&i.hasOwnProperty("type")}class n{constructor(){this.list=[]}find(s,o){return this.list.find(a=>a.platform===s&&a.id===o)}add(s){const o=[],l=(Array.isArray(s)?s:[s]).filter(c=>!this.find(c.platform,c.id));for(const c of l)r(c)?(c.platform===t.Platform.TEST&&!t.Test.testProductsArray.some(u=>u.id===c.id)&&t.Test.registerTestProduct(c),this.list.push(c)):o.push(t.storeError(t.ErrorCode.LOAD,'Invalid parameter to "register", expected "id", "type" and "platform". Got: '+JSON.stringify(c),null,null));return o}byPlatform(){const s={};return this.list.forEach(o=>{s[o.platform]=(s[o.platform]||[]).concat(o)}),Object.keys(s).map(o=>({platform:o,products:s[o]}))}}e.RegisteredProducts=n})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(i){this.monitors=[],this.isListening=!1,this.when=i}findMonitors(i){return this.monitors.filter(s=>s.transaction.platform===i.platform&&s.transaction.transactionId===i.transactionId)}startListening(){this.isListening||(this.isListening=!0,this.when.approved(i=>this.callOnChange(i),"transactionStateMonitors_callOnChange").finished(i=>this.callOnChange(i),"transactionStateMonitors_callOnChange"))}callOnChange(i){this.findMonitors(i).forEach(s=>{s.lastChange!==i.state&&(s.lastChange=i.state,s.onChange(i.state))})}start(i,s){this.startListening();const o=t.Utils.uuidv4();return this.monitors.push({monitorId:o,transaction:i,onChange:s,lastChange:i.state}),setTimeout(s,0,i.state),{transaction:i,stop:()=>this.stop(o)}}stop(i){this.monitors=this.monitors.filter(s=>s.monitorId!==i)}}e.TransactionStateMonitors=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(i){this.hasCalledReceiptsVerified=!1,this.controller=i,this.log=i.log.child("ReceiptsMonitor")}callReceiptsVerified(){this.hasCalledReceiptsVerified||(this.hasCalledReceiptsVerified=!0,this.log.info("receiptsVerified()"),this.controller.when().receiptsReady(()=>{setTimeout(()=>{this.controller.receiptsVerified()},0)},"receiptsMonitor_callReceiptsVerified"))}launch(){const i=()=>{this.log.debug(`check(${this.controller.numValidationResponses()}/${this.controller.numValidationRequests()})`),this.controller.numValidationRequests()===this.controller.numValidationResponses()&&(this.intervalChecker!==void 0&&(clearInterval(this.intervalChecker),this.intervalChecker=void 0),this.controller.off(i),this.callReceiptsVerified())};this.controller.when().verified(i,"receiptsMonitor_check").unverified(i,"receiptsMonitor_check").receiptsReady(()=>{this.log.debug("receiptsReady..."),(!this.controller.hasLocalReceipts()||!this.controller.hasValidator())&&setTimeout(()=>{i()},0),this.intervalChecker=setInterval(()=>{this.log.debug("keep checking every 10s..."),i()},1e4)},"receiptsMonitor_setup")}}e.ReceiptsMonitor=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(i,s){this.activePurchases={},this.notifiedPurchases={},this.activeTransactions={},this.notifiedTransactions={},this.controller=i,this.log=s.child("ExpiryMonitor")}stop(){this.interval&&(clearInterval(this.interval),this.interval=void 0)}launch(){this.log.info("Starting expiry monitoring"),this.stop(),this.interval=setInterval(()=>{var i,s,o,a,l,c;const u=+new Date;for(const d of this.controller.verifiedReceipts){const h=(i=r.GRACE_PERIOD_MS[d.platform])!==null&&i!==void 0?i:r.GRACE_PERIOD_MS.DEFAULT;for(const f of d.collection)if(f.expiryDate){const m=f.expiryDate+h,y=(s=f.transactionId)!==null&&s!==void 0?s:`${m}`;m>u&&(this.activePurchases[y]=!0),m<u&&this.activePurchases[y]&&!this.notifiedPurchases[y]&&(this.log.info(`Verified purchase expired: ${y}`),this.notifiedPurchases[y]=!0,this.controller.onVerifiedPurchaseExpired(f,d))}}for(const d of this.controller.localReceipts)for(const h of d.transactions){if(d.platform==="android-playstore"&&!h.expirationDate&&!((o=h.nativePurchase)===null||o===void 0)&&o.autoRenewing){const m=(a=h.transactionId)!==null&&a!==void 0?a:`${u}`;this.activeTransactions[m]||(this.log.debug(`Tracking auto-renewing Google Play subscription without expiration: ${m}`),this.activeTransactions[m]=!0)}if(h.expirationDate){const f=(l=r.GRACE_PERIOD_MS[d.platform])!==null&&l!==void 0?l:r.GRACE_PERIOD_MS.DEFAULT,m=+h.expirationDate+f,y=(c=h.transactionId)!==null&&c!==void 0?c:`${m}`;m>u&&(this.activeTransactions[y]=!0),m<u&&this.activeTransactions[y]&&!this.notifiedTransactions[y]&&(this.log.info(`Local transaction expired: ${y}`),this.notifiedTransactions[y]=!0,this.controller.onTransactionExpired(h))}}},r.INTERVAL_MS)}}r.INTERVAL_MS=1e4,r.GRACE_PERIOD_MS={DEFAULT:6e4,"ios-appstore":6e4,"android-playstore":3e4},e.ExpiryMonitor=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){t.PLUGIN_VERSION="13.13.0";class e{constructor(){this.adapters=new t.Internal.Adapters,this.registeredProducts=new t.Internal.RegisteredProducts,this.log=new t.Logger(this),this.verbosity=t.LogLevel.ERROR,this._readyCallbacks=new t.Internal.ReadyCallbacks(this.log),this.updatedCallbacks=new t.Internal.Callbacks(this.log,"productUpdated()"),this.updatedReceiptsCallbacks=new t.Internal.Callbacks(this.log,"receiptUpdated()"),this.initiatedCallbacks=new t.Internal.Callbacks(this.log,"initiated()"),this.approvedCallbacks=new t.Internal.Callbacks(this.log,"approved()"),this.finishedCallbacks=new t.Internal.Callbacks(this.log,"finished()"),this.pendingCallbacks=new t.Internal.Callbacks(this.log,"pending()"),this.verifiedCallbacks=new t.Internal.Callbacks(this.log,"verified()"),this.unverifiedCallbacks=new t.Internal.Callbacks(this.log,"unverified()"),this.receiptsReadyCallbacks=new t.Internal.Callbacks(this.log,"receiptsReady()",!0),this.receiptsVerifiedCallbacks=new t.Internal.Callbacks(this.log,"receiptsVerified()",!0),this.errorCallbacks=new t.Internal.Callbacks(this.log,"error()"),this.initializedHasBeenCalled=!1,this.lastUpdate=0,this.minTimeBetweenUpdates=6e5,this.version=t.PLUGIN_VERSION;const n=this;this.listener=new t.Internal.StoreAdapterListener({updatedCallbacks:this.updatedCallbacks,updatedReceiptCallbacks:this.updatedReceiptsCallbacks,initiatedCallbacks:this.initiatedCallbacks,approvedCallbacks:this.approvedCallbacks,finishedCallbacks:this.finishedCallbacks,pendingCallbacks:this.pendingCallbacks,receiptsReadyCallbacks:this.receiptsReadyCallbacks},this.log),this.transactionStateMonitors=new t.Internal.TransactionStateMonitors(this.when()),this._validator=new t.Internal.Validator({adapters:this.adapters,getApplicationUsername:this.getApplicationUsername.bind(this),get localReceipts(){return n.localReceipts},get validator(){return n.validator},get validator_privacy_policy(){return n.validator_privacy_policy},verifiedCallbacks:this.verifiedCallbacks,unverifiedCallbacks:this.unverifiedCallbacks,finish:i=>this.finish(i)},this.log),new t.Internal.ReceiptsMonitor({hasLocalReceipts:()=>this.localReceipts.length>0,hasValidator:()=>!!this.validator,numValidationRequests:()=>this._validator.numRequests,numValidationResponses:()=>this._validator.numResponses,off:this.off.bind(this),when:this.when.bind(this),receiptsVerified:()=>{n.receiptsVerifiedCallbacks.trigger(void 0,"receipts_monitor_controller")},log:this.log}).launch(),this.expiryMonitor=new t.Internal.ExpiryMonitor({get localReceipts(){return n.validator?[]:n.localReceipts},get verifiedReceipts(){return n.verifiedReceipts},onTransactionExpired(i){var s;if(n.log.debug(`Local transaction expired (${i.transactionId}), refreshing purchases`),!n.validator){const o=(s=i.products[0])===null||s===void 0?void 0:s.id;o&&!n.owned(o)&&n.updatedReceiptsCallbacks.trigger(i.parentReceipt,"expiry_monitor_transaction_expired")}},onVerifiedPurchaseExpired(i,s){n.verify(s.sourceReceipt)}},this.log),this.expiryMonitor.launch()}getAdapter(n){return this.adapters.find(n)}getApplicationUsername(){return this.applicationUsername instanceof Function?this.applicationUsername():this.applicationUsername}register(n){this.registeredProducts.add(n).forEach(s=>{t.store.errorCallbacks.trigger(s,"register_error"),this.log.error(s)})}initialize(n=[this.defaultPlatform()]){return A(this,void 0,void 0,function*(){if(this.initializedHasBeenCalled)return this.log.warn("store.initialized() has been called already."),[];this.log.info("initialize("+JSON.stringify(n)+") v"+t.PLUGIN_VERSION),this.initializedHasBeenCalled=!0,this.lastUpdate=+new Date;const i=this,s=this.adapters.initialize(n,{error:this.triggerError.bind(this),get verbosity(){return i.verbosity},getApplicationUsername(){return i.getApplicationUsername()},get listener(){return i.listener},get log(){return i.log},get registeredProducts(){return i.registeredProducts},apiDecorators:{canPurchase:this.canPurchase.bind(this),owned:this.owned.bind(this),finish:this.finish.bind(this),order:this.order.bind(this),verify:this.verify.bind(this)}});return s.then(()=>{this._readyCallbacks.trigger("initialize_promise_resolved"),this.listener.setSupportedPlatforms(this.adapters.list.filter(o=>o.isSupported).map(o=>o.id))}),s})}refresh(){throw new Error("use store.initialize() or store.update()")}update(){var n;return A(this,void 0,void 0,function*(){if(this.log.info("update()"),!this._readyCallbacks.isReady){this.log.warn("Do not call store.update() at startup! It is meant to reload the price of products (if needed) long after initialization.");return}const i=+new Date;if(this.lastUpdate>i-this.minTimeBetweenUpdates){this.log.info("Skipping store.update() as the last call occurred less than store.minTimeBetweenUpdates millis ago.");return}this.lastUpdate=i;for(const s of this.registeredProducts.byPlatform()){const o=yield(n=this.adapters.findReady(s.platform))===null||n===void 0?void 0:n.loadProducts(s.products);o==null||o.forEach(a=>{a instanceof t.Product&&this.updatedCallbacks.trigger(a,"update_has_loaded_products")})}})}ready(n){this._readyCallbacks.add(n)}get isReady(){return this._readyCallbacks.isReady}when(){const n={productUpdated:(i,s)=>(this.updatedCallbacks.push(i,s),n),receiptUpdated:(i,s)=>(this.updatedReceiptsCallbacks.push(i,s),n),updated:(i,s)=>(this.updatedCallbacks.push(i,s),this.updatedReceiptsCallbacks.push(i,s),n),approved:(i,s)=>(this.approvedCallbacks.push(i,s),n),initiated:(i,s)=>(this.initiatedCallbacks.push(i,s),n),pending:(i,s)=>(this.pendingCallbacks.push(i,s),n),finished:(i,s)=>(this.finishedCallbacks.push(i,s),n),verified:(i,s)=>(this.verifiedCallbacks.push(i,s),n),unverified:(i,s)=>(this.unverifiedCallbacks.push(i,s),n),receiptsReady:(i,s)=>(this.receiptsReadyCallbacks.push(i,s),n),receiptsVerified:(i,s)=>(this.receiptsVerifiedCallbacks.push(i,s),n)};return n}off(n){this.updatedCallbacks.remove(n),this.updatedReceiptsCallbacks.remove(n),this.approvedCallbacks.remove(n),this.finishedCallbacks.remove(n),this.pendingCallbacks.remove(n),this.verifiedCallbacks.remove(n),this.unverifiedCallbacks.remove(n),this.receiptsReadyCallbacks.remove(n),this.receiptsVerifiedCallbacks.remove(n),this.errorCallbacks.remove(n),this._readyCallbacks.remove(n)}monitor(n,i,s){return this.transactionStateMonitors.start(n,t.Utils.safeCallback(this.log,"monitor()",i,s,"transactionStateMonitors_stateChanged"))}get products(){return[].concat(...this.adapters.list.map(n=>n.products))}get(n,i){var s;return(s=this.adapters.findReady(i))===null||s===void 0?void 0:s.products.find(o=>o.id===n)}get localReceipts(){return[].concat(...this.adapters.list.map(n=>n.receipts))}get localTransactions(){const n=[];for(const i of this.localReceipts)n.push(...i.transactions);return n}get verifiedReceipts(){return this._validator.verifiedReceipts}get verifiedPurchases(){return t.Internal.VerifiedReceipts.getVerifiedPurchases(this.verifiedReceipts)}findInVerifiedReceipts(n){return t.Internal.VerifiedReceipts.find(this.verifiedReceipts,n)}findInLocalReceipts(n){return t.Internal.LocalReceipts.find(this.localReceipts,n)}canPurchase(n){const i=n instanceof t.Offer?this.get(n.productId,n.platform):n,s=this.adapters.findReady(n.platform);return s!=null&&s.checkSupport("order")?t.Internal.LocalReceipts.canPurchase(this.localReceipts,i):!1}owned(n){return t.Internal.owned({product:typeof n=="string"?{id:n}:n,verifiedReceipts:this.validator?this.verifiedReceipts:void 0,localReceipts:this.localReceipts})}order(n,i){return A(this,void 0,void 0,function*(){this.log.info(`order(${n.productId})`);const s=this.adapters.findReady(n.platform);if(!s)return t.storeError(t.ErrorCode.PAYMENT_NOT_ALLOWED,"Adapter not found or not ready ("+n.platform+")",n.platform,null);const o=yield s.order(n,i||{});return o&&"isError"in o&&t.store.triggerError(o),o})}requestPayment(n,i){var s,o,a,l,c;const u=this.adapters.findReady(n.platform);if(!u)return t.PaymentRequestPromise.failed(t.ErrorCode.PAYMENT_NOT_ALLOWED,"Adapter not found or not ready ("+n.platform+")",n.platform,null);if(!n.amountMicros){n.amountMicros=0;for(const h of n.items)n.amountMicros+=(o=(s=h==null?void 0:h.pricing)===null||s===void 0?void 0:s.priceMicros)!==null&&o!==void 0?o:0}if(n.currency)for(const h of n.items)if(!((l=h==null?void 0:h.pricing)===null||l===void 0)&&l.currency){if(n.currency!==h.pricing.currency)return t.PaymentRequestPromise.failed(t.ErrorCode.PAYMENT_INVALID,"Currencies do not match",n.platform,h.id)}else h!=null&&h.pricing&&(h.pricing.currency=n.currency);else for(const h of n.items)!((a=h==null?void 0:h.pricing)===null||a===void 0)&&a.currency&&(n.currency=h.pricing.currency);if(n.items.length===1){const h=n.items[0];h&&!h.pricing&&(h.pricing={priceMicros:(c=n.amountMicros)!==null&&c!==void 0?c:0,currency:n.currency})}const d=new t.PaymentRequestPromise;return u.requestPayment(n,i).then(h=>{if(d.trigger(h),h instanceof t.Transaction){const f=y=>{d.trigger(h),h.state===t.TransactionState.FINISHED&&m.stop()},m=this.monitor(h,f,"requestPayment_onStateChange")}}),d}checkSupport(n,i){const s=this.adapters.find(n);return s?s.checkSupport(i):!1}verify(n){return A(this,void 0,void 0,function*(){this.log.info(`verify(${n.className})`),this._validator.add(n),setTimeout(()=>this._validator.run(),200)})}finish(n){return A(this,void 0,void 0,function*(){this.log.info(`finish(${n.className})`),(n instanceof t.VerifiedReceipt?n.sourceReceipt.transactions:n instanceof t.Receipt?n.transactions:[n]).forEach(s=>{var o;let a=!1;if(this.validator&&n instanceof t.VerifiedReceipt){const c=n.collection.find(u=>u.transactionId&&u.transactionId===s.transactionId);c&&(c.isAcknowledged===!0&&(this.log.info(`Transaction ${s.transactionId} already acknowledged according to verification API`),s.isAcknowledged=!0,a=!0),c.isConsumed===!0&&(this.log.info(`Transaction ${s.transactionId} already consumed according to verification API`),s.isConsumed=!0,a=!0))}const l=this.adapters.findReady(s.platform);l!=null&&l.canSkipFinish&&a&&s.state===t.TransactionState.APPROVED?s.state=t.TransactionState.FINISHED:(o=this.adapters.findReady(s.platform))===null||o===void 0||o.finish(s)})})}restorePurchases(){return A(this,void 0,void 0,function*(){let n;for(const i of this.adapters.list)i.ready&&(n=n??(yield i.restorePurchases()));return n})}manageSubscriptions(n){return A(this,void 0,void 0,function*(){this.log.info("manageSubscriptions()");const i=this.adapters.findReady(n);return i?i.manageSubscriptions():t.storeError(t.ErrorCode.SETUP,"Found no adapter ready to handle 'manageSubscription'",n??null,null)})}manageBilling(n){return A(this,void 0,void 0,function*(){this.log.info("manageBilling()");const i=this.adapters.findReady(n);return i?i.manageBilling():t.storeError(t.ErrorCode.SETUP,"Found no adapter ready to handle 'manageBilling'",n??null,null)})}defaultPlatform(){switch(t.Utils.platformId()){case"android":return t.Platform.GOOGLE_PLAY;case"ios":return t.Platform.APPLE_APPSTORE;default:return t.Platform.TEST}}error(n){this.errorCallbacks.push(n)}triggerError(n){this.errorCallbacks.trigger(n,"triggerError")}}t.Store=e})(E||(E={}));window.cordova?setTimeout(Ap,0):Ap();function Ap(){var t;console.log("Create CdvPurchase...");const e=(t=window.CdvPurchase)===null||t===void 0?void 0:t.store;window.CdvPurchase=E,e?window.CdvPurchase.store=e:window.CdvPurchase.store=new E.Store,Object.assign(window.CdvPurchase.store,E.LogLevel,E.ProductType,E.ErrorCode,E.Platform)}var E;(function(t){(function(e){e.CONSUMABLE="consumable",e.NON_CONSUMABLE="non consumable",e.FREE_SUBSCRIPTION="free subscription",e.PAID_SUBSCRIPTION="paid subscription",e.NON_RENEWING_SUBSCRIPTION="non renewing subscription",e.APPLICATION="application"})(t.ProductType||(t.ProductType={})),function(e){e.NON_RECURRING="NON_RECURRING",e.FINITE_RECURRING="FINITE_RECURRING",e.INFINITE_RECURRING="INFINITE_RECURRING"}(t.RecurrenceMode||(t.RecurrenceMode={})),function(e){e.PAY_AS_YOU_GO="PayAsYouGo",e.UP_FRONT="UpFront",e.FREE_TRIAL="FreeTrial"}(t.PaymentMode||(t.PaymentMode={})),function(e){e.APPLE_APPSTORE="ios-appstore",e.GOOGLE_PLAY="android-playstore",e.WINDOWS_STORE="windows-store-transaction",e.BRAINTREE="braintree",e.TEST="test",e.IAPTIC_JS="iaptic-js"}(t.Platform||(t.Platform={})),function(e){e.INITIATED="initiated",e.PENDING="pending",e.APPROVED="approved",e.CANCELLED="cancelled",e.FINISHED="finished",e.UNKNOWN_STATE=""}(t.TransactionState||(t.TransactionState={})),function(e){e.LAPSE="Lapse",e.RENEW="Renew"}(t.RenewalIntent||(t.RenewalIntent={})),function(e){e.NOTIFIED="Notified",e.AGREED="Agreed"}(t.PriceConsentStatus||(t.PriceConsentStatus={})),function(e){e.NOT_CANCELED="",e.DEVELOPER="Developer",e.SYSTEM="System",e.SYSTEM_REPLACED="System.Replaced",e.SYSTEM_PRODUCT_UNAVAILABLE="System.ProductUnavailable",e.SYSTEM_BILLING_ERROR="System.BillingError",e.SYSTEM_DELETED="System.Deleted",e.CUSTOMER="Customer",e.CUSTOMER_TECHNICAL_ISSUES="Customer.TechnicalIssues",e.CUSTOMER_PRICE_INCREASE="Customer.PriceIncrease",e.CUSTOMER_COST="Customer.Cost",e.CUSTOMER_FOUND_BETTER_APP="Customer.FoundBetterApp",e.CUSTOMER_NOT_USEFUL_ENOUGH="Customer.NotUsefulEnough",e.CUSTOMER_OTHER_REASON="Customer.OtherReason",e.UNKNOWN="Unknown"}(t.CancelationReason||(t.CancelationReason={}))})(E||(E={}));var E;(function(t){class e{constructor(n,i){this.className="Offer",this.id=n.id,this.pricingPhases=n.pricingPhases,Object.defineProperty(this,"productId",{enumerable:!0,get:()=>n.product.id}),Object.defineProperty(this,"productType",{enumerable:!0,get:()=>n.product.type}),Object.defineProperty(this,"productGroup",{enumerable:!0,get:()=>n.product.group}),Object.defineProperty(this,"platform",{enumerable:!0,get:()=>n.product.platform}),Object.defineProperty(this,"order",{enumerable:!1,get:()=>s=>i.order(this,s)}),Object.defineProperty(this,"canPurchase",{enumerable:!1,get:()=>i.canPurchase(this)})}get productId(){return""}get productType(){return t.ProductType.APPLICATION}get productGroup(){}get platform(){return t.Platform.TEST}order(n){return A(this,void 0,void 0,function*(){})}get canPurchase(){return!1}}t.Offer=e})(E||(E={}));var E;(function(t){class e{constructor(){this.failedCallbacks=new t.Internal.PromiseLike,this.initiatedCallbacks=new t.Internal.PromiseLike,this.approvedCallbacks=new t.Internal.PromiseLike,this.finishedCallbacks=new t.Internal.PromiseLike,this.cancelledCallback=new t.Internal.PromiseLike}failed(n){return this.failedCallbacks.push(n),this}initiated(n){return this.initiatedCallbacks.push(n),this}approved(n){return this.approvedCallbacks.push(n),this}finished(n){return this.finishedCallbacks.push(n),this}cancelled(n){return this.cancelledCallback.push(n),this}trigger(n){if(!n)this.cancelledCallback.resolve();else if("isError"in n)this.failedCallbacks.resolve(n);else switch(n.state){case t.TransactionState.INITIATED:this.initiatedCallbacks.resolve(n);break;case t.TransactionState.APPROVED:this.approvedCallbacks.resolve(n);break;case t.TransactionState.FINISHED:this.finishedCallbacks.resolve(n);break}return this}static failed(n,i,s,o){return new e().trigger(t.storeError(n,i,s,o))}static cancelled(){return new e().trigger()}static initiated(n){return new e().trigger(n)}}t.PaymentRequestPromise=e})(E||(E={}));var E;(function(t){class e{constructor(n,i){this.className="Receipt",this.transactions=[],this.platform=n,Object.defineProperty(this,"verify",{enumerable:!1,get(){return()=>i.verify(this)}}),Object.defineProperty(this,"finish",{enumerable:!1,get(){return()=>i.finish(this)}})}verify(){return A(this,void 0,void 0,function*(){})}finish(){return A(this,void 0,void 0,function*(){})}hasTransaction(n){return!!this.transactions.find(i=>i===n)}lastTransaction(){return this.transactions[this.transactions.length-1]}}t.Receipt=e})(E||(E={}));var E;(function(t){class e{constructor(n,i,s){this.className="Transaction",this.transactionId="",this.state=t.TransactionState.UNKNOWN_STATE,this.products=[],this.platform=n,Object.defineProperty(this,"finish",{enumerable:!1,get(){return()=>s.finish(this)}}),Object.defineProperty(this,"verify",{enumerable:!1,get(){return()=>s.verify(this)}}),Object.defineProperty(this,"parentReceipt",{enumerable:!1,get(){return i}})}finish(){return A(this,void 0,void 0,function*(){})}verify(){return A(this,void 0,void 0,function*(){})}get parentReceipt(){return{}}}t.Transaction=e})(E||(E={}));var E;(function(t){(function(e){class r{static find(i,s){var o,a;if(!s)return;let l;for(const c of i)if(!(s.platform&&c.platform!==s.platform))for(const u of c.transactions)for(const d of u.products)d.id===s.id&&(!l||((o=u.purchaseDate)!==null&&o!==void 0?o:0)<((a=l.purchaseDate)!==null&&a!==void 0?a:1))&&(l=u);return l}static isOwned(i,s){if(!s)return!1;const o=r.find(i,s);return!o||o.isConsumed||o.isPending?!1:o.expirationDate?o.expirationDate.getTime()>+new Date:!0}static canPurchase(i,s){if(!s)return!1;const o=r.find(i,s);return!o||o.isConsumed?!0:o.expirationDate?o.expirationDate.getTime()<=+new Date:!0}}e.LocalReceipts=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){function r(n){return n.verifiedReceipts!==void 0?e.VerifiedReceipts.isOwned(n.verifiedReceipts,n.product):n.localReceipts!==void 0?e.LocalReceipts.isOwned(n.localReceipts,n.product):!1}e.owned=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(){this.resolved=!1,this.callbacks=[]}push(i){this.resolved?setTimeout(i,0,this.resolvedArgument):this.callbacks.push(i)}resolve(i){this.resolved||(this.resolved=!0,this.resolvedArgument=i,this.callbacks.forEach(s=>setTimeout(s,0,i)),this.callbacks=[])}}e.PromiseLike=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(i=5e3,s=12e4){this.maxTimeout=12e4,this.minTimeout=5e3,this.retryTimeout=5e3,this.retries=[],this.minTimeout=i,this.maxTimeout=s,this.retryTimeout=i,document.addEventListener("online",()=>{const o=this.retries;this.retries=[],this.retryTimeout=this.minTimeout;for(var a=0;a<o.length;++a)clearTimeout(o[a].tid),o[a].fn.call(this)},!1)}retry(i){var s=setTimeout(()=>{this.retries=this.retries.filter(function(o){return s!==o.tid}),i()},this.retryTimeout);this.retries.push({tid:s,fn:i}),this.retryTimeout*=2,this.retryTimeout>this.maxTimeout&&(this.retryTimeout=this.maxTimeout)}}e.Retry=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){class r{static find(i,s){var o,a;if(!s)return;let l;for(const c of i)if(!(s.platform&&c.platform!==s.platform))for(const u of c.collection)u.id===s.id&&((o=l==null?void 0:l.purchaseDate)!==null&&o!==void 0?o:0)<((a=u.purchaseDate)!==null&&a!==void 0?a:1)&&(l=u);return l}static isOwned(i,s){if(!s)return!1;const o=r.find(i,s);return!o||o!=null&&o.isExpired?!1:o!=null&&o.expiryDate?o.expiryDate>+new Date:!0}static getVerifiedPurchases(i){var s,o,a,l;const c={};for(const u of i)for(const d of u.collection){const h=u.platform+":"+d.id,f=c[h];(!f||f&&((o=(s=f.lastRenewalDate)!==null&&s!==void 0?s:f.purchaseDate)!==null&&o!==void 0?o:0)<((l=(a=d.lastRenewalDate)!==null&&a!==void 0?a:d.purchaseDate)!==null&&l!==void 0?l:0))&&(c[h]=Object.assign(Object.assign({},d),{platform:u.platform}))}return Object.keys(c).map(u=>c[u])}}e.VerifiedReceipts=r})(t.Internal||(t.Internal={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){r.Name="name",r.EmailAddress="emailAddress",r.PhoneNumber="phoneNumber",r.PostalAddress="postalAddress",r.PhoneticName="phoneticName"})(e.ContactField||(e.ContactField={})),function(r){r.Amex="Amex",r.Barcode="Barcode",r.CartesBancaires="CartesBancaires",r.ChinaUnionPay="ChinaUnionPay",r.Dankort="Dankort",r.Discover="Discover",r.Eftpos="Eftpos",r.Electron="Electron",r.Elo="Elo",r.Girocard="Girocard",r.IDCredit="IDCredit",r.Interac="Interac",r.JCB="JCB",r.Mada="Mada",r.Maestro="Maestro",r.MasterCard="MasterCard",r.Mir="Mir",r.Nanaco="Nanaco",r.PrivateLabel="PrivateLabel",r.QuicPay="QuicPay",r.Suica="Suica",r.Visa="Visa",r.VPay="VPay",r.Waon="Waon"}(e.PaymentNetwork||(e.PaymentNetwork={})),function(r){r.ThreeDS="3DS",r.EMV="EMV",r.Credit="Credit",r.Debit="Debit"}(e.MerchantCapability||(e.MerchantCapability={}))})(t.ApplePay||(t.ApplePay={}))})(E||(E={}));var E;(function(t){(function(e){function r(s){return`virtual.${s}`}class n{constructor(o,a){var l,c;this.id=t.Platform.APPLE_APPSTORE,this.name="AppStore",this.ready=!1,this._canMakePayments=!1,this.forceReceiptReload=!1,this._products=[],this.validProducts={},this._paymentMonitor=()=>{},this.supportsParallelLoading=!0,this._appStoreReceiptLoading=!1,this._appStoreReceiptCallbacks=[],this.context=o,this.bridge=new e.Bridge.Bridge,this.log=o.log.child("AppleAppStore"),this.discountEligibilityDeterminer=a.discountEligibilityDeterminer,this.needAppReceipt=(l=a.needAppReceipt)!==null&&l!==void 0?l:!0,this.autoFinish=(c=a.autoFinish)!==null&&c!==void 0?c:!1,this.pseudoReceipt=new t.Receipt(t.Platform.APPLE_APPSTORE,this.context.apiDecorators),this.receiptsUpdated=t.Utils.createDebouncer(()=>{this._receiptsUpdated()},300)}get products(){return this._products}getProduct(o){return this._products.find(a=>a.id===o)}get receipts(){return this.isSupported?(this._receipt?[this._receipt]:[]).concat(this.pseudoReceipt?this.pseudoReceipt:[]):[]}addValidProducts(o,a){a.forEach(l=>{const c=o.find(u=>u.id===l.id);c&&(this.validProducts[l.id]=Object.assign(Object.assign({},l),c))})}get isSupported(){return t.Utils.platformId()==="ios"}upsertTransactionInProgress(o,a){const l=r(o);return new Promise(c=>{const u=this.pseudoReceipt.transactions.find(d=>d.transactionId===l);if(u)u.state=a,u.refresh(o),c(u);else{const d=new e.SKTransaction(t.Platform.APPLE_APPSTORE,this.pseudoReceipt,this.context.apiDecorators);d.state=a,d.transactionId=l,d.refresh(o),this.pseudoReceipt.transactions.push(d),c(d)}})}removeTransactionInProgress(o){const a=r(o);this.pseudoReceipt.transactions=this.pseudoReceipt.transactions.filter(l=>l.transactionId!==a)}upsertTransaction(o,a,l){return A(this,void 0,void 0,function*(){return new Promise(c=>{this.initializeAppReceipt(()=>{var u;if(!this._receipt){this.log.warn("Failed to load the application receipt, cannot proceed with handling the purchase");return}const d=(u=this._receipt)===null||u===void 0?void 0:u.transactions.find(h=>h.transactionId===a);if(d)d.state=l,d.refresh(o),c(d);else{const h=new e.SKTransaction(t.Platform.APPLE_APPSTORE,this._receipt,this.context.apiDecorators);h.state=l,h.transactionId=a,h.refresh(o),this._receipt.transactions.push(h),c(h)}})})})}removeTransaction(o){this._receipt&&(this._receipt.transactions=this._receipt.transactions.filter(a=>a.transactionId!==o))}_receiptsUpdated(){this._receipt?(this.log.debug("receipt updated and ready."),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this._receipt,this.pseudoReceipt]),this.context.listener.receiptsReady(t.Platform.APPLE_APPSTORE)):(this.log.debug("receipt updated."),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this.pseudoReceipt]))}setPaymentMonitor(o){this._paymentMonitor=o}callPaymentMonitor(o,a,l){this._paymentMonitor(o)}initialize(){return new Promise(o=>{this.log.info("bridge.init");const a=this.log.child("Bridge");this.bridge.init({autoFinish:this.autoFinish,debug:this.context.verbosity===t.LogLevel.DEBUG,log:l=>a.debug(l),error:(l,c,u)=>{if(this.log.error("ERROR: "+l+" - "+c),l===t.ErrorCode.PAYMENT_CANCELLED){this.callPaymentMonitor("cancelled",t.ErrorCode.PAYMENT_CANCELLED,c);return}else this.context.error(i(l,c,(u==null?void 0:u.productId)||null))},ready:()=>{this.log.info("ready")},purchased:(l,c,u,d,h)=>A(this,void 0,void 0,function*(){this.log.info("purchase: id:"+l+" product:"+c+" originalTransaction:"+u+" - date:"+d+" - discount:"+h),(yield this.upsertTransaction(c,l,t.TransactionState.APPROVED)).refresh(c,u,d,h),this.removeTransactionInProgress(c),this.receiptsUpdated.call(),this.callPaymentMonitor("purchased")}),purchaseEnqueued:(l,c)=>A(this,void 0,void 0,function*(){this.log.info("purchaseEnqueued: "+l+" - "+c),yield this.upsertTransactionInProgress(l,t.TransactionState.INITIATED),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this.pseudoReceipt])}),purchaseFailed:(l,c,u)=>{this.log.info("purchaseFailed: "+l+" - "+c+" - "+u),this.removeTransactionInProgress(l),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this.pseudoReceipt]),this.callPaymentMonitor("failed",c,u)},purchasing:l=>A(this,void 0,void 0,function*(){this.log.info("purchasing: "+l),yield this.upsertTransactionInProgress(l,t.TransactionState.INITIATED),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this.pseudoReceipt])}),deferred:l=>A(this,void 0,void 0,function*(){this.log.info("deferred: "+l),yield this.upsertTransactionInProgress(l,t.TransactionState.PENDING),this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[this.pseudoReceipt]),this.callPaymentMonitor("deferred")}),finished:(l,c)=>A(this,void 0,void 0,function*(){yield this.receiptsUpdated.wait(),this.log.info("finish: "+l+" - "+c),this.removeTransactionInProgress(c),yield this.upsertTransaction(c,l,t.TransactionState.FINISHED),this.receiptsUpdated.call()}),restored:(l,c)=>A(this,void 0,void 0,function*(){this.log.info("restore: "+l+" - "+c),yield this.upsertTransaction(c,l,t.TransactionState.APPROVED),this.receiptsUpdated.call()}),receiptsRefreshed:l=>{this.log.info("receiptsRefreshed"),this._receipt&&this._receipt.refresh(l,this.needAppReceipt,this.context.apiDecorators)},restoreFailed:l=>{this.log.info("restoreFailed: "+l),this.onRestoreCompleted&&(this.onRestoreCompleted(i(l,"Restore purchases failed",null)),this.onRestoreCompleted=void 0)},restoreCompleted:()=>{this.log.info("restoreCompleted"),this.onRestoreCompleted&&(this.onRestoreCompleted(void 0),this.onRestoreCompleted=void 0)}},()=>A(this,void 0,void 0,function*(){this.log.info("bridge.init done"),yield this.canMakePayments(),o(void 0)}),(l,c)=>{this.log.info("bridge.init failed: "+l+" - "+c),o(i(l,c,null))})})}loadReceipts(){return new Promise(o=>{setTimeout(()=>{this.initializeAppReceipt(()=>{this.receiptsUpdated.call(),this._receipt?o([this._receipt,this.pseudoReceipt]):o([this.pseudoReceipt])})},300)})}canMakePayments(){return A(this,void 0,void 0,function*(){return new Promise(o=>{this.bridge.canMakePayments(()=>{this._canMakePayments=!0,o(!0)},a=>{this.log.warn(`canMakePayments: ${a}`),this._canMakePayments=!1,o(!1)})})})}initializeAppReceipt(o){return A(this,void 0,void 0,function*(){if(this._receipt)return this.log.debug("initializeAppReceipt() => already initialized."),o(void 0);if(this._appStoreReceiptCallbacks.push(o),this._appStoreReceiptLoading){this.log.debug("initializeAppReceipt() => already loading.");return}this._appStoreReceiptLoading=!0;const a=yield this.loadAppStoreReceipt(),l=c=>{const u=this._appStoreReceiptCallbacks;this._appStoreReceiptCallbacks=[],u.forEach(d=>{d(c)})};if(!(a!=null&&a.appStoreReceipt)){this.log.warn("no appStoreReceipt"),this._appStoreReceiptLoading=!1,l(i(t.ErrorCode.REFRESH,"No appStoreReceipt",null));return}this._receipt=new e.SKApplicationReceipt(a,this.needAppReceipt,this.context.apiDecorators),l(void 0)})}prepareReceipt(o){o!=null&&o.appStoreReceipt&&(this._receipt?this._receipt.refresh(o,this.needAppReceipt,this.context.apiDecorators):this._receipt=new e.SKApplicationReceipt(o,this.needAppReceipt,this.context.apiDecorators))}loadAppStoreReceipt(){return A(this,void 0,void 0,function*(){let o=!1;return new Promise(a=>{var l;if(!((l=this.bridge.appStoreReceipt)===null||l===void 0)&&l.appStoreReceipt&&!this.forceReceiptReload)return this.log.debug("using cached appstore receipt"),a(this.bridge.appStoreReceipt);this.log.debug("loading appstore receipt..."),this.forceReceiptReload=!1,this.bridge.loadReceipts(c=>{this.log.debug("appstore receipt loaded"),o||a(c),o=!0},(c,u)=>{this.log.warn("Failed to load appStoreReceipt: "+c+" - "+u),o||a(void 0),o=!0}),setTimeout(function(){o||a(void 0),o=!0},5e3)}).then(a=>(this.context.listener.receiptsReady(t.Platform.APPLE_APPSTORE),a)).catch(a=>(this.context.listener.receiptsReady(t.Platform.APPLE_APPSTORE),a))})}loadEligibility(o){return A(this,void 0,void 0,function*(){if(this.log.debug("load eligibility: "+JSON.stringify(o)),!this.discountEligibilityDeterminer)return this.log.debug("No discount eligibility determiner, skipping..."),new e.Internal.DiscountEligibilities([],[]);const a=[];if(o.forEach(l=>{var c,u,d;(c=l.discounts)===null||c===void 0||c.forEach(h=>{a.push({productId:l.id,discountId:h.id,discountType:h.type})}),((d=(u=l.discounts)===null||u===void 0?void 0:u.length)!==null&&d!==void 0?d:0)===0&&l.introPrice&&a.push({productId:l.id,discountId:"intro",discountType:"Introductory"})}),a.length>0){const l=yield this.loadAppStoreReceipt();if(!l||!l.appStoreReceipt)return this.log.debug("no receipt, assuming introductory price are available."),new e.Internal.DiscountEligibilities(a,a.map(c=>c.discountType==="Introductory"));{this.log.debug("calling discount eligibility determiner.");const c=yield this.callDiscountEligibilityDeterminer(l,a);return this.log.debug("response: "+JSON.stringify(c)),new e.Internal.DiscountEligibilities(a,c)}}else return new e.Internal.DiscountEligibilities([],[])})}callDiscountEligibilityDeterminer(o,a){return new Promise(l=>{if(!this.discountEligibilityDeterminer)return l([]);this.discountEligibilityDeterminer(o,a,l)})}loadProducts(o){return new Promise(a=>{this.log.info("bridge.load"),this.bridge.load(o.map(l=>l.id),(l,c)=>A(this,void 0,void 0,function*(){this.log.info("bridge.loaded: "+JSON.stringify({validProducts:l,invalidProducts:c})),this.addValidProducts(o,l);const u=yield this.loadEligibility(l);this.log.info("eligibilities ready: "+JSON.stringify(u));const d=o.map(h=>{if(c.indexOf(h.id)>=0)return this.log.debug(`${h.id} is invalid`),i(t.ErrorCode.INVALID_PRODUCT_ID,"Product not found in AppStore. #400",h.id);{const f=l.find(y=>y.id===h.id);if(this.log.debug(`${h.id} is valid: ${JSON.stringify(f)}`),!f)return i(t.ErrorCode.INVALID_PRODUCT_ID,"Product not found in AppStore. #404",h.id);let m=this.getProduct(h.id);return m?(this.log.debug("refreshing existing product"),m==null||m.refresh(f,this.context.apiDecorators,u)):(this.log.debug("registering new product"),m=new e.SKProduct(f,h,this.context.apiDecorators,u),this._products.push(m)),m}});this.log.debug(`Products loaded: ${JSON.stringify(d)}`),a(d)}),(l,c)=>o.map(u=>i(l,c,null)))})}order(o,a){return A(this,void 0,void 0,function*(){let l=!1;return new Promise(c=>{var u;const d=v=>{l||(this.setPaymentMonitor(()=>{}),l=!0,c(v))};this.log.info("order");const h=o.id!==e.DEFAULT_OFFER_ID?o.id:void 0,f=(u=a==null?void 0:a.appStore)===null||u===void 0?void 0:u.discount;if(h&&!f)return d(i(t.ErrorCode.MISSING_OFFER_PARAMS,"Missing additionalData.appStore.discount when ordering a discount offer",o.productId));if(h&&(f==null?void 0:f.id)!==h)return d(i(t.ErrorCode.INVALID_OFFER_IDENTIFIER,"Offer identifier does not match additionalData.appStore.discount.id",o.productId));this.setPaymentMonitor((v,w,p)=>{if(this.log.info("order.paymentMonitor => "+v+" "+(w??"")+" "+(p??"")),!l)switch(v){case"cancelled":d(i(w??t.ErrorCode.PAYMENT_CANCELLED,p??"The user cancelled the order.",o.productId));break;case"failed":setTimeout(()=>{d(i(w??t.ErrorCode.PURCHASE,p??"Purchase failed",o.productId))},500);break;case"purchased":case"deferred":d(void 0);break}});const m=()=>{this.log.info("order.success")},y=()=>{this.log.info("order.error"),d(i(t.ErrorCode.PURCHASE,"Failed to place order",o.productId))};this.forceReceiptReload=!0,this.bridge.purchase(o.productId,1,this.context.getApplicationUsername(),f,m,y)})})}finish(o){return new Promise(a=>{if(this.log.info("finish("+o.transactionId+")"),o.transactionId===e.APPLICATION_VIRTUAL_TRANSACTION_ID||o.transactionId===r(o.products[0].id))return o.state=t.TransactionState.FINISHED,this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[o.parentReceipt]),a(void 0);const l=()=>{o.state=t.TransactionState.FINISHED,this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[o.parentReceipt]),a(void 0)},c=u=>{var d,h;u!=null&&u.includes("[#CdvPurchase:100]")?l():a(i(t.ErrorCode.FINISH,"Failed to finish transaction",(h=(d=o.products[0])===null||d===void 0?void 0:d.id)!==null&&h!==void 0?h:null))};this.bridge.finish(o.transactionId,l,c)})}refreshReceipt(){return new Promise(o=>{const a=c=>{o(c)},l=(c,u)=>{o(i(c,u,null))};this.bridge.refreshReceipts(a,l)})}receiptValidationBody(o){return A(this,void 0,void 0,function*(){if(o.platform!==t.Platform.APPLE_APPSTORE||o!==this._receipt)return;const a=o;let l=a.nativeData;if(this.forceReceiptReload){const u=yield this.loadAppStoreReceipt();this.forceReceiptReload=!1,u&&(l=u,this.prepareReceipt(u))}if(!a.nativeData.appStoreReceipt){this.log.info("Cannot prepare the receipt validation body, because appStoreReceipt is missing. Refreshing...");const u=yield this.refreshReceipt();if(!u||"isError"in u){this.log.warn("Failed to refresh receipt, cannot run receipt validation."),u&&this.log.error(u);return}this.log.info("Receipt refreshed."),l=u}const c=a.transactions.slice(-1)[0];return{id:l.bundleIdentifier,type:t.ProductType.APPLICATION,products:t.Utils.objectValues(this.validProducts).map(u=>new e.SKProduct(u,u,this.context.apiDecorators,{isEligible:()=>!0})),transaction:{type:"ios-appstore",id:c==null?void 0:c.transactionId,appStoreReceipt:l.appStoreReceipt}}})}handleReceiptValidationResponse(o,a){var l,c;return A(this,void 0,void 0,function*(){let u=!1;if(a.ok){const d=(l=a.data)===null||l===void 0?void 0:l.transaction;(d==null?void 0:d.type)==="ios-appstore"&&"original_application_version"in d&&((c=this._receipt)===null||c===void 0||c.transactions.forEach(h=>{h.transactionId===e.APPLICATION_VIRTUAL_TRANSACTION_ID&&d.original_purchase_date_ms&&(h.purchaseDate=new Date(parseInt(d.original_purchase_date_ms)),u=!0)}))}u&&this.context.listener.receiptsUpdated(t.Platform.APPLE_APPSTORE,[o])})}requestPayment(o,a){return A(this,void 0,void 0,function*(){return i(t.ErrorCode.UNKNOWN,"requestPayment not supported",null)})}manageSubscriptions(){return A(this,void 0,void 0,function*(){this.bridge.manageSubscriptions()})}manageBilling(){return A(this,void 0,void 0,function*(){this.bridge.manageBilling()})}checkSupport(o){return o==="order"?this._canMakePayments:["order","manageBilling","manageSubscriptions"].indexOf(o)>=0}restorePurchases(){return new Promise(o=>{this.onRestoreCompleted=a=>{this.onRestoreCompleted=void 0,this.bridge.refreshReceipts(l=>{o(a)},(l,c)=>{o(a||i(l,c,null))})},this.forceReceiptReload=!0,this.bridge.restore()})}presentCodeRedemptionSheet(){return new Promise(o=>{this.bridge.presentCodeRedemptionSheet(o)})}}e.Adapter=n;function i(s,o,a){return t.storeError(s,o,t.Platform.APPLE_APPSTORE,a)}})(t.AppleAppStore||(t.AppleAppStore={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){const n=l=>{};let i=n;function s(l,c,u,d){window.cordova.exec(u,d,"InAppPurchase",l,c)}function o(l,c,...u){if(l)try{l.apply(this,u)}catch(d){i("exception in "+c+': "'+d+'"')}}class a{constructor(){this.transactionsForProduct={},this.initialized=!1,this.registeredProducts=[],this.needRestoreNotification=!1,this.pendingUpdates=[],this.onPurchased=!1,this.onFailed=!1,this.onRestored=!1,window.storekit=this,this.options={error:n,ready:n,purchased:n,purchaseEnqueued:n,purchasing:n,purchaseFailed:n,deferred:n,finished:n,restored:n,receiptsRefreshed:n,restoreFailed:n,restoreCompleted:n}}init(c,u,d){this.options={error:c.error||n,ready:c.ready||n,purchased:c.purchased||n,purchaseEnqueued:c.purchaseEnqueued||n,purchasing:c.purchasing||n,purchaseFailed:c.purchaseFailed||n,deferred:c.deferred||n,finished:c.finished||n,restored:c.restored||n,receiptsRefreshed:c.receiptsRefreshed||n,restoreFailed:c.restoreFailed||n,restoreCompleted:c.restoreCompleted||n},c.debug&&(s("debug",[],n,n),i=c.log||function(m){console.log("[CdvPurchase.AppAppStore.Bridge] "+m)}),c.autoFinish&&s("autoFinish",[],n,n),s("setup",[],()=>{i("setup ok"),o(this.options.ready,"options.ready"),o(u,"init.success"),this.initialized=!0,setTimeout(()=>this.processPendingTransactions(),50)},m=>{i("setup failed"),o(d,"init.error",t.ErrorCode.SETUP,"Setup failed: "+m)})}processPendingTransactions(){i("processing pending transactions"),s("processPendingTransactions",[],()=>{this.finalizeTransactionUpdates()},void 0)}purchase(c,u,d,h,f,m){u=u|0||1;const y=this.options;if(this.registeredProducts.indexOf(c)<0){const p="Purchasing "+c+" failed.  Ensure the product was loaded first with Bridge.load(...)!";i(p),typeof y.error=="function"&&o(y.error,"options.error",t.ErrorCode.PURCHASE,"Trying to purchase a unknown product.",{productId:c,quantity:u});return}s("purchase",[c,u,d,h||{}],()=>{i("Purchase enqueued "+c),typeof y.purchaseEnqueued=="function"&&o(y.purchaseEnqueued,"options.purchaseEnqueued",c,u),o(f,"purchase.success")},()=>{const p="Purchase failed: "+c;i(p),typeof y.error=="function"&&o(y.error,"options.error",t.ErrorCode.PURCHASE,p,{productId:c,quantity:u}),o(m,"purchase.error")})}canMakePayments(c,u){return s("canMakePayments",[],c,u)}restore(c){this.needRestoreNotification=!0,s("restoreCompletedTransactions",[],c,c)}manageSubscriptions(c){s("manageSubscriptions",[],c,c)}manageBilling(c){s("manageBilling",[],c,c)}presentCodeRedemptionSheet(c){s("presentCodeRedemptionSheet",[],c,c)}load(c,u,d){const h=this.options;if(typeof c=="string"&&(c=[c]),!c)o(u,"load.success",[],[]);else if(!c.length)o(u,"load.success",[],[]);else{if(typeof c[0]!="string"){const y="invalid productIds given to store.load: "+JSON.stringify(c);i(y),o(h.error,"options.error",t.ErrorCode.LOAD,y),o(d,"load.error",t.ErrorCode.LOAD,y);return}i("load "+JSON.stringify(c));const f=y=>{const v=y[0],w=y[1];i("load ok: { valid:"+JSON.stringify(v)+" invalid:"+JSON.stringify(w)+" }"),o(u,"load.success",v,w)},m=y=>{i("load failed"),i(y);const v="Load failed: "+y;o(h.error,"options.error",t.ErrorCode.LOAD,v),o(d,"load.error",t.ErrorCode.LOAD,v)};this.registeredProducts=this.registeredProducts.concat(c),s("load",[c],f,m)}}finish(c,u,d){s("finishTransaction",[c],u,d)}finalizeTransactionUpdates(){for(let c=0;c<this.pendingUpdates.length;++c){const u=this.pendingUpdates[c];this.transactionUpdated(u.state,u.errorCode,u.errorText,u.transactionIdentifier,u.productId,u.transactionReceipt,u.originalTransactionIdentifier,u.transactionDate,u.discountId)}this.pendingUpdates=[]}lastTransactionUpdated(){}transactionUpdated(c,u,d,h,f,m,y,v,w){if(!this.initialized){this.pendingUpdates.push({state:c,errorCode:u,errorText:d,transactionIdentifier:h,productId:f,transactionReceipt:m,originalTransactionIdentifier:y,transactionDate:v,discountId:w});return}switch(i("transaction updated:"+h+" state:"+c+" product:"+f),f&&h&&(this.transactionsForProduct[f]?this.transactionsForProduct[f].push(h):this.transactionsForProduct[f]=[h]),c){case"PaymentTransactionStatePurchasing":o(this.options.purchasing,"options.purchasing",f);return;case"PaymentTransactionStatePurchased":o(this.options.purchased,"options.purchase",h,f,y,v,w);return;case"PaymentTransactionStateDeferred":o(this.options.deferred,"options.deferred",f);return;case"PaymentTransactionStateFailed":o(this.options.purchaseFailed,"options.purchaseFailed",f,u||t.ErrorCode.UNKNOWN,d||"ERROR"),o(this.options.error,"options.error",u||t.ErrorCode.UNKNOWN,d||"ERROR",{productId:f});return;case"PaymentTransactionStateRestored":o(this.options.restored,"options.restore",h,f);return;case"PaymentTransactionStateFinished":o(this.options.finished,"options.finish",h,f);return}}restoreCompletedTransactionsFinished(){this.needRestoreNotification&&(this.needRestoreNotification=!1,o(this.options.restoreCompleted,"options.restoreCompleted"))}restoreCompletedTransactionsFailed(c){this.needRestoreNotification&&(this.needRestoreNotification=!1,o(this.options.restoreFailed,"options.restoreFailed",c))}parseReceiptArgs(c){const u=c[0],d=c[1],h=c[2],f=c[3],m=c[4];return i("infoPlist: "+d+","+h+","+f+","+m),{appStoreReceipt:u,bundleIdentifier:d,bundleShortVersion:h,bundleNumericVersion:f,bundleSignature:m}}refreshReceipts(c,u){const d=f=>{const m=this.parseReceiptArgs(f);this.appStoreReceipt=m,o(this.options.receiptsRefreshed,"options.receiptsRefreshed",m),o(c,"refreshReceipts.success",m)},h=f=>{i("refresh receipt failed: "+f),f.includes("(@AMSErrorDomain:100)")&&i('authentication failed, indicated by the string "(@AMSErrorDomain:100)"'),o(this.options.error,"options.error",t.ErrorCode.REFRESH_RECEIPTS,"Failed to refresh receipt: "+f),o(u,"refreshReceipts.error",t.ErrorCode.REFRESH_RECEIPTS,"Failed to refresh receipt: "+f)};this.appStoreReceipt=null,i("refreshing appStoreReceipt"),s("appStoreRefreshReceipt",[],d,h)}loadReceipts(c,u){const d=f=>{const m=this.parseReceiptArgs(f);this.appStoreReceipt=m,o(c,"loadReceipts.callback",m)},h=f=>{};i("loading appStoreReceipt"),s("appStoreReceipt",[],d,h)}}r.Bridge=a})(e.Bridge||(e.Bridge={}))})(t.AppleAppStore||(t.AppleAppStore={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){class n{constructor(s,o){this.request=s,this.response=o}isEligible(s,o,a){var l;for(let c=0;c<this.request.length;++c){const u=this.request[c];if(u.productId===s&&u.discountId===a&&u.discountType===o)return(l=this.response[c])!==null&&l!==void 0?l:!1}return!0}}r.DiscountEligibilities=n})(e.Internal||(e.Internal={}))})(t.AppleAppStore||(t.AppleAppStore={}))})(E||(E={}));var E;(function(t){(function(e){e.DEFAULT_OFFER_ID="$";class r extends t.Offer{constructor(s,o){super(s,o),this.offerType=s.offerType}}e.SKOffer=r;class n extends t.Product{constructor(s,o,a,l){super(o,a),this.raw=s,this.refresh(s,a,l)}removeIneligibleDiscounts(s){this.offers=this.offers.filter(o=>{const a=o;return a.offerType==="Default"?!0:s.isEligible(this.id,a.offerType,o.id)})}refresh(s,o,a){var l;this.raw=s,this.title=s.title,this.description=s.description,this.countryCode=s.countryCode,s.group&&(this.group=s.group),this.removeIneligibleDiscounts(a);const c={price:s.price,priceMicros:s.priceMicros,currency:s.currency,billingPeriod:d(s.billingPeriod,s.billingPeriodUnit),paymentMode:this.type===t.ProductType.PAID_SUBSCRIPTION?t.PaymentMode.PAY_AS_YOU_GO:t.PaymentMode.UP_FRONT,recurrenceMode:this.type===t.ProductType.PAID_SUBSCRIPTION?t.RecurrenceMode.INFINITE_RECURRING:t.RecurrenceMode.NON_RECURRING};if((l=s.discounts)===null||l===void 0||l.forEach(h=>{if(a.isEligible(s.id,h.type,h.id)){const f=[],m=h.paymentMode===t.PaymentMode.PAY_AS_YOU_GO?h.period:1,y=h.paymentMode===t.PaymentMode.PAY_AS_YOU_GO?1:h.period,v={price:h.price,priceMicros:h.priceMicros,currency:s.currency,billingPeriod:d(y,h.periodUnit),billingCycles:m,paymentMode:h.paymentMode,recurrenceMode:t.RecurrenceMode.FINITE_RECURRING};f.push(v),f.push(c),this.addOffer(new r({id:h.id,product:this,pricingPhases:f,offerType:h.type},o))}}),!u(this)){const h=[];if(s.introPrice&&s.introPriceMicros!==void 0&&a.isEligible(s.id,"Introductory","intro")){const f={price:s.introPrice,priceMicros:s.introPriceMicros,currency:s.currency,billingPeriod:d(s.introPricePeriod,s.introPricePeriodUnit),paymentMode:s.introPricePaymentMode,recurrenceMode:t.RecurrenceMode.FINITE_RECURRING,billingCycles:1};h.push(f)}h.push(c),this.addOffer(new r({id:e.DEFAULT_OFFER_ID,product:this,pricingPhases:h,offerType:"Default"},o))}function u(h){return h.offers.filter(f=>{const m=f;return m.offerType==="Introductory"||m.offerType==="Default"&&m.pricingPhases.length>1}).length>0}function d(h,f){if(h&&f)return`P${h}${f[0]}`}}}e.SKProduct=n})(t.AppleAppStore||(t.AppleAppStore={}))})(E||(E={}));var E;(function(t){(function(e){e.APPLICATION_VIRTUAL_TRANSACTION_ID="appstore.application";class r extends t.Receipt{constructor(s,o,a){super(t.Platform.APPLE_APPSTORE,a),this.nativeData=s,this.refresh(this.nativeData,o,a)}refresh(s,o,a){if(this.nativeData=s,o){if(this.transactions.find(u=>u.transactionId===e.APPLICATION_VIRTUAL_TRANSACTION_ID))return;const c=new t.Transaction(t.Platform.APPLE_APPSTORE,this,a);c.transactionId=e.APPLICATION_VIRTUAL_TRANSACTION_ID,c.state=t.TransactionState.APPROVED,c.products.push({id:s.bundleIdentifier}),this.transactions.push(c)}}}e.SKApplicationReceipt=r;class n extends t.Transaction{refresh(s,o,a,l){s&&(this.products=[{id:s,offerId:l}]),o&&(this.originalTransactionId=o),a&&(this.purchaseDate=new Date(+a))}}e.SKTransaction=n})(t.AppleAppStore||(t.AppleAppStore={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){(function(n){n.CANCELED="1",n.BILLING_ERROR="2",n.PRICE_INCREASE="3",n.PRODUCT_NOT_AVAILABLE="4",n.UNKNOWN="5"})(r.AppleExpirationIntent||(r.AppleExpirationIntent={}))})(e.VerifyReceipt||(e.VerifyReceipt={}))})(t.AppleAppStore||(t.AppleAppStore={}))})(E||(E={}));var E;(function(t){(function(e){class r extends t.Receipt{constructor(u,d,h){var f,m,y;super(t.Platform.BRAINTREE,h);const v=new t.Transaction(t.Platform.BRAINTREE,this,h);v.purchaseDate=new Date,v.products=((f=u.items)===null||f===void 0?void 0:f.filter(w=>w).map(w=>({id:(w==null?void 0:w.id)||""})))||[],v.state=t.TransactionState.APPROVED,v.transactionId=(y=(m=d.paymentMethodNonce)===null||m===void 0?void 0:m.nonce)!==null&&y!==void 0?y:`UNKNOWN_${d.paymentMethodType}_${d.paymentDescription}`,this.transactions=[v],this.dropInResult=d,this.paymentRequest=u,this.refresh(u,d,h)}refresh(u,d,h){var f,m;this.dropInResult=d,this.paymentRequest=u;const y=new t.Transaction(t.Platform.BRAINTREE,this,h);y.products=u.items.filter(v=>v).map(v=>({id:(v==null?void 0:v.id)||""})),y.state=t.TransactionState.APPROVED,y.transactionId=(m=(f=d.paymentMethodNonce)===null||f===void 0?void 0:f.nonce)!==null&&m!==void 0?m:`UNKNOWN_${d.paymentMethodType}_${d.paymentDescription}`,y.amountMicros=u.amountMicros,y.currency=u.currency,this.transactions=[y]}}e.BraintreeReceipt=r;class n{constructor(u,d){this.id=t.Platform.BRAINTREE,this.name="BrainTree",this.ready=!1,this.products=[],this._receipts=[],this.supportsParallelLoading=!1,this.context=u,this.log=u.log.child("Braintree"),this.options=d}get receipts(){return this._receipts}get isSupported(){return e.IosBridge.Bridge.isSupported()||e.AndroidBridge.Bridge.isSupported()}initialize(){return new Promise(u=>{if(this.log.info("initialize()"),e.IosBridge.Bridge.isSupported())this.log.info("instantiating ios bridge..."),this.iosBridge=new e.IosBridge.Bridge(this.log,d=>{this.options.tokenizationKey?d(this.options.tokenizationKey):this.options.clientTokenProvider?this.options.clientTokenProvider(d):d(l(t.ErrorCode.CLIENT_INVALID,"Braintree iOS Bridge requires a clientTokenProvider or tokenizationKey"))},this.options.applePay),this.iosBridge.initialize(this.context,u);else if(e.AndroidBridge.Bridge.isSupported()&&!this.androidBridge){this.log.info("instantiating android bridge..."),this.androidBridge=new e.AndroidBridge.Bridge(this.log),this.log.info("calling android bridge -> initialize...");const d=this.options.tokenizationKey?this.options.tokenizationKey:this.options.clientTokenProvider?this.options.clientTokenProvider:"";this.androidBridge.initialize(d,u)}else this.log.info("platform not supported..."),u(void 0);this.context.listener.receiptsReady(t.Platform.BRAINTREE)})}loadProducts(u){return A(this,void 0,void 0,function*(){return u.map(d=>l(t.ErrorCode.PRODUCT_NOT_AVAILABLE,"N/A"))})}loadReceipts(){return A(this,void 0,void 0,function*(){return this.context.listener.receiptsReady(t.Platform.BRAINTREE),[]})}order(u){return A(this,void 0,void 0,function*(){return l(t.ErrorCode.UNKNOWN,"N/A: Not implemented with Braintree")})}finish(u){return A(this,void 0,void 0,function*(){u.state=t.TransactionState.FINISHED,this.context.listener.receiptsUpdated(t.Platform.TEST,[u.parentReceipt])})}manageSubscriptions(){return A(this,void 0,void 0,function*(){this.log.info("N/A: manageSubscriptions() is not available with Braintree")})}manageBilling(){return A(this,void 0,void 0,function*(){this.log.info("N/A: manageBilling() is not available with Braintree")})}launchDropIn(u,d){return A(this,void 0,void 0,function*(){return this.androidBridge?this.androidBridge.launchDropIn(d):this.iosBridge?this.iosBridge.launchDropIn(u,d):l(t.ErrorCode.PURCHASE,"Braintree is not available")})}requestPayment(u,d){var h,f,m,y,v,w,p,g,_;return A(this,void 0,void 0,function*(){this.log.info("requestPayment()"+JSON.stringify(u));const S=((h=d==null?void 0:d.braintree)===null||h===void 0?void 0:h.dropInRequest)||{};if((yield e.IosBridge.ApplePayPlugin.isSupported(this.log))||(this.log.info("Apple Pay is not supported."),S.applePayDisabled=!0),this.options.googlePay||S.googlePayRequest){const I=Object.assign(Object.assign({},(f=this.options.googlePay)!==null&&f!==void 0?f:{}),(m=S.googlePayRequest)!==null&&m!==void 0?m:{});I.transactionInfo||(I.transactionInfo={currencyCode:(y=u.currency)!==null&&y!==void 0?y:"",totalPrice:((v=u.amountMicros)!==null&&v!==void 0?v:0)/1e6,totalPriceStatus:e.GooglePay.TotalPriceStatus.FINAL}),S.googlePayRequest=I}if(this.options.threeDSecure||S.threeDSecureRequest){const I=Object.assign(Object.assign({},(w=this.options.threeDSecure)!==null&&w!==void 0?w:{}),(p=S.threeDSecureRequest)!==null&&p!==void 0?p:{});I.amount||(I.amount=i((g=u.amountMicros)!==null&&g!==void 0?g:0)),!I.billingAddress&&u.billingAddress&&(I.billingAddress={givenName:u.billingAddress.givenName,surname:u.billingAddress.surname,countryCodeAlpha2:u.billingAddress.countryCode,postalCode:u.billingAddress.postalCode,locality:u.billingAddress.locality,streetAddress:u.billingAddress.streetAddress1,extendedAddress:u.billingAddress.streetAddress2,line3:u.billingAddress.streetAddress3,phoneNumber:u.billingAddress.phoneNumber,region:u.billingAddress.region}),I.email||(I.email=u.email),S.threeDSecureRequest=I}const R=yield this.launchDropIn(u,S);if(!o(R))return a(this.log,R);const x=R;if(this.log.info("launchDropIn success: "+JSON.stringify({paymentRequest:u,dropInResult:x})),!(!((_=x.paymentMethodNonce)===null||_===void 0)&&_.nonce))return l(t.ErrorCode.BAD_RESPONSE,"launchDropIn returned no paymentMethodNonce");let T=this._receipts.find(I=>{var N,M;return((N=I.dropInResult.paymentMethodNonce)===null||N===void 0?void 0:N.nonce)===((M=x.paymentMethodNonce)===null||M===void 0?void 0:M.nonce)});return T?T.refresh(u,x,this.context.apiDecorators):(T=new r(u,x,this.context.apiDecorators),this.receipts.push(T)),this.context.listener.receiptsUpdated(t.Platform.BRAINTREE,[T]),T.transactions[0]})}receiptValidationBody(u){var d,h,f,m,y;return A(this,void 0,void 0,function*(){if(!s(u)){this.log.error("Unexpected error, expecting a BraintreeReceipt: "+JSON.stringify(u));return}return this.log.info("create receiptValidationBody for: "+JSON.stringify(u)),{id:(f=(h=(d=u.paymentRequest.items)===null||d===void 0?void 0:d[0])===null||h===void 0?void 0:h.id)!==null&&f!==void 0?f:"unknown",type:t.ProductType.CONSUMABLE,priceMicros:u.paymentRequest.amountMicros,currency:u.paymentRequest.currency,products:[],transaction:{type:t.Platform.BRAINTREE,deviceData:u.dropInResult.deviceData,id:"nonce",paymentMethodNonce:(y=(m=u.dropInResult.paymentMethodNonce)===null||m===void 0?void 0:m.nonce)!==null&&y!==void 0?y:"",paymentDescription:u.dropInResult.paymentDescription,paymentMethodType:u.dropInResult.paymentMethodType}}})}handleReceiptValidationResponse(u,d){var h;return A(this,void 0,void 0,function*(){if(this.log.info("receipt validation response: "+JSON.stringify(d)),d!=null&&d.data&&"transaction"in d.data&&d.data.transaction.type==="braintree"){const f=(h=d.data.transaction.data.transaction)===null||h===void 0?void 0:h.customer.id;f&&!e.customerId&&(this.log.info("customerId updated: "+f),e.customerId=f)}})}checkSupport(u){return u==="requestPayment"}restorePurchases(){return A(this,void 0,void 0,function*(){})}}e.Adapter=n;function i(c){const u=""+c/1e4;return(u.slice(0,-2)||"0")+"."+(u.slice(-2,-1)||"0")+(u.slice(-1)||"0")}function s(c){return c.platform===t.Platform.BRAINTREE}const o=c=>!!c&&!("code"in c&&"message"in c),a=(c,u)=>{if(u){if(u.code===t.ErrorCode.PAYMENT_CANCELLED){c.info("User cancelled the payment request");return}return c.warn("launchDropIn failed: "+JSON.stringify(u)),u}else return c.warn("launchDropIn failed: no response"),l(t.ErrorCode.BAD_RESPONSE,"Braintree failed to launch drop in")};function l(c,u){return t.storeError(c,u,t.Platform.BRAINTREE,null)}e.braintreeError=l})(t.Braintree||(t.Braintree={}))})(E||(E={}));var E;(function(t){(function(e){const r="BraintreePlugin";(function(n){class i{constructor(o){this.log=o.child("AndroidBridge")}listener(o){this.log.debug("listener: "+JSON.stringify(o)),!(!o||!o.type)&&(o.type==="getClientToken"?this.getClientToken():o.type)}initialize(o,a){try{if(typeof o=="string"){const c=o;this.clientTokenProvider=u=>{u(c)}}else this.clientTokenProvider=o;this.log.info("exec.setListener()");const l=this.listener.bind(this);window.cordova.exec(l,null,r,"setListener",[]),a(void 0)}catch(l){this.log.warn("initialization failed: "+(l==null?void 0:l.message)),a(e.braintreeError(t.ErrorCode.SETUP,"Failed to initialize Braintree Android Bridge: "+(l==null?void 0:l.message)))}}getClientToken(){this.log.info("getClientToken()"),this.clientTokenProvider?(this.log.debug("clientTokenProvider set, calling."),this.clientTokenProvider(o=>{typeof o=="string"?window.cordova.exec(null,null,r,"onClientTokenSuccess",[o]):window.cordova.exec(null,null,r,"onClientTokenFailure",[o.code,o.message])})):(this.log.debug("clientTokenProvider not set, retrying later..."),setTimeout(()=>this.getClientToken(),1e3))}static isSupported(){return t.Utils.platformId()==="android"}isApplePaySupported(){return A(this,void 0,void 0,function*(){return!1})}launchDropIn(o){return new Promise(a=>{window.cordova.exec(l=>{this.log.info("dropInSuccess: "+JSON.stringify(l)),a(l)},l=>{this.log.info("dropInFailure: "+l);const c=l.split("|")[0],u=l.split("|").slice(1).join("");a(c==="UserCanceledException"?e.braintreeError(t.ErrorCode.PAYMENT_CANCELLED,u):c==="AuthorizationException"?e.braintreeError(t.ErrorCode.UNAUTHORIZED_REQUEST_DATA,u):e.braintreeError(t.ErrorCode.UNKNOWN,l))},r,"launchDropIn",[o])})}}n.Bridge=i})(e.AndroidBridge||(e.AndroidBridge={}))})(t.Braintree||(t.Braintree={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){const n="BraintreeApplePayPlugin";class i{static get(){return window.CdvPurchaseBraintreeApplePay}static requestPayment(o){return new Promise(a=>{var l;if(!((l=i.get())===null||l===void 0)&&l.installed){const c=d=>{a(d)},u=d=>{const h=d??"payment request failed";a(e.braintreeError(t.ErrorCode.PURCHASE,"Braintree+ApplePay ERROR: "+h))};window.cordova.exec(c,u,n,"presentDropInPaymentUI",[o])}else return a(e.braintreeError(t.ErrorCode.SETUP,"cordova-plugin-purchase-braintree-applepay does not appear to be installed."))})}static isSupported(o){return new Promise(a=>{var l;if(t.Utils.platformId()!=="ios")return o.info("BraintreeApplePayPlugin is only available for ios."),a(!1);if(!(!((l=i.get())===null||l===void 0)&&l.installed))return o.info("BraintreeApplePayPlugin does not appear to be installed."),a(!1);try{window.cordova.exec(c=>{a(c)},()=>{o.info("BraintreeApplePayPlugin is not available."),a(!1)},n,"isApplePaySupported",[])}catch{o.info("BraintreeApplePayPlugin is not installed."),a(!1)}})}}r.ApplePayPlugin=i})(e.IosBridge||(e.IosBridge={}))})(t.Braintree||(t.Braintree={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){class n{constructor(s,o,a){this.log=s.child("IosBridge"),this.clientTokenProvider=o,this.applePayOptions=a}initialize(s,o){window.cordova.exec(null,null,"BraintreePlugin","setVerbosity",[s.verbosity]),window.cordova.exec(a=>this.log.debug("(Native) "+a),null,"BraintreePlugin","setLogger",[]),setTimeout(()=>o(void 0),0)}continueDropInForApplePay(s,o,a){var l,c,u,d,h,f,m,y,v;return A(this,void 0,void 0,function*(){const w=((c=(l=this.applePayOptions)===null||l===void 0?void 0:l.preparePaymentRequest)===null||c===void 0?void 0:c.call(l,s))||{merchantCapabilities:[t.ApplePay.MerchantCapability.ThreeDS]};if(!w.paymentSummaryItems){const g=s.items.filter(S=>S).map((S,R)=>{var x,T,I;return{type:"final",label:(S==null?void 0:S.title)||(S==null?void 0:S.id)||`Item #${R+1}`,amount:`${Math.round(((I=(T=(x=S==null?void 0:S.pricing)===null||x===void 0?void 0:x.priceMicros)!==null&&T!==void 0?T:s.amountMicros)!==null&&I!==void 0?I:0)/1e4)/100}`}}),_={type:"final",label:(d=(u=this.applePayOptions)===null||u===void 0?void 0:u.companyName)!==null&&d!==void 0?d:"Total",amount:`${Math.round(((h=s.amountMicros)!==null&&h!==void 0?h:0)/1e4)/100}`};w.paymentSummaryItems=[...g,_]}const p=yield r.ApplePayPlugin.requestPayment(w);return this.log.info("Result from Apple Pay: "+JSON.stringify(p)),"isError"in p?p:p.userCancelled?e.braintreeError(t.ErrorCode.PAYMENT_CANCELLED,"User cancelled the payment request"):{paymentMethodNonce:{isDefault:!1,nonce:(m=(f=p.applePayCardNonce)===null||f===void 0?void 0:f.nonce)!==null&&m!==void 0?m:"",type:(v=(y=p.applePayCardNonce)===null||y===void 0?void 0:y.type)!==null&&v!==void 0?v:""},paymentMethodType:a.paymentMethodType,deviceData:a.deviceData,paymentDescription:a.paymentDescription}})}launchDropIn(s,o){return new Promise(a=>A(this,void 0,void 0,function*(){const l=u=>{this.log.info("dropInSuccess: "+JSON.stringify(u)),u.paymentMethodType===e.DropIn.PaymentMethod.APPLE_PAY?(this.log.info("it's an ApplePay request, we have to process it."),this.continueDropInForApplePay(s,o,u).then(a)):a(u)},c=u=>{this.log.info("dropInFailure: "+u);const[d,h]=u.split("|");a(d==="UserCanceledException"?e.braintreeError(t.ErrorCode.PAYMENT_CANCELLED,h):e.braintreeError(t.ErrorCode.UNKNOWN,"ERROR "+d+": "+h))};this.clientTokenProvider(u=>{typeof u=="string"?window.cordova.exec(l,c,"BraintreePlugin","launchDropIn",[u,o]):a(u)})}))}braintreePlugin(){return window.CdvPurchaseBraintree}static isSupported(){return t.Utils.platformId()==="ios"}}r.Bridge=n})(e.IosBridge||(e.IosBridge={}))})(t.Braintree||(t.Braintree={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){(function(n){n[n.DISABLED=0]="DISABLED",n[n.OPTIONAL=1]="OPTIONAL",n[n.REQUIRED=2]="REQUIRED"})(r.CardFormFieldStatus||(r.CardFormFieldStatus={}))})(e.DropIn||(e.DropIn={}))})(t.Braintree||(t.Braintree={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){(function(n){n.GOOGLE_PAY="GOOGLE_PAY",n.LASER="LASER",n.UK_MAESTRO="UK_MAESTRO",n.SWITCH="SWITCH",n.SOLOR="SOLO",n.APPLE_PAY="APPLE_PAY",n.AMEX="AMEX",n.DINERS_CLUB="DINERS_CLUB",n.DISCOVER="DISCOVER",n.JCB="JCB",n.MAESTRO="MAESTRO",n.MASTERCARD="MASTERCARD",n.PAYPAL="PAYPAL",n.VISA="VISA",n.VENMO="VENMO",n.UNIONPAY="UNIONPAY",n.HIPER="HIPER",n.HIPERCARD="HIPERCARD",n.UNKNOWN="UNKNOWN"})(r.PaymentMethod||(r.PaymentMethod={}))})(e.DropIn||(e.DropIn={}))})(t.Braintree||(t.Braintree={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){(function(n){n[n.MIN=0]="MIN",n[n.FULL=1]="FULL"})(r.BillingAddressFormat||(r.BillingAddressFormat={})),function(n){n[n.NOT_CURRENTLY_KNOWN=1]="NOT_CURRENTLY_KNOWN",n[n.ESTIMATED=2]="ESTIMATED",n[n.FINAL=3]="FINAL"}(r.TotalPriceStatus||(r.TotalPriceStatus={}))})(e.GooglePay||(e.GooglePay={}))})(t.Braintree||(t.Braintree={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){(function(n){n.UNSPECIFIED="00",n.CREDIT="01",n.DEBIT="02"})(r.AccountType||(r.AccountType={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.SAME_DAY=1]="SAME_DAY",n[n.EXPEDITED=2]="EXPEDITED",n[n.PRIORITY=3]="PRIORITY",n[n.GROUND=4]="GROUND",n[n.ELECTRONIC_DELIVERY=5]="ELECTRONIC_DELIVERY",n[n.SHIP_TO_STORE=6]="SHIP_TO_STORE"}(r.ShippingMethod||(r.ShippingMethod={})),function(n){n[n.V1=0]="V1",n[n.V2=1]="V2"}(r.Version||(r.Version={}))})(e.ThreeDSecure||(e.ThreeDSecure={}))})(t.Braintree||(t.Braintree={}))})(E||(E={}));var E;(function(t){(function(e){class r extends t.Transaction{constructor(a,l,c){super(t.Platform.GOOGLE_PLAY,l,c),this.nativePurchase=a,this.refresh(a,!0)}static toState(a,l,c,u){switch(l){case e.Bridge.PurchaseState.PENDING:return t.TransactionState.INITIATED;case e.Bridge.PurchaseState.PURCHASED:return u?t.TransactionState.FINISHED:c?t.TransactionState.APPROVED:a?t.TransactionState.INITIATED:t.TransactionState.APPROVED;case e.Bridge.PurchaseState.UNSPECIFIED_STATE:return t.TransactionState.UNKNOWN_STATE}}refresh(a,l){var c,u;if(this.nativePurchase=a,this.transactionId=`${a.orderId||a.purchaseToken}`,this.purchaseId=`${a.purchaseToken}`,this.products=a.productIds.map(d=>({id:d})),a.purchaseTime&&(this.purchaseDate=new Date(a.purchaseTime)),this.isPending=a.getPurchaseState===e.Bridge.PurchaseState.PENDING,typeof a.acknowledged<"u"&&(this.isAcknowledged=a.acknowledged),typeof a.consumed<"u"&&(this.isConsumed=a.consumed),typeof a.autoRenewing<"u"&&(this.renewalIntent=a.autoRenewing?t.RenewalIntent.RENEW:t.RenewalIntent.LAPSE),typeof a.quantity<"u"&&(this.quantity=a.quantity),a.expiryTimeMillis){const d=parseInt(a.expiryTimeMillis,10);isNaN(d)||(this.expirationDate=new Date(d))}this.state=r.toState(l??!1,a.getPurchaseState,(c=this.isAcknowledged)!==null&&c!==void 0?c:!1,(u=this.isConsumed)!==null&&u!==void 0?u:!1)}removed(){this.renewalIntent?this.expirationDate=new Date(Date.now()-t.Internal.ExpiryMonitor.GRACE_PERIOD_MS[t.Platform.GOOGLE_PLAY]):this.isConsumed=!0,this.state=t.TransactionState.CANCELLED}}e.Transaction=r;class n extends t.Receipt{constructor(a,l){super(t.Platform.GOOGLE_PLAY,l),this.transactions=[new r(a,this,l)],this.purchaseToken=a.purchaseToken,this.orderId=a.orderId}refreshPurchase(a){var l;(l=this.transactions[0])===null||l===void 0||l.refresh(a),this.orderId=a.orderId}removed(){this.transactions.forEach(a=>a==null?void 0:a.removed())}}e.Receipt=n;class i{constructor(a,l=1e3*3600*24){if(this.id=t.Platform.GOOGLE_PLAY,this.name="GooglePlay",this.ready=!1,this.supportsParallelLoading=!1,this.canSkipFinish=!0,this._receipts=[],this.bridge=new e.Bridge.Bridge,this.initialized=!1,this.retry=new t.Internal.Retry,this.autoRefreshIntervalMillis=0,this.refreshSchedule={},i._instance)throw new Error("GooglePlay adapter already initialized");this._products=new e.Products(a.apiDecorators),this.autoRefreshIntervalMillis=l,this.context=a,this.log=a.log.child("GooglePlay"),i._instance=this}get products(){return this._products.products}get receipts(){return this._receipts}get isSupported(){return t.Utils.platformId()==="android"}initialize(){return A(this,void 0,void 0,function*(){return this.log.info("Initialize"),this.initializationPromise?this.initializationPromise:this.initializationPromise=new Promise(a=>{const l=this.log.child("Bridge"),c={onSetPurchases:this.onSetPurchases.bind(this),onPurchasesUpdated:this.onPurchasesUpdated.bind(this),onPurchaseConsumed:this.onPurchaseConsumed.bind(this),showLog:this.context.verbosity>=t.LogLevel.DEBUG,log:h=>l.info(h)},u=()=>{this.log.debug("Ready"),this.autoRefreshIntervalMillis>0&&window.setInterval(()=>this.getPurchases(),this.autoRefreshIntervalMillis),a(void 0)},d=h=>{this.initialized=!1,this.context.error(s(t.ErrorCode.SETUP,"Init failed - "+h,null)),this.retry.retry(()=>this.initialize())};this.bridge.init(u,d,c)})})}getSkusOf(a){const l=[],c=[];for(const u of a)u.type===t.ProductType.PAID_SUBSCRIPTION?c.push(u.id):l.push(u.id);return{inAppSkus:l,subsSkus:c}}loadReceipts(){return new Promise(a=>{this.getPurchases().then(l=>{a(this._receipts)})})}loadProducts(a){return new Promise(l=>{this.log.debug("Load: "+JSON.stringify(a));const c=d=>{if(this.log.debug("Loaded: "+JSON.stringify(d)),!Array.isArray(d)){const f=`Invalid product list received: ${JSON.stringify(d)}, retrying later...`;this.log.warn(f),this.retry.retry(u),this.context.error(s(t.ErrorCode.LOAD,f,null));return}const h=a.map(f=>{const m=d.find(y=>y.productId===f.id);return m&&m.productId?this._products.addProduct(f,m):s(t.ErrorCode.INVALID_PRODUCT_ID,`Product with id ${f.id} not found.`,f.id)});l(h)},u=()=>{const{inAppSkus:d,subsSkus:h}=this.getSkusOf(a);this.log.debug("getAvailableProducts: "+JSON.stringify(d)+" | "+JSON.stringify(h)),this.bridge.getAvailableProducts(d,h,c,f=>{this.retry.retry(u),this.context.error(s(t.ErrorCode.LOAD,"Loading product info failed - "+f+" - retrying later...",null))})};u()})}finish(a){return new Promise(l=>{const c=()=>{a.state!==t.TransactionState.FINISHED&&(a.state=t.TransactionState.FINISHED,this.context.listener.receiptsUpdated(t.Platform.GOOGLE_PLAY,[a.parentReceipt])),l(void 0)},u=a.products[0];if(!u)return l(s(t.ErrorCode.FINISH,"Cannot finish a transaction with no product",null));const d=this._products.getProduct(u.id);if(!d)return l(s(t.ErrorCode.FINISH,"Cannot finish transaction, unknown product "+u.id,u.id));const h=this._receipts.find(m=>m.hasTransaction(a));if(!h)return l(s(t.ErrorCode.FINISH,"Cannot finish transaction, linked receipt not found.",d.id));if(!h.purchaseToken)return l(s(t.ErrorCode.FINISH,"Cannot finish transaction, linked receipt contains no purchaseToken.",d.id));const f=(m,y)=>l(s(y||t.ErrorCode.UNKNOWN,m,d.id));if(d.type===t.ProductType.NON_RENEWING_SUBSCRIPTION||d.type===t.ProductType.CONSUMABLE){if(!a.isConsumed)return this.bridge.consumePurchase(c,f,h.purchaseToken)}else if(!a.isAcknowledged)return this.bridge.acknowledgePurchase(c,f,h.purchaseToken);l(void 0)})}onPurchaseConsumed(a){this.log.debug("onPurchaseConsumed: "+a.orderId),a.acknowledged=!0,a.consumed=!0,this.onPurchasesUpdated([a])}scheduleRefreshForSubscription(a){if(!a.purchaseToken)return;const l=this.refreshSchedule[a.purchaseToken]||[];l.length===0&&(this.refreshSchedule[a.purchaseToken]=l),[i.REFRESH_INTERVALS.SANDBOX,i.REFRESH_INTERVALS.PRODUCTION].forEach(u=>{const d=a.purchaseTime+u;if(l.find(f=>f.refreshTime===d)||d<Date.now())return;this.log.debug(`Scheduling refresh for purchase token ${a.purchaseToken} at ${new Date(d).toISOString()}`);const h=window.setTimeout(()=>{this.log.debug(`Executing scheduled refresh for purchase token ${a.purchaseToken}`),delete this.refreshSchedule[a.purchaseToken],this.getPurchases().catch(f=>{this.log.warn(`Failed scheduled refresh: ${f}`)})},d-Date.now());l.push({timeoutId:h,refreshTime:d})})}scheduleRefreshesForSubscriptions(a){for(const l of a){if(l.autoRenewing!==!1)continue;const c=l.productIds[0],u=c?this._products.getProduct(c):void 0;!u||u.type!==t.ProductType.PAID_SUBSCRIPTION||l.expiryTimeMillis||this.scheduleRefreshForSubscription(l)}}onSetPurchases(a){this.log.debug("onSetPurchases: "+JSON.stringify(a)),this.onPurchasesUpdated(a),this.context.listener.receiptsReady(t.Platform.GOOGLE_PLAY),this.scheduleRefreshesForSubscriptions(a)}onPurchasesUpdated(a){this.log.debug("onPurchaseUpdated: "+a.map(c=>c.orderId).join(", "));const l=this.receipts.filter(c=>!a.find(u=>u.purchaseToken===c.purchaseToken));l.length>0&&(this.log.debug("Removed purchases: "+l.map(c=>c.purchaseToken).join(", ")),l.forEach(c=>c.removed())),a.forEach(c=>{var u;const d=this.receipts.find(h=>h.purchaseToken===c.purchaseToken);if(d){const h=d.transactions[0];if(h){const f=(u=h.products[0])===null||u===void 0?void 0:u.id;if(f){const m=this._products.getProduct(f);if(m&&m.type===t.ProductType.PAID_SUBSCRIPTION&&c.getPurchaseState===e.Bridge.PurchaseState.PURCHASED&&c.expiryTimeMillis){const y=parseInt(c.expiryTimeMillis,10);isNaN(y)||(h.expirationDate=new Date(y),this.log.debug(`Updated expirationDate for ${f} to ${h.expirationDate} (autoRenewing: ${c.autoRenewing})`))}}}d.refreshPurchase(c),this.context.listener.receiptsUpdated(t.Platform.GOOGLE_PLAY,[d])}else{const h=new n(c,this.context.apiDecorators);this.receipts.push(h),this.context.listener.receiptsUpdated(t.Platform.GOOGLE_PLAY,[h]),h.transactions[0].state===t.TransactionState.INITIATED&&!h.transactions[0].isPending&&(h.refreshPurchase(c),this.context.listener.receiptsUpdated(t.Platform.GOOGLE_PLAY,[h]))}})}onPriceChangeConfirmationResult(a){}getPurchases(){return new Promise(a=>{this.log.debug("getPurchases");const l=()=>{this.log.debug("getPurchases success"),setTimeout(()=>a(void 0),0)},c=(u,d)=>{this.log.warn("getPurchases failed: "+u+" ("+d+")"),setTimeout(()=>a(s(d||t.ErrorCode.UNKNOWN,u,null)),0)};this.bridge.getPurchases(l,c)})}order(a,l){return A(this,void 0,void 0,function*(){return new Promise(c=>{this.log.info("Order - "+JSON.stringify(a));const u=()=>c(void 0),d=(h,f)=>{this.log.warn("Order failed: "+JSON.stringify({message:h,code:f})),c(s(f??t.ErrorCode.UNKNOWN,h,a.productId))};if(a.productType===t.ProductType.PAID_SUBSCRIPTION){const h="token"in a?a.productId+"@"+a.token:a.productId,f=this.findOldPurchaseToken(a.productId,a.productGroup);f&&(l.googlePlay?l.googlePlay.oldPurchaseToken||(l.googlePlay.oldPurchaseToken=f):l.googlePlay={oldPurchaseToken:f}),this.bridge.subscribe(u,d,h,l)}else this.bridge.buy(u,d,a.productId,l)})})}findOldPurchaseToken(a,l){if(!l)return;const c=this._receipts.find(u=>!!u.transactions.find(d=>!!d.products.find(h=>{const f=this._products.getProduct(h.id);return!f||!t.Internal.LocalReceipts.isOwned([u],f)?!1:h.id===a||l&&f.group===l})));return c==null?void 0:c.purchaseToken}receiptValidationBody(a){var l;return A(this,void 0,void 0,function*(){const c=a.transactions[0];if(!c)return;const u=(l=c.products[0])===null||l===void 0?void 0:l.id;if(!u)return;const d=this._products.getProduct(u);if(!d)return;const h=c.nativePurchase;return{id:u,type:d.type,offers:d.offers,products:this._products.products,transaction:{type:t.Platform.GOOGLE_PLAY,id:a.transactions[0].transactionId,purchaseToken:h.purchaseToken,signature:h.signature,receipt:h.receipt}}})}handleReceiptValidationResponse(a,l){var c;return A(this,void 0,void 0,function*(){if(l!=null&&l.ok){const u=(c=l==null?void 0:l.data)===null||c===void 0?void 0:c.transaction;if((u==null?void 0:u.type)!==t.Platform.GOOGLE_PLAY)return;switch(u.kind){}}})}requestPayment(a,l){return A(this,void 0,void 0,function*(){return s(t.ErrorCode.UNKNOWN,"requestPayment not supported",null)})}manageSubscriptions(){return A(this,void 0,void 0,function*(){this.bridge.manageSubscriptions()})}manageBilling(){return A(this,void 0,void 0,function*(){this.bridge.manageBilling()})}checkSupport(a){return["order","manageBilling","manageSubscriptions"].indexOf(a)>=0}restorePurchases(){return new Promise(a=>{this.bridge.getPurchases(()=>a(void 0),(l,c)=>{this.log.warn("getPurchases() failed: "+(c??"ERROR")+": "+l),a(s(c??t.ErrorCode.UNKNOWN,l,null))})})}}i.trimProductTitles=!0,i.REFRESH_INTERVALS={SANDBOX:6*60*1e3,PRODUCTION:7*24*60*60*1e3+10*60*1e3},e.Adapter=i;function s(o,a,l){return t.storeError(o,a,t.Platform.GOOGLE_PLAY,l)}})(t.GooglePlay||(t.GooglePlay={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){(function(n){n.FINITE_RECURRING="FINITE_RECURRING",n.INFINITE_RECURRING="INFINITE_RECURRING",n.NON_RECURRING="NON_RECURRING"})(r.RecurrenceMode||(r.RecurrenceMode={}))})(e.Bridge||(e.Bridge={}))})(t.GooglePlay||(t.GooglePlay={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){r.IMMEDIATE_WITH_TIME_PRORATION="IMMEDIATE_WITH_TIME_PRORATION",r.IMMEDIATE_AND_CHARGE_PRORATED_PRICE="IMMEDIATE_AND_CHARGE_PRORATED_PRICE",r.IMMEDIATE_WITHOUT_PRORATION="IMMEDIATE_WITHOUT_PRORATION",r.DEFERRED="DEFERRED",r.IMMEDIATE_AND_CHARGE_FULL_PRICE="IMMEDIATE_AND_CHARGE_FULL_PRICE"})(e.ProrationMode||(e.ProrationMode={})),function(r){r.WITH_TIME_PRORATION="IMMEDIATE_WITH_TIME_PRORATION",r.CHARGE_PRORATED_PRICE="IMMEDIATE_AND_CHARGE_PRORATED_PRICE",r.WITHOUT_PRORATION="IMMEDIATE_WITHOUT_PRORATION",r.DEFERRED="DEFERRED",r.CHARGE_FULL_PRICE="IMMEDIATE_AND_CHARGE_FULL_PRICE"}(e.ReplacementMode||(e.ReplacementMode={})),function(r){let n=function(c){console.log("InAppBilling[js]: "+c)};(function(l){l[l.UNSPECIFIED_STATE=0]="UNSPECIFIED_STATE",l[l.PURCHASED=1]="PURCHASED",l[l.PENDING=2]="PENDING"})(r.PurchaseState||(r.PurchaseState={}));class i{constructor(){this.options={}}init(c,u,d){d||(d={}),d.log&&(n=d.log),this.options={showLog:d.showLog!==!1,onPurchaseConsumed:d.onPurchaseConsumed,onPurchasesUpdated:d.onPurchasesUpdated,onSetPurchases:d.onSetPurchases},this.options.showLog&&n("setup ok");const h=this.listener.bind(this);window.cordova.exec(h,function(f){},"InAppBillingPlugin","setListener",[]),window.cordova.exec(c,s(u),"InAppBillingPlugin","init",[])}load(c,u,d,h,f){if(typeof d<"u"&&(typeof d=="string"&&(d=[d]),d.length>0)){if(typeof d[0]!="string"){var m="invalid productIds: "+JSON.stringify(d);this.options.showLog&&n(m),u(m,t.ErrorCode.INVALID_PRODUCT_ID);return}this.options.showLog&&n("load "+JSON.stringify(d))}window.cordova.exec(c,s(u),"InAppBillingPlugin","load",[d,h,f])}listener(c){this.options.showLog&&n("listener: "+JSON.stringify(c)),!(!c||!c.type)&&(c.type==="setPurchases"&&this.options.onSetPurchases&&this.options.onSetPurchases(c.data.purchases),c.type==="purchasesUpdated"&&this.options.onPurchasesUpdated&&this.options.onPurchasesUpdated(c.data.purchases),c.type==="purchaseConsumed"&&this.options.onPurchaseConsumed&&this.options.onPurchaseConsumed(c.data.purchase),c.type==="onPriceChangeConfirmationResultOK"&&this.options.onPriceChangeConfirmationResult&&this.options.onPriceChangeConfirmationResult("OK"),c.type==="onPriceChangeConfirmationResultUserCanceled"&&this.options.onPriceChangeConfirmationResult&&this.options.onPriceChangeConfirmationResult("UserCanceled"),c.type==="onPriceChangeConfirmationResultUnknownSku"&&this.options.onPriceChangeConfirmationResult&&this.options.onPriceChangeConfirmationResult("UnknownProduct"))}getPurchases(c,u){return this.options.showLog&&n("getPurchases()"),window.cordova.exec(c,s(u),"InAppBillingPlugin","getPurchases",["null"])}buy(c,u,d,h){return this.options.showLog&&n("buy()"),window.cordova.exec(c,s(u),"InAppBillingPlugin","buy",[d,a(h)])}subscribe(c,u,d,h){var f;return this.options.showLog&&n("subscribe()"),!((f=h.googlePlay)===null||f===void 0)&&f.oldPurchaseToken&&this.options.showLog&&n("subscribe() -> upgrading from an old purchase"),window.cordova.exec(c,s(u),"InAppBillingPlugin","subscribe",[d,a(h)])}consumePurchase(c,u,d){return this.options.showLog&&n("consumePurchase()"),window.cordova.exec(c,s(u),"InAppBillingPlugin","consumePurchase",[d])}acknowledgePurchase(c,u,d){return this.options.showLog&&n("acknowledgePurchase()"),window.cordova.exec(c,s(u),"InAppBillingPlugin","acknowledgePurchase",[d])}getAvailableProducts(c,u,d,h){return this.options.showLog&&n("getAvailableProducts()"),window.cordova.exec(d,s(h),"InAppBillingPlugin","getAvailableProducts",[c,u])}manageSubscriptions(){return window.cordova.exec(function(){},function(){},"InAppBillingPlugin","manageSubscriptions",[])}manageBilling(){return window.cordova.exec(function(){},function(){},"InAppBillingPlugin","manageBilling",[])}launchPriceChangeConfirmationFlow(c){return window.cordova.exec(function(){},function(){},"InAppBillingPlugin","launchPriceChangeConfirmationFlow",[c])}}r.Bridge=i;function s(l){return function(c){if(!l)return;const u=typeof c=="string"?c.split("|"):[];if(u.length>1&&/^[-+]?(\d+)$/.test(u[0])){var d=u[0],h=u[1];l(h,+d)}else l(c)}}function o(l){return l&&l.constructor===Object?l:{}}function a(l){const c=o(l==null?void 0:l.googlePlay);return!c.accountId&&(l!=null&&l.applicationUsername)&&(c.accountId=t.Utils.md5(l.applicationUsername)),c}}(e.Bridge||(e.Bridge={}))})(t.GooglePlay||(t.GooglePlay={}))})(E||(E={}));var E;(function(t){(function(e){class r extends t.Product{}e.GProduct=r;class n extends t.Offer{constructor(){super(...arguments),this.type="inapp"}}e.InAppOffer=n;class i extends t.Offer{constructor(a,l){super(a,l),this.type="subs",this.tags=a.tags,this.token=a.token}}e.SubscriptionOffer=i;class s{constructor(a){this.products=[],this.offers=[],this.decorator=a}getProduct(a){return this.products.find(l=>l.id===a)}getOffer(a){return this.offers.find(l=>l.id===a)}addProduct(a,l){const c=this.getProduct(a.id),u=c??new r(a,this.decorator);return u.title=l.title||l.name||u.title,e.Adapter.trimProductTitles&&(u.title=u.title.replace(/ \(.*\)$/,"")),u.description=l.description||u.description,"product_format"in l&&l.product_format==="v12.0"?l.product_type==="subs"?this.onSubsV12Loaded(u,l):this.onInAppLoaded(u,l):this.onInAppLoaded(u,l),c||this.products.push(u),u}onSubsV12Loaded(a,l){l.offers.forEach(u=>{const d=u.pricing_phases.slice(-1)[0];if((d==null?void 0:d.recurrence_mode)===t.RecurrenceMode.FINITE_RECURRING){const f=c(u.base_plan_id);f&&f!==u&&u.pricing_phases.push(...f.pricing_phases)}const h=this.iabSubsOfferV12Loaded(a,l,u);a.addOffer(h)});function c(u){if(!u)return null;for(const d of l.offers)if(d.base_plan_id===u&&!d.offer_id)return d;return null}return a}makeOfferId(a,l){return l.base_plan_id?l.offer_id?a+"@"+l.base_plan_id+"@"+l.offer_id:a+"@"+l.base_plan_id:a+"@"+l.token}iabSubsOfferV12Loaded(a,l,c){const u=this.makeOfferId(l.productId,c),d=this.getOffer(u),h=c.pricing_phases.map(f=>this.toPricingPhase(f));if(d)return d.pricingPhases=h,d;{const f=new i({id:u,product:a,pricingPhases:h,token:c.token,tags:c.tags},this.decorator);return this.offers.push(f),f}}onInAppLoaded(a,l){var c,u,d,h;const f=this.getOffer(l.productId),m=[{price:(u=(c=l.formatted_price)!==null&&c!==void 0?c:l.price)!==null&&u!==void 0?u:`${((d=l.price_amount_micros)!==null&&d!==void 0?d:0)/1e6} ${l.price_currency_code}`,priceMicros:(h=l.price_amount_micros)!==null&&h!==void 0?h:0,currency:l.price_currency_code,recurrenceMode:t.RecurrenceMode.NON_RECURRING}];if(f)f.pricingPhases=m,a.offers=[f];else{const y=new n({id:l.productId,product:a,pricingPhases:m},this.decorator);this.offers.push(y),a.offers=[y]}return a}toPaymentMode(a){return a.price_amount_micros===0?t.PaymentMode.FREE_TRIAL:a.recurrence_mode===e.Bridge.RecurrenceMode.NON_RECURRING?t.PaymentMode.UP_FRONT:t.PaymentMode.PAY_AS_YOU_GO}toRecurrenceMode(a){switch(a){case e.Bridge.RecurrenceMode.FINITE_RECURRING:return t.RecurrenceMode.FINITE_RECURRING;case e.Bridge.RecurrenceMode.INFINITE_RECURRING:return t.RecurrenceMode.INFINITE_RECURRING;case e.Bridge.RecurrenceMode.NON_RECURRING:return t.RecurrenceMode.NON_RECURRING}}toPricingPhase(a){return{price:a.formatted_price,priceMicros:a.price_amount_micros,currency:a.price_currency_code,billingPeriod:a.billing_period,billingCycles:a.billing_cycle_count,recurrenceMode:this.toRecurrenceMode(a.recurrence_mode),paymentMode:this.toPaymentMode(a)}}}e.Products=s})(t.GooglePlay||(t.GooglePlay={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){(function(n){n.SUBSCRIPTION_NO_LONGER_AVAILABLE="subscriptionPurchaseNoLongerAvailable",n.PURCHASE_TOKEN_NO_LONGER_VALID="purchaseTokenNoLongerValid"})(r.GoogleErrorReason||(r.GoogleErrorReason={})),function(n){n[n.GONE=410]="GONE"}(r.ErrorCode||(r.ErrorCode={}))})(e.PublisherAPI||(e.PublisherAPI={}))})(t.GooglePlay||(t.GooglePlay={}))})(E||(E={}));var E;(function(t){(function(e){const r="0123456789abcdef".split("");function n(y){for(var v="",w=0;w<4;w++)v+=r[y>>8*w+4&15]+r[y>>8*w&15];return v}function i(y){const v=[];for(var w=y.length,p=0;p<w;p++)v.push(n(y[p]));return v.join("")}function s(y,v){return y+v&4294967295}function o(y,v,w,p,g,_,S){function R(T,I,N){return s(T<<I|T>>>32-I,N)}function x(T,I,N,M){return s(s(I,T),s(N,M))}return R(x(y,v,p,_),g,w)}var a=function(y,v,w,p,g,_,S,R){return o(w&p|~w&g,v,w,_,S,R)},l=function(y,v,w,p,g,_,S,R){return o(w&g|p&~g,v,w,_,S,R)},c=function(y,v,w,p,g,_,S,R){return o(w^p^g,v,w,_,S,R)},u=function(y,v,w,p,g,_,S,R){return o(p^(w|~g),v,w,_,S,R)};function d(y,v,w){w||(w=s);let p=y[0],g=y[1],_=y[2],S=y[3];var R=a.bind(null,w);p=R(p,g,_,S,v[0],7,-680876936),S=R(S,p,g,_,v[1],12,-389564586),_=R(_,S,p,g,v[2],17,606105819),g=R(g,_,S,p,v[3],22,-1044525330),p=R(p,g,_,S,v[4],7,-176418897),S=R(S,p,g,_,v[5],12,1200080426),_=R(_,S,p,g,v[6],17,-1473231341),g=R(g,_,S,p,v[7],22,-45705983),p=R(p,g,_,S,v[8],7,1770035416),S=R(S,p,g,_,v[9],12,-1958414417),_=R(_,S,p,g,v[10],17,-42063),g=R(g,_,S,p,v[11],22,-1990404162),p=R(p,g,_,S,v[12],7,1804603682),S=R(S,p,g,_,v[13],12,-40341101),_=R(_,S,p,g,v[14],17,-1502002290),g=R(g,_,S,p,v[15],22,1236535329);var x=l.bind(null,w);p=x(p,g,_,S,v[1],5,-165796510),S=x(S,p,g,_,v[6],9,-1069501632),_=x(_,S,p,g,v[11],14,643717713),g=x(g,_,S,p,v[0],20,-373897302),p=x(p,g,_,S,v[5],5,-701558691),S=x(S,p,g,_,v[10],9,38016083),_=x(_,S,p,g,v[15],14,-660478335),g=x(g,_,S,p,v[4],20,-405537848),p=x(p,g,_,S,v[9],5,568446438),S=x(S,p,g,_,v[14],9,-1019803690),_=x(_,S,p,g,v[3],14,-187363961),g=x(g,_,S,p,v[8],20,1163531501),p=x(p,g,_,S,v[13],5,-1444681467),S=x(S,p,g,_,v[2],9,-51403784),_=x(_,S,p,g,v[7],14,1735328473),g=x(g,_,S,p,v[12],20,-1926607734);var T=c.bind(null,w);p=T(p,g,_,S,v[5],4,-378558),S=T(S,p,g,_,v[8],11,-2022574463),_=T(_,S,p,g,v[11],16,1839030562),g=T(g,_,S,p,v[14],23,-35309556),p=T(p,g,_,S,v[1],4,-1530992060),S=T(S,p,g,_,v[4],11,1272893353),_=T(_,S,p,g,v[7],16,-155497632),g=T(g,_,S,p,v[10],23,-1094730640),p=T(p,g,_,S,v[13],4,681279174),S=T(S,p,g,_,v[0],11,-358537222),_=T(_,S,p,g,v[3],16,-722521979),g=T(g,_,S,p,v[6],23,76029189),p=T(p,g,_,S,v[9],4,-640364487),S=T(S,p,g,_,v[12],11,-421815835),_=T(_,S,p,g,v[15],16,530742520),g=T(g,_,S,p,v[2],23,-995338651);var I=u.bind(null,w);p=I(p,g,_,S,v[0],6,-198630844),S=I(S,p,g,_,v[7],10,1126891415),_=I(_,S,p,g,v[14],15,-1416354905),g=I(g,_,S,p,v[5],21,-57434055),p=I(p,g,_,S,v[12],6,1700485571),S=I(S,p,g,_,v[3],10,-1894986606),_=I(_,S,p,g,v[10],15,-1051523),g=I(g,_,S,p,v[1],21,-2054922799),p=I(p,g,_,S,v[8],6,1873313359),S=I(S,p,g,_,v[15],10,-30611744),_=I(_,S,p,g,v[6],15,-1560198380),g=I(g,_,S,p,v[13],21,1309151649),p=I(p,g,_,S,v[4],6,-145523070),S=I(S,p,g,_,v[11],10,-1120210379),_=I(_,S,p,g,v[2],15,718787259),g=I(g,_,S,p,v[9],21,-343485551),y[0]=w(p,y[0]),y[1]=w(g,y[1]),y[2]=w(_,y[2]),y[3]=w(S,y[3])}function h(y){for(var v=[],w=0;w<64;w+=4)v[w>>2]=y.charCodeAt(w)+(y.charCodeAt(w+1)<<8)+(y.charCodeAt(w+2)<<16)+(y.charCodeAt(w+3)<<24);return v}function f(y,v){let w;const p=y.length,g=[1732584193,-271733879,-1732584194,271733878];for(w=64;w<=p;w+=64)d(g,h(y.substring(w-64,w)),v);const _=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S=(y=y.substring(w-64)).length;let R;for(R=0;R<S;R++)_[R>>2]|=y.charCodeAt(R)<<(R%4<<3);if(_[R>>2]|=128<<(R%4<<3),R>55)for(d(g,_,v),R=16;R--;)_[R]=0;return _[14]=8*p,d(g,_,v),g}function m(y){if(!y)return"";let v;return i(f("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(v=function(w,p){const g=(65535&w)+(65535&p);return(w>>16)+(p>>16)+(g>>16)<<16|65535&g}),i(f(y,v))}e.md5=m})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){class r extends t.Receipt{constructor(a,l,c){super(t.Platform.IAPTIC_JS,c.apiDecorators),this.context=c,this.purchases=a,this.accessToken=l,this.transactions=a.map(u=>new n(this,u,c.apiDecorators))}refresh(a){this.purchases=a,this.transactions=a.map(l=>{const c=this.transactions.find(u=>u.purchase.purchaseId===l.purchaseId);return c?(c.refresh(l),c):new n(this,l,this.context.apiDecorators)})}}e.Receipt=r;class n extends t.Transaction{constructor(a,l,c){super(t.Platform.IAPTIC_JS,a,c),this.purchase=l,this.refresh(l)}refresh(a){this.purchase=a;const l=a.platform?`${a.platform}:`:"stripe:",c=a.productId.startsWith(l)?a.productId:`${l}${a.productId}`;this.products=[{id:c}],this.transactionId=a.transactionId,this.purchaseId=a.purchaseId,this.purchaseDate=new Date(a.purchaseDate),this.expirationDate=a.expirationDate?new Date(a.expirationDate):void 0,this.lastRenewalDate=a.lastRenewalDate?new Date(a.lastRenewalDate):void 0,this.renewalIntent=a.renewalIntent==="Renew"?t.RenewalIntent.RENEW:t.RenewalIntent.LAPSE,this.state=t.TransactionState.APPROVED,this.isAcknowledged=!0,this.amountMicros=a.amountMicros,this.currency=a.currency}}e.Transaction=n;class i{constructor(a,l){this.id=t.Platform.IAPTIC_JS,this.name="IapticJS",this.ready=!1,this.products=[],this._receipts=[],this.supportsParallelLoading=!1,this.context=a,this.log=a.log.child("IapticJS"),this.options=l,this.backendAdapterType=l.type}get receipts(){return this._receipts}upsertProduct(a){this.log.debug(`upsertProduct(${a.id})`);const l=this.products.findIndex(c=>c.id===a.id);l>=0?this.products[l]=a:this.products.push(a)}get isSupported(){return typeof window.IapticJS<"u"&&typeof window.IapticJS.createAdapter=="function"}initialize(){return A(this,void 0,void 0,function*(){if(this.log.info("initialize()"),!this.isSupported){const a="iaptic-js SDK is not available. Please ensure it is loaded.";return this.log.warn(a),s(t.ErrorCode.SETUP,a,null)}try{this.log.info(`Creating iaptic-js adapter with options: ${JSON.stringify(this.options)}`),this.iapticAdapterInstance=window.IapticJS.createAdapter(this.options),this.ready=!0,yield this.loadReceipts(),this.log.info("IapticJS Adapter Initialized"),this.context.listener.receiptsReady(t.Platform.IAPTIC_JS);return}catch(a){this.ready=!1;const l=(a==null?void 0:a.message)||"Failed to initialize IapticJS adapter";return this.log.error("Initialization failed: "+l),s(t.ErrorCode.SETUP,l,null)}})}loadProducts(a){return A(this,void 0,void 0,function*(){if(this.log.info(`loadProducts() for ${a.length} registered products`),!this.ready||!this.iapticAdapterInstance)return a.map(l=>s(t.ErrorCode.SETUP,"Adapter not initialized",l.id));try{const l=yield this.iapticAdapterInstance.getProducts();this.log.debug("Fetched products from iaptic-js: "+JSON.stringify(l.map(u=>u.id)));const c=a.map(u=>{var d;const h=l.find(y=>{const v=y.id.includes(":")?y.id.split(":",2)[1]:y.id,w=u.id.includes(":")?u.id.split(":",2)[1]:u.id;return v===w});if(!h)return this.log.warn(`Registered product ID "${u.id}" not found in fetched iaptic-js products.`),s(t.ErrorCode.PRODUCT_NOT_AVAILABLE,`Product ${u.id} not found via iaptic-js`,u.id);const f=`${t.Platform.IAPTIC_JS}:${h.id.split(":").pop()}`;let m=this.products.find(y=>y.id===f);return m||(m=new t.Product(Object.assign(Object.assign({},u),{platform:t.Platform.IAPTIC_JS,id:f}),this.context.apiDecorators),this.upsertProduct(m)),m.title=h.title,m.description=(d=h.description)!==null&&d!==void 0?d:"",m.offers=[],h.offers.forEach(y=>{const v=y.platform?`${y.platform}:`:"stripe:",w=y.id.includes(":")?y.id.split(":",2)[1]:y.id,p=`${v}${w}`,g=new t.Offer({id:p,product:m,pricingPhases:y.pricingPhases.map(_=>({priceMicros:_.priceMicros,currency:_.currency,billingPeriod:_.billingPeriod,paymentMode:_.paymentMode,recurrenceMode:_.recurrenceMode,price:window.IapticJS.Utils.formatCurrency(_.priceMicros,_.currency)}))},this.context.apiDecorators);m.addOffer(g)}),this.log.debug(`Processed product ${m.id} with ${m.offers.length} offers.`),m});return this.context.listener.productsUpdated(t.Platform.IAPTIC_JS,this.products),c}catch(l){return this.log.error("Failed to load products: "+l.message),a.map(c=>s(t.ErrorCode.LOAD,l.message||"Failed to load products",c.id))}})}loadReceipts(){var a,l;return A(this,void 0,void 0,function*(){if(this.log.info("loadReceipts()"),!this.ready||!this.iapticAdapterInstance)return this.log.warn("Adapter not ready, skipping loadReceipts."),this._receipts;try{const c=this.iapticAdapterInstance.getAccessToken();if(!c)return this.log.info("No stored access token found."),this._receipts.length>0&&(this._receipts=[],this.context.listener.receiptsUpdated(t.Platform.IAPTIC_JS,[])),this._receipts;this.log.info("Fetching purchases with stored access token.");const u=yield this.iapticAdapterInstance.getPurchases(c),d=(a=this.iapticAdapterInstance.getAccessToken())!==null&&a!==void 0?a:c;if(u.length>0){let h=this._receipts.find(f=>f.accessToken===d);h?(this.log.info(`Refreshing existing receipt for token hash ${d.substring(0,10)}...`),h.refresh(u)):(this.log.info(`Creating new receipt for token hash ${d.substring(0,10)}...`),h=new r(u,d,this.context),this._receipts=[h]),this.context.listener.receiptsUpdated(t.Platform.IAPTIC_JS,[h])}else this._receipts.length>0&&(this.log.info("No purchases found for token, clearing local receipts."),this._receipts=[],this.context.listener.receiptsUpdated(t.Platform.IAPTIC_JS,[]));return this.context.listener.receiptsReady(t.Platform.IAPTIC_JS),this._receipts}catch(c){return this.log.warn("Failed to load receipts: "+c.message),!((l=c.message)===null||l===void 0)&&l.includes("Invalid access token")&&(this.log.warn("Invalid access token detected, clearing stored data."),this.iapticAdapterInstance.clearStoredData(),this._receipts=[],this.context.listener.receiptsUpdated(t.Platform.IAPTIC_JS,[])),this.context.listener.receiptsReady(t.Platform.IAPTIC_JS),[]}})}order(a,l){return A(this,void 0,void 0,function*(){if(this.log.info(`order() - Offer ID: ${a.id}`),!this.ready||!this.iapticAdapterInstance)return s(t.ErrorCode.SETUP,"Adapter not initialized",a.productId);try{yield this.iapticAdapterInstance.order({offerId:a.id,applicationUsername:(l==null?void 0:l.applicationUsername)||this.context.getApplicationUsername()||"",successUrl:window.location.href,cancelUrl:window.location.href,accessToken:this.iapticAdapterInstance.getAccessToken()}),this.log.info(`Order initiated for offer ${a.id}. User will be redirected.`);return}catch(c){return this.log.error("Order failed: "+c.message),s(t.ErrorCode.PURCHASE,c.message||"Failed to initiate order",a.productId)}})}finish(a){return A(this,void 0,void 0,function*(){this.log.info(`finish(${a.transactionId}) - No-op for IapticJS/Stripe`),a.state=t.TransactionState.FINISHED;const l=this._receipts.find(c=>c.transactions.indexOf(a)>=0);l&&this.context.listener.receiptsUpdated(t.Platform.IAPTIC_JS,[l])})}receiptValidationBody(a){var l,c,u;return A(this,void 0,void 0,function*(){if(a.platform!==t.Platform.IAPTIC_JS)return;if(this.log.info(`receiptValidationBody for IapticJS - AccessToken: ${a.accessToken?"present":"missing"}`),!a.accessToken){this.log.warn("Cannot prepare validation body: IapticJS receipt is missing accessToken.");return}const d=a.purchases[0],h=d?this.context.registeredProducts.find(t.Platform.IAPTIC_JS,d.productId):void 0,f=(c=(l=h==null?void 0:h.id)!==null&&l!==void 0?l:d==null?void 0:d.productId)!==null&&c!==void 0?c:"unknown-product",m=(u=h==null?void 0:h.type)!==null&&u!==void 0?u:d?t.ProductType.PAID_SUBSCRIPTION:t.ProductType.CONSUMABLE;return{id:f,type:m,products:this.products.map(y=>({id:y.id,type:y.type,offers:y.offers.map(v=>({id:v.id,pricingPhases:v.pricingPhases}))})),transaction:{type:"iaptic",adapter:this.backendAdapterType,accessToken:a.accessToken}}})}handleReceiptValidationResponse(a,l){return A(this,void 0,void 0,function*(){if(this.log.info("handleReceiptValidationResponse for IapticJS"),l.ok){l.data.transaction;const c=l.data.collection;if(c){const u=c.map(d=>{var h;return{purchaseId:d.purchaseId,transactionId:d.transactionId,productId:d.id,platform:"stripe",purchaseDate:d.purchaseDate?new Date(d.purchaseDate).toISOString():"",lastRenewalDate:d.lastRenewalDate?new Date(d.lastRenewalDate).toISOString():"",expirationDate:d.expiryDate?new Date(d.expiryDate).toISOString():"",renewalIntent:d.renewalIntent===t.RenewalIntent.RENEW?"Renew":"Cancel",isTrialPeriod:(h=d.isTrialPeriod)!==null&&h!==void 0?h:!1,amountMicros:0,currency:""}});a.refresh(u)}else a.refresh([]);this.context.listener.receiptsUpdated(t.Platform.IAPTIC_JS,[a])}else this.log.warn(`Receipt validation failed: ${l.message} (Code: ${l.code})`),l.code===t.ErrorCode.COMMUNICATION&&(this.log.info("Clearing potentially invalid access token due to validation failure."),this.iapticAdapterInstance.clearStoredData(),this._receipts=this._receipts.filter(c=>c!==a),this.context.listener.receiptsUpdated(t.Platform.IAPTIC_JS,[]))})}requestPayment(a,l){return A(this,void 0,void 0,function*(){return this.log.warn("requestPayment is not directly supported for IapticJS/Stripe. Use order()."),s(t.ErrorCode.UNKNOWN,"requestPayment not supported, use order() instead",null)})}manageSubscriptions(){return A(this,void 0,void 0,function*(){if(!this.ready||!this.iapticAdapterInstance)return s(t.ErrorCode.SETUP,"Adapter not initialized",null);try{yield this.iapticAdapterInstance.redirectToCustomerPortal({returnUrl:window.location.href});return}catch(a){return this.log.error("Failed to redirect to customer portal: "+a.message),s(t.ErrorCode.UNKNOWN,a.message||"Failed to open subscription management",null)}})}manageBilling(){return A(this,void 0,void 0,function*(){return this.manageSubscriptions()})}checkSupport(a){return["order","manageSubscriptions","manageBilling"].indexOf(a)!==-1}restorePurchases(){return A(this,void 0,void 0,function*(){if(this.log.info("restorePurchases() - calling loadReceipts()"),!this.ready||!this.iapticAdapterInstance)return s(t.ErrorCode.SETUP,"Adapter not initialized",null);try{yield this.loadReceipts();return}catch(a){return this.log.error("Restore purchases failed during loadReceipts: "+a.message),s(t.ErrorCode.REFRESH,a.message||"Failed to restore purchases",null)}})}}e.Adapter=i;function s(o,a,l){return t.storeError(o,a,t.Platform.IAPTIC_JS,l)}})(t.IapticJS||(t.IapticJS={}))})(E||(E={}));var E;(function(t){(function(e){const r=t.Platform.TEST;let n=[];function i(a){a.products.forEach(l=>{var c,u,d,h;const f=n.find(y=>l.id===y.id),m={id:l.id,purchaseDate:(c=a.purchaseDate)===null||c===void 0?void 0:c.getTime(),expiryDate:(u=a.expirationDate)===null||u===void 0?void 0:u.getTime(),lastRenewalDate:(d=a.lastRenewalDate)===null||d===void 0?void 0:d.getTime(),renewalIntent:a.renewalIntent,renewalIntentChangeDate:(h=a.renewalIntentChangeDate)===null||h===void 0?void 0:h.getTime()};f?Object.assign(f,m):n.push(m)})}class s{constructor(l){this.id=t.Platform.TEST,this.name="Test",this.ready=!1,this.products=[],this.receipts=[],this.supportsParallelLoading=!0,this.context=l,this.log=l.log.child("Test")}get isSupported(){return!0}initialize(){return A(this,void 0,void 0,function*(){})}loadReceipts(){return A(this,void 0,void 0,function*(){return new Promise(l=>{setTimeout(()=>{this.context.listener.receiptsReady(t.Platform.TEST),l(this.receipts)},600)})})}loadProducts(l){return A(this,void 0,void 0,function*(){return l.map(c=>{const u=!!e.customTestProducts[c.id],d=!!e.testProductsArray.find(m=>m.id===c.id&&m.type===c.type);if(!u&&!d)return o(t.ErrorCode.PRODUCT_NOT_AVAILABLE,"This product is not available",c.id);const h=this.products.find(m=>m.id===c.id);if(h)return h;c.id===e.testProducts.PAID_SUBSCRIPTION_ACTIVE.id&&setTimeout(()=>{this.reportActiveSubscription()},500);const f=e.initTestProduct(c.id,this.context.apiDecorators);return f?(this.products.push(f),this.context.listener.productsUpdated(t.Platform.TEST,[f]),f):o(t.ErrorCode.PRODUCT_NOT_AVAILABLE,"Could not load this product",c.id)})})}order(l){return A(this,void 0,void 0,function*(){if(l.id.indexOf("-fail-")>0)return o(t.ErrorCode.PURCHASE,"Purchase failed.",l.productId);const c=this.products.find(f=>f.id===l.productId);if(!t.Internal.LocalReceipts.canPurchase(this.receipts,c))return o(t.ErrorCode.PURCHASE,"Product already owned",l.productId);const u=prompt(`Do you want to purchase ${l.productId} for ${l.pricingPhases[0].price}?
Enter "Y" to confirm.
Enter "E" to fail with an error.Anything else to cancel.`);if((u==null?void 0:u.toUpperCase())==="E")return o(t.ErrorCode.PURCHASE,"Purchase failed",l.productId);if((u==null?void 0:u.toUpperCase())!=="Y")return o(t.ErrorCode.PAYMENT_CANCELLED,"Purchase flow has been cancelled by the user",l.productId);const d=new t.Receipt(r,this.context.apiDecorators),h=new t.Transaction(r,d,this.context.apiDecorators);d.transactions=[h],h.products=[{id:l.productId,offerId:l.id}],h.state=t.TransactionState.APPROVED,h.purchaseDate=new Date,h.transactionId=l.productId+"-"+new Date().getTime(),h.isAcknowledged=!1,l.productType===t.ProductType.PAID_SUBSCRIPTION&&(h.expirationDate=new Date(+new Date+6048e5),h.renewalIntent=t.RenewalIntent.RENEW),i(h),this.receipts.push(d),this.context.listener.receiptsUpdated(t.Platform.TEST,[d])})}finish(l){return new Promise(c=>{setTimeout(()=>{l.state=t.TransactionState.FINISHED,l.isAcknowledged=!0,i(l);const u=this.products.find(h=>l.products[0].id===h.id);(u==null?void 0:u.type)===t.ProductType.CONSUMABLE&&(l.isConsumed=!0);const d=this.receipts.filter(h=>h.hasTransaction(l));this.context.listener.receiptsUpdated(r,d),c(void 0)},500)})}receiptValidationBody(l){return A(this,void 0,void 0,function*(){})}handleReceiptValidationResponse(l,c){return A(this,void 0,void 0,function*(){})}requestPayment(l,c){var u;return A(this,void 0,void 0,function*(){yield t.Utils.asyncDelay(100);const d=prompt(`Mock payment of ${((u=l.amountMicros)!==null&&u!==void 0?u:0)/1e6} ${l.currency}. Enter "Y" to confirm. Enter "E" to trigger an error.`);if((d==null?void 0:d.toUpperCase())==="E")return o(t.ErrorCode.PAYMENT_NOT_ALLOWED,"Payment not allowed",null);if((d==null?void 0:d.toUpperCase())!=="Y")return;const h=new t.Receipt(r,this.context.apiDecorators),f=new t.Transaction(t.Platform.TEST,h,this.context.apiDecorators);return f.purchaseDate=new Date,f.products=l.items.filter(m=>m).map(m=>({id:(m==null?void 0:m.id)||""})),f.state=t.TransactionState.APPROVED,f.transactionId="payment-"+new Date().getTime(),f.amountMicros=l.amountMicros,f.currency=l.currency,h.transactions=[f],this.receipts.push(h),setTimeout(()=>{this.context.listener.receiptsUpdated(r,[h])},400),f})}manageSubscriptions(){return A(this,void 0,void 0,function*(){alert("Pseudo subscription management interface. Close it when you are done.")})}manageBilling(){return A(this,void 0,void 0,function*(){alert("Pseudo billing management interface. Close it when you are done.")})}reportActiveSubscription(){if(this.receipts.find(f=>f.transactions[0].transactionId===d(1)))return;const l=2*6e4,c=new t.Receipt(r,this.context.apiDecorators),u=f=>{var m,y;const v=new t.Transaction(r,c,this.context.apiDecorators);v.products=[{id:e.testProducts.PAID_SUBSCRIPTION_ACTIVE.id,offerId:e.testProducts.PAID_SUBSCRIPTION_ACTIVE.extra.offerId}],v.state=t.TransactionState.APPROVED,v.transactionId=d(f),v.isAcknowledged=f==1,v.renewalIntent=t.RenewalIntent.RENEW;const w=+(((y=(m=c==null?void 0:c.transactions)===null||m===void 0?void 0:m[0])===null||y===void 0?void 0:y.purchaseDate)||new Date);return v.purchaseDate=new Date(w),v.lastRenewalDate=new Date(w+l*(f-1)),v.expirationDate=new Date(w+l*f),i(v),v};c.transactions.push(u(1)),this.receipts.push(c),this.context.listener.receiptsUpdated(t.Platform.TEST,[c]);function d(f){return"test-active-subscription-transaction-"+f}let h=1;setInterval(()=>{this.log.info("auto-renewing the mock subscription"),h+=1,c.transactions.push(u(h)),this.context.listener.receiptsUpdated(t.Platform.TEST,[c])},l)}static verify(l,c){setTimeout(()=>{var u,d;c({receipt:l,payload:{ok:!0,data:{id:(d=(u=l.transactions[0])===null||u===void 0?void 0:u.products[0])===null||d===void 0?void 0:d.id,latest_receipt:!0,transaction:{type:"test"},collection:n}}})},500)}checkSupport(l){return!0}restorePurchases(){return A(this,void 0,void 0,function*(){})}}e.Adapter=s;function o(a,l,c){return t.storeError(a,l,t.Platform.TEST,c)}})(t.Test||(t.Test={}))})(E||(E={}));var E;(function(t){(function(e){const r=t.Platform.TEST;e.customTestProducts={},e.testProducts={CONSUMABLE:{platform:r,id:"test-consumable",type:t.ProductType.CONSUMABLE},CONSUMABLE_FAILING:{platform:r,id:"test-consumable-fail",type:t.ProductType.CONSUMABLE},NON_CONSUMABLE:{platform:r,id:"test-non-consumable",type:t.ProductType.NON_CONSUMABLE},PAID_SUBSCRIPTION:{platform:r,id:"test-subscription",type:t.ProductType.PAID_SUBSCRIPTION},PAID_SUBSCRIPTION_ACTIVE:{platform:r,id:"test-subscription-active",type:t.ProductType.PAID_SUBSCRIPTION,extra:{offerId:"test-paid-subscription-active-offer1"}}},e.testProductsArray=t.Utils.objectValues(e.testProducts);const n={[t.ProductType.CONSUMABLE]:[{price:"$1.99",currency:"USD",priceMicros:199e4,paymentMode:t.PaymentMode.UP_FRONT,recurrenceMode:t.RecurrenceMode.NON_RECURRING}],[t.ProductType.NON_CONSUMABLE]:[{price:"$4.99",currency:"USD",priceMicros:499e4,paymentMode:t.PaymentMode.UP_FRONT,recurrenceMode:t.RecurrenceMode.NON_RECURRING}],[t.ProductType.PAID_SUBSCRIPTION]:[{price:"$9.99",currency:"USD",priceMicros:999e4,paymentMode:t.PaymentMode.PAY_AS_YOU_GO,recurrenceMode:t.RecurrenceMode.INFINITE_RECURRING,billingPeriod:"P1M"}]};function i(o){if(!o.id)throw new Error("Product ID is required");if(o.type===void 0)throw new Error("Product type is required");const a={title:o.title||`Test ${o.type}`,description:o.description||`A test ${o.type} product`,offerId:o.offerId||`${o.id}-offer1`,pricing:o.pricing||n[o.type]},l={platform:r,id:o.id,type:o.type,customMetadata:a};return e.customTestProducts[o.id]=l,l}e.registerTestProduct=i;function s(o,a){if(e.customTestProducts[o]){const u=e.customTestProducts[o],d=new t.Product({platform:r,id:u.id,type:u.type},a);if(u.customMetadata){d.title=u.customMetadata.title,d.description=u.customMetadata.description;const h=u.customMetadata.offerId;let f=[];if(Array.isArray(u.customMetadata.pricing))f=u.customMetadata.pricing;else if(u.customMetadata.pricing){const m=u.customMetadata.pricing;f=[{price:m.price,currency:m.currency,priceMicros:m.priceMicros,paymentMode:u.type===t.ProductType.PAID_SUBSCRIPTION?t.PaymentMode.PAY_AS_YOU_GO:t.PaymentMode.UP_FRONT,recurrenceMode:u.type===t.ProductType.PAID_SUBSCRIPTION?t.RecurrenceMode.INFINITE_RECURRING:t.RecurrenceMode.NON_RECURRING,billingPeriod:u.type===t.ProductType.PAID_SUBSCRIPTION?"P1M":void 0}]}d.addOffer(new t.Offer({id:h,product:d,pricingPhases:f},a))}return d}const l=Object.keys(e.testProducts).find(u=>e.testProducts[u]&&e.testProducts[u].id===o);if(!l)return;const c=new t.Product(e.testProducts[l],a);switch(l){case"CONSUMABLE":c.title="Test Consumable",c.description="A consumable product that you can purchase",c.addOffer(new t.Offer({id:"test-consumable-offer1",pricingPhases:[{price:"$4.99",currency:"USD",priceMicros:499e4,paymentMode:t.PaymentMode.UP_FRONT,recurrenceMode:t.RecurrenceMode.NON_RECURRING}],product:c},a));break;case"CONSUMABLE_FAILING":c.title="Failing Consumable",c.description="A consumable product that cannot be purchased",c.addOffer(new t.Offer({id:"test-consumable-fail-offer1",pricingPhases:[{price:"$1.99",currency:"USD",priceMicros:199e4,paymentMode:t.PaymentMode.UP_FRONT,recurrenceMode:t.RecurrenceMode.NON_RECURRING}],product:c},a));break;case"NON_CONSUMABLE":c.title="Non Consumable",c.description="A non consumable product",c.addOffer(new t.Offer({id:"test-non-consumable-offer1",pricingPhases:[{price:"$9.99",currency:"USD",priceMicros:999e4,paymentMode:t.PaymentMode.UP_FRONT,recurrenceMode:t.RecurrenceMode.NON_RECURRING}],product:c},a));break;case"PAID_SUBSCRIPTION":c.title="A subscription product",c.description="An auto-renewing paid subscription with a trial period",c.addOffer(new t.Offer({id:"test-paid-subscription-offer1",product:c,pricingPhases:[{price:"$0.00",currency:"USD",priceMicros:0,paymentMode:t.PaymentMode.FREE_TRIAL,recurrenceMode:t.RecurrenceMode.FINITE_RECURRING,billingCycles:3,billingPeriod:"P1W"},{price:"$4.99",currency:"USD",priceMicros:499e4,paymentMode:t.PaymentMode.PAY_AS_YOU_GO,recurrenceMode:t.RecurrenceMode.INFINITE_RECURRING,billingPeriod:"P1M"}]},a));break;case"PAID_SUBSCRIPTION_ACTIVE":c.title="An owned subscription product",c.description="An active paid subscription",c.addOffer(new t.Offer({id:e.testProducts.PAID_SUBSCRIPTION_ACTIVE.extra.offerId,product:c,pricingPhases:[{price:"$19.99",currency:"USD",priceMicros:1999e4,paymentMode:t.PaymentMode.PAY_AS_YOU_GO,recurrenceMode:t.RecurrenceMode.INFINITE_RECURRING,billingPeriod:"P1Y"}]},a));break;default:const u=l;throw new Error(`Unhandled enum case: ${u}`)}return c}e.initTestProduct=s})(t.Test||(t.Test={}))})(E||(E={}));var E;(function(t){(function(e){class r{constructor(){this.id=t.Platform.WINDOWS_STORE,this.name="WindowsStore",this.ready=!1,this.supportsParallelLoading=!1,this.products=[],this.receipts=[]}initialize(){return A(this,void 0,void 0,function*(){})}get isSupported(){return!1}loadProducts(s){return A(this,void 0,void 0,function*(){return s.map(o=>n(t.ErrorCode.PRODUCT_NOT_AVAILABLE,"TODO",o.id))})}loadReceipts(){return A(this,void 0,void 0,function*(){return[]})}order(s){return A(this,void 0,void 0,function*(){return n(t.ErrorCode.UNKNOWN,"TODO: Not implemented",s.productId)})}finish(s){return A(this,void 0,void 0,function*(){return n(t.ErrorCode.UNKNOWN,"TODO: Not implemented",null)})}handleReceiptValidationResponse(s,o){return A(this,void 0,void 0,function*(){})}receiptValidationBody(s){return A(this,void 0,void 0,function*(){})}requestPayment(s,o){return A(this,void 0,void 0,function*(){return n(t.ErrorCode.UNKNOWN,"requestPayment not supported",null)})}manageSubscriptions(){return A(this,void 0,void 0,function*(){return n(t.ErrorCode.UNKNOWN,"manageSubscriptions not supported",null)})}manageBilling(){return A(this,void 0,void 0,function*(){return n(t.ErrorCode.UNKNOWN,"manageBilling not supported",null)})}checkSupport(s){return!1}restorePurchases(){return A(this,void 0,void 0,function*(){})}}e.Adapter=r;function n(i,s,o){return t.storeError(i,s,t.Platform.WINDOWS_STORE,o)}})(t.WindowsStore||(t.WindowsStore={}))})(E||(E={}));var E;(function(t){(function(e){let r;(function(s){s.HTTP_REQUEST_TIMEOUT=408})(r=e.Ajax||(e.Ajax={}));function n(s,o){if(typeof window<"u"&&window.cordova&&window.cordova.plugin&&window.cordova.plugin.http)return i(s,o);var a=function(){},l=new XMLHttpRequest;o.timeout&&(l.timeout=o.timeout,l.ontimeout=function(){s.warn("ajax -> request to "+o.url+" timeout"),e.callExternal(s,"ajax.error",o.error,r.HTTP_REQUEST_TIMEOUT,"Timeout")}),l.open(o.method||"POST",o.url,!0),l.onreadystatechange=function(){try{l.readyState===4&&(l.status===200?e.callExternal(s,"ajax.success",o.success,JSON.parse(l.responseText)):(s.warn("ajax -> request to "+o.url+" failed with status "+l.status+" ("+l.statusText+")"),e.callExternal(s,"ajax.error",o.error,l.status,l.statusText)))}catch(u){s.warn("ajax -> request to "+o.url+" failed with an exception: "+u.message),o.error&&o.error(417,u.message,null)}l.readyState===4&&e.callExternal(s,"ajax.done",a)};const c=o.customHeaders;return c&&Object.keys(c).forEach(function(u){s.debug("ajax -> adding custom header: "+u),l.setRequestHeader(u,c[u])}),l.setRequestHeader("Accept","application/json"),s.debug("ajax -> send request to "+o.url),o.data?(l.setRequestHeader("Content-Type","application/json;charset=UTF-8"),l.send(JSON.stringify(o.data))):l.send(),{done:function(u){return a=u,this}}}e.ajax=n;function i(s,o){let a=function(){};const l={method:(o.method||"get").toLowerCase(),data:o.data,serializer:"json"};o.customHeaders&&(s.debug("ajax[http] -> adding custom headers: "+JSON.stringify(o.customHeaders)),l.headers=o.customHeaders),s.debug("ajax[http] -> send request to "+o.url);const c=u=>{try{u.status==200?e.callExternal(s,"ajax.success",o.success,JSON.parse(u.data)):(s.warn("ajax[http] -> request to "+o.url+" failed with status "+u.status+" ("+u.error+")"),e.callExternal(s,"ajax.error",o.error,u.status,u.error))}catch(d){s.warn("ajax[http] -> request to "+o.url+" failed with an exception: "+d.message),o.error&&e.callExternal(s,"ajax.error",o.error,417,d.message)}e.callExternal(s,"ajax.done",a)};return window.cordova.plugin.http.sendRequest(o.url,l,c,c),{done:function(u){return a=u,this}}}})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){function r(n,i,s,...o){try{const a=Array.prototype.slice.call(arguments,3);s&&s.apply(t.store,a)}catch(a){n.logCallbackException(i,a)}}e.callExternal=r})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){function r(o,a){return setTimeout(o,a)}e.delay=r;function n(o,a){return i(o,a).call}e.debounce=n;function i(o,a){let l=null,c=[];const u=function(h,f){const m=c;c=[],l=null,o(),m.forEach(y=>y())};return{call:function(){l&&window.clearTimeout(l),l=setTimeout(u,a)},wait:()=>new Promise(h=>{l?c.push(h):h()})}}e.createDebouncer=i;function s(o){return new Promise(a=>setTimeout(a,o))}e.asyncDelay=s})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){function r(i){switch(n(i)){case t.RecurrenceMode.FINITE_RECURRING:return`${i.billingCycles}x ${e.formatDurationEN(i.billingPeriod)}`;case t.RecurrenceMode.NON_RECURRING:return"for "+e.formatDurationEN(i.billingPeriod);default:return"every "+e.formatDurationEN(i.billingPeriod,{omitOne:!0})}}e.formatBillingCycleEN=r;function n(i){var s;const o=(s=i.billingCycles)!==null&&s!==void 0?s:0;if(i.recurrenceMode===t.RecurrenceMode.FINITE_RECURRING){if(o==1)return t.RecurrenceMode.NON_RECURRING;if(o<=0)return t.RecurrenceMode.INFINITE_RECURRING}return i.recurrenceMode}})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){function r(n,i){if(!n)return"";const s=n.length,o=n.slice(1,s-1);if(o==="1")return i!=null&&i.omitOne?{D:"day",W:"week",M:"month",Y:"year"}[n[s-1]]||n[s-1]:{D:"1 day",W:"1 week",M:"1 month",Y:"1 year"}[n[s-1]]||n[s-1];{const a={D:"days",W:"weeks",M:"months",Y:"years"}[n[s-1]]||n[s-1];return`${o} ${a}`}}e.formatDurationEN=r})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){function r(){var n,i,s;return!((n=window.cordova)===null||n===void 0)&&n.platformId?(i=window.cordova)===null||i===void 0?void 0:i.platformId:!((s=window.Capacitor)===null||s===void 0)&&s.getPlatform?window.Capacitor.getPlatform():"web"}e.platformId=r})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){function r(i,s,o,a,l){return function(c){n(i,s,o,c,a,l)}}e.safeCallback=r;function n(i,s,o,a,l,c){o&&(l||(l=o.name||"#"+e.md5(o.toString())),setTimeout(()=>{try{i.debug(`Calling callback: type=${s} name=${l} reason=${c}`),o(a)}catch(u){i.error(`Error in callback: type=${s} name=${l} reason=${c}`),i.debug(o.toString());const d=u;"message"in d&&i.error(d.message),"fileName"in u&&i.error("in "+u.fileName+":"+u.lineNumber),"stack"in d&&i.error(d.stack)}},0))}e.safeCall=n})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){function r(){return window.crypto||window.msCrypto}function n(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,function(i){return(i^r().getRandomValues(new Uint8Array(1))[0]&15>>i/4).toString(16)})}e.uuidv4=n})(t.Utils||(t.Utils={}))})(E||(E={}));var E;(function(t){(function(e){(function(r){function n(a){return Object.prototype.toString.call(a)==="[object Array]"}function i(a){return Object.prototype.toString.call(a)==="[object Object]"}function s(a){return typeof a.validator_privacy_policy=="string"?a.validator_privacy_policy.split(","):n(a.validator_privacy_policy)?a.validator_privacy_policy:["analytics","support","fraud"]}function o(a){const l=s(a);function c(m){return l.indexOf(m)>=0}const u={plugin:"cordova-plugin-purchase/"+t.PLUGIN_VERSION},d=window,h=i(d.device)?d.device:{};if(c("analytics")||c("support")){const m=d.Ionic||d.ionic;m&&m.version&&(u.ionic=m.version),h.cordova&&(u.cordova=h.cordova),h.model&&(u.model=h.model),h.platform&&(u.platform=h.platform),h.version&&(u.version=h.version),h.manufacturer&&(u.manufacturer=h.manufacturer)}if(c("tracking")&&(h.serial&&(u.serial=h.serial),h.uuid&&(u.uuid=h.uuid)),h.isVirtual&&(u.isVirtual=h.isVirtual),c("fraud")){var f="";h.serial?f="serial:"+h.serial:h.uuid?f="uuid:"+h.uuid:(h.model&&(f+="/"+h.model),h.manufacturer&&(f="/"+h.manufacturer)),f&&(u.fingerprint=t.Utils.md5(f))}return u}r.getDeviceInfo=o})(e.Internal||(e.Internal={}))})(t.Validator||(t.Validator={}))})(E||(E={}));var E;(function(t){(function(e){e.Request||(e.Request={})})(t.Validator||(t.Validator={}))})(E||(E={}));var E;(function(t){class e{constructor(n,i,s){var o;this.className="VerifiedReceipt",this.id=i.id,this.sourceReceipt=n,this.collection=(o=i.collection)!==null&&o!==void 0?o:[],this.latestReceipt=i.latest_receipt,this.nativeTransactions=[i.transaction],this.warning=i.warning,this.validationDate=i.date?new Date(i.date):new Date,Object.defineProperty(this,"raw",{enumerable:!1,get(){return i}}),Object.defineProperty(this,"finish",{enumerable:!1,get(){return()=>s.finish(this)}})}get platform(){return this.sourceReceipt.platform}get raw(){return{}}set(n,i){var s;this.id=i.id,this.sourceReceipt=n,this.collection=(s=i.collection)!==null&&s!==void 0?s:[],this.latestReceipt=i.latest_receipt,this.nativeTransactions=[i.transaction],this.warning=i.warning}finish(){return A(this,void 0,void 0,function*(){})}}t.VerifiedReceipt=e})(E||(E={}));const Jo=()=>{const t=window.CdvPurchase;return t||{ProductType:{PAID_SUBSCRIPTION:"paid subscription"},Platform:{GOOGLE_PLAY:"google-play",APPLE_APPSTORE:"apple-appstore"},ErrorCode:{PAYMENT_CANCELLED:6777006},store:{register:()=>{},when:()=>({approved:()=>{},verified:()=>({finish:()=>{}}),finished:()=>{},productUpdated:()=>{},updated:()=>{}}),initialize:async()=>{},update:async()=>{},get:()=>null,restore:async()=>{},products:[],error:()=>{},order:async()=>{}}}},Op=()=>Jo().ProductType.PAID_SUBSCRIPTION,vt={WEEKLY:{androidId:"premium",androidBasePlanId:"weekly",iosId:"premium_weekly",get type(){return Op()}},MONTHLY:{androidId:"premium",androidBasePlanId:"monthly",iosId:"premium_monthly",get type(){return Op()}}};class LR{constructor(){xi(this,"isInitialized",!1);xi(this,"products",[]);xi(this,"onSuccess",null);xi(this,"onError",null)}initialize(e,r){if(this.onSuccess=e,this.onError=r,!X.isNativePlatform()){console.log("IAP: Not native platform, skipping initialization.");return}if(this.isInitialized)return;const n=Jo();if(!n)return;const{store:i,Platform:s}=n,o=[],a=new Set,l=(c,u,d)=>{if(!c)return;const h=`${d}_${c}`;a.has(h)||(o.push({id:c,type:u,platform:d}),a.add(h))};X.getPlatform()==="android"?(l(vt.WEEKLY.androidId,vt.WEEKLY.type,s.GOOGLE_PLAY),l(vt.MONTHLY.androidId,vt.MONTHLY.type,s.GOOGLE_PLAY)):X.getPlatform()==="ios"&&(l(vt.WEEKLY.iosId,vt.WEEKLY.type,s.APPLE_APPSTORE),l(vt.MONTHLY.iosId,vt.MONTHLY.type,s.APPLE_APPSTORE)),o.length>0&&i.register(o),i.when().approved(c=>{console.log("IAP: Transaction approved",c),this.onSuccess&&this.onSuccess(),c.finish()}),i.when().verified(c=>{console.log("IAP: Receipt verified",c),c.finish()}),i.when().finished(c=>{console.log("IAP: Transaction finished",c)}),i.when().productUpdated(c=>{console.log(`IAP: Product Updated: ${c.id} [${c.state}] CanPurchase: ${c.canPurchase}`),this.products=i.products}),i.when().updated(c=>{this.products=i.products}),i.error(c=>{console.error("IAP Error:",c),c&&c.code!==n.ErrorCode.PAYMENT_CANCELLED&&this.onError&&this.onError(`Store Error: ${c.message}`)}),i.initialize().then(()=>{this.isInitialized=!0,console.log("IAP: Store initialized"),i.update()})}async purchase(e){if(!X.isNativePlatform()){console.warn("IAP: Cannot purchase on web.");return}const r=Jo(),{store:n}=r,i=X.getPlatform()==="ios",s=e==="WEEKLY"?vt.WEEKLY:vt.MONTHLY,o=i?s.iosId:s.androidId,a=i?null:s.androidBasePlanId;console.log(`IAP: Attempting purchase for ${o} (BasePlan: ${a||"N/A"})`),this.isInitialized||await n.update();const l=n.get(o);if(l&&l.canPurchase)try{if(a){if(!l.offers||l.offers.length===0){await n.order(o);return}const c=l.offers.find(u=>u.id===a||u.id.includes(a));c?await c.order():await n.order(o)}else{const c=l.getOffer();c?await c.order():await n.order(o)}}catch(c){console.error("IAP: Order failed",c),this.onError&&this.onError(c.message||"Purchase failed")}else n.update(),this.onError&&this.onError("Product unavailable. Retrying connection...")}async restore(){if(!X.isNativePlatform())return;const e=Jo();try{await e.store.restore(),await e.store.update()}catch(r){console.error("IAP: Restore failed",r)}}getPrice(e){var a,l,c,u,d;if(!X.isNativePlatform())return null;const r=X.getPlatform()==="ios",n=e==="WEEKLY"?vt.WEEKLY:vt.MONTHLY,i=r?n.iosId:n.androidId,s=r?null:n.androidBasePlanId,o=this.products.find(h=>h.id===i);if(!o)return null;if(s){const h=(a=o.offers)==null?void 0:a.find(f=>f.id===s||f.id.includes(s));if(h&&h.pricingPhases&&h.pricingPhases.length>0)return h.pricingPhases[0].price}return((d=(u=(c=(l=o.offers)==null?void 0:l[0])==null?void 0:c.pricingPhases)==null?void 0:u[0])==null?void 0:d.price)||null}}const Np=new LR,jR=({dataAdSlot:t,format:e="auto",responsive:r="true",className:n,refreshInterval:i=6e4})=>{const s=O.useRef(null),o=O.useRef(!1),[a,l]=O.useState(0);return O.useEffect(()=>{const c=setInterval(()=>{l(u=>u+1),o.current=!1},i);return()=>clearInterval(c)},[i]),O.useEffect(()=>{if(s.current&&!o.current)try{(window.adsbygoogle=window.adsbygoogle||[]).push({}),o.current=!0}catch(c){console.error("AdSense Error:",c)}},[a]),b.jsx("div",{className:`w-full overflow-hidden text-center flex items-center justify-center bg-white/5 rounded-lg border border-white/5 ${n||"my-4 min-h-[100px]"}`,children:b.jsxs("div",{className:"text-xs text-white/20 uppercase tracking-widest p-4 absolute z-0",children:["Ad Space (",t,")",b.jsx("br",{}),b.jsxs("span",{className:"opacity-50 text-[10px]",children:["Refreshing in ",i/1e3,"s..."]})]})},a)},Io=[{id:"chat",icon:"",title:"Generate Fire Replies",desc:"Paste a boring chat or upload a screenshot. We'll write the perfect response to keep the convo alive.",color:"from-rose-500 to-orange-500"},{id:"bio",icon:"",title:"Craft the Perfect Bio",desc:"Stand out instantly. Describe your vibe, hobbies, or job, and we'll generate a magnetic profile bio.",color:"from-purple-500 to-indigo-500"},{id:"saved",icon:"",title:"Save Your Gems",desc:"Found a line that hits different? Save it to your collection so you never lose your best rizz.",color:"from-blue-500 to-cyan-500"},{id:"credits",icon:"",title:"Daily Credits",desc:"You get 5 free credits every day. Want more? Watch an ad or upgrade to Pro for unlimited power.",color:"from-yellow-400 to-amber-600"}],UR=({onComplete:t})=>{const[e,r]=O.useState(0),[n,i]=O.useState(!1),s=()=>{Q.haptic("light"),e<Io.length-1?r(l=>l+1):o()},o=()=>{Q.haptic("medium"),i(!0),setTimeout(t,500)},a=Io[e];return b.jsxs("div",{className:`fixed inset-0 z-[200] bg-black flex flex-col items-center justify-center p-6 transition-opacity duration-500 ${n?"opacity-0 pointer-events-none":"opacity-100"}`,children:[b.jsx("div",{className:`absolute top-1/4 left-1/4 w-64 h-64 rounded-full blur-[100px] opacity-20 bg-gradient-to-br ${a.color} transition-colors duration-700`}),b.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-black via-black/90 to-transparent z-0"}),b.jsx("div",{className:"absolute top-safe-top right-6 z-20 mt-4",children:b.jsx("button",{onClick:o,className:"text-white/40 text-sm font-bold uppercase tracking-wider hover:text-white transition-colors",children:"Skip"})}),b.jsxs("div",{className:"relative z-10 w-full max-w-md flex flex-col items-center text-center",children:[b.jsxs("div",{className:"mb-8 relative group",children:[b.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${a.color} blur-2xl opacity-20 group-hover:opacity-40 transition-opacity duration-500 rounded-full`}),b.jsx("div",{className:"relative text-7xl md:text-8xl animate-float select-none",children:a.icon})]}),b.jsxs("div",{className:"min-h-[160px] flex flex-col items-center justify-start animate-fade-in-up",children:[b.jsx("h2",{className:"text-3xl font-black text-white mb-4 tracking-tight leading-tight",children:a.title}),b.jsx("p",{className:"text-white/60 text-lg leading-relaxed max-w-xs",children:a.desc})]},e),b.jsx("div",{className:"flex gap-2 mb-10 mt-4",children:Io.map((l,c)=>b.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${c===e?"w-8 bg-white":"w-1.5 bg-white/20"}`},c))}),b.jsx("button",{onClick:s,className:"w-full py-4 rounded-2xl font-bold text-lg text-white rizz-gradient shadow-lg hover:shadow-rose-500/20 active:scale-[0.98] transition-all",children:e===Io.length-1?"Let's Go ":"Next"})]})]})},$R=O.lazy(()=>mi(()=>import("./PremiumModal-BV0Ekt3-.js"),[],import.meta.url)),MR=O.lazy(()=>mi(()=>import("./SavedModal-eX1qJJs7.js"),[],import.meta.url)),BR=O.lazy(()=>mi(()=>import("./InfoPages-9w7O8tNs.js"),[],import.meta.url)),sc=5,Po=5,oc=15,FR="ca-app-pub-3940256099942544/1712485313",Cp="ca-app-pub-3940256099942544/2934735716",Dp="ca-app-pub-7381421031784616/7234804095",zR="1234567890",ac=["Analyzing context...","Reading between the lines...","Scanning for red flags...","Consulting the Rizz God...","Drafting fire replies...","Polishing the charm...","Cooking..."],VR=[{label:"Flirty",isPro:!1},{label:"Funny",isPro:!1},{label:"Savage",isPro:!0},{label:"Wholesome",isPro:!1},{label:"Nonchalant",isPro:!1},{label:"Intellectual",isPro:!0},{label:"Romantic",isPro:!0}],WR=[{label:"Confident",isPro:!1},{label:"Chill",isPro:!1},{label:"Funny",isPro:!1},{label:"Mysterious",isPro:!0},{label:"Adventurous",isPro:!1},{label:"Direct",isPro:!0},{label:"Witty",isPro:!0}],HR=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Date.now().toString(36)+Math.random().toString(36).substring(2),GR=({isAppReady:t,onComplete:e})=>{const[r,n]=O.useState(0),[i,s]=O.useState(!1);return O.useEffect(()=>{let c=0;const u=setInterval(()=>{c++;const d=Math.min(100,c/110*100);n(d),c>=110&&clearInterval(u)},20);return()=>clearInterval(u)},[]),O.useEffect(()=>{r>=100&&t&&!i&&(s(!0),setTimeout(()=>{e()},800))},[r,t,i,e]),b.jsxs("div",{className:`fixed inset-0 z-[9999] bg-black flex flex-col items-center justify-center overflow-hidden transition-all duration-800 ${i?"opacity-0 scale-105 pointer-events-none":"opacity-100"}`,children:[b.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-rose-900/20 rounded-full blur-[100px] animate-pulse-glow"}),b.jsx("div",{className:"absolute top-1/4 left-1/4 w-[300px] h-[300px] bg-amber-900/10 rounded-full blur-[80px] animate-float"}),b.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center w-full max-w-4xl px-4",children:[b.jsxs("div",{className:"relative mb-12",children:[b.jsx("h1",{className:"text-6xl md:text-8xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-rose-200 via-amber-100 to-rose-200 animate-text-shimmer drop-shadow-2xl",children:"Rizz Master"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent blur-xl opacity-50 animate-text-shimmer",style:{backgroundSize:"200% 100%"}})]}),b.jsx("div",{className:"w-64 md:w-80 h-[2px] bg-white/10 rounded-full overflow-hidden relative",children:b.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-rose-500 via-amber-400 to-rose-500 shadow-[0_0_15px_rgba(251,191,36,0.5)] transition-all duration-75 ease-out",style:{width:`${r}%`}})}),b.jsx("div",{className:"mt-4 h-6 overflow-hidden",children:b.jsx("p",{className:"text-[10px] md:text-xs font-bold tracking-[0.5em] text-white/40 uppercase animate-fade-in-up",children:r<30?"ANALYZING...":r<70?"COOKING...":t?"READY.":"AUTHENTICATING..."})})]})]})},KR=Hp.memo(()=>b.jsx(O.Suspense,{fallback:b.jsx("div",{className:"fixed inset-0 bg-black z-50"}),children:b.jsx(JR,{})})),JR=()=>{const{showToast:t}=m0(),[e,r]=O.useState(null),[n,i]=O.useState(null),[s,o]=O.useState(!1),a=O.useRef(null),l=O.useRef(null),c=O.useRef(null),[u,d]=O.useState(!0),[h,f]=O.useState(!1),[m,y]=O.useState("HOME"),[v,w]=O.useState(He.CHAT),[p,g]=O.useState(""),[_,S]=O.useState(null),[R,x]=O.useState(null),[T,I]=O.useState(!1),[N,M]=O.useState("Cooking..."),[B,Se]=O.useState(null),[kt,ze]=O.useState(null),[pr,Xt]=O.useState(!1),[C,H]=O.useState(0),[L,J]=O.useState(!1),[Z,De]=O.useState(!1),[oe,se]=O.useState([]),[Ze,yt]=O.useState(!1),[ol,al]=O.useState(!1),ll=O.useRef({currentView:m,showPremiumModal:L,showSavedModal:Z});O.useEffect(()=>{ll.current={currentView:m,showPremiumModal:L,showSavedModal:Z}},[m,L,Z]),O.useEffect(()=>{if(!X.isNativePlatform())return;let k=!1;ji.hide().catch(()=>{});const j=()=>{requestAnimationFrame(()=>{const te=window.scrollY>50;te&&!k?(k=!0,ji.show().catch(()=>{}),ji.setStyle({style:xu.Dark}).catch(()=>{}),ji.setOverlaysWebView({overlay:!0}).catch(()=>{})):!te&&k&&(k=!1,ji.hide().catch(()=>{}))})};return window.addEventListener("scroll",j,{passive:!0}),()=>window.removeEventListener("scroll",j)},[]),O.useEffect(()=>{a.current=n},[n]),O.useEffect(()=>{localStorage.getItem("rizz_onboarding_completed")||f(!0)},[]);const L0=()=>{localStorage.setItem("rizz_onboarding_completed","true"),f(!1)};O.useEffect(()=>{let k,j=0;const F=30*60*1e3;(()=>{if(X.isNativePlatform()&&e){if(!n)return;if(n.is_premium)Pt.hideBanner();else{const Ee=X.getPlatform()==="ios"?Cp:Dp;k=setTimeout(()=>Pt.showBanner(Ee),2e3)}}})();let q;return X.isNativePlatform()&&Li.addListener("appStateChange",({isActive:Ee})=>{if(Ee){n&&!n.is_premium&&Pt.hideBanner().then(()=>{const wt=X.getPlatform()==="ios"?Cp:Dp;k=setTimeout(()=>Pt.showBanner(wt),1e3)});const Zt=Date.now();if(n&&!n.is_premium&&Zt-j>F){const wt=X.getPlatform()==="ios"?dh:hh;Pt.showInterstitial(wt).then(zt=>{zt&&(j=Zt,console.log("App Open Ad (via Interstitial ID) Shown"))})}}}).then(Ee=>q=Ee),()=>{k&&clearTimeout(k),q&&q.remove()}},[n==null?void 0:n.is_premium,e]);const bi=O.useCallback(async()=>{const k=a.current;if(!k)return;Q.haptic("success");const j={...k,is_premium:!0};i(j),X.isNativePlatform()&&Pt.hideBanner(),ll.current.showPremiumModal&&window.history.back(),t("Welcome to the Elite Club! ","success"),re&&k.id!=="guest"?await re.from("profiles").update({is_premium:!0}).eq("id",k.id):localStorage.setItem("guest_profile",JSON.stringify(j))},[t]);O.useEffect(()=>{X.isNativePlatform()&&(Ru.initialize({clientId:"YOUR_WEB_CLIENT_ID_PLACEHOLDER",scopes:["profile","email"],grantOfflineAccess:!1}),Pt.initialize(),Np.initialize(()=>{bi()},k=>{t(k,"error")}))},[bi,t]),O.useEffect(()=>{const k=j=>{const F=j.state||{};y(F.view||"HOME"),J(!!F.premium),De(!!F.saved)};return window.history.state||window.history.replaceState({view:"HOME"},""),window.addEventListener("popstate",k),()=>window.removeEventListener("popstate",k)},[]),O.useEffect(()=>X.isNativePlatform()?((async()=>{await Li.removeAllListeners(),Li.addListener("backButton",({canGoBack:j})=>{const{currentView:F,showPremiumModal:te,showSavedModal:q}=ll.current;if(te||q){window.history.back();return}if(F!=="HOME"){window.history.back();return}window.confirm("Do you want to exit Rizz Master?")&&Li.exitApp()})})(),()=>{Li.removeAllListeners()}):void 0,[]);const j0=O.useCallback(k=>{k!==m&&(window.history.pushState({view:k},""),y(k),Q.haptic("light"))},[m]),Ks=O.useCallback(()=>{Q.haptic("light"),window.history.back()},[]),Si=O.useCallback(()=>{window.history.pushState({view:m,premium:!0},""),J(!0),Q.haptic("medium")},[m]),U0=O.useCallback(()=>{window.history.pushState({view:m,saved:!0},""),De(!0),Q.haptic("light")},[m]);O.useEffect(()=>{if(!re){o(!0);return}re.auth.getSession().then(({data:{session:j}})=>{r(j),j?cl(j.user.id,j.user.email).finally(()=>o(!0)):o(!0)});const{data:{subscription:k}}=re.auth.onAuthStateChange((j,F)=>{r(F),F?cl(F.user.id,F.user.email):(i(null),se([]),X.isNativePlatform()&&Pt.hideBanner())});return()=>k.unsubscribe()},[]),O.useEffect(()=>{if(typeof BroadcastChannel>"u")return;const k=new BroadcastChannel("rizz_session_sync");return c.current=k,k.postMessage({type:"NEW_SESSION_STARTED"}),k.onmessage=j=>{j.data.type==="NEW_SESSION_STARTED"&&yt(!0)},()=>{k.close(),c.current=null}},[]),O.useEffect(()=>{let k;if(T){let j=0;M(ac[0]),k=setInterval(()=>{j=(j+1)%ac.length,M(ac[j])},1500)}return()=>clearInterval(k)},[T]);const $0=O.useCallback(()=>{var k;yt(!1),(k=c.current)==null||k.postMessage({type:"NEW_SESSION_STARTED"})},[]),cl=async(k,j)=>{var F;if(!re||k==="guest"){const te=localStorage.getItem("guest_profile"),q=localStorage.getItem("guest_saved_items");if(te)i(JSON.parse(te));else{const Ee={id:"guest",email:"guest@rizzmaster.ai",credits:sc,is_premium:!1,last_daily_reset:new Date().toISOString().split("T")[0]};i(Ee),localStorage.setItem("guest_profile",JSON.stringify(Ee))}se(q?JSON.parse(q):[]);return}try{const te=re.from("profiles").select("*").eq("id",k).single(),q=re.from("saved_items").select("*").eq("user_id",k).order("created_at",{ascending:!1}),[Ee,Zt]=await Promise.all([te,q]);let wt=Ee.data;const zt=Zt.data;if(zt&&se(zt),((F=Ee.error)==null?void 0:F.code)==="PGRST116"){const{data:mn}=await re.from("profiles").insert([{id:k,email:j,credits:sc,is_premium:!1,last_daily_reset:new Date().toISOString().split("T")[0]}]).select().single();mn&&(wt=mn)}else if(wt){const mn=new Date().toISOString().split("T")[0];if(wt.last_daily_reset!==mn){const{data:ph}=await re.from("profiles").update({credits:sc,last_daily_reset:mn}).eq("id",k).select().single();ph&&(wt=ph)}}wt&&i(wt),zt&&se(zt)}catch(te){console.error("Error loading user data",te)}},M0=O.useCallback(async()=>{if(window.confirm("Are you sure you want to log out of Rizz Master?")){Q.haptic("medium");try{if(re&&await re.auth.signOut(),X.isNativePlatform()){try{await Ru.signOut()}catch(k){console.warn("Native Logout err",k)}Pt.hideBanner()}}catch(k){console.error("Logout failed:",k)}finally{r(null),i(null),se([]),Se(null),g(""),S(null),ze(null),x(null),y("HOME"),J(!1),De(!1),t("Successfully logged out ","success"),window.history.replaceState({view:"HOME"},"","/")}}},[t]),B0=O.useCallback(()=>{Q.haptic("light");const k={id:"guest",email:"guest@rizzmaster.ai"};r({user:k}),cl(k.id)},[]),pn=O.useCallback(async k=>{const j=a.current;if(!j)return;const F={...j,credits:k};i(F),re&&j.id!=="guest"?await re.from("profiles").update({credits:k}).eq("id",j.id):localStorage.setItem("guest_profile",JSON.stringify(F))},[]),F0=O.useCallback(async()=>{a.current&&(Q.haptic("medium"),X.isNativePlatform()?Np.restore():setTimeout(()=>bi(),1500))},[bi]),ul=O.useCallback(async(k,j)=>{const F=a.current;if(!F)return;Q.haptic("light");const te=oe.find(q=>q.content===k);if(te){const q=oe.filter(Ee=>Ee.id!==te.id);se(q),t("Removed from saved","info"),re&&F.id!=="guest"?await re.from("saved_items").delete().eq("id",te.id):localStorage.setItem("guest_saved_items",JSON.stringify(q))}else{const q={id:HR(),user_id:F.id,content:k,type:j,created_at:new Date().toISOString()},Ee=[q,...oe];if(se(Ee),t("Saved to your gems","success"),re&&F.id!=="guest"){const{data:Zt}=await re.from("saved_items").insert([{user_id:F.id,content:k,type:j}]).select().single();Zt&&se(wt=>wt.map(zt=>zt.id===q.id?{...zt,id:Zt.id}:zt))}else localStorage.setItem("guest_saved_items",JSON.stringify(Ee))}},[oe,t]),z0=O.useCallback(async k=>{var F;Q.haptic("medium");const j=oe.filter(te=>te.id!==k);se(j),t("Item deleted","info"),re&&((F=a.current)==null?void 0:F.id)!=="guest"?await re.from("saved_items").delete().eq("id",k):localStorage.setItem("guest_saved_items",JSON.stringify(j))},[oe,t]),V0=O.useCallback(async()=>{var j;if(Q.haptic("error"),!window.confirm("Are you sure? This cannot be undone. Your account and data will be permanently deleted."))return;const k=a.current;if(k){if(!re||k.id==="guest"){localStorage.removeItem("guest_profile"),localStorage.removeItem("guest_saved_items"),i(null),r(null),se([]),Se(null),y("HOME"),t("Guest account deleted","info"),window.history.replaceState({view:"HOME"},"","/");return}I(!0);try{const{error:F}=await re.rpc("delete_user");if(F){if(console.error("RPC Error:",F),F.code==="42883"||(j=F.message)!=null&&j.includes("does not exist")){alert(`CRITICAL ERROR: The database function 'delete_user' is missing.

You must run the SQL script in your Supabase SQL Editor to enable account deletion.`),I(!1);return}throw new Error(F.message)}await re.auth.signOut(),r(null),i(null),se([]),Se(null),y("HOME"),t("Account permanently deleted","success"),window.history.replaceState({view:"HOME"},"","/")}catch(F){console.error("Delete Account Critical Error:",F),t(F.message||"Failed to delete account.","error")}finally{I(!1)}}},[t]),dl=O.useCallback((k,j)=>{ul(k,j)},[ul]),Ei=O.useCallback(async k=>{Q.haptic("light");const j=await Q.share("Rizz Master Reply",k);j==="COPIED"?t("Link copied to clipboard!","success"):j==="FAILED"&&t("Could not share content.","error")},[t]),hl=O.useCallback(()=>{Q.haptic("medium"),t("Report submitted. We will review this.","info")},[t]),W0=k=>{var F;const j=(F=k.target.files)==null?void 0:F[0];if(j){if(j.size>5*1024*1024){Q.haptic("error"),t("Image too large. Max 5MB.","error");return}Q.haptic("light");const te=new FileReader;te.onloadend=()=>{S(te.result),l.current&&(l.current.value="")},te.readAsDataURL(j),kt&&ze(null)}},H0=k=>{var F;const j=(F=a.current)==null?void 0:F.is_premium;if(k.isPro&&!j){Q.haptic("error"),t(`'${k.label}' is a Pro vibe!`,"error"),Si();return}Q.haptic("light"),x(R===k.label?null:k.label)},uh=O.useRef(Date.now()),G0=2*60*1e3,K0=O.useRef(Date.now()),dh="ca-app-pub-3940256099942544/4411468910",hh="ca-app-pub-7381421031784616/5183026259",J0="ca-app-pub-7381421031784616/6580197977",q0=3*60*1e3,Y0=async()=>{const k=a.current;if(!k)return;if(v===He.CHAT&&!p.trim()&&!_){Q.haptic("error"),ze("Give me some context! Paste the chat or upload a screenshot.");return}if(v===He.BIO&&!p.trim()){Q.haptic("error"),ze("I can't write a bio for a ghost! Tell me about your hobbies, job, or vibes.");return}ze(null),Q.haptic("medium");const j=v===He.CHAT&&_?2:1;if(!k.is_premium&&(k.credits||0)<j){(k.credits||0)>0&&t(`Need ${j} credits.`,"error"),Si();return}I(!0);const F=async()=>{if(!k.is_premium&&X.isNativePlatform()){const q=Date.now();if(q-K0.current<G0){console.log("Skipping Interstitial: In Launch Grace Period");return}if(q-uh.current>q0){console.log("Showing Interstitial Ad...");const Ee=X.getPlatform()==="ios"?dh:hh;try{await Pt.showInterstitial(Ee),uh.current=Date.now()}catch(Zt){console.warn("Interstitial failed to show:",Zt)}}}},te=k.credits||0;try{k.is_premium||pn(te-j);let q;v===He.CHAT?q=await zb(p,_||void 0,R||void 0):q=await Vb(p,R||void 0),"potentialStatus"in q&&(q.potentialStatus==="Error"||q.potentialStatus==="Blocked")?(k.is_premium||pn(te),q.potentialStatus==="Blocked"?t("Request blocked by Safety Policy.","error"):t("Service unavailable. Credits refunded.","error"),Se(q)):"analysis"in q&&(q.analysis==="System Error"||q.analysis==="Safety Policy Violation")?(k.is_premium||pn(te),t(q.analysis,"error"),Se(q)):(Se(q),Q.haptic("success"),setTimeout(()=>F(),3e3))}catch(q){console.error(q),t("The wingman tripped! Try again.","error"),k.is_premium||pn(te)}finally{I(!1)}},Q0=async()=>{var j;if(Q.haptic("medium"),Ks(),X.isNativePlatform()){al(!0);try{const F=X.getPlatform()==="ios"?FR:J0,te=await Pt.showRewardVideo(F);al(!1),te?(pn((((j=a.current)==null?void 0:j.credits)||0)+Po),Q.haptic("success"),t(`+${Po} Credits Added!`,"success")):t("Ad was canceled or failed.","info");return}catch(F){console.warn("Native Ad failed, fallback to web.",F),al(!1)}}Xt(!0),H(oc);const k=setInterval(()=>{H(F=>F<=1?(clearInterval(k),0):F-1)},1e3);setTimeout(()=>{Xt(!1),a.current&&(pn((a.current.credits||0)+Po),Q.haptic("success"),t(`+${Po} Credits Added!`,"success"))},oc*1e3)},Ri=O.useCallback(k=>oe.some(j=>j.content===k),[oe]),fh=O.useCallback(()=>{g(""),S(null),Se(null),ze(null),x(null),Q.haptic("light")},[]);return b.jsxs("div",{className:"relative min-h-screen bg-black overflow-x-hidden",children:[u&&b.jsx(GR,{isAppReady:s,onComplete:()=>d(!1)}),!u&&h&&b.jsx(UR,{onComplete:L0}),b.jsx("div",{className:u?"pointer-events-none":"",children:Ze?b.jsx("div",{className:"min-h-[100dvh] flex flex-col items-center justify-center p-4 relative overflow-hidden bg-black safe-top safe-bottom",children:b.jsxs("div",{className:"glass max-w-md w-full p-8 rounded-3xl border border-white/10 text-center relative z-10 shadow-2xl",children:[b.jsx("h1",{className:"text-2xl font-bold mb-4 text-white",children:"Session Paused"}),b.jsx("button",{onClick:()=>{$0(),Q.haptic("medium")},className:"w-full rizz-gradient py-3.5 rounded-xl font-bold text-white",children:"Use Here Instead"})]})}):e?n?m!=="HOME"?b.jsx("div",{className:"safe-top safe-bottom",children:b.jsx(O.Suspense,{fallback:b.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center text-white",children:"Loading..."}),children:b.jsx(BR,{page:m,onBack:Ks,onDeleteAccount:V0})})}):b.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6 md:py-12 pb-40 relative min-h-[100dvh] flex flex-col animate-fade-in safe-top",children:[b.jsx("div",{className:"fixed inset-0 z-[-1] pointer-events-none overflow-hidden bg-black"}),b.jsxs(O.Suspense,{fallback:null,children:[L&&b.jsx($R,{onClose:Ks,onUpgrade:bi,onRestore:F0}),b.jsx(MR,{isOpen:Z,onClose:Ks,savedItems:oe,onDelete:z0,onShare:Ei})]}),ol&&b.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 flex flex-col items-center justify-center p-8 backdrop-blur-sm",children:b.jsxs("div",{className:"bg-zinc-900 border border-white/10 rounded-2xl p-6 flex flex-col items-center",children:[b.jsxs("svg",{className:"animate-spin h-8 w-8 text-rose-500 mb-4",viewBox:"0 0 24 24",children:[b.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),b.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),b.jsx("p",{className:"text-white font-bold",children:"Loading Ad..."})]})}),pr&&b.jsx("div",{className:"fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center p-8 safe-top safe-bottom",children:b.jsxs("div",{className:"w-full max-w-md bg-zinc-900 rounded-3xl p-8 text-center border border-white/10 relative overflow-hidden flex flex-col h-[60vh] justify-center",children:[b.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-white/20",children:b.jsx("div",{className:"h-full bg-rose-500 transition-all ease-linear w-full",style:{width:"0%",transitionDuration:`${oc}s`}})}),b.jsxs("div",{className:"text-4xl font-black text-rose-500 mb-4",children:[C,"s"]}),b.jsx("p",{className:"text-white/60 mb-6",children:"Watching Rewarded Ad..."})]})}),b.jsxs("nav",{className:"flex justify-between items-center mb-8 md:mb-12",children:[b.jsxs("button",{onClick:M0,className:"px-3 py-1.5 text-xs md:text-sm text-white/40 hover:text-white hover:bg-white/5 rounded-lg transition-all uppercase tracking-widest font-medium border border-transparent hover:border-white/10 flex items-center gap-2 active:scale-95",children:[b.jsx("span",{className:"text-lg",children:""})," ",b.jsx("span",{children:"Logout"})]}),b.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[b.jsxs("button",{onClick:U0,className:"p-2 md:px-4 md:py-2 bg-white/5 hover:bg-white/10 rounded-full flex items-center gap-1.5 transition-all border border-white/5 active:scale-95",children:[b.jsx("span",{className:"text-rose-500 text-base md:text-lg",children:""}),b.jsx("span",{className:"hidden md:inline text-xs font-bold text-white",children:"Saved"})]}),!(n!=null&&n.is_premium)&&b.jsxs("button",{onClick:Si,className:"hidden md:flex px-4 py-2 bg-gradient-to-r from-yellow-600 to-yellow-400 text-black text-xs font-bold rounded-full items-center gap-1 hover:brightness-110 transition-all active:scale-95",children:[b.jsx("span",{children:""})," Go Premium"]}),b.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 md:px-4 md:py-2 rounded-full border backdrop-blur-md ${n!=null&&n.is_premium?"bg-yellow-500/10 border-yellow-500/30":"bg-white/5 border-white/10"}`,children:[b.jsx("span",{className:(n!=null&&n.is_premium,"text-yellow-400 text-lg"),children:n!=null&&n.is_premium?"":""}),b.jsx("span",{className:`font-bold text-xs md:text-sm ${n!=null&&n.is_premium?"text-yellow-400":"text-white"}`,children:n!=null&&n.is_premium?"Unlimited":`${n==null?void 0:n.credits} Credits`})]})]})]}),b.jsxs("header",{className:"text-center mb-8 md:mb-12",children:[b.jsxs("div",{className:"inline-block relative",children:[b.jsx("h1",{className:"text-5xl md:text-7xl font-black mb-2 tracking-tighter bg-gradient-to-r from-rose-400 via-amber-200 to-rose-400 bg-clip-text text-transparent pb-2 animate-text-shimmer",children:"Rizz Master"}),(n==null?void 0:n.is_premium)&&b.jsx("div",{className:"absolute -top-4 -right-6 md:-right-8 rotate-12 bg-yellow-500 text-black font-bold text-[10px] md:text-xs px-2 py-1 rounded shadow-lg",children:"PRO"})]}),b.jsx("p",{className:"text-white/60 text-sm md:text-xl font-light max-w-md mx-auto leading-relaxed",children:"Never send a boring text again."})]}),b.jsxs("div",{className:"flex p-1 bg-white/5 rounded-full mb-8 relative border border-white/10 max-w-md mx-auto w-full select-none",children:[b.jsx("button",{onClick:()=>{w(He.CHAT),fh()},className:`flex-1 py-3 rounded-full font-medium text-sm md:text-base transition-all duration-300 relative z-10 ${v===He.CHAT?"text-white shadow-lg":"text-white/50 hover:text-white/80"}`,children:"Chat Reply"}),b.jsx("button",{onClick:()=>{w(He.BIO),fh()},className:`flex-1 py-3 rounded-full font-medium text-sm md:text-base transition-all duration-300 relative z-10 ${v===He.BIO?"text-white shadow-lg":"text-white/50 hover:text-white/80"}`,children:"Profile Bio"}),b.jsx("div",{className:`absolute top-1 bottom-1 w-[calc(50%-4px)] rounded-full rizz-gradient transition-all duration-300 ${v===He.CHAT?"left-1":"left-[calc(50%+4px)]"}`})]}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8 items-start",children:[b.jsxs("section",{className:"glass rounded-3xl p-5 md:p-6 border border-white/10 lg:sticky lg:top-8 lg:max-h-[calc(100vh-6rem)] lg:overflow-y-auto custom-scrollbar",children:[b.jsxs("div",{className:"mb-4",children:[b.jsxs("div",{className:"flex justify-between items-center mb-2",children:[b.jsx("label",{className:"block text-xs font-bold text-white/50 uppercase tracking-widest",children:v===He.CHAT?"The Context":"About You"}),p.length>0&&b.jsx("button",{onClick:()=>g(""),className:"text-xs text-white/30 hover:text-white",children:"Clear"})]}),b.jsx("textarea",{value:p,onChange:k=>{g(k.target.value),kt&&ze(null)},placeholder:v===He.CHAT?"Paste chat. Get Rizz.":"Hobbies, job, vibes...",className:"w-full h-32 md:h-40 bg-black/40 border border-white/10 rounded-2xl p-4 text-sm md:text-base focus:ring-2 focus:ring-rose-500/50 focus:outline-none resize-none transition-all placeholder:text-white/20",style:{fontSize:"16px"}})]}),b.jsxs("div",{className:"mb-6",children:[b.jsx("label",{className:"block text-xs font-bold text-white/50 uppercase tracking-widest mb-3",children:"Select Vibe (Optional)"}),b.jsx("div",{className:"flex flex-wrap gap-2",children:(v===He.CHAT?VR:WR).map(k=>b.jsxs("button",{onClick:()=>H0(k),className:`px-3 py-1.5 rounded-full text-xs font-bold border transition-all active:scale-95 flex items-center gap-1.5 ${R===k.label?"bg-rose-500/20 border-rose-500 text-rose-300":k.isPro&&!(n!=null&&n.is_premium)?"bg-white/5 border-yellow-500/30 text-white/40 hover:bg-white/10":"bg-white/5 border-white/10 text-white/60 hover:bg-white/10 hover:text-white"}`,children:[k.label,k.isPro&&!(n!=null&&n.is_premium)&&b.jsx("span",{className:"text-[10px]",children:""}),k.isPro&&(n==null?void 0:n.is_premium)&&R!==k.label&&b.jsx("span",{className:"text-[10px] text-yellow-500",children:""})]},k.label))})]}),v===He.CHAT&&b.jsx("div",{className:"mb-4 md:mb-6",children:b.jsxs("div",{onClick:()=>{var k;return(k=l.current)==null?void 0:k.click()},className:`group border-2 border-dashed border-white/10 rounded-2xl transition-all cursor-pointer hover:border-rose-500/50 hover:bg-white/5 active:scale-[0.99] ${_?"p-2":"p-6 md:p-8"}`,children:[_?b.jsxs("div",{className:"relative w-full",children:[b.jsx("img",{src:_,alt:"Preview",className:"w-full max-h-48 object-contain rounded-lg mx-auto"}),b.jsx("button",{onClick:k=>{k.stopPropagation(),S(null)},className:"absolute top-2 right-2 bg-black/80 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm border border-white/20",children:""})]}):b.jsxs("div",{className:"flex flex-row items-center justify-center gap-3 opacity-50",children:[b.jsx("span",{className:"text-2xl",children:""}),b.jsx("span",{className:"text-sm font-medium",children:"Add Screenshot"})]}),b.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:l,onChange:W0})]})}),kt&&b.jsxs("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/50 rounded-xl flex items-center justify-center gap-2 animate-pulse",children:[b.jsx("span",{className:"text-lg",children:""}),b.jsx("p",{className:"text-sm text-red-200 font-medium",children:kt})]}),n!=null&&n.is_premium||((n==null?void 0:n.credits)||0)>0?b.jsx("button",{onClick:Y0,disabled:T,className:`w-full py-3.5 md:py-4 rounded-2xl font-bold text-base md:text-lg shadow-xl hover:opacity-90 active:scale-[0.98] transition-all disabled:opacity-30 disabled:cursor-not-allowed ${n!=null&&n.is_premium?"bg-gradient-to-r from-yellow-500 to-amber-600 text-black":"rizz-gradient text-white"}`,children:T?b.jsxs("span",{className:"flex items-center justify-center gap-2 animate-pulse",children:[b.jsxs("svg",{className:`animate-spin h-5 w-5 ${n!=null&&n.is_premium?"text-black":"text-white"}`,viewBox:"0 0 24 24",children:[b.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),b.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),N]}):n!=null&&n.is_premium?"Get Rizz (VIP)":`Get Rizz (${v===He.CHAT&&_?2:1} )`}):b.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[b.jsx("button",{onClick:Q0,disabled:ol,className:"bg-white/10 border border-white/10 py-3.5 md:py-4 rounded-2xl font-bold text-sm md:text-base hover:bg-white/20 active:scale-[0.98] transition-all flex flex-col items-center justify-center",children:ol?b.jsx("span",{className:"text-white/50 text-xs",children:"Loading..."}):b.jsxs(b.Fragment,{children:[b.jsx("span",{className:"text-xl mb-1",children:""})," ",b.jsx("span",{children:"Watch Ad (+5)"})]})}),b.jsxs("button",{onClick:Si,className:"bg-gradient-to-r from-yellow-500 to-amber-600 text-black py-3.5 md:py-4 rounded-2xl font-bold text-sm md:text-base shadow-xl hover:brightness-110 active:scale-[0.98] transition-all flex flex-col items-center justify-center animate-pulse",children:[b.jsx("span",{className:"text-xl mb-1",children:""})," ",b.jsx("span",{children:"Go Unlimited"})]})]}),!(n!=null&&n.is_premium)&&b.jsxs("p",{className:"text-center text-[10px] md:text-xs text-white/30 mt-3 md:mt-4",children:[n==null?void 0:n.credits," daily credits remaining. ",b.jsx("span",{className:"text-yellow-500/80 cursor-pointer hover:underline",onClick:Si,children:"Upgrade."})]})]}),b.jsxs("section",{className:"flex flex-col gap-4 md:gap-6 min-h-[300px]",children:[!B&&!T&&b.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-white/20 py-12 px-4 text-center border-2 border-dashed border-white/5 rounded-3xl bg-white/[0.02] select-none",children:[b.jsx("span",{className:"text-5xl md:text-6xl mb-4 grayscale opacity-50",children:""}),b.jsx("p",{className:"text-sm md:text-xl font-medium max-w-[200px] md:max-w-none mx-auto",children:"Results will appear here."})]}),B&&"tease"in B&&b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"glass rounded-3xl p-5 md:p-6 border border-white/10 animate-fade-in-up",children:[b.jsxs("div",{className:"flex justify-between items-center mb-3",children:[b.jsx("h3",{className:"text-xs font-bold uppercase tracking-widest text-white/40",children:"Analysis"}),b.jsxs("span",{className:"text-2xl md:text-3xl font-black text-white",children:[B.loveScore,"%"]})]}),b.jsx("div",{className:"mb-4",children:b.jsx("div",{className:"text-xl md:text-2xl font-black text-rose-500 uppercase italic leading-none",children:B.potentialStatus})}),b.jsx("div",{className:"relative h-3 md:h-4 bg-black/40 rounded-full overflow-hidden border border-white/5",children:b.jsx("div",{className:"absolute top-0 left-0 h-full rizz-gradient transition-all duration-1000 ease-out",style:{width:`${B.loveScore}%`}})}),B.analysis&&b.jsx("p",{className:"mt-4 text-xs md:text-sm text-white/60 leading-relaxed border-t border-white/5 pt-3",children:B.analysis})]}),b.jsxs("div",{className:"grid gap-3 md:gap-4 pb-12",children:[b.jsx(rc,{label:"Tease",content:B.tease,icon:"",color:"from-purple-500 to-indigo-500",isSaved:Ri(B.tease),onSave:()=>dl(B.tease,"tease"),onShare:()=>Ei(B.tease),onReport:hl,delay:.1}),b.jsx(rc,{label:"Smooth",content:B.smooth,icon:"",color:"from-blue-500 to-cyan-500",isSaved:Ri(B.smooth),onSave:()=>dl(B.smooth,"smooth"),onShare:()=>Ei(B.smooth),onReport:hl,delay:.2}),b.jsx(rc,{label:"Chaotic",content:B.chaotic,icon:"",color:"from-orange-500 to-red-500",isSaved:Ri(B.chaotic),onSave:()=>dl(B.chaotic,"chaotic"),onShare:()=>Ei(B.chaotic),onReport:hl,delay:.3})]})]}),B&&"bio"in B&&b.jsxs("div",{className:"glass rounded-3xl p-6 md:p-8 border border-white/10 animate-fade-in-up pb-12",children:[b.jsxs("div",{className:"flex items-center gap-2 mb-4 md:mb-6",children:[b.jsx("span",{className:"text-2xl",children:""}),b.jsx("h3",{className:"text-xs md:text-sm font-semibold uppercase tracking-widest text-white/60",children:"Bio Result"}),b.jsxs("div",{className:"ml-auto flex gap-2",children:[b.jsx("button",{onClick:()=>{Q.copyToClipboard(B.bio),t("Bio copied!","success"),Q.haptic("light")},className:"p-2 rounded-full hover:bg-white/10 transition-all text-white/50 hover:text-white",children:b.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})})}),b.jsx("button",{onClick:()=>Ei(B.bio),className:"p-2 rounded-full hover:bg-white/10 transition-all text-white/50 hover:text-white",children:b.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),b.jsx("button",{onClick:()=>ul(B.bio,"bio"),className:`p-2 rounded-full hover:bg-white/10 transition-all ${Ri(B.bio)?"text-rose-500":"text-white/50 hover:text-rose-400"}`,children:b.jsx("svg",{className:"w-5 h-5",fill:Ri(B.bio)?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})})]})]}),b.jsx("p",{className:"text-lg md:text-xl leading-relaxed font-medium mb-6 md:mb-8 text-white",children:B.bio}),b.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 mb-4",children:[b.jsx("h4",{className:"text-[10px] uppercase font-bold text-rose-400 mb-1",children:"Why it works"}),b.jsx("p",{className:"text-xs md:text-sm text-white/60",children:B.analysis})]}),b.jsxs("button",{onClick:()=>{Q.copyToClipboard(B.bio),t("Bio copied!","success"),Q.haptic("light")},className:"w-full py-3 border border-white/20 rounded-xl hover:bg-white/5 transition-colors text-sm font-medium flex items-center justify-center gap-2",children:[b.jsx("span",{children:""})," Copy Bio"]})]})]})]}),!(n!=null&&n.is_premium)&&!X.isNativePlatform()&&b.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-40 bg-black/90 backdrop-blur-md border-t border-white/10 pb-[env(safe-area-inset-bottom)] pt-2 animate-slide-up-fade",children:b.jsx("div",{className:"max-w-md mx-auto px-2",children:b.jsx(jR,{dataAdSlot:zR,className:"!my-0 !min-h-[50px] !bg-transparent !border-none"})})}),b.jsx(DR,{className:"mt-12 md:mt-20",onNavigate:j0})]}):b.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-white p-4 bg-black safe-top safe-bottom",children:[b.jsxs("svg",{className:"animate-spin h-8 w-8 text-rose-500 mb-4",viewBox:"0 0 24 24",children:[b.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),b.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),b.jsx("p",{className:"text-white/50 animate-pulse",children:"Loading Profile..."})]}):b.jsx(CR,{onGuestLogin:B0})})]})},qR=()=>b.jsx(Hb,{children:b.jsx(KR,{})}),D0=document.getElementById("root");if(!D0)throw new Error("Could not find root element to mount to");const YR=lc.createRoot(D0);YR.render(b.jsx(Hp.StrictMode,{children:b.jsx(qR,{})}));export{Ip as A,X as C,Np as I,Q as N,C0 as W,b as j,O as r};
